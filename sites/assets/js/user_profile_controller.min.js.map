{"version":3,"file":"user_profile_controller.min.js","sources":["../../../apps/frappe/frappe/desk/page/user_profile/user_profile_controller.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/base_timeline.js"],"sourcesContent":["import BaseTimeline from \"../../../public/js/frappe/form/footer/base_timeline\";\nfrappe.provide('frappe.energy_points');\n\nclass UserProfile {\n\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper);\n\t\tthis.page = frappe.ui.make_app_page({\n\t\t\tparent: wrapper,\n\t\t});\n\t\tthis.sidebar = this.wrapper.find('.layout-side-section');\n\t\tthis.main_section = this.wrapper.find('.layout-main-section');\n\t\tthis.wrapper.bind('show', () => {\n\t\t\tthis.show();\n\t\t});\n\t}\n\n\tshow() {\n\t\tlet route = frappe.get_route();\n\t\tthis.user_id = route[1] || frappe.session.user;\n\n\t\t//validate if user\n\t\tif (route.length > 1) {\n\t\t\tfrappe.dom.freeze(__('Loading user profile') + '...');\n\t\t\tfrappe.db.exists('User', this.user_id).then(exists => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tif (exists) {\n\t\t\t\t\tthis.make_user_profile();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__('User does not exist'));\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.set_route('user-profile', frappe.session.user);\n\t\t}\n\t}\n\n\tmake_user_profile() {\n\t\tthis.user = frappe.user_info(this.user_id);\n\t\tthis.page.set_title(this.user.fullname);\n\t\tthis.setup_user_search();\n\t\tthis.main_section.empty().append(frappe.render_template('user_profile'));\n\t\tthis.energy_points = 0;\n\t\tthis.review_points = 0;\n\t\tthis.rank = 0;\n\t\tthis.month_rank = 0;\n\t\tthis.render_user_details();\n\t\tthis.render_points_and_rank();\n\t\tthis.render_heatmap();\n\t\tthis.render_line_chart();\n\t\tthis.render_percentage_chart('type', __('Type Distribution'));\n\t\tthis.create_percentage_chart_filters();\n\t\tthis.setup_user_activity_timeline();\n\t}\n\n\tsetup_user_search() {\n\t\tthis.$user_search_button = this.page.set_secondary_action(\n\t\t\t__('Change User'),\n\t\t\t() => this.show_user_search_dialog(),\n\t\t\t{ icon: 'change', size: 'sm' }\n\t\t);\n\t}\n\n\tshow_user_search_dialog() {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Change User'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\tfieldname: 'user',\n\t\t\t\t\toptions: 'User',\n\t\t\t\t\tlabel: __('User'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Go'),\n\t\t\tprimary_action: ({ user }) => {\n\t\t\t\tdialog.hide();\n\t\t\t\tthis.user_id = user;\n\t\t\t\tthis.make_user_profile();\n\t\t\t}\n\t\t});\n\t\tdialog.show();\n\t}\n\n\trender_heatmap() {\n\t\tthis.heatmap = new frappe.Chart('.performance-heatmap', {\n\t\t\ttype: 'heatmap',\n\t\t\tcountLabel: __('Energy Points'),\n\t\t\tdata: {},\n\t\t\tdiscreteDomains: 1,\n\t\t\tradius: 3,\n\t\t\theight: 150\n\t\t});\n\t\tthis.update_heatmap_data();\n\t\tthis.create_heatmap_chart_filters();\n\t}\n\n\tupdate_heatmap_data(date_from) {\n\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.get_energy_points_heatmap_data', {\n\t\t\tuser: this.user_id,\n\t\t\tdate: date_from || frappe.datetime.year_start(),\n\t\t}).then((r) => {\n\t\t\tthis.heatmap.update({ dataPoints: r });\n\t\t});\n\t}\n\n\trender_line_chart() {\n\t\tthis.line_chart_filters = [\n\t\t\t['Energy Point Log', 'user', '=', this.user_id, false],\n\t\t\t['Energy Point Log', 'type', '!=', 'Review', false]\n\t\t];\n\t\tthis.line_chart_config = {\n\t\t\ttimespan: 'Last Month',\n\t\t\ttime_interval: 'Daily',\n\t\t\ttype: 'Line',\n\t\t\tvalue_based_on: 'points',\n\t\t\tchart_type: 'Sum',\n\t\t\tdocument_type: 'Energy Point Log',\n\t\t\tname: 'Energy Points',\n\t\t\twidth: 'half',\n\t\t\tbased_on: 'creation'\n\t\t};\n\n\t\tthis.line_chart = new frappe.Chart('.performance-line-chart', {\n\t\t\ttype: 'line',\n\t\t\theight: 200,\n\t\t\tdata: {\n\t\t\t\tlabels: [],\n\t\t\t\tdatasets: [{}]\n\t\t\t},\n\t\t\tcolors: ['purple'],\n\t\t\taxisOptions: {\n\t\t\t\txIsSeries: 1\n\t\t\t},\n\t\t\ttooltipOptions: {}\n\t\t});\n\t\tthis.update_line_chart_data();\n\t\tthis.create_line_chart_filters();\n\t}\n\n\tupdate_line_chart_data() {\n\t\tthis.line_chart_config.filters_json = JSON.stringify(this.line_chart_filters);\n\n\t\tfrappe.xcall('frappe.desk.doctype.dashboard_chart.dashboard_chart.get', {\n\t\t\tchart: this.line_chart_config,\n\t\t\tno_cache: 1,\n\t\t}).then(chart => {\n\t\t\tthis.line_chart.update(chart);\n\t\t});\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\trender_percentage_chart(field, title) {\n\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.get_energy_points_percentage_chart_data', {\n\t\t\tuser: this.user_id,\n\t\t\tfield: field\n\t\t}).then(chart => {\n\t\t\tif (chart.labels.length) {\n\t\t\t\tthis.percentage_chart = new frappe.Chart('.performance-percentage-chart', {\n\t\t\t\t\ttype: 'percentage',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlabels: chart.labels,\n\t\t\t\t\t\tdatasets: chart.datasets\n\t\t\t\t\t},\n\t\t\t\t\ttruncateLegends: 1,\n\t\t\t\t\tbarOptions: {\n\t\t\t\t\t\theight: 11,\n\t\t\t\t\t\tdepth: 1\n\t\t\t\t\t},\n\t\t\t\t\theight: 200,\n\t\t\t\t\tmaxSlices: 8,\n\t\t\t\t\tcolors: ['purple', 'blue', 'cyan', 'teal', 'pink', 'red', 'orange', 'yellow'],\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.wrapper.find('.percentage-chart-container').hide();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_line_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: __('All'),\n\t\t\t\toptions: [\n\t\t\t\t\t{label: __('All'), value: 'All'},\n\t\t\t\t\t{label: __('Auto'), value: 'Auto'},\n\t\t\t\t\t{label: __('Criticism'), value: 'Criticism'},\n\t\t\t\t\t{label: __('Appreciation'), value: 'Appreciation'},\n\t\t\t\t\t{label: __('Revert'), value: 'Revert'}\n\t\t\t\t],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tif (selected_item === 'All') {\n\t\t\t\t\t\tthis.line_chart_filters = [\n\t\t\t\t\t\t\t['Energy Point Log', 'user', '=', this.user_id, false],\n\t\t\t\t\t\t\t['Energy Point Log', 'type', '!=', 'Review', false]\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.line_chart_filters[1] = ['Energy Point Log', 'type', '=', selected_item, false];\n\t\t\t\t\t}\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Last Month'),\n\t\t\t\toptions: [\n\t\t\t\t\t{label: __('Last Week'), value: 'Last Week'},\n\t\t\t\t\t{label: __('Last Month'), value: 'Last Month'},\n\t\t\t\t\t{label: __('Last Quarter'), value: 'Last Quarter'},\n\t\t\t\t\t{label: __('Last Year'), value: 'Last Year'}\n\t\t\t\t],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.line_chart_config.timespan = selected_item;\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Daily'),\n\t\t\t\toptions: [\n\t\t\t\t\t{label: __('Daily'), value: 'Daily'},\n\t\t\t\t\t{label: __('Weekly'), value: 'Weekly'},\n\t\t\t\t\t{label: __('Monthly'), value: 'Monthly'}\n\t\t\t\t],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.line_chart_config.time_interval = selected_item;\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.line-chart-options', 1);\n\t}\n\n\tcreate_percentage_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: __('Type'),\n\t\t\t\toptions: [\n\t\t\t\t\t{label: __('Type'), value: 'Type'},\n\t\t\t\t\t{label: __('Reference Doctype'), value: 'Reference Doctype'},\n\t\t\t\t\t{label: __('Rule'), value: 'Rule'}\n\t\t\t\t],\n\t\t\t\tfieldnames: ['type', 'reference_doctype', 'rule'],\n\t\t\t\taction: (selected_item, fieldname) => {\n\t\t\t\t\tlet title = __('{0} Distribution', [__(selected_item)]);\n\t\t\t\t\tthis.render_percentage_chart(fieldname, title);\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.percentage-chart-options');\n\t}\n\n\tcreate_heatmap_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: frappe.dashboard_utils.get_year(frappe.datetime.now_date()),\n\t\t\t\toptions: frappe.dashboard_utils.get_years_since_creation(frappe.boot.user.creation),\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.update_heatmap_data(frappe.datetime.obj_to_str(selected_item));\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.heatmap-options');\n\t}\n\n\tedit_profile() {\n\t\tlet edit_profile_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit Profile'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Attach Image',\n\t\t\t\t\tfieldname: 'user_image',\n\t\t\t\t\tlabel: __('Profile Image'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tfieldname: 'interest',\n\t\t\t\t\tlabel: __('Interests'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tfieldname: 'location',\n\t\t\t\t\tlabel: __('Location'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tfieldname: __('Interest'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\t\tfieldname: 'bio',\n\t\t\t\t\tlabel: __('Bio'),\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: values => {\n\t\t\t\tedit_profile_dialog.disable_primary_action();\n\t\t\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.update_profile_info', {\n\t\t\t\t\tprofile_info: values\n\t\t\t\t}).then(user => {\n\t\t\t\t\tuser.image = user.user_image;\n\t\t\t\t\tthis.user = Object.assign(values, user);\n\t\t\t\t\tedit_profile_dialog.hide();\n\t\t\t\t\tthis.render_user_details();\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tedit_profile_dialog.enable_primary_action();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Save')\n\t\t});\n\n\t\tedit_profile_dialog.set_values({\n\t\t\tuser_image: this.user.image,\n\t\t\tlocation: this.user.location,\n\t\t\tinterest: this.user.interest,\n\t\t\tbio: this.user.bio\n\t\t});\n\t\tedit_profile_dialog.show();\n\t}\n\n\trender_user_details() {\n\t\tthis.sidebar.empty().append(frappe.render_template('user_profile_sidebar', {\n\t\t\tuser_image: this.user.image,\n\t\t\tuser_abbr: this.user.abbr,\n\t\t\tuser_location: this.user.location,\n\t\t\tuser_interest: this.user.interest,\n\t\t\tuser_bio: this.user.bio,\n\t\t}));\n\n\t\tthis.setup_user_profile_links();\n\t}\n\n\tsetup_user_profile_links() {\n\t\tif (this.user_id !== frappe.session.user) {\n\t\t\tthis.wrapper.find('.profile-links').hide();\n\t\t} else {\n\t\t\tthis.wrapper.find('.edit-profile-link').on('click', () => {\n\t\t\t\tthis.edit_profile();\n\t\t\t});\n\n\t\t\tthis.wrapper.find('.user-settings-link').on('click', () => {\n\t\t\t\tthis.go_to_user_settings();\n\t\t\t});\n\t\t}\n\t}\n\n\tget_user_rank() {\n\t\treturn frappe.xcall('frappe.desk.page.user_profile.user_profile.get_user_rank', {\n\t\t\tuser: this.user_id,\n\t\t}).then(r => {\n\t\t\tif (r.monthly_rank.length) this.month_rank = r.monthly_rank[0];\n\t\t\tif (r.all_time_rank.length) this.rank = r.all_time_rank[0];\n\t\t});\n\t}\n\n\tget_user_points() {\n\t\treturn frappe.xcall(\n\t\t\t'frappe.social.doctype.energy_point_log.energy_point_log.get_user_energy_and_review_points',\n\t\t\t{\n\t\t\t\tuser: this.user_id,\n\t\t\t}\n\t\t).then(r => {\n\t\t\tif (r[this.user_id]) {\n\t\t\t\tthis.energy_points = r[this.user_id].energy_points;\n\t\t\t\tthis.review_points = r[this.user_id].review_points;\n\t\t\t}\n\t\t});\n\t}\n\n\trender_points_and_rank() {\n\t\tlet $profile_details = this.wrapper.find('.user-stats');\n\t\tlet $profile_details_wrapper = this.wrapper.find('.user-stats-detail');\n\n\t\tconst _get_stat_dom = (value, label, icon) => {\n\t\t\treturn `<div class=\"user-stats-item mt-4\">\n\t\t\t\t\t${frappe.utils.icon(icon, \"lg\", \"no-stroke\")}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"stat-value\">${value}</div>\n\t\t\t\t\t\t<div class=\"stat-label\">${label}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t};\n\n\t\tthis.get_user_rank().then(() => {\n\t\t\tthis.get_user_points().then(() => {\n\t\t\t\tlet html = $(`\n\t\t\t\t\t${_get_stat_dom(this.energy_points, __('Energy Points'), \"color-energy-points\")}\n\t\t\t\t\t${_get_stat_dom(this.review_points, __('Review Points'), \"color-review-points\")}\n\t\t\t\t\t${_get_stat_dom(this.rank, __('Rank'), \"color-rank\")}\n\t\t\t\t\t${_get_stat_dom(this.month_rank, __('Monthly Rank'), \"color-monthly-rank\")}\n\t\t\t\t`);\n\n\t\t\t\t$profile_details.append(html);\n\t\t\t\t$profile_details_wrapper.removeClass(\"hide\");\n\t\t\t});\n\t\t});\n\t}\n\n\tgo_to_user_settings() {\n\t\tfrappe.set_route('Form', 'User', this.user_id);\n\t}\n\n\tsetup_user_activity_timeline() {\n\t\tthis.user_activity_timeline = new UserProfileTimeline({\n\t\t\tparent: this.wrapper.find('.recent-activity-list'),\n\t\t\tfooter: this.wrapper.find('.recent-activity-footer'),\n\t\t\tuser: this.user_id\n\t\t});\n\n\t\tthis.user_activity_timeline.refresh();\n\t}\n}\n\nclass UserProfileTimeline extends BaseTimeline {\n\tmake() {\n\t\tsuper.make();\n\t\tthis.activity_start = 0;\n\t\tthis.activity_limit = 20;\n\t\tthis.setup_show_more_activity();\n\t}\n\tprepare_timeline_contents() {\n\t\treturn this.get_user_activity_data().then((activities) => {\n\t\t\tif (!activities.length) {\n\t\t\t\tthis.show_more_button.hide();\n\t\t\t\tthis.timeline_wrapper.html(`<div>${__('No activities to show')}</div>`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.show_more_button.toggle(activities.length === this.activity_limit);\n\t\t\tthis.timeline_items = activities.map((activity) => this.get_activity_timeline_item(activity));\n\t\t});\n\t}\n\n\tget_user_activity_data() {\n\t\treturn frappe.xcall('frappe.desk.page.user_profile.user_profile.get_energy_points_list', {\n\t\t\tstart: this.activity_start,\n\t\t\tlimit: this.activity_limit,\n\t\t\tuser: this.user\n\t\t});\n\t}\n\n\tget_activity_timeline_item(data) {\n\t\tlet icon = data.type == 'Appreciation' ? 'clap': data.type == 'Criticism' ? 'criticize': null;\n\t\treturn {\n\t\t\ticon: icon,\n\t\t\tcreation: data.creation,\n\t\t\tis_card: true,\n\t\t\tcontent: frappe.energy_points.format_history_log(data),\n\t\t};\n\t}\n\n\tsetup_show_more_activity() {\n\t\tthis.show_more_button = $(`<a class=\"show-more-activity-btn\">${__('Show More Activity')}</a>`);\n\t\tthis.show_more_button.hide();\n\t\tthis.footer.append(this.show_more_button);\n\t\tthis.show_more_button.on('click', () => this.show_more_activity());\n\t}\n\n\tshow_more_activity() {\n\t\tthis.activity_start += this.activity_limit;\n\t\tthis.get_user_activity_data().then(activities => {\n\t\t\tif (!activities.length || activities.length < this.activity_limit) {\n\t\t\t\tthis.show_more_button.hide();\n\t\t\t}\n\t\t\tlet timeline_items = activities.map((activity) => this.get_activity_timeline_item(activity));\n\t\t\ttimeline_items.map((item) => this.add_timeline_item(item, true));\n\t\t});\n\t}\n}\n\nfrappe.provide('frappe.ui');\nfrappe.ui.UserProfile = UserProfile;","// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nclass BaseTimeline {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.timeline_wrapper = $(`<div class=\"new-timeline\">`);\n\t\tthis.wrapper = this.timeline_wrapper;\n\t\tthis.timeline_items_wrapper = $(`<div class=\"timeline-items\">`);\n\t\tthis.timeline_actions_wrapper = $(`\n\t\t\t<div class=\"timeline-actions\">\n\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.timeline_wrapper.append(this.timeline_actions_wrapper);\n\t\tthis.timeline_actions_wrapper.hide();\n\t\tthis.timeline_wrapper.append(this.timeline_items_wrapper);\n\n\t\tthis.parent.replaceWith(this.timeline_wrapper);\n\t\tthis.timeline_items = [];\n\t}\n\n\trefresh() {\n\t\tthis.render_timeline_items();\n\t}\n\n\tadd_action_button(label, action, icon=null, btn_class=null) {\n\t\tlet icon_element = icon ? frappe.utils.icon(icon, 'xs') : null;\n\t\tthis.timeline_actions_wrapper.show();\n\t\tlet action_btn = $(`<button class=\"btn btn-xs ${btn_class || 'btn-default'} action-btn\">\n\t\t\t${icon_element}\n\t\t\t${label}\n\t\t</button>`);\n\t\taction_btn.click(action);\n\t\tthis.timeline_actions_wrapper.append(action_btn);\n\t\treturn action_btn;\n\t}\n\n\trender_timeline_items() {\n\t\tthis.timeline_items_wrapper.empty();\n\t\tthis.timeline_items = [];\n\t\tthis.doc_info = this.frm && this.frm.get_docinfo() || {};\n\t\tlet response = this.prepare_timeline_contents();\n\n\t\tif (response instanceof Promise) {\n\t\t\tresponse.then(() => {\n\t\t\t\tthis.timeline_items.sort((item1, item2) =>  new Date(item2.creation) - new Date(item1.creation));\n\t\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.timeline_items.sort((item1, item2) =>  new Date(item2.creation) - new Date(item1.creation));\n\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\t//\n\t}\n\n\tadd_timeline_item(item, append_at_the_end=false) {\n\t\tlet timeline_item = this.get_timeline_item(item);\n\t\tif (append_at_the_end) {\n\t\t\tthis.timeline_items_wrapper.append(timeline_item);\n\t\t} else {\n\t\t\tthis.timeline_items_wrapper.prepend(timeline_item);\n\t\t}\n\t\treturn timeline_item;\n\t}\n\n\tadd_timeline_items(items, append_at_the_end=false) {\n\t\titems.forEach((item) => this.add_timeline_item(item, append_at_the_end));\n\t}\n\n\tget_timeline_item(item) {\n\t\t// item can have content*, creation*,\n\t\t// timeline_badge, icon, icon_size,\n\t\t// hide_timestamp, is_card\n\t\tconst timeline_item = $(`<div class=\"timeline-item\">`);\n\t\ttimeline_item.attr({\n\t\t\t\"data-doctype\": item.doctype,\n\t\t\t\"data-name\": item.name,\n\t\t});\n\t\tif (item.icon) {\n\t\t\ttimeline_item.append(`\n\t\t\t\t<div class=\"timeline-badge\">\n\t\t\t\t\t${frappe.utils.icon(item.icon, item.icon_size || 'md')}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t} else if (item.timeline_badge) {\n\t\t\ttimeline_item.append(item.timeline_badge);\n\t\t} else {\n\t\t\ttimeline_item.append(`<div class=\"timeline-dot\">`);\n\t\t}\n\n\t\ttimeline_item.append(`<div class=\"timeline-content ${item.is_card ? 'frappe-card' : ''}\">`);\n\t\ttimeline_item.find('.timeline-content').append(item.content);\n\t\tif (!item.hide_timestamp && !item.is_card) {\n\t\t\ttimeline_item.find('.timeline-content').append(`<span> - ${comment_when(item.creation)}</span>`);\n\t\t}\n\t\treturn timeline_item;\n\t}\n}\n\nexport default BaseTimeline;"],"names":["frappe","provide","UserProfileTimeline","[object Object]","opts","Object","assign","this","make","timeline_wrapper","$","wrapper","timeline_items_wrapper","timeline_actions_wrapper","append","hide","parent","replaceWith","timeline_items","render_timeline_items","label","action","icon","btn_class","let","icon_element","utils","show","action_btn","click","empty","doc_info","frm","get_docinfo","response","prepare_timeline_contents","Promise","then","sort","item1","item2","Date","creation","forEach","add_timeline_item","bind","item","append_at_the_end","timeline_item","get_timeline_item","prepend","items","const","attr","data-doctype","doctype","data-name","name","icon_size","timeline_badge","is_card","find","content","hide_timestamp","comment_when","super","activity_start","activity_limit","setup_show_more_activity","get_user_activity_data","activities","length","show_more_button","html","__","toggle","map","activity","get_activity_timeline_item","xcall","start","limit","user","data","type","energy_points","format_history_log","footer","on","show_more_activity","ui","UserProfile","page","make_app_page","sidebar","main_section","route","get_route","user_id","session","dom","freeze","db","exists","unfreeze","make_user_profile","msgprint","set_route","user_info","set_title","fullname","setup_user_search","render_template","review_points","rank","month_rank","render_user_details","render_points_and_rank","render_heatmap","render_line_chart","render_percentage_chart","create_percentage_chart_filters","setup_user_activity_timeline","$user_search_button","set_secondary_action","show_user_search_dialog","size","dialog","Dialog","title","fields","fieldtype","fieldname","options","reqd","primary_action_label","primary_action","heatmap","Chart","countLabel","discreteDomains","radius","height","update_heatmap_data","create_heatmap_chart_filters","date_from","date","datetime","year_start","r","update","dataPoints","line_chart_filters","line_chart_config","timespan","time_interval","value_based_on","chart_type","document_type","width","based_on","line_chart","labels","datasets","colors","axisOptions","xIsSeries","tooltipOptions","update_line_chart_data","create_line_chart_filters","filters_json","JSON","stringify","chart","no_cache","field","percentage_chart","truncateLegends","barOptions","depth","maxSlices","filters","value","selected_item","dashboard_utils","render_chart_filters","fieldnames","get_year","now_date","get_years_since_creation","boot","obj_to_str","edit_profile_dialog","values","disable_primary_action","profile_info","image","user_image","finally","enable_primary_action","set_values","location","interest","bio","user_abbr","abbr","user_location","user_interest","user_bio","setup_user_profile_links","edit_profile","go_to_user_settings","monthly_rank","all_time_rank","$profile_details","$profile_details_wrapper","_get_stat_dom","get_user_rank","get_user_points","removeClass","user_activity_timeline","refresh"],"mappings":"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"}