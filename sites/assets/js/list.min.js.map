{"version":3,"file":"list.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/model/indicator.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter_list.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/field_select.js","../../../apps/frappe/frappe/public/js/frappe/ui/tags.js","../../../apps/frappe/frappe/public/js/frappe/ui/tag_editor.js","../../../apps/frappe/frappe/public/js/frappe/ui/like.js","../../../apps/frappe/frappe/public/js/frappe/list/base_list.js","../../../apps/frappe/frappe/public/js/frappe/list/bulk_operations.js","../../../apps/frappe/frappe/public/js/frappe/list/list_settings.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view.js","../../../apps/frappe/frappe/public/js/frappe/list/list_factory.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view_select.js","../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar_group_by.js","../../../apps/frappe/frappe/public/js/frappe/views/gantt/gantt_view.js","../../../apps/frappe/node_modules/tslib/tslib.es6.js","../../../apps/frappe/node_modules/preact/dist/preact.module.js","../../../apps/frappe/node_modules/@fullcalendar/core/vdom.js","../../../apps/frappe/node_modules/@fullcalendar/common/vdom.js","../../../apps/frappe/node_modules/@fullcalendar/common/main.js","../../../apps/frappe/node_modules/@fullcalendar/core/main.js","../../../apps/frappe/node_modules/@fullcalendar/daygrid/main.js","../../../apps/frappe/node_modules/@fullcalendar/timegrid/main.js","../../../apps/frappe/node_modules/@fullcalendar/interaction/main.js","../../../apps/frappe/frappe/public/js/frappe/views/calendar/calendar.js","../../../apps/frappe/frappe/public/js/frappe/views/file/file_view.js","../../../apps/frappe/frappe/public/js/frappe/views/interaction.js","../../../apps/frappe/frappe/public/js/frappe/views/dashboard/dashboard_view.js","../../../apps/frappe/frappe/public/js/frappe/views/image/image_view.js","../../../apps/frappe/frappe/public/js/frappe/views/kanban/kanban_view.js","../../../apps/frappe/frappe/public/js/frappe/views/inbox/inbox_view.js","../../../apps/frappe/frappe/public/js/frappe/views/map/map_view.js","../../../apps/frappe/frappe/public/js/frappe/views/treeview.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n\nfrappe.has_indicator = function(doctype) {\n\t// returns true if indicator is present\n\tif(frappe.model.is_submittable(doctype)) {\n\t\treturn true;\n\t} else if((frappe.listview_settings[doctype] || {}).get_indicator\n\t\t|| frappe.workflow.get_state_fieldname(doctype)) {\n\t\treturn true;\n\t} else if(frappe.meta.has_field(doctype, 'enabled')\n\t\t|| frappe.meta.has_field(doctype, 'disabled')) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfrappe.get_indicator = function(doc, doctype) {\n\tif(doc.__unsaved) {\n\t\treturn [__(\"Not Saved\"), \"orange\"];\n\t}\n\n\tif(!doctype) doctype = doc.doctype;\n\n\tvar workflow = frappe.workflow.workflows[doctype];\n\tvar without_workflow = workflow ? workflow['override_status'] : true;\n\n\tvar settings = frappe.listview_settings[doctype] || {};\n\n\tvar is_submittable = frappe.model.is_submittable(doctype),\n\t\tworkflow_fieldname = frappe.workflow.get_state_fieldname(doctype);\n\n\t// workflow\n\tif(workflow_fieldname && !without_workflow) {\n\t\tvar value = doc[workflow_fieldname];\n\t\tif(value) {\n\t\t\tvar colour = \"\";\n\n\t\t\tif(locals[\"Workflow State\"][value] && locals[\"Workflow State\"][value].style) {\n\t\t\t\tvar colour = {\n\t\t\t\t\t\"Success\": \"green\",\n\t\t\t\t\t\"Warning\": \"orange\",\n\t\t\t\t\t\"Danger\": \"red\",\n\t\t\t\t\t\"Primary\": \"blue\",\n\t\t\t\t\t\"Inverse\": \"black\",\n\t\t\t\t\t\"Info\": \"light-blue\",\n\t\t\t\t}[locals[\"Workflow State\"][value].style];\n\t\t\t}\n\t\t\tif (!colour) colour = \"gray\";\n\n\t\t\treturn [__(value), colour, workflow_fieldname + ',=,' + value];\n\t\t}\n\t}\n\n\t// draft if document is submittable\n\tif(is_submittable && doc.docstatus==0 && !settings.has_indicator_for_draft) {\n\t\treturn [__(\"Draft\"), \"red\", \"docstatus,=,0\"];\n\t}\n\n\t// cancelled\n\tif(is_submittable && doc.docstatus==2 && !settings.has_indicator_for_cancelled) {\n\t\treturn [__(\"Cancelled\"), \"red\", \"docstatus,=,2\"];\n\t}\n\n\tif(settings.get_indicator) {\n\t\tvar indicator = settings.get_indicator(doc);\n\t\tif(indicator) return indicator;\n\t}\n\n\t// if submittable\n\tif(is_submittable && doc.docstatus==1) {\n\t\treturn [__(\"Submitted\"), \"blue\", \"docstatus,=,1\"];\n\t}\n\n\t// based on status\n\tif(doc.status) {\n\t\treturn [__(doc.status), frappe.utils.guess_colour(doc.status)];\n\t}\n\n\t// based on enabled\n\tif(frappe.meta.has_field(doctype, 'enabled')) {\n\t\tif(doc.enabled) {\n\t\t\treturn [__('Enabled'), 'blue', 'enabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Disabled'), 'gray', 'enabled,=,0'];\n\t\t}\n\t}\n\n\t// based on disabled\n\tif(frappe.meta.has_field(doctype, 'disabled')) {\n\t\tif(doc.disabled) {\n\t\t\treturn [__('Disabled'), 'gray', 'disabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Enabled'), 'blue', 'disabled,=,0'];\n\t\t}\n\t}\n}\n","frappe.ui.Filter = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (this.value === null || this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\n\t\tthis.utils = frappe.ui.filter_utils;\n\t\tthis.set_conditions();\n\t\tthis.set_conditions_from_config();\n\t\tthis.make();\n\t}\n\n\tset_conditions() {\n\t\tthis.conditions = [\n\t\t\t['=', __('Equals')],\n\t\t\t['!=', __('Not Equals')],\n\t\t\t['like', __('Like')],\n\t\t\t['not like', __('Not Like')],\n\t\t\t['in', __('In')],\n\t\t\t['not in', __('Not In')],\n\t\t\t['is', __('Is')],\n\t\t\t['>', '>'],\n\t\t\t['<', '<'],\n\t\t\t['>=', '>='],\n\t\t\t['<=', '<='],\n\t\t\t['Between', __('Between')],\n\t\t\t['Timespan', __('Timespan')],\n\t\t];\n\n\t\tthis.nested_set_conditions = [\n\t\t\t['descendants of', __('Descendants Of')],\n\t\t\t['not descendants of', __('Not Descendants Of')],\n\t\t\t['ancestors of', __('Ancestors Of')],\n\t\t\t['not ancestors of', __('Not Ancestors Of')],\n\t\t];\n\n\t\tthis.conditions.push(...this.nested_set_conditions);\n\n\t\tthis.invalid_condition_map = {\n\t\t\tDate: ['like', 'not like'],\n\t\t\tDatetime: ['like', 'not like'],\n\t\t\tData: ['Between', 'Timespan'],\n\t\t\tSelect: ['like', 'not like', 'Between', 'Timespan'],\n\t\t\tLink: ['Between', 'Timespan', '>', '<', '>=', '<='],\n\t\t\tCurrency: ['Between', 'Timespan'],\n\t\t\tColor: ['Between', 'Timespan'],\n\t\t\tCheck: this.conditions.map((c) => c[0]).filter((c) => c !== '='),\n\t\t};\n\t}\n\n\tset_conditions_from_config() {\n\t\tif (frappe.boot.additional_filters_config) {\n\t\t\tthis.filters_config = frappe.boot.additional_filters_config;\n\t\t\tfor (let key of Object.keys(this.filters_config)) {\n\t\t\t\tconst filter = this.filters_config[key];\n\t\t\t\tthis.conditions.push([key, __(filter.label)]);\n\t\t\t\tfor (let fieldtype of Object.keys(this.invalid_condition_map)) {\n\t\t\t\t\tif (!filter.valid_for_fieldtypes.includes(fieldtype)) {\n\t\t\t\t\t\tthis.invalid_condition_map[fieldtype].push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tmake() {\n\t\tthis.filter_edit_area = $(\n\t\t\tfrappe.render_template('edit_filter', {\n\t\t\t\tconditions: this.conditions,\n\t\t\t})\n\t\t);\n\t\tthis.parent && this.filter_edit_area.appendTo(this.parent.find('.filter-edit-area'));\n\t\tthis.make_select();\n\t\tthis.set_events();\n\t\tthis.setup();\n\t}\n\n\tmake_select() {\n\t\tthis.fieldselect = new frappe.ui.FieldSelect({\n\t\t\tparent: this.filter_edit_area.find('.fieldname-select-area'),\n\t\t\tdoctype: this.parent_doctype,\n\t\t\tfilter_fields: this.filter_fields,\n\t\t\tinput_class: 'input-xs',\n\t\t\tselect: (doctype, fieldname) => {\n\t\t\t\tthis.set_field(doctype, fieldname);\n\t\t\t},\n\t\t});\n\n\t\tif (this.fieldname) {\n\t\t\tthis.fieldselect.set_value(this.doctype, this.fieldname);\n\t\t}\n\t}\n\n\tset_events() {\n\t\tthis.filter_edit_area.find('span.remove-filter').on('click', () => {\n\t\t\tthis.remove();\n\t\t\tthis.on_change();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.condition').change(() => {\n\t\t\tif (!this.field) return;\n\n\t\t\tlet condition = this.get_condition();\n\t\t\tlet fieldtype = null;\n\n\t\t\tif (['in', 'like', 'not in', 'not like'].includes(condition)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tthis.add_condition_help(condition);\n\t\t\t} else {\n\t\t\t\tthis.filter_edit_area.find('.filter-description').empty();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t['Select', 'MultiSelect'].includes(this.field.df.fieldtype) &&\n\t\t\t\t['in', 'not in'].includes(condition)\n\t\t\t) {\n\t\t\t\tfieldtype = 'MultiSelect';\n\t\t\t}\n\n\t\t\tthis.set_field(\n\t\t\t\tthis.field.df.parent,\n\t\t\t\tthis.field.df.fieldname,\n\t\t\t\tfieldtype,\n\t\t\t\tcondition\n\t\t\t);\n\t\t});\n\t}\n\n\tsetup() {\n\t\tconst fieldname = this.fieldname || 'name';\n\t\t// set the field\n\t\treturn this.set_values(this.doctype, fieldname, this.condition, this.value);\n\t}\n\n\tsetup_state(is_new) {\n\t\tlet promise = Promise.resolve();\n\t\tif (is_new) {\n\t\t\tthis.filter_edit_area.addClass('new-filter');\n\t\t} else {\n\t\t\tpromise = this.update_filter_tag();\n\t\t}\n\n\t\tif (this.hidden) {\n\t\t\tpromise.then(() => this.$filter_tag.hide());\n\t\t}\n\t}\n\n\tfreeze() {\n\t\tthis.update_filter_tag();\n\t}\n\n\tupdate_filter_tag() {\n\t\tif (this._filter_value_set) {\n\t\t\treturn this._filter_value_set.then(() => {\n\t\t\t\t!this.$filter_tag ? this.make_tag() : this.set_filter_button_text();\n\t\t\t\tthis.filter_edit_area.hide();\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.filter_edit_area.remove();\n\t\tthis.field = null;\n\t\t// this.on_change(true);\n\t}\n\n\tset_values(doctype, fieldname, condition, value) {\n\t\t// presents given (could be via tags!)\n\t\tif (this.set_field(doctype, fieldname) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.field.df.original_type === 'Check') {\n\t\t\tvalue = value == 1 ? 'Yes' : 'No';\n\t\t}\n\t\tif (condition) this.set_condition(condition, true);\n\n\t\t// set value can be asynchronous, so update_filter_tag should happen after field is set\n\t\tthis._filter_value_set = Promise.resolve();\n\n\t\tif (['in', 'not in'].includes(condition) && Array.isArray(value)) {\n\t\t\tvalue = value.join(',');\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\tthis._filter_value_set = this.field.set_value(value);\n\t\t} else if (value !== undefined || value !== null) {\n\t\t\tthis._filter_value_set = this.field.set_value((value + '').trim());\n\t\t}\n\t\treturn this._filter_value_set;\n\t}\n\n\tset_field(doctype, fieldname, fieldtype, condition) {\n\t\t// set in fieldname (again)\n\t\tlet cur = {};\n\t\tif (this.field) for (let k in this.field.df) cur[k] = this.field.df[k];\n\n\t\tlet original_docfield = (this.fieldselect.fields_by_name[doctype] || {})[\n\t\t\tfieldname\n\t\t];\n\n\t\tif (!original_docfield) {\n\t\t\tconsole.warn(`Field ${fieldname} is not selectable.`);\n\t\t\tthis.remove();\n\t\t\treturn false;\n\t\t}\n\n\t\tlet df = copy_dict(original_docfield);\n\n\t\t// filter field shouldn't be read only or hidden\n\t\tdf.read_only = 0;\n\t\tdf.hidden = 0;\n\t\tdf.is_filter = true;\n\t\tdelete df.hidden_due_to_dependency;\n\n\t\tlet c = condition ? condition : this.utils.get_default_condition(df);\n\t\tthis.set_condition(c);\n\n\t\tthis.utils.set_fieldtype(df, fieldtype, this.get_condition());\n\n\t\t// called when condition is changed,\n\t\t// don't change if all is well\n\t\tif (\n\t\t\tthis.field &&\n\t\t\tcur.fieldname == fieldname &&\n\t\t\tdf.fieldtype == cur.fieldtype &&\n\t\t\tdf.parent == cur.parent &&\n\t\t\tdf.options == cur.options\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// clear field area and make field\n\t\tthis.fieldselect.selected_doctype = doctype;\n\t\tthis.fieldselect.selected_fieldname = fieldname;\n\n\t\tif (\n\t\t\tthis.filters_config &&\n\t\t\tthis.filters_config[condition] &&\n\t\t\tthis.filters_config[condition].valid_for_fieldtypes.includes(df.fieldtype)\n\t\t) {\n\t\t\tlet args = {};\n\t\t\tif (this.filters_config[condition].depends_on) {\n\t\t\t\tconst field_name = this.filters_config[condition].depends_on;\n\t\t\t\tconst filter_value = this.filter_list.get_filter_value(fieldname);\n\t\t\t\targs[field_name] = filter_value;\n\t\t\t}\n\t\t\tfrappe\n\t\t\t\t.xcall(this.filters_config[condition].get_field, args)\n\t\t\t\t.then(field => {\n\t\t\t\t\tdf.fieldtype = field.fieldtype;\n\t\t\t\t\tdf.options = field.options;\n\t\t\t\t\tdf.fieldname = fieldname;\n\t\t\t\t\tthis.make_field(df, cur.fieldtype);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.make_field(df, cur.fieldtype);\n\t\t}\n\t}\n\n\tmake_field(df, old_fieldtype) {\n\t\tlet old_text = this.field ? this.field.get_value() : null;\n\t\tthis.hide_invalid_conditions(df.fieldtype, df.original_type);\n\t\tthis.toggle_nested_set_conditions(df);\n\t\tlet field_area = this.filter_edit_area\n\t\t\t.find('.filter-field')\n\t\t\t.empty()\n\t\t\t.get(0);\n\t\tdf.input_class = 'input-xs';\n\t\tlet f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: field_area,\n\t\t\tonly_input: true,\n\t\t});\n\t\tf.refresh();\n\n\t\tthis.field = f;\n\t\tif (old_text && f.fieldtype === old_fieldtype) {\n\t\t\tthis.field.set_value(old_text);\n\t\t}\n\n\t\tthis.bind_filter_field_events();\n\t}\n\n\tbind_filter_field_events() {\n\t\t// Apply filter on input focus out\n\t\tthis.field.$input.on('focusout', () => this.on_change());\n\n\t\t// run on enter\n\t\t$(this.field.wrapper)\n\t\t\t.find(':input')\n\t\t\t.keydown(e => {\n\t\t\t\tif (e.which == 13 && this.field.df.fieldtype !== 'MultiSelect') {\n\t\t\t\t\tthis.on_change();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tget_value() {\n\t\treturn [\n\t\t\tthis.fieldselect.selected_doctype,\n\t\t\tthis.field.df.fieldname,\n\t\t\tthis.get_condition(),\n\t\t\tthis.get_selected_value(),\n\t\t\tthis.hidden,\n\t\t];\n\t}\n\n\tget_selected_value() {\n\t\treturn this.utils.get_selected_value(this.field, this.get_condition());\n\t}\n\n\tadd_condition_help(condition) {\n\t\tconst description = ['in', 'not in'].includes(condition)\n\t\t\t? __('values separated by commas')\n\t\t\t: __('use % as wildcard');\n\n\t\tthis.filter_edit_area.find('.filter-description').html(description);\n\t}\n\n\tget_condition() {\n\t\treturn this.filter_edit_area.find('.condition').val();\n\t}\n\n\tset_condition(condition, trigger_change = false) {\n\t\tlet $condition_field = this.filter_edit_area.find('.condition');\n\t\t$condition_field.val(condition);\n\t\tif (trigger_change) $condition_field.change();\n\t}\n\n\tmake_tag() {\n\t\tif (!this.field) return;\n\t\tthis.$filter_tag = this.get_filter_tag_element().insertAfter(\n\t\t\tthis.parent.find('.active-tag-filters .clear-filters')\n\t\t);\n\t\tthis.set_filter_button_text();\n\t\tthis.bind_tag();\n\t}\n\n\tbind_tag() {\n\t\tthis.$filter_tag.find('.remove-filter').on('click', this.remove.bind(this));\n\n\t\tlet filter_button = this.$filter_tag.find('.toggle-filter');\n\t\tfilter_button.on('click', () => {\n\t\t\tfilter_button\n\t\t\t\t.closest('.tag-filters-area')\n\t\t\t\t.find('.filter-edit-area')\n\t\t\t\t.show();\n\t\t\tthis.filter_edit_area.toggle();\n\t\t});\n\t}\n\n\tset_filter_button_text() {\n\t\tthis.$filter_tag.find('.toggle-filter').html(this.get_filter_button_text());\n\t}\n\n\tget_filter_button_text() {\n\t\tlet value = this.utils.get_formatted_value(\n\t\t\tthis.field,\n\t\t\tthis.get_selected_value()\n\t\t);\n\t\treturn `${__(this.field.df.label)} ${__(this.get_condition())} ${__(\n\t\t\tvalue\n\t\t)}`;\n\t}\n\n\tget_filter_tag_element() {\n\t\treturn $(`<div class=\"filter-tag btn-group\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-filter\"\n\t\t\t\ttitle=\"${__('Edit Filter')}\">\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-filter\"\n\t\t\t\ttitle=\"${__('Remove Filter')}\">\n\t\t\t\t${frappe.utils.icon('close')}\n\t\t\t</button>\n\t\t</div>`);\n\t}\n\n\thide_invalid_conditions(fieldtype, original_type) {\n\t\tlet invalid_conditions =\n\t\t\tthis.invalid_condition_map[original_type] ||\n\t\t\tthis.invalid_condition_map[fieldtype] ||\n\t\t\t[];\n\n\t\tfor (let condition of this.conditions) {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(!invalid_conditions.includes(condition[0]));\n\t\t}\n\t}\n\n\ttoggle_nested_set_conditions(df) {\n\t\tlet show_condition =\n\t\t\tdf.fieldtype === 'Link' &&\n\t\t\tfrappe.boot.nested_set_doctypes.includes(df.options);\n\t\tthis.nested_set_conditions.forEach((condition) => {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(show_condition);\n\t\t});\n\t}\n};\n\nfrappe.ui.filter_utils = {\n\tget_formatted_value(field, value) {\n\t\tif (field.df.fieldname === 'docstatus') {\n\t\t\tvalue = { 0: 'Draft', 1: 'Submitted', 2: 'Cancelled' }[value] || value;\n\t\t} else if (field.df.original_type === 'Check') {\n\t\t\tvalue = { 0: 'No', 1: 'Yes' }[cint(value)];\n\t\t}\n\t\treturn frappe.format(value, field.df, { only_value: 1 });\n\t},\n\n\tget_selected_value(field, condition) {\n\t\tif (!field) return;\n\n\t\tlet val = field.get_value();\n\n\t\tif (typeof val === 'string') {\n\t\t\tval = strip(val);\n\t\t}\n\n\t\tif (condition == 'is' && !val) {\n\t\t\tval = field.df.options[0].value;\n\t\t}\n\n\t\tif (field.df.original_type == 'Check') {\n\t\t\tval = val == 'Yes' ? 1 : 0;\n\t\t}\n\n\t\tif (condition.indexOf('like', 'not like') !== -1) {\n\t\t\t// automatically append wildcards\n\t\t\tif (val && !(val.startsWith('%') || val.endsWith('%'))) {\n\t\t\t\tval = '%' + val + '%';\n\t\t\t}\n\t\t} else if (in_list(['in', 'not in'], condition)) {\n\t\t\tif (val) {\n\t\t\t\tval = val.split(',').map((v) => strip(v));\n\t\t\t}\n\t\t}\n\t\tif (val === '%') {\n\t\t\tval = '';\n\t\t}\n\n\t\treturn val;\n\t},\n\n\tget_default_condition(df) {\n\t\tif (df.fieldtype == 'Data') {\n\t\t\treturn 'like';\n\t\t} else if (df.fieldtype == 'Date' || df.fieldtype == 'Datetime') {\n\t\t\treturn 'Between';\n\t\t} else {\n\t\t\treturn '=';\n\t\t}\n\t},\n\n\tset_fieldtype(df, fieldtype, condition) {\n\t\t// reset\n\t\tif (df.original_type) df.fieldtype = df.original_type;\n\t\telse df.original_type = df.fieldtype;\n\n\t\tdf.description = '';\n\t\tdf.reqd = 0;\n\t\tdf.ignore_link_validation = true;\n\n\t\t// given\n\t\tif (fieldtype) {\n\t\t\tdf.fieldtype = fieldtype;\n\t\t\treturn;\n\t\t}\n\n\t\t// scrub\n\t\tif (df.fieldname == 'docstatus') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: __('Draft') },\n\t\t\t\t{ value: 1, label: __('Submitted') },\n\t\t\t\t{ value: 2, label: __('Cancelled') },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = 'No\\nYes';\n\t\t} else if (\n\t\t\t[\n\t\t\t\t'Text',\n\t\t\t\t'Small Text',\n\t\t\t\t'Text Editor',\n\t\t\t\t'Code',\n\t\t\t\t'Tag',\n\t\t\t\t'Comments',\n\t\t\t\t'Dynamic Link',\n\t\t\t\t'Read Only',\n\t\t\t\t'Assign',\n\t\t\t\t'Color',\n\t\t\t].indexOf(df.fieldtype) != -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (\n\t\t\tdf.fieldtype == 'Link' &&\n\t\t\t[\n\t\t\t\t'=',\n\t\t\t\t'!=',\n\t\t\t\t'descendants of',\n\t\t\t\t'ancestors of',\n\t\t\t\t'not descendants of',\n\t\t\t\t'not ancestors of',\n\t\t\t].indexOf(condition) == -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (\n\t\t\tdf.fieldtype === 'Data' &&\n\t\t\t(df.options || '').toLowerCase() === 'email'\n\t\t) {\n\t\t\tdf.options = null;\n\t\t}\n\t\tif (\n\t\t\tcondition == 'Between' &&\n\t\t\t(df.fieldtype == 'Date' || df.fieldtype == 'Datetime')\n\t\t) {\n\t\t\tdf.fieldtype = 'DateRange';\n\t\t}\n\t\tif (\n\t\t\tcondition == 'Timespan' &&\n\t\t\t['Date', 'Datetime', 'DateRange', 'Select'].includes(df.fieldtype)\n\t\t) {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = this.get_timespan_options(['Last', 'Yesterday', 'Today', 'Tomorrow', 'This', 'Next']);\n\t\t}\n\t\tif (condition === 'is') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [\n\t\t\t\t{ label: __('Set', null, 'Filters'), value: 'set' },\n\t\t\t\t{ label: __('Not Set'), value: 'not set' },\n\t\t\t];\n\t\t}\n\t\treturn;\n\t},\n\n\tget_timespan_options(periods) {\n\t\tconst period_map = {\n\t\t\tLast: [\n\t\t\t\t{label: __('Last Week'), value: 'last week'},\n\t\t\t\t{label: __('Last Month'), value: 'last month'},\n\t\t\t\t{label: __('Last Quarter'), value: 'last quarter'},\n\t\t\t\t{label: __('Last 6 months'), value: 'last 6 months'},\n\t\t\t\t{label: __('Last Year'), value: 'last year'}\n\t\t\t],\n\t\t\tThis: [\n\t\t\t\t{label: __('This Week'), value: 'this week'},\n\t\t\t\t{label: __('This Month'), value: 'this month'},\n\t\t\t\t{label: __('This Quarter'), value: 'this quarter'},\n\t\t\t\t{label: __('This Year'), value: 'this year'}\n\t\t\t],\n\t\t\tNext: [\n\t\t\t\t{label: __('Next Week'), value: 'next week'},\n\t\t\t\t{label: __('Next Month'), value: 'next month'},\n\t\t\t\t{label: __('Next Quarter'), value: 'next quarter'},\n\t\t\t\t{label: __('Next 6 months'), value: 'next 6 months'},\n\t\t\t\t{label: __('Next Year'), value: 'next year'}\n\t\t\t],\n\t\t};\n\t\tlet options = [];\n\t\tperiods.forEach((period) => {\n\t\t\tif (period_map[period]) {\n\t\t\t\tperiod_map[period].forEach((p) => {\n\t\t\t\t\toptions.push(p);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\toptions.push({\n\t\t\t\t\tlabel: __(period),\n\t\t\t\t\tvalue: `${period.toLowerCase()}`,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn options;\n\t},\n};","frappe.ui.FilterGroup = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.filters = [];\n\t\twindow.fltr = this;\n\t\tif (!this.filter_button) {\n\t\t\tthis.wrapper = this.parent;\n\t\t\tthis.wrapper.append(this.get_filter_area_template());\n\t\t\tthis.set_filter_events();\n\t\t} else {\n\t\t\tthis.make_popover();\n\t\t}\n\t}\n\n\tmake_popover() {\n\t\tthis.init_filter_popover();\n\t\tthis.set_popover_events();\n\t}\n\n\tinit_filter_popover() {\n\t\tthis.filter_button.popover({\n\t\t\tcontent: this.get_filter_area_template(),\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"filter-popover popover\">\n\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t<div class=\"popover-body popover-content\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\thtml: true,\n\t\t\ttrigger: 'manual',\n\t\t\tcontainer: 'body',\n\t\t\tplacement: 'bottom',\n\t\t\toffset: '-100px 0'\n\t\t});\n\t}\n\n\ttoggle_empty_filters(show) {\n\t\tthis.wrapper &&\n\t\t\tthis.wrapper.find('.empty-filters').toggle(show);\n\t}\n\n\tset_popover_events() {\n\t\t$(document.body).on('click', (e) => {\n\t\t\tif (this.wrapper && this.wrapper.is(':visible')) {\n\t\t\t\tconst in_datepicker = $(e.target).is('.datepicker--cell')\n\t\t\t\t\t|| $(e.target).closest('.datepicker--nav-title').length !== 0\n\t\t\t\t\t|| $(e.target).parents('.datepicker--nav-action').length !== 0;\n\n\t\t\t\tif (\n\t\t\t\t\t$(e.target).parents('.filter-popover').length === 0\n\t\t\t\t\t&& $(e.target).parents('.filter-box').length === 0\n\t\t\t\t\t&& this.filter_button.find($(e.target)).length === 0\n\t\t\t\t\t&& !$(e.target).is(this.filter_button)\n\t\t\t\t\t&& !in_datepicker\n\t\t\t\t) {\n\t\t\t\t\tthis.wrapper && this.filter_button.popover('hide');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.filter_button.on('click', () => {\n\t\t\tthis.filter_button.popover('toggle');\n\t\t});\n\n\t\tthis.filter_button.on('shown.bs.popover', () => {\n\t\t\tlet hide_empty_filters = this.filters && this.filters.length > 0;\n\t\t\tif (!this.wrapper) {\n\t\t\t\tthis.wrapper = $('.filter-popover');\n\t\t\t\tif (hide_empty_filters) {\n\t\t\t\t\tthis.toggle_empty_filters(false);\n\t\t\t\t\tthis.add_filters_to_popover(this.filters);\n\t\t\t\t}\n\t\t\t\tthis.set_filter_events();\n\t\t\t}\n\t\t\tthis.toggle_empty_filters(false);\n\t\t\t!hide_empty_filters && this.add_filter(this.doctype, 'name');\n\t\t});\n\n\t\tthis.filter_button.on('hidden.bs.popover', () => {\n\t\t\tthis.apply();\n\t\t});\n\n\t\t// REDESIGN-TODO: (Temporary) Review and find best solution for this\n\t\tfrappe.router.on('change', () => {\n\t\t\tif (this.wrapper && this.wrapper.is(':visible')) {\n\t\t\t\tthis.filter_button.popover('hide');\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_filters_to_popover(filters) {\n\t\tfilters.forEach(filter => {\n\t\t\tfilter.parent = this.wrapper;\n\t\t\tfilter.field = null;\n\t\t\tfilter.make();\n\t\t});\n\t}\n\n\tapply() {\n\t\tthis.update_filters();\n\t\tthis.on_change();\n\t}\n\n\tupdate_filter_button() {\n\t\tconst filters_applied = this.filters.length > 0;\n\t\tconst button_label = filters_applied\n\t\t\t? this.filters.length > 1\n\t\t\t\t? __(\"{0} filters\", [this.filters.length])\n\t\t\t\t: __(\"{0} filter\", [this.filters.length])\n\t\t\t: __('Filter');\n\n\n\t\tthis.filter_button\n\t\t\t.toggleClass('btn-default', !filters_applied)\n\t\t\t.toggleClass('btn-primary-light', filters_applied);\n\n\t\tthis.filter_button.find('.filter-icon')\n\t\t\t.toggleClass('active', filters_applied);\n\n\t\tthis.filter_button.find('.button-label').html(button_label);\n\t}\n\n\tset_filter_events() {\n\t\tthis.wrapper.find('.add-filter').on('click', () => {\n\t\t\tthis.toggle_empty_filters(false);\n\t\t\tthis.add_filter(this.doctype, 'name');\n\t\t});\n\n\t\tthis.wrapper.find('.clear-filters').on('click', () => {\n\t\t\tthis.toggle_empty_filters(true);\n\t\t\tthis.clear_filters();\n\t\t\tthis.on_change();\n\t\t});\n\n\t\tthis.wrapper.find('.apply-filters').on('click', () => {\n\t\t\tthis.filter_button.popover('hide');\n\t\t});\n\t}\n\n\tadd_filters(filters) {\n\t\tlet promises = [];\n\n\t\tfor (const filter of filters) {\n\t\t\tpromises.push(() => this.add_filter(...filter));\n\t\t}\n\n\t\treturn frappe.run_serially(promises).then(() => this.update_filters());\n\t}\n\n\tadd_filter(doctype, fieldname, condition, value, hidden) {\n\t\tif (!fieldname) return Promise.resolve();\n\t\t// adds a new filter, returns true if filter has been added\n\n\t\t// {}: Add in page filter by fieldname if exists ('=' => 'like')\n\n\t\tif (!this.validate_args(doctype, fieldname)) return false;\n\t\tconst is_new_filter = arguments.length < 2;\n\t\tif (is_new_filter && this.wrapper.find('.new-filter:visible').length) {\n\t\t\t// only allow 1 new filter at a time!\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet args = [doctype, fieldname, condition, value, hidden];\n\t\t\tconst promise = this.push_new_filter(args, is_new_filter);\n\t\t\treturn (promise && promise.then) ? promise : Promise.resolve();\n\t\t}\n\t}\n\n\tvalidate_args(doctype, fieldname) {\n\t\tif (doctype && fieldname\n\t\t\t&& !frappe.meta.has_field(doctype, fieldname)\n\t\t\t&& !frappe.model.std_fields_list.includes(fieldname)\n\t\t) {\n\t\t\tfrappe.msgprint({\n\t\t\t\tmessage: __('Invalid filter: {0}', [fieldname.bold()]),\n\t\t\t\tindicator: 'red',\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpush_new_filter(args) {\n\t\t// args: [doctype, fieldname, condition, value]\n\t\tif (this.filter_exists(args)) return;\n\n\t\t// {}: Clear page filter fieldname field\n\n\t\tlet filter = this._push_new_filter(...args);\n\n\t\tif (filter && filter.value) {\n\t\t\t// filter.setup_state(is_new_filter);\n\t\t\treturn filter._filter_value_set; // internal promise\n\t\t}\n\t}\n\n\t_push_new_filter(doctype, fieldname, condition, value, hidden = false) {\n\t\tlet args = {\n\t\t\tparent: this.wrapper,\n\t\t\tparent_doctype: this.doctype,\n\t\t\tdoctype: doctype,\n\t\t\tfieldname: fieldname,\n\t\t\tcondition: condition,\n\t\t\tvalue: value,\n\t\t\thidden: hidden,\n\t\t\tindex: this.filters.length + 1,\n\t\t\ton_change: (update) => {\n\t\t\t\tif (update) this.update_filters();\n\t\t\t\tthis.on_change();\n\t\t\t},\n\t\t\tfilter_items: (doctype, fieldname) => {\n\t\t\t\treturn !this.filter_exists([doctype, fieldname]);\n\t\t\t},\n\t\t\tfilter_list: this.base_list || this,\n\t\t};\n\t\tlet filter = new frappe.ui.Filter(args);\n\t\tthis.filters.push(filter);\n\t\treturn filter;\n\t}\n\n\tget_filter_value(fieldname) {\n\t\tlet filter_obj = this.filters.find(f => f.fieldname == fieldname) || {};\n\t\treturn filter_obj.value;\n\t}\n\n\tfilter_exists(filter_value) {\n\t\t// filter_value of form: [doctype, fieldname, condition, value]\n\t\tlet exists = false;\n\t\tthis.filters\n\t\t\t.filter((f) => f.field)\n\t\t\t.map((f) => {\n\t\t\t\tlet f_value = f.get_value();\n\t\t\t\tif (filter_value.length === 2) {\n\t\t\t\t\texists =\n\t\t\t\t\t\tfilter_value[0] === f_value[0] && filter_value[1] === f_value[1];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet value = filter_value[3];\n\t\t\t\tlet equal = frappe.utils.arrays_equal;\n\n\t\t\t\tif (\n\t\t\t\t\tequal(f_value.slice(0, 4), filter_value.slice(0, 4)) ||\n\t\t\t\t\t(Array.isArray(value) && equal(value, f_value[3]))\n\t\t\t\t) {\n\t\t\t\t\texists = true;\n\t\t\t\t}\n\t\t\t});\n\t\treturn exists;\n\t}\n\n\tget_filters() {\n\t\treturn this.filters\n\t\t\t.filter((f) => f.field)\n\t\t\t.map((f) => {\n\t\t\t\treturn f.get_value();\n\t\t\t});\n\t\t// {}: this.list.update_standard_filters(values);\n\t}\n\n\tupdate_filters() {\n\t\t// remove hidden filters and undefined filters\n\t\tconst filter_exists = (f) => ![undefined, null].includes(f.get_selected_value());\n\t\tthis.filters.map(f => !filter_exists(f) && f.remove());\n\t\tthis.filters = this.filters.filter(f => filter_exists(f) && f.field);\n\t\tthis.update_filter_button();\n\t\tthis.filters.length === 0 &&\n\t\t\tthis.toggle_empty_filters(true);\n\t}\n\n\tclear_filters() {\n\t\tthis.filters.map((f) => f.remove(true));\n\t\t// {}: Clear page filters, .date-range-picker (called list run())\n\t\tthis.filters = [];\n\t}\n\n\tget_filter(fieldname) {\n\t\treturn this.filters.filter((f) => {\n\t\t\treturn f.field && f.field.df.fieldname == fieldname;\n\t\t})[0];\n\t}\n\n\tget_filter_area_template() {\n\t\t/* eslint-disable indent */\n\t\treturn $(`\n\t\t\t<div class=\"filter-area\">\n\t\t\t\t<div class=\"filter-edit-area\">\n\t\t\t\t\t<div class=\"text-muted empty-filters text-center\">\n\t\t\t\t\t\t${__('No filters selected')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<hr class=\"divider\"></hr>\n\t\t\t\t<div class=\"filter-action-buttons\">\n\t\t\t\t\t<button class=\"text-muted add-filter btn btn-xs\">\n\t\t\t\t\t\t+ ${__('Add a Filter')}\n\t\t\t\t\t</button>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button class=\"btn btn-secondary-dark btn-xs clear-filters\">\n\t\t\t\t\t\t\t${__('Clear Filters')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t${this.filter_button ?\n\t\t\t\t\t\t\t`<button class=\"btn btn-primary btn-xs apply-filters\">\n\t\t\t\t\t\t\t\t${__('Apply Filters')}\n\t\t\t\t\t\t\t</button>`\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t\t/* eslint-disable indent */\n\t}\n\n\tget_filters_as_object() {\n\t\tlet filters = this.get_filters().reduce((acc, filter) => {\n\t\t\treturn Object.assign(acc, {\n\t\t\t\t[filter[1]]: [filter[2], filter[3]],\n\t\t\t});\n\t\t}, {});\n\t\treturn filters;\n\t}\n\n\tadd_filters_to_filter_group(filters) {\n\t\tfilters.forEach((filter) => {\n\t\t\tthis.add_filter(filter[0], filter[1], filter[2], filter[3]);\n\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || (Array.isArray(filters) && filters.length === 0))\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === \"string\") {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter((f) => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(\n\t\t\tfilters\n\t\t);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn (\n\t\t\t\t\tnon_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters)\n\t\t\t\t);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n};","// <select> widget with all fields of a doctype as options\nfrappe.ui.FieldSelect = Class.extend({\n\t// opts parent, doctype, filter_fields, with_blank, select\n\tinit(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fields_by_name = {};\n\t\tthis.options = [];\n\t\tthis.$input = $('<input class=\"form-control\">')\n\t\t\t.appendTo(this.parent)\n\t\t\t.on(\"click\", function () { $(this).select(); });\n\t\tthis.input_class && this.$input.addClass(this.input_class);\n\t\tthis.select_input = this.$input.get(0);\n\t\tthis.awesomplete = new Awesomplete(this.select_input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: me.options,\n\t\t\titem(item) {\n\t\t\t\treturn $(repl('<li class=\"filter-field-select\"><p>%(label)s</p></li>', item))\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.get(0);\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-select\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.selected_doctype = item.doctype;\n\t\t\tme.selected_fieldname = item.fieldname;\n\t\t\tif(me.select) me.select(item.doctype, item.fieldname);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-selectcomplete\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.$input.val(item.label);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-open\", () => {\n\t\t\tlet modal = this.$input.parents('.modal-dialog')[0];\n\t\t\tif (modal) {\n\t\t\t\t$(modal).removeClass(\"modal-dialog-scrollable\");\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-close\", () => {\n\t\t\tlet modal = this.$input.parents('.modal-dialog')[0];\n\t\t\tif (modal) {\n\t\t\t\t$(modal).addClass(\"modal-dialog-scrollable\");\n\t\t\t}\n\t\t});\n\n\t\tif(this.filter_fields) {\n\t\t\tfor(var i in this.filter_fields)\n\t\t\t\tthis.add_field_option(this.filter_fields[i]);\n\t\t} else {\n\t\t\tthis.build_options();\n\t\t}\n\t\tthis.set_value(this.doctype, \"name\");\n\t},\n\tget_value() {\n\t\treturn this.selected_doctype ? this.selected_doctype + \".\" + this.selected_fieldname : null;\n\t},\n\tval(value) {\n\t\tif(value===undefined) {\n\t\t\treturn this.get_value();\n\t\t} else {\n\t\t\tthis.set_value(value);\n\t\t}\n\t},\n\tclear() {\n\t\tthis.selected_doctype = null;\n\t\tthis.selected_fieldname = null;\n\t\tthis.$input.val(\"\");\n\t},\n\tset_value(doctype, fieldname) {\n\t\tvar me = this;\n\t\tthis.clear();\n\t\tif(!doctype) return;\n\n\t\t// old style\n\t\tif(doctype.indexOf(\".\")!==-1) {\n\t\t\tvar parts = doctype.split(\".\");\n\t\t\tdoctype = parts[0];\n\t\t\tfieldname = parts[1];\n\t\t}\n\n\t\t$.each(this.options, function(i, v) {\n\t\t\tif(v.doctype===doctype && v.fieldname===fieldname) {\n\t\t\t\tme.selected_doctype = doctype;\n\t\t\t\tme.selected_fieldname = fieldname;\n\t\t\t\tme.$input.val(v.label);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tbuild_options() {\n\t\tvar me = this;\n\t\tme.table_fields = [];\n\t\tvar std_filters = $.map(frappe.model.std_fields, function(d) {\n\t\t\tvar opts = {parent: me.doctype};\n\t\t\tif(d.fieldname==\"name\") opts.options = me.doctype;\n\t\t\treturn $.extend(copy_dict(d), opts);\n\t\t});\n\n\t\t// add parenttype column\n\t\tvar doctype_obj = locals['DocType'][me.doctype];\n\t\tif(doctype_obj && cint(doctype_obj.istable)) {\n\t\t\tstd_filters = std_filters.concat([{\n\t\t\t\tfieldname: 'parent',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: __('Parent'),\n\t\t\t\tparent: me.doctype,\n\t\t\t}]);\n\t\t}\n\n\t\t// blank\n\t\tif(this.with_blank) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel:\"\",\n\t\t\t\tvalue:\"\",\n\t\t\t});\n\t\t}\n\n\t\t// main table\n\t\tvar main_table_fields = std_filters.concat(frappe.meta.docfield_list[me.doctype]);\n\t\t$.each(frappe.utils.sort(main_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\tme.add_field_option(df);\n\t\t});\n\n\t\t// child tables\n\t\t$.each(me.table_fields, function(i, table_df) {\n\t\t\tif(table_df.options) {\n\t\t\t\tlet child_table_fields = [].concat(frappe.meta.docfield_list[table_df.options]);\n\n\t\t\t\tif (table_df.fieldtype === \"Table MultiSelect\") {\n\t\t\t\t\tconst link_field = frappe.meta.get_docfields(table_df.options)\n\t\t\t\t\t\t.find(df => df.fieldtype === 'Link');\n\t\t\t\t\tchild_table_fields = link_field ? [link_field] : [];\n\t\t\t\t}\n\t\t\t\t$.each(frappe.utils.sort(child_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\t\t\tme.add_field_option(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_field_option(df) {\n\t\tlet me = this;\n\n\t\tif (df.fieldname == 'docstatus' && !frappe.model.is_submittable(me.doctype))\n\t\t\treturn;\n\n\t\tif (frappe.model.table_fields.includes(df.fieldtype)) {\n\t\t\tme.table_fields.push(df);\n\t\t\treturn;\n\t\t}\n\n\t\tlet label = null;\n\t\tlet table = null;\n\n\t\tif(me.doctype && df.parent==me.doctype) {\n\t\t\tlabel = __(df.label);\n\t\t\ttable = me.doctype;\n\t\t} else {\n\t\t\tlabel = __(df.label) + ' (' + __(df.parent) + ')';\n\t\t\ttable = df.parent;\n\t\t}\n\n\t\tif(frappe.model.no_value_type.indexOf(df.fieldtype) == -1 &&\n\t\t\t!(me.fields_by_name[df.parent] && me.fields_by_name[df.parent][df.fieldname])) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel: label,\n\t\t\t\tvalue: table + \".\" + df.fieldname,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tdoctype: df.parent\n\t\t\t});\n\t\t\tif(!me.fields_by_name[df.parent]) me.fields_by_name[df.parent] = {};\n\t\t\tme.fields_by_name[df.parent][df.fieldname] = df;\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.Tags = class {\n\tconstructor({\n\t\tparent, placeholder, tagsList,\n\t\tonTagAdd,\n\t\tonTagRemove,\n\t\tonTagClick,\n\t\tonChange\n\t}) {\n\t\tthis.tagsList = tagsList || [];\n\t\tthis.onTagAdd = onTagAdd;\n\t\tthis.onTagRemove = onTagRemove;\n\t\tthis.onTagClick = onTagClick;\n\t\tthis.onChange = onChange;\n\n\t\tthis.setup(parent, placeholder);\n\t}\n\n\tsetup(parent, placeholder) {\n\t\tthis.$ul = parent;\n\t\tthis.$input = $(`<input class=\"tags-input form-control\"></input>`);\n\n\t\tthis.$inputWrapper = this.get_list_element(this.$input);\n\t\tthis.$placeholder = this.get_list_element($(`<span class=\"tags-placeholder text-muted\">${placeholder}</span>`));\n\t\tthis.$inputWrapper.appendTo(this.$ul);\n\t\tthis.$placeholder.appendTo(this.$ul);\n\n\t\tthis.deactivate();\n\t\tthis.bind();\n\t\tthis.boot();\n\t}\n\n\tbind() {\n\t\tconst me = this;\n\t\tconst select_tag = function() {\n\t\t\tconst tagValue = frappe.utils.xss_sanitise(me.$input.val());\n\t\t\tme.addTag(tagValue);\n\t\t\tme.$input.val('');\n\t\t};\n\n\t\tthis.$input.keypress((e) => {\n\t\t\tif (e.which == 13 || e.keyCode == 13) select_tag();\n\t\t});\n\t\tthis.$input.focusout(select_tag);\n\n\t\tthis.$input.on('blur', () => {\n\t\t\tthis.deactivate();\n\t\t});\n\n\t\tthis.$placeholder.on('click', () => {\n\t\t\tthis.activate();\n\t\t\tthis.$input.focus(); // focus only when clicked\n\t\t});\n\t}\n\n\tboot() {\n\t\tthis.addTags(this.tagsList);\n\t}\n\n\tactivate() {\n\t\tthis.$placeholder.hide();\n\t\tthis.$inputWrapper.show();\n\t}\n\n\tdeactivate() {\n\t\tthis.$inputWrapper.hide();\n\t\tthis.$placeholder.show();\n\t}\n\n\taddTag(label) {\n\t\tif (label && label!== '' && !this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.get_tag(label);\n\t\t\tlet row = this.get_list_element($tag, 'form-tag-row');\n\t\t\trow.insertBefore(this.$inputWrapper);\n\t\t\tthis.tagsList.push(label);\n\t\t\tthis.onTagAdd && this.onTagAdd(label);\n\t\t}\n\t}\n\n\tremoveTag(label) {\n\t\tlabel = frappe.utils.xss_sanitise(label);\n\t\tif(this.tagsList.includes(label)) {\n\t\t\tthis.tagsList.splice(this.tagsList.indexOf(label), 1);\n\t\t\tthis.onTagRemove && this.onTagRemove(label);\n\t\t}\n\t}\n\n\taddTags(labels) {\n\t\tlabels.map(this.addTag.bind(this));\n\t}\n\n\tclearTags() {\n\t\tthis.$ul.find('.form-tag-row').remove();\n\t\tthis.tagsList = [];\n\t}\n\n\tget_list_element($element, class_name=\"\") {\n\t\tlet $li = $(`<li class=\"${class_name}\"></li>`);\n\t\t$element.appendTo($li);\n\t\treturn $li;\n\t}\n\n\tget_tag(label) {\n\t\tlet $tag = frappe.get_data_pill(label, label, (target, pill_wrapper) => {\n\t\t\tthis.removeTag(target);\n\t\t\tpill_wrapper.closest('.form-tag-row').remove();\n\t\t});\n\n\t\tif (this.onTagClick) {\n\t\t\t$tag.on('click', '.pill-label', () => {\n\t\t\t\tthis.onTagClick(label);\n\t\t\t});\n\t\t}\n\n\t\treturn $tag;\n\t}\n}","frappe.ui.TagEditor = Class.extend({\n\tinit: function(opts) {\n\t\t/* docs:\n\t\tArguments\n\n\t\t- parent\n\t\t- user_tags\n\t\t- doctype\n\t\t- docname\n\t\t*/\n\t\t$.extend(this, opts);\n\n\t\tthis.setup_tags();\n\n\t\tif (!this.user_tags) {\n\t\t\tthis.user_tags = \"\";\n\t\t}\n\t\tthis.initialized = true;\n\t\tthis.refresh(this.user_tags);\n\t},\n\tsetup_tags: function() {\n\t\tvar me = this;\n\n\t\t// hidden form, does not have parent\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = this.parent;\n\t\tif (!this.wrapper.length) return;\n\n\t\tthis.tags = new frappe.ui.Tags({\n\t\t\tparent: this.wrapper,\n\t\t\tplaceholder: __(\"Add a tag ...\"),\n\t\t\tonTagAdd: (tag) => {\n\t\t\t\tif(me.initialized && !me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.add_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags ? me.user_tags.split(\",\") : [];\n\t\t\t\t\t\t\tuser_tags.push(tag)\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTagRemove: (tag) => {\n\t\t\t\tif(!me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.remove_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags.split(\",\");\n\t\t\t\t\t\t\tuser_tags.splice(user_tags.indexOf(tag), 1);\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.setup_awesomplete();\n\t\tthis.setup_complete = true;\n\t},\n\tsetup_awesomplete: function() {\n\t\tvar me = this;\n\t\tvar $input = this.wrapper.find(\"input.tags-input\");\n\t\tvar input = $input.get(0);\n\t\tthis.awesomplete = new Awesomplete(input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tlist: []\n\t\t});\n\t\t$input.on(\"awesomplete-open\", function(e){\n\t\t\t$input.attr('state', 'open');\n\t\t});\n\t\t$input.on(\"awesomplete-close\", function(e){\n\t\t\t$input.attr('state', 'closed');\n\t\t});\n\t\t$input.on(\"input\", function(e) {\n\t\t\tvar value = e.target.value;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.get_tags\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\ttxt: value.toLowerCase(),\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.awesomplete.list = r.message;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t$input.on(\"focus\", function(e) {\n\t\t\tif($input.attr('state') != 'open') {\n\t\t\t\t$input.trigger(\"input\");\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function(tag) {\n\t\treturn {\n\t\t\ttag: tag,\n\t\t\tdt: this.frm.doctype,\n\t\t\tdn: this.frm.docname,\n\t\t}\n\t},\n\trefresh: function(user_tags) {\n\t\tvar me = this;\n\t\tif (!this.initialized || !this.setup_complete || this.refreshing) return;\n\n\t\tme.refreshing = true;\n\t\ttry {\n\t\t\tme.tags.clearTags();\n\t\t\tif(user_tags) {\n\t\t\t\tme.user_tags = user_tags;\n\t\t\t\tme.tags.addTags(user_tags.split(','));\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tme.refreshing = false;\n\t\t\t// wtf bug\n\t\t\tsetTimeout( function() { me.refresh(); }, 100);\n\t\t}\n\t\tme.refreshing = false;\n\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.is_liked = function(doc) {\n\tvar liked = frappe.ui.get_liked_by(doc);\n\treturn liked.indexOf(frappe.session.user)===-1 ? false : true;\n}\n\nfrappe.ui.get_liked_by = function(doc) {\n\tvar liked = doc._liked_by;\n\tif(liked) {\n\t\tliked = JSON.parse(liked);\n\t}\n\n\treturn liked || [];\n}\n\nfrappe.ui.toggle_like = function($btn, doctype, name, callback) {\n\tvar add = $btn.hasClass(\"not-liked\") ? \"Yes\" : \"No\";\n\t// disable click\n\t$btn.css('pointer-events', 'none');\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.like.toggle_like\",\n\t\tquiet: true,\n\t\targs: {\n\t\t\tdoctype: doctype,\n\t\t\tname: name,\n\t\t\tadd: add,\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// renable click\n\t\t\t$btn.css('pointer-events', 'auto');\n\n\t\t\tif(!r.exc) {\n\t\t\t\t// update in all local-buttons\n\t\t\t\tvar action_buttons = $('.like-action[data-name=\"'+ name.replace(/\"/g, '\\\"')\n\t\t\t\t\t+'\"][data-doctype=\"'+ doctype.replace(/\"/g, '\\\"')+'\"]');\n\n\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\taction_buttons.removeClass(\"not-liked\").addClass(\"liked\");\n\t\t\t\t} else {\n\t\t\t\t\taction_buttons.addClass(\"not-liked\").removeClass(\"liked\");\n\t\t\t\t}\n\n\t\t\t\t// update in locals (form)\n\t\t\t\tvar doc = locals[doctype] && locals[doctype][name];\n\t\t\t\tif(doc) {\n\t\t\t\t\tvar liked_by = JSON.parse(doc._liked_by || \"[]\"),\n\t\t\t\t\t\tidx = liked_by.indexOf(frappe.session.user);\n\t\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\t\tif(idx===-1)\n\t\t\t\t\t\t\tliked_by.push(frappe.session.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(idx!==-1) {\n\t\t\t\t\t\t\tliked_by = liked_by.slice(0,idx).concat(liked_by.slice(idx+1))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdoc._liked_by = JSON.stringify(liked_by);\n\t\t\t\t}\n\n\t\t\t\tif(callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfrappe.ui.click_toggle_like = function() {\n\tvar $btn = $(this);\n\tvar $count = $btn.siblings(\".likes-count\");\n\tvar not_liked = $btn.hasClass(\"not-liked\");\n\tvar doctype = $btn.attr(\"data-doctype\");\n\tvar name = $btn.attr(\"data-name\");\n\n\tfrappe.ui.toggle_like($btn, doctype, name, function() {\n\t\tif (not_liked) {\n\t\t\t$count.text(cint($count.text()) + 1);\n\t\t} else {\n\t\t\t$count.text(cint($count.text()) - 1);\n\t\t}\n\t});\n\n\treturn false;\n}\n\nfrappe.ui.setup_like_popover = ($parent, selector, check_not_liked=true) => {\n\tif (frappe.dom.is_touchscreen()) {\n\t\treturn;\n\t}\n\n\t$parent.on('mouseover', selector, function() {\n\t\tconst target_element = $(this);\n\t\ttarget_element.popover({\n\t\t\tanimation: true,\n\t\t\tplacement: 'bottom',\n\t\t\ttrigger: 'manual',\n\t\t\ttemplate: `<div class=\"liked-by-popover popover\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<div class=\"popover-body popover-content\"></div>\n\t\t\t</div>`,\n\t\t\tcontent: () => {\n\t\t\t\tlet liked_by = target_element.parents(\".liked-by\").attr('data-liked-by');\n\t\t\t\tliked_by = liked_by ? decodeURI(liked_by) : '[]';\n\t\t\t\tliked_by = JSON.parse(liked_by);\n\n\t\t\t\tconst user = frappe.session.user;\n\t\t\t\t// hack\n\t\t\t\tif (check_not_liked) {\n\t\t\t\t\tif (target_element.parents(\".liked-by\").find(\".not-liked\").length) {\n\t\t\t\t\t\tif (liked_by.indexOf(user)!==-1) {\n\t\t\t\t\t\t\tliked_by.splice(liked_by.indexOf(user), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (liked_by.indexOf(user)===-1) {\n\t\t\t\t\t\t\tliked_by.push(user);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!liked_by.length) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\tlet liked_by_list = $(`<ul class=\"list-unstyled\"></ul>`);\n\n\t\t\t\t// to show social profile of the user\n\t\t\t\tlet link_base = '/app/user-profile/';\n\n\t\t\t\tliked_by.forEach(user => {\n\t\t\t\t\t// append user list item\n\t\t\t\t\tliked_by_list.append(`\n\t\t\t\t\t\t<li data-user=${user}>${frappe.avatar(user, \"avatar-xs\")}\n\t\t\t\t\t\t\t<span>${frappe.user.full_name(user)}</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`);\n\t\t\t\t});\n\n\t\t\t\tliked_by_list.children('li').click(ev => {\n\t\t\t\t\tlet user = ev.currentTarget.dataset.user;\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t\tfrappe.set_route(link_base + user);\n\t\t\t\t});\n\n\t\t\t\treturn liked_by_list;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\t\ttarget_element.popover('show');\n\n\t\t$(\".popover\").on(\"mouseleave\", () => {\n\t\t\ttarget_element.popover('hide');\n\t\t});\n\n\t\ttarget_element.on('mouseout', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!$('.popover:hover').length) {\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\t});\n\n};","frappe.provide(\"frappe.views\");\n\nfrappe.views.BaseList = class BaseList {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t}\n\n\tshow() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.init(),\n\t\t\t() => this.before_refresh(),\n\t\t\t() => this.refresh(),\n\t\t]);\n\t}\n\n\tinit() {\n\t\tif (this.init_promise) return this.init_promise;\n\n\t\tlet tasks = [\n\t\t\tthis.setup_defaults,\n\t\t\tthis.set_stats,\n\t\t\tthis.setup_fields,\n\t\t\t// make view\n\t\t\tthis.setup_page,\n\t\t\tthis.setup_side_bar,\n\t\t\tthis.setup_main_section,\n\t\t\tthis.setup_view,\n\t\t\tthis.setup_view_menu,\n\t\t].map((fn) => fn.bind(this));\n\n\t\tthis.init_promise = frappe.run_serially(tasks);\n\t\treturn this.init_promise;\n\t}\n\n\tsetup_defaults() {\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.page_title = this.page_title || frappe.router.doctype_layout || __(this.doctype);\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tthis.settings = frappe.listview_settings[this.doctype] || {};\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 20;\n\t\tthis.data = [];\n\t\tthis.method = \"frappe.desk.reportview.get\";\n\n\t\tthis.can_create = frappe.model.can_create(this.doctype);\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\n\t\tthis.fields = [];\n\t\tthis.filters = [];\n\t\tthis.nested_set_conditions = ['descendants of', 'not descendants of', 'ancestors of', 'not ancestors of']\n\t\tthis.sort_by = \"modified\";\n\t\tthis.sort_order = \"desc\";\n\n\t\t// Setup buttons\n\t\tthis.primary_action = null;\n\t\tthis.secondary_action = null;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __(\"Refresh\"),\n\t\t\t\taction: () => this.refresh(),\n\t\t\t\tclass: \"visible-xs\",\n\t\t\t},\n\t\t];\n\t}\n\n\tsetup_fields() {\n\t\tthis.set_fields();\n\t\tthis.build_fields();\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.meta.title_field\n\t\t);\n\n\t\tfields.forEach((f) => this._add_field(f));\n\t}\n\n\tget_fields_in_list_view() {\n\t\treturn this.meta.fields.filter((df) => {\n\t\t\treturn (\n\t\t\t\t(frappe.model.is_value_type(df.fieldtype) &&\n\t\t\t\t\t(df.in_list_view &&\n\t\t\t\t\t\tfrappe.perm.has_perm(\n\t\t\t\t\t\t\tthis.doctype,\n\t\t\t\t\t\t\tdf.permlevel,\n\t\t\t\t\t\t\t\"read\"\n\t\t\t\t\t\t))) ||\n\t\t\t\t(df.fieldtype === \"Currency\" &&\n\t\t\t\t\tdf.options &&\n\t\t\t\t\t!df.options.includes(\":\")) ||\n\t\t\t\tdf.fieldname === \"status\"\n\t\t\t);\n\t\t});\n\t}\n\n\tbuild_fields() {\n\t\t// fill in missing doctype\n\t\tthis.fields = this.fields.map((f) => {\n\t\t\tif (typeof f === \"string\") {\n\t\t\t\tf = [f, this.doctype];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t\t// remove null or undefined values\n\t\tthis.fields = this.fields.filter(Boolean);\n\t\t//de-duplicate\n\t\tthis.fields = this.fields.uniqBy((f) => f[0] + f[1]);\n\t}\n\n\t_add_field(fieldname, doctype) {\n\t\tif (!fieldname) return;\n\n\t\tif (!doctype) doctype = this.doctype;\n\n\t\tif (typeof fieldname === \"object\") {\n\t\t\t// df is passed\n\t\t\tconst df = fieldname;\n\t\t\tfieldname = df.fieldname;\n\t\t\tdoctype = df.parent;\n\t\t}\n\n\t\tif (!this.fields) this.fields = [];\n\t\tconst is_valid_field =\n\t\t\tfrappe.model.std_fields_list.includes(fieldname) ||\n\t\t\tfrappe.meta.has_field(doctype, fieldname) ||\n\t\t\tfieldname === \"_seen\";\n\n\t\tif (!is_valid_field) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fields.push([fieldname, doctype]);\n\t}\n\n\tset_stats() {\n\t\tthis.stats = [\"_user_tags\"];\n\t\t// add workflow field (as priority)\n\t\tthis.workflow_state_fieldname = frappe.workflow.get_state_fieldname(\n\t\t\tthis.doctype\n\t\t);\n\t\tif (this.workflow_state_fieldname) {\n\t\t\tif (!frappe.workflow.workflows[this.doctype][\"override_status\"]) {\n\t\t\t\tthis._add_field(this.workflow_state_fieldname);\n\t\t\t}\n\t\t\tthis.stats.push(this.workflow_state_fieldname);\n\t\t}\n\t}\n\n\tsetup_page() {\n\t\tthis.page = this.parent.page;\n\t\tthis.$page = $(this.parent);\n\t\tthis.page.main.addClass('frappe-card');\n\t\tthis.page.page_form.removeClass(\"row\").addClass(\"flex\");\n\t\tthis.hide_page_form && this.page.page_form.hide();\n\t\tthis.hide_sidebar && this.$page.addClass('no-list-sidebar');\n\t\tthis.setup_page_head();\n\t}\n\n\tsetup_page_head() {\n\t\tthis.set_title();\n\t\tthis.set_menu_items();\n\t\tthis.set_breadcrumbs();\n\t}\n\n\tset_title() {\n\t\tthis.page.set_title(this.page_title);\n\t}\n\n\tsetup_view_menu() {\n\t\t// TODO: add all icons\n\t\tconst icon_map = {\n\t\t\t'Image': 'image-view',\n\t\t\t'List': 'list',\n\t\t\t'Report': 'small-file',\n\t\t\t'Calendar': 'calendar',\n\t\t\t'Gantt': 'gantt',\n\t\t\t'Kanban': 'kanban',\n\t\t\t'Dashboard': 'dashboard',\n\t\t\t'Map': 'map',\n\t\t};\n\n\t\tif (frappe.boot.desk_settings.view_switcher) {\n\t\t\tthis.views_menu = this.page.add_custom_button_group(__('{0} View', [__(this.view_name)]), icon_map[this.view_name] || 'list');\n\t\t\tthis.views_list = new frappe.views.ListViewSelect({\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tparent: this.views_menu,\n\t\t\t\tpage: this.page,\n\t\t\t\tlist_view: this,\n\t\t\t\tsidebar: this.list_sidebar,\n\t\t\t\ticon_map: icon_map\n\t\t\t});\n\t\t}\n\t}\n\n\tset_default_secondary_action() {\n\t\tif (this.secondary_action) {\n\t\t\tconst $secondary_action = this.page.set_secondary_action(\n\t\t\t\tthis.secondary_action.label,\n\t\t\t\tthis.secondary_action.action,\n\t\t\t\tthis.secondary_action.icon\n\t\t\t);\n\t\t\tif (!this.secondary_action.icon) {\n\t\t\t\t$secondary_action.addClass(\"hidden-xs\");\n\t\t\t} else if (!this.secondary_action.label) {\n\t\t\t\t$secondary_action.addClass(\"visible-xs\");\n\t\t\t}\n\t\t} else {\n\t\t\tthis.refresh_button = this.page.add_action_icon(\"refresh\", () => {\n\t\t\t\tthis.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\tset_menu_items() {\n\t\tthis.set_default_secondary_action();\n\n\t\tthis.menu_items && this.menu_items.map((item) => {\n\t\t\tif (item.condition && item.condition() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst $item = this.page.add_menu_item(\n\t\t\t\titem.label,\n\t\t\t\titem.action,\n\t\t\t\titem.standard,\n\t\t\t\titem.shortcut\n\t\t\t);\n\t\t\tif (item.class) {\n\t\t\t\t$item && $item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_breadcrumbs() {\n\t\tfrappe.breadcrumbs.add(this.meta.module, this.doctype);\n\t}\n\n\tsetup_side_bar() {\n\t\tif (this.hide_sidebar || !frappe.boot.desk_settings.list_sidebar) return;\n\t\tthis.list_sidebar = new frappe.views.ListSidebar({\n\t\t\tdoctype: this.doctype,\n\t\t\tstats: this.stats,\n\t\t\tparent: this.$page.find(\".layout-side-section\"),\n\t\t\t// set_filter: this.set_filter.bind(this),\n\t\t\tpage: this.page,\n\t\t\tlist_view: this,\n\t\t});\n\t}\n\n\ttoggle_side_bar(show) {\n\t\tlet show_sidebar = show || JSON.parse(localStorage.show_sidebar || \"true\");\n\t\tshow_sidebar = !show_sidebar;\n\t\tlocalStorage.show_sidebar = show_sidebar;\n\t\tthis.show_or_hide_sidebar();\n\t\t$(document.body).trigger(\"toggleListSidebar\");\n\t}\n\n\tshow_or_hide_sidebar() {\n\t\tlet show_sidebar = JSON.parse(localStorage.show_sidebar || \"true\");\n\t\t$(document.body).toggleClass(\"no-list-sidebar\", !show_sidebar);\n\t}\n\n\tsetup_main_section() {\n\t\treturn frappe.run_serially(\n\t\t\t[\n\t\t\t\tthis.setup_list_wrapper,\n\t\t\t\tthis.show_or_hide_sidebar,\n\t\t\t\tthis.setup_filter_area,\n\t\t\t\tthis.setup_sort_selector,\n\t\t\t\tthis.setup_result_area,\n\t\t\t\tthis.setup_no_result_area,\n\t\t\t\tthis.setup_freeze_area,\n\t\t\t\tthis.setup_paging_area,\n\t\t\t].map((fn) => fn.bind(this))\n\t\t);\n\t}\n\n\tsetup_list_wrapper() {\n\t\tthis.$frappe_list = $('<div class=\"frappe-list\">').appendTo(\n\t\t\tthis.page.main\n\t\t);\n\t}\n\n\tsetup_filter_area() {\n\t\tif (this.hide_filters) return;\n\t\tthis.filter_area = new FilterArea(this);\n\n\t\tif (this.filters && this.filters.length > 0) {\n\t\t\treturn this.filter_area.set(this.filters);\n\t\t}\n\t}\n\n\tsetup_sort_selector() {\n\t\tif (this.hide_sort_selector) return;\n\t\tthis.sort_selector = new frappe.ui.SortSelector({\n\t\t\tparent: this.$filter_section,\n\t\t\tdoctype: this.doctype,\n\t\t\targs: {\n\t\t\t\tsort_by: this.sort_by,\n\t\t\t\tsort_order: this.sort_order,\n\t\t\t},\n\t\t\tonchange: this.on_sort_change.bind(this),\n\t\t});\n\t}\n\n\ton_sort_change() {\n\t\tthis.refresh();\n\t}\n\n\tsetup_result_area() {\n\t\tthis.$result = $(`<div class=\"result\">`);\n\t\tthis.$frappe_list.append(this.$result);\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $('<div class=\"freeze\"></div>').hide();\n\t\tthis.$frappe_list.append(this.$freeze);\n\t}\n\n\tget_no_result_message() {\n\t\treturn __(\"Nothing to show\");\n\t}\n\n\tsetup_paging_area() {\n\t\tconst paging_values = [20, 100, 500];\n\t\tthis.$paging_area = $(\n\t\t\t`<div class=\"list-paging-area level\">\n\t\t\t\t<div class=\"level-left\">\n\t\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t\t${paging_values\n\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t(value) => `\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-paging\"\n\t\t\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t\t\t${value}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.join(\"\")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t<button class=\"btn btn-default btn-more btn-sm\">\n\t\t\t\t\t\t${__(\"Load More\")}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t).hide();\n\t\tthis.$frappe_list.append(this.$paging_area);\n\n\t\t// set default paging btn active\n\t\tthis.$paging_area\n\t\t\t.find(`.btn-paging[data-value=\"${this.page_length}\"]`)\n\t\t\t.addClass(\"btn-info\");\n\n\t\tthis.$paging_area.on(\"click\", \".btn-paging, .btn-more\", (e) => {\n\t\t\tconst $this = $(e.currentTarget);\n\n\t\t\tif ($this.is(\".btn-paging\")) {\n\t\t\t\t// set active button\n\t\t\t\tthis.$paging_area.find(\".btn-paging\").removeClass(\"btn-info\");\n\t\t\t\t$this.addClass(\"btn-info\");\n\n\t\t\t\tthis.start = 0;\n\t\t\t\tthis.page_length = $this.data().value;\n\t\t\t} else if ($this.is(\".btn-more\")) {\n\t\t\t\tthis.start = this.start + this.page_length;\n\t\t\t}\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tget_fields() {\n\t\t// convert [fieldname, Doctype] => tabDoctype.fieldname\n\t\treturn this.fields.map((f) =>\n\t\t\tfrappe.model.get_full_column_name(f[0], f[1])\n\t\t);\n\t}\n\n\tsetup_view() {\n\t\t// for child classes\n\t}\n\n\tget_filter_value(fieldname) {\n\t\tconst filter = this.get_filters_for_args().filter(f => f[1] == fieldname)[0];\n\t\tif (!filter) return;\n\t\treturn {\n\t\t\t'like': filter[3].replace(/^%?|%$/g, ''),\n\t\t\t'not set': null\n\t\t}[filter[2]] || filter[3];\n\t}\n\n\tget_filters_for_args() {\n\t\t// filters might have a fifth param called hidden,\n\t\t// we don't want to pass that server side\n\t\treturn this.filter_area\n\t\t\t? this.filter_area.get()\n\t\t\t.filter(f => !this.nested_set_conditions.includes(f[2]))\n\t\t\t.map((filter) => filter.slice(0, 4))\n\t\t\t: [];\n\t}\n\n\tget_or_filters_for_args() {\n\t\tconst nested_filters = this.filter_area ? this.filter_area.get()\n\t\t\t.filter(f => this.nested_set_conditions.includes(f[2]))\n\t\t\t.map((filter) => filter.slice(0, 4))\n\t\t\t: [];\n\n\t\tconst or_filter = nested_filters.length ? nested_filters.map(f => {\n\t\t\tconst n = f.slice()\n\t\t\tn.splice(2, 1, \"=\")\n\t\t\treturn n\n\t\t}) : []\n\n\t\treturn nested_filters.length ? nested_filters.concat(or_filter) : []\n\t}\n\n\tget_args() {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tfields: this.get_fields(),\n\t\t\tfilters: this.get_filters_for_args(),\n\t\t\tor_filters: this.get_or_filters_for_args(),\n\t\t\torder_by: this.sort_selector && this.sort_selector.get_sql_string(),\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length,\n\t\t\tview: this.view,\n\t\t};\n\t}\n\n\tget_call_args() {\n\t\tconst args = this.get_args();\n\t\treturn {\n\t\t\tmethod: this.method,\n\t\t\targs: args,\n\t\t\tfreeze: this.freeze_on_refresh || false,\n\t\t\tfreeze_message: this.freeze_message || __(\"Loading\") + \"...\",\n\t\t};\n\t}\n\n\tbefore_refresh() {\n\t\t// modify args here just before making the request\n\t\t// see list_view.js\n\t}\n\n\trefresh() {\n\t\tthis.freeze(true);\n\t\t// fetch data from server\n\t\treturn frappe.call(this.get_call_args()).then((r) => {\n\t\t\t// render\n\t\t\tthis.prepare_data(r);\n\t\t\tthis.toggle_result_area();\n\t\t\tthis.before_render();\n\t\t\tthis.render();\n\t\t\tthis.after_render();\n\t\t\tthis.freeze(false);\n\t\t\tif (this.settings.refresh) {\n\t\t\t\tthis.settings.refresh(this);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_data(r) {\n\t\tlet data = r.message || {};\n\t\tdata = !Array.isArray(data)\n\t\t\t? frappe.utils.dict(data.keys, data.values)\n\t\t\t: data;\n\n\t\tif (this.start === 0) {\n\t\t\tthis.data = data;\n\t\t} else {\n\t\t\tthis.data = this.data.concat(data);\n\t\t}\n\n\t\tthis.data = this.data.uniqBy((d) => d.name);\n\t}\n\n\tfreeze() {\n\t\t// show a freeze message while data is loading\n\t}\n\n\tbefore_render() {}\n\n\tafter_render() {}\n\n\trender() {\n\t\t// for child classes\n\t}\n\n\ton_filter_change() {\n\t\t// fired when filters are added or removed\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t\tthis.$paging_area.toggle(this.data.length > 0);\n\t\tthis.$no_result.toggle(this.data.length == 0);\n\n\t\tconst show_more = this.start + this.page_length <= this.data.length;\n\t\tthis.$paging_area.find(\".btn-more\").toggle(show_more);\n\t}\n\n\tcall_for_selected_items(method, args = {}) {\n\t\targs.names = this.get_checked_items(true);\n\n\t\tfrappe.call({\n\t\t\tmethod: method,\n\t\t\targs: args,\n\t\t\tfreeze: true,\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n};\n\nclass FilterArea {\n\tconstructor(list_view) {\n\t\tthis.list_view = list_view;\n\t\tthis.list_view.page.page_form.append(`<div class=\"standard-filter-section flex\"></div>`);\n\t\tconst filter_area = this.list_view.hide_page_form\n\t\t\t? this.list_view.page.custom_actions\n\t\t\t: this.list_view.page.page_form;\n\t\tthis.list_view.$filter_section = $('<div class=\"filter-section flex\">').appendTo(\n\t\t\tfilter_area\n\t\t)\n\t\tthis.$filter_list_wrapper = this.list_view.$filter_section;\n\t\tthis.trigger_refresh = true;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tif (!this.list_view.hide_page_form) this.make_standard_filters();\n\t\tthis.make_filter_list();\n\t}\n\n\tget() {\n\t\tlet filters = this.filter_list.get_filters();\n\t\tlet standard_filters = this.get_standard_filters();\n\n\t\treturn filters.concat(standard_filters).uniqBy(JSON.stringify);\n\t}\n\n\tset(filters) {\n\t\t// use to method to set filters without triggering refresh\n\t\tthis.trigger_refresh = false;\n\t\treturn this.add(filters, false).then(() => {\n\t\t\tthis.trigger_refresh = true;\n\t\t\tthis.filter_list.update_filter_button();\n\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || (Array.isArray(filters) && filters.length === 0))\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === \"string\") {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter((f) => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(\n\t\t\tfilters\n\t\t);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn (\n\t\t\t\t\tnon_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters)\n\t\t\t\t);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n\n\trefresh_list_view() {\n\t\tif (this.trigger_refresh) {\n\t\t\tthis.list_view.start = 0;\n\t\t\tthis.list_view.refresh();\n\t\t\tthis.list_view.on_filter_change();\n\t\t}\n\t}\n\n\texists(f) {\n\t\tlet exists = false;\n\t\t// check in standard filters\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tif (f[2] === \"=\" && f[1] in fields_dict) {\n\t\t\tconst value = fields_dict[f[1]].get_value();\n\t\t\tif (value) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t}\n\n\t\t// check in filter area\n\t\tif (!exists) {\n\t\t\texists = this.filter_list.filter_exists(f);\n\t\t}\n\n\t\treturn exists;\n\t}\n\n\tset_standard_filter(filters) {\n\t\tif (filters.length === 0) {\n\t\t\treturn {\n\t\t\t\tnon_standard_filters: [],\n\t\t\t\tpromise: Promise.resolve(),\n\t\t\t};\n\t\t}\n\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tlet out = filters.reduce((out, filter) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst [dt, fieldname, condition, value] = filter;\n\t\t\tout.promise = out.promise || Promise.resolve();\n\t\t\tout.non_standard_filters = out.non_standard_filters || [];\n\n\t\t\tif (\n\t\t\t\tfields_dict[fieldname] &&\n\t\t\t\t(condition === \"=\" || condition === \"like\" || condition === \"descendants of\")\n\t\t\t) {\n\t\t\t\t// standard filter\n\t\t\t\tout.promise = out.promise.then(() =>\n\t\t\t\t\tfields_dict[fieldname].set_value(value)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// filter out non standard filters\n\t\t\t\tout.non_standard_filters.push(filter);\n\t\t\t}\n\t\t\treturn out;\n\t\t}, {});\n\n\t\treturn out;\n\t}\n\n\tremove_filters(filters) {\n\t\tfilters.map(f => {\n\t\t\tthis.remove(f[1]);\n\t\t});\n\t}\n\n\tremove(fieldname) {\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tif (fieldname in fields_dict) {\n\t\t\tfields_dict[fieldname].set_value(\"\");\n\t\t}\n\n\t\tlet filter = this.filter_list.get_filter(fieldname);\n\t\tif (filter) filter.remove();\n\t\tthis.filter_list.apply();\n\t\treturn Promise.resolve();\n\t}\n\n\tclear(refresh = true) {\n\t\tif (!refresh) {\n\t\t\tthis.trigger_refresh = false;\n\t\t}\n\n\t\tthis.filter_list.clear_filters();\n\n\t\tconst promises = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tconst field = this.list_view.page.fields_dict[key];\n\t\t\tpromises.push(() => field.set_value(\"\"));\n\t\t}\n\t\treturn frappe.run_serially(promises).then(() => {\n\t\t\tthis.trigger_refresh = true;\n\t\t});\n\t}\n\n\tmake_standard_filters() {\n\t\tthis.standard_filters_wrapper = this.list_view.page.page_form.find('.standard-filter-section');\n\t\tconst context = this.list_view && this.list_view.doctype ? this.list_view.doctype : null\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: __(\"Name\"),\n\t\t\t\tcondition: \"like\",\n\t\t\t\tfieldname: \"name\",\n\t\t\t\tonchange: () => this.refresh_list_view(),\n\t\t\t},\n\t\t];\n\n\t\tif (this.list_view.custom_filter_configs) {\n\t\t\tthis.list_view.custom_filter_configs.forEach((config) => {\n\t\t\t\tconfig.onchange = () => this.refresh_list_view();\n\t\t\t});\n\n\t\t\tfields = fields.concat(this.list_view.custom_filter_configs);\n\t\t}\n\n\t\tconst doctype_fields = this.list_view.meta.fields;\n\t\tconst title_field = this.list_view.meta.title_field;\n\t\tconst standard_filter_fields = doctype_fields\n\t\t\t.filter(\n\t\t\t\t(df) =>\n\t\t\t\t\tdf.fieldname === title_field ||\n\t\t\t\t\t(df.in_standard_filter &&\n\t\t\t\t\t\tfrappe.model.is_value_type(df.fieldtype))\n\t\t\t)\n\n\t\tfields = fields.concat(\n\t\t\t\tstandard_filter_fields.map(df => {\n\t\t\t\t\tif (df.fieldtype === 'Link' && frappe.boot.nested_set_doctypes.includes(df.options)) {\n\t\t\t\t\t\treturn Object.assign(df, {condition: \"descendants of\"})\n\t\t\t\t\t}\n\t\t\t\t\treturn df\n\t\t\t\t}).map((df) => {\n\t\t\t\t\tlet options = df.options;\n\t\t\t\t\tlet condition = df.condition || \"=\";\n\t\t\t\t\tlet fieldtype = df.fieldtype;\n\t\t\t\t\tif (\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"Text\",\n\t\t\t\t\t\t\t\"Small Text\",\n\t\t\t\t\t\t\t\"Text Editor\",\n\t\t\t\t\t\t\t\"HTML Editor\",\n\t\t\t\t\t\t\t\"Data\",\n\t\t\t\t\t\t\t\"Code\",\n\t\t\t\t\t\t\t\"Read Only\",\n\t\t\t\t\t\t].includes(fieldtype)\n\t\t\t\t\t) {\n\t\t\t\t\t\tfieldtype = \"Data\";\n\t\t\t\t\t\tcondition = \"like\";\n\t\t\t\t\t}\n\t\t\t\t\tif (df.fieldtype == \"Select\" && df.options) {\n\t\t\t\t\t\toptions = df.options.split(\"\\n\");\n\t\t\t\t\t\tif (options.length > 0 && options[0] != \"\") {\n\t\t\t\t\t\t\toptions.unshift(\"\");\n\t\t\t\t\t\t\toptions = options.join(\"\\n\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet default_value =\n\t\t\t\t\t\tfieldtype === \"Link\"\n\t\t\t\t\t\t\t? frappe.defaults.get_user_default(options)\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\tif ([\"__default\", \"__global\"].includes(default_value)) {\n\t\t\t\t\t\tdefault_value = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfieldtype: fieldtype,\n\t\t\t\t\t\tlabel: __(df.label, null, context),\n\t\t\t\t\t\tcontext: context,\n\t\t\t\t\t\toptions: options,\n\t\t\t\t\t\tfieldname: df.fieldname,\n\t\t\t\t\t\tcondition: condition,\n\t\t\t\t\t\tdefault: default_value,\n\t\t\t\t\t\tonchange: () => this.refresh_list_view(),\n\t\t\t\t\t\tignore_link_validation: fieldtype === \"Dynamic Link\",\n\t\t\t\t\t\tis_filter: 1,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t);\n\n\t\tfields.map(df => {\n\t\t\tthis.list_view.page.add_field(df, this.standard_filters_wrapper);\n\t\t});\n\t}\n\n\tget_standard_filters() {\n\t\tconst filters = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tlet field = fields_dict[key];\n\t\t\tlet value = field.get_value();\n\t\t\tif (value) {\n\t\t\t\tif (field.df.condition === \"like\" && !value.includes(\"%\")) {\n\t\t\t\t\tvalue = \"%\" + value + \"%\";\n\t\t\t\t}\n\t\t\t\tfilters.push([\n\t\t\t\t\tthis.list_view.doctype,\n\t\t\t\t\tfield.df.fieldname,\n\t\t\t\t\tfield.df.condition || \"=\",\n\t\t\t\t\tvalue,\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tmake_filter_list() {\n\t\t$(`<div class=\"filter-selector\">\n\t\t\t<button class=\"btn btn-default btn-sm filter-button\">\n\t\t\t\t<span class=\"filter-icon\">\n\t\t\t\t\t${frappe.utils.icon('filter')}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"button-label hidden-xs\">\n\t\t\t\t\t${__(\"Filter\")}\n\t\t\t\t<span>\n\t\t\t</button>\n\t\t</div>`\n\t\t).appendTo(this.$filter_list_wrapper);\n\n\t\tthis.filter_button = this.$filter_list_wrapper.find('.filter-button');\n\t\tthis.filter_list = new frappe.ui.FilterGroup({\n\t\t\tbase_list: this.list_view,\n\t\t\tparent: this.$filter_list_wrapper,\n\t\t\tdoctype: this.list_view.doctype,\n\t\t\tfilter_button: this.filter_button,\n\t\t\tdefault_filters: [],\n\t\t\ton_change: () => this.refresh_list_view(),\n\t\t});\n\t}\n\n\tis_being_edited() {\n\t\t// returns true if user is currently editing filters\n\t\treturn (\n\t\t\tthis.filter_list &&\n\t\t\tthis.filter_list.wrapper &&\n\t\t\tthis.filter_list.wrapper.find(\".filter-box:visible\").length > 0\n\t\t);\n\t}\n}\n\n// utility function to validate view modes\nfrappe.views.view_modes = [\n\t\"List\",\n\t\"Report\",\n\t\"Dashboard\",\n\t\"Gantt\",\n\t\"Kanban\",\n\t\"Calendar\",\n\t\"Image\",\n\t\"Inbox\",\n\t\"Tree\",\n\t\"Map\",\n];\nfrappe.views.is_valid = (view_mode) =>\n\tfrappe.views.view_modes.includes(view_mode);","export default class BulkOperations {\n\tconstructor({ doctype }) {\n\t\tif (!doctype) frappe.throw(__('Doctype required'));\n\t\tthis.doctype = doctype;\n\t}\n\n\tprint(docs) {\n\t\tconst print_settings = frappe.model.get_doc(':Print Settings', 'Print Settings');\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst is_submittable = frappe.model.is_submittable(this.doctype);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tconst valid_docs = docs.filter(doc => {\n\t\t\treturn !is_submittable || doc.docstatus === 1 ||\n\t\t\t\t(allow_print_for_cancelled && doc.docstatus == 2) ||\n\t\t\t\t(allow_print_for_draft && doc.docstatus == 0) ||\n\t\t\t\tfrappe.user.has_role('Administrator');\n\t\t}).map(doc => doc.name);\n\n\t\tconst invalid_docs = docs.filter(doc => !valid_docs.includes(doc.name));\n\n\t\tif (invalid_docs.length > 0) {\n\t\t\tfrappe.msgprint(__('You selected Draft or Cancelled documents'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (valid_docs.length > 0) {\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Print Documents'),\n\t\t\t\tfields: [{\n\t\t\t\t\t'fieldtype': 'Check',\n\t\t\t\t\t'label': __('With Letterhead'),\n\t\t\t\t\t'fieldname': 'with_letterhead'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'label': __('Print Format'),\n\t\t\t\t\t'fieldname': 'print_sel',\n\t\t\t\t\toptions: frappe.meta.get_print_formats(this.doctype)\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tdialog.set_primary_action(__('Print'), args => {\n\t\t\t\tif (!args) return;\n\t\t\t\tconst default_print_format = frappe.get_meta(this.doctype).default_print_format;\n\t\t\t\tconst with_letterhead = args.with_letterhead ? 1 : 0;\n\t\t\t\tconst print_format = args.print_sel ? args.print_sel : default_print_format;\n\t\t\t\tconst json_string = JSON.stringify(valid_docs);\n\n\t\t\t\tconst w = window.open('/api/method/frappe.utils.print_format.download_multi_pdf?' +\n\t\t\t\t\t'doctype=' + encodeURIComponent(this.doctype) +\n\t\t\t\t\t'&name=' + encodeURIComponent(json_string) +\n\t\t\t\t\t'&format=' + encodeURIComponent(print_format) +\n\t\t\t\t\t'&no_letterhead=' + (with_letterhead ? '0' : '1'));\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__('Please enable pop-ups'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select atleast 1 record for printing'));\n\t\t}\n\t}\n\n\tdelete(docnames, done = null) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.reportview.delete_items',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\titems: docnames,\n\t\t\t\t\tdoctype: this.doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot delete {0}', [failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound('delete');\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tassign(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tconst assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: this,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add_multiple',\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocname: docnames,\n\t\t\t\tbulk_assign: true,\n\t\t\t\tre_assign: true,\n\t\t\t\tcallback: done\n\t\t\t});\n\t\t\tassign_to.dialog.clear();\n\t\t\tassign_to.dialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select records for assignment'));\n\t\t}\n\t}\n\n\tapply_assignment_rule(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tfrappe.call('frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply', {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocnames: docnames\n\t\t\t}).then(() => done());\n\t\t}\n\t}\n\n\tsubmit_or_cancel(docnames, action='submit', done=null) {\n\t\taction = action.toLowerCase();\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\taction: action,\n\t\t\t\t\tdocnames: docnames\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot {0} {1}', [action, failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound(action);\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tedit(docnames, field_mappings, done) {\n\t\tconst field_options = Object.keys(field_mappings).map(v => {\n\t\t\treturn {label: __(v), value: v}\n\t\t})\n\n\t\tconst status_regex = /status/i;\n\n\t\tconst default_field = Object.keys(field_mappings).find(value => status_regex.test(value));\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'options': field_options.sort(function(a, b) {\n\t\t\t\t\t\tconst nameA = a.label.toUpperCase();\n\t\t\t\t\t\tconst nameB = b.label.toUpperCase();\n\t\t\t\t\t\tif (nameA < nameB) {\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nameA > nameB) {\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}),\n\t\t\t\t\t'default': default_field,\n\t\t\t\t\t'label': __('Field'),\n\t\t\t\t\t'fieldname': 'field',\n\t\t\t\t\t'reqd': 1,\n\t\t\t\t\t'onchange': () => {\n\t\t\t\t\t\tset_value_field(dialog);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t\t'label': __('Value'),\n\t\t\t\t\t'fieldname': 'value',\n\t\t\t\t\t'reqd': 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: ({ value }) => {\n\t\t\t\tconst fieldname = field_mappings[dialog.get_value('field')].fieldname;\n\t\t\t\tdialog.disable_primary_action();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tdocnames: docnames,\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t[fieldname]: value\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tlet failed = r.message || [];\n\n\t\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\t\tdialog.enable_primary_action();\n\t\t\t\t\t\tfrappe.throw(__('Cannot update {0}', [failed.map(f => f.bold ? f.bold() : f).join(', ')]));\n\t\t\t\t\t}\n\t\t\t\t\tdone();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\tfrappe.msgprint(__('Updated successfully'));\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Update')\n\t\t});\n\n\t\tif (default_field) set_value_field(dialog); // to set `Value` df based on default `Field`\n\n\t\tfunction set_value_field(dialogObj) {\n\t\t\tconst new_df = Object.assign({},\n\t\t\t\tfield_mappings[dialogObj.get_value('field')]);\n\t\t\t/* if the field label has status in it and\n\t\t\tif it has select fieldtype with no default value then\n\t\t\tset a default value from the available option. */\n\t\t\tif(new_df.label.match(status_regex) &&\n\t\t\t\tnew_df.fieldtype === 'Select' && !new_df.default) {\n\t\t\t\tlet options = [];\n\t\t\t\tif(typeof new_df.options===\"string\") {\n\t\t\t\t\toptions = new_df.options.split(\"\\n\");\n\t\t\t\t}\n\t\t\t\t//set second option as default if first option is an empty string\n\t\t\t\tnew_df.default = options[0] || options[1];\n\t\t\t}\n\t\t\tnew_df.label = __('Value');\n\t\t\tnew_df.reqd = 1;\n\t\t\tdelete new_df.depends_on;\n\t\t\tdialogObj.replace_field('value', new_df);\n\t\t}\n\n\t\tdialog.refresh();\n\t\tdialog.show();\n\t}\n\n\tadd_tags(docnames, done) {\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Tags'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'MultiSelectPills',\n\t\t\t\t\tfieldname: 'tags',\n\t\t\t\t\tlabel: __(\"Tags\"),\n\t\t\t\t\treqd: true,\n\t\t\t\t\tget_data: function(txt) {\n\t\t\t\t\t\treturn frappe.db.get_link_options(\"Tag\", txt);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet args = dialog.get_values();\n\t\t\t\tif (args && args.tags) {\n\t\t\t\t\tdialog.set_message(\"Adding Tags...\");\n\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.add_tags\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'tags': args.tags,\n\t\t\t\t\t\t\t'dt': this.doctype,\n\t\t\t\t\t\t\t'docs': docnames,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tdialog.show();\n\t}\n}\n","export default class ListSettings {\n\tconstructor({ listview, doctype, meta, settings }) {\n\t\tif (!doctype) {\n\t\t\tfrappe.throw('DocType required');\n\t\t}\n\n\t\tthis.listview = listview;\n\t\tthis.doctype = doctype;\n\t\tthis.meta = meta;\n\t\tthis.settings = settings;\n\t\tthis.dialog = null;\n\t\tthis.fields = this.settings && this.settings.fields ? JSON.parse(this.settings.fields) : [];\n\t\tthis.subject_field = null;\n\n\t\tfrappe.model.with_doctype(\"List View Settings\", () => {\n\t\t\tthis.make();\n\t\t\tthis.get_listview_fields(meta);\n\t\t\tthis.setup_fields();\n\t\t\tthis.setup_remove_fields();\n\t\t\tthis.add_new_fields();\n\t\t\tthis.show_dialog();\n\t\t});\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\n\t\tlet list_view_settings = frappe.get_meta(\"List View Settings\");\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"{0} Settings\", [__(me.doctype)]),\n\t\t\tfields: list_view_settings.fields\n\t\t});\n\t\tme.dialog.set_values(me.settings);\n\t\tme.dialog.set_primary_action(__('Save'), () => {\n\t\t\tlet values = me.dialog.get_values();\n\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Saving\"),\n\t\t\t\tindicator: \"green\"\n\t\t\t});\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\tlistview_settings: values,\n\t\t\t\t\tremoved_listview_fields: me.removed_fields || []\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.listview.refresh_columns(r.message.meta, r.message.listview_settings);\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tme.dialog.fields_dict[\"total_fields\"].df.onchange = () => me.refresh();\n\t}\n\n\trefresh() {\n\t\tlet me = this;\n\n\t\tme.setup_fields();\n\t\tme.add_new_fields();\n\t\tme.setup_remove_fields();\n\t}\n\n\tshow_dialog() {\n\t\tlet me = this;\n\n\t\tif (!this.settings.fields) {\n\t\t\tme.update_fields();\n\t\t}\n\n\t\tif (!me.dialog.get_value(\"total_fields\")) {\n\t\t\tlet field_count = me.fields.length;\n\n\t\t\tif (field_count < 4) {\n\t\t\t\tfield_count = 4;\n\t\t\t} else if (field_count > 10) {\n\t\t\t\tfield_count = 4;\n\t\t\t}\n\n\t\t\tme.dialog.set_value(\"total_fields\", field_count);\n\t\t}\n\n\t\tme.dialog.show();\n\t}\n\n\tsetup_fields() {\n\t\tfunction is_status_field(field) {\n\t\t\treturn field.fieldname === \"status_field\";\n\t\t}\n\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet wrapper = fields_html.$wrapper[0];\n\t\tlet fields = ``;\n\t\tlet total_fields = me.dialog.get_values().total_fields || me.settings.total_fields;\n\n\t\tfor (let idx in me.fields) {\n\t\t\tif (idx == parseInt(total_fields)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet is_sortable = (idx == 0) ? `` : `sortable`;\n\t\t\tlet show_sortable_handle = (idx == 0) ? `hide` : ``;\n\t\t\tlet can_remove = (idx == 0 || is_status_field(me.fields[idx])) ? `hide` : ``;\n\n\t\t\tfields += `\n\t\t\t\t<div class=\"control-input flex align-center form-control fields_order ${is_sortable}\"\n\t\t\t\t\tstyle=\"display: block; margin-bottom: 5px;\" data-fieldname=\"${me.fields[idx].fieldname}\"\n\t\t\t\t\tdata-label=\"${me.fields[idx].label}\" data-type=\"${me.fields[idx].type}\">\n\n\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t<div class=\"col-md-1\">\n\t\t\t\t\t\t\t<i class=\"fa fa-bars text-muted sortable-handle ${show_sortable_handle}\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"col-md-10\" style=\"padding-left:0px;\">\n\t\t\t\t\t\t\t${__(me.fields[idx].label)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"col-md-1 ${can_remove}\">\n\t\t\t\t\t\t\t<a class=\"text-muted remove-field\" data-fieldname=\"${me.fields[idx].fieldname}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t}\n\n\t\tfields_html.html(`\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<div class=\"clearfix\">\n\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">${__(\"Fields\")}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"control-input-wrapper\">\n\t\t\t\t${fields}\n\t\t\t\t</div>\n\t\t\t\t<p class=\"help-box small text-muted hidden-xs\">\n\t\t\t\t\t<a class=\"add-new-fields text-muted\">\n\t\t\t\t\t\t${__(\"+ Add / Remove Fields\")}\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`);\n\n\t\tnew Sortable(wrapper.getElementsByClassName(\"control-input-wrapper\")[0], {\n\t\t\thandle: '.sortable-handle',\n\t\t\tdraggable: '.sortable',\n\t\t\tonUpdate: () => {\n\t\t\t\tme.update_fields();\n\t\t\t\tme.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_new_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet add_new_fields = fields_html.$wrapper[0].getElementsByClassName(\"add-new-fields\")[0];\n\t\tadd_new_fields.onclick = () => me.column_selector();\n\t}\n\n\tsetup_remove_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet remove_fields = fields_html.$wrapper[0].getElementsByClassName(\"remove-field\");\n\n\t\tfor (let idx = 0; idx < remove_fields.length; idx++) {\n\t\t\tremove_fields.item(idx).onclick = () => me.remove_fields(remove_fields.item(idx).getAttribute(\"data-fieldname\"));\n\t\t}\n\t}\n\n\tremove_fields(fieldname) {\n\t\tlet me = this;\n\t\tlet existing_fields = me.fields.map(f => f.fieldname);\n\n\t\tfor (let idx in me.fields) {\n\t\t\tlet field = me.fields[idx];\n\n\t\t\tif (field.fieldname == fieldname) {\n\t\t\t\tme.fields.splice(idx, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tme.set_removed_fields(me.get_removed_listview_fields(me.fields.map(f => f.fieldname), existing_fields));\n\t\tme.refresh();\n\t\tme.update_fields();\n\t}\n\n\tupdate_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet wrapper = fields_html.$wrapper[0];\n\n\t\tlet fields_order = wrapper.getElementsByClassName(\"fields_order\");\n\t\tme.fields = [];\n\n\t\tfor (let idx = 0; idx < fields_order.length; idx++) {\n\t\t\tme.fields.push({\n\t\t\t\tfieldname: fields_order.item(idx).getAttribute(\"data-fieldname\"),\n\t\t\t\tlabel: fields_order.item(idx).getAttribute(\"data-label\")\n\t\t\t});\n\t\t}\n\n\t\tme.dialog.set_value(\"fields\", JSON.stringify(me.fields));\n\t\tme.dialog.get_value(\"fields\");\n\t}\n\n\tcolumn_selector() {\n\t\tlet me = this;\n\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"{0} Fields\", [__(me.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Reset Fields\"),\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tfieldname: \"reset_fields\",\n\t\t\t\t\tclick: () => me.reset_listview_fields(d)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Select Fields\"),\n\t\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\t\tfieldname: \"fields\",\n\t\t\t\t\toptions: me.get_doctype_fields(me.meta, me.fields.map(f => f.fieldname)),\n\t\t\t\t\tcolumns: 2\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\td.set_primary_action(__('Save'), () => {\n\t\t\tlet values = d.get_values().fields;\n\n\t\t\tme.set_removed_fields(me.get_removed_listview_fields(values, me.fields.map(f => f.fieldname)));\n\n\t\t\tme.fields = [];\n\t\t\tme.set_subject_field(me.meta);\n\t\t\tme.set_status_field();\n\n\t\t\tfor (let idx in values) {\n\t\t\t\tlet value = values[idx];\n\n\t\t\t\tif (me.fields.length === parseInt(me.dialog.get_values().total_fields)) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (value != me.subject_field.fieldname) {\n\t\t\t\t\tlet field = frappe.meta.get_docfield(me.doctype, value);\n\t\t\t\t\tif (field) {\n\t\t\t\t\t\tme.fields.push({\n\t\t\t\t\t\t\tlabel: field.label,\n\t\t\t\t\t\t\tfieldname: field.fieldname\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tme.refresh();\n\t\t\tme.dialog.set_value(\"fields\", JSON.stringify(me.fields));\n\t\t\td.hide();\n\t\t});\n\t\td.show();\n\t}\n\n\treset_listview_fields(dialog) {\n\t\tlet me = this;\n\n\t\tfrappe.xcall(\"frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields\", {\n\t\t\tdoctype: me.doctype\n\t\t}).then((fields) => {\n\t\t\tlet field = dialog.get_field(\"fields\");\n\t\t\tfield.df.options = me.get_doctype_fields(me.meta, fields);\n\t\t\tdialog.refresh();\n\t\t});\n\n\t}\n\n\tget_listview_fields(meta) {\n\t\tlet me = this;\n\n\t\tif (!me.settings.fields) {\n\t\t\tme.set_list_view_fields(meta);\n\t\t} else {\n\t\t\tme.fields = JSON.parse(this.settings.fields);\n\t\t}\n\n\t\tme.fields.uniqBy(f => f.fieldname);\n\t}\n\n\tset_list_view_fields(meta) {\n\t\tlet me = this;\n\n\t\tme.set_subject_field(meta);\n\t\tme.set_status_field();\n\n\t\tmeta.fields.forEach(field => {\n\t\t\tif (field.in_list_view && !in_list(frappe.model.no_value_type, field.fieldtype) &&\n\t\t\t\tme.subject_field.fieldname != field.fieldname) {\n\n\t\t\t\tme.fields.push({\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tfieldname: field.fieldname\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_subject_field(meta) {\n\t\tlet me = this;\n\n\t\tme.subject_field = {\n\t\t\tlabel: __(\"Name\"),\n\t\t\tfieldname: \"name\"\n\t\t};\n\n\t\tif (meta.title_field) {\n\t\t\tlet field = frappe.meta.get_docfield(me.doctype, meta.title_field.trim());\n\n\t\t\tme.subject_field = {\n\t\t\t\tlabel: field.label,\n\t\t\t\tfieldname: field.fieldname\n\t\t\t};\n\t\t}\n\n\t\tme.fields.push(me.subject_field);\n\t}\n\n\tset_status_field() {\n\t\tlet me = this;\n\n\t\tif (frappe.has_indicator(me.doctype)) {\n\t\t\tme.fields.push({\n\t\t\t\ttype: \"Status\",\n\t\t\t\tlabel: __(\"Status\"),\n\t\t\t\tfieldname: \"status_field\"\n\t\t\t});\n\t\t}\n\t}\n\n\tget_doctype_fields(meta, fields) {\n\t\tlet multiselect_fields = [];\n\n\t\tmeta.fields.forEach(field => {\n\t\t\tif (!in_list(frappe.model.no_value_type, field.fieldtype)) {\n\t\t\t\tmultiselect_fields.push({\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tvalue: field.fieldname,\n\t\t\t\t\tchecked: in_list(fields, field.fieldname)\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn multiselect_fields;\n\t}\n\n\tget_removed_listview_fields(new_fields, existing_fields) {\n\t\tlet me = this;\n\t\tlet removed_fields = [];\n\n\t\tif (frappe.has_indicator(me.doctype)) {\n\t\t\tnew_fields.push(\"status_field\");\n\t\t}\n\n\t\texisting_fields.forEach(column => {\n\t\t\tif (!in_list(new_fields, column)) {\n\t\t\t\tremoved_fields.push(column);\n\t\t\t}\n\t\t});\n\n\t\treturn removed_fields;\n\t}\n\n\tset_removed_fields(fields) {\n\t\tlet me = this;\n\n\t\tif (me.removed_fields) {\n\t\t\tme.removed_fields.concat(fields);\n\t\t} else {\n\t\t\tme.removed_fields = fields;\n\t\t}\n\t}\n}\n","import BulkOperations from \"./bulk_operations\";\nimport ListSettings from \"./list_settings\";\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ListView = class ListView extends frappe.views.BaseList {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tconst doctype = route[1];\n\t\tconst parsed_route = frappe.router.get_sub_path_string().split('/')\n\n\t\tif (parsed_route.length === 1) {\n\t\t\tconst user_settings = frappe.get_user_settings(doctype);\n\t\t\tconst last_view = user_settings.last_view;\n\t\t\tif (last_view && last_view.toLowerCase() != \"list\") {\n\t\t\t\tfrappe.set_route(\n\t\t\t\t\t\"list\",\n\t\t\t\t\tfrappe.router.doctype_layout || doctype,\n\t\t\t\t\tfrappe.views.is_valid(last_view) ? last_view.toLowerCase() : \"list\"\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.show();\n\t}\n\n\thas_permissions() {\n\t\tconst can_read = frappe.perm.has_perm(this.doctype, 0, \"read\");\n\t\treturn can_read;\n\t}\n\n\tshow() {\n\t\tthis.parent.disable_scroll_to_top = true;\n\n\t\tif (!this.has_permissions()) {\n\t\t\tfrappe.set_route(\"\");\n\t\t\tfrappe.msgprint(__(\"Not permitted to view {0}\", [__(this.doctype)]));\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.show();\n\t}\n\n\tget view_name() {\n\t\t// __(\"List\")\n\t\treturn \"List\";\n\t}\n\n\tget view_user_settings() {\n\t\treturn this.user_settings[this.view_name] || {};\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\tthis.view = \"List\";\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || \"modified\";\n\t\tthis.sort_order = this.view_user_settings.sort_order || \"desc\";\n\n\t\t// set filters from user_settings or list_settings\n\t\tif (\n\t\t\tthis.view_user_settings.filters &&\n\t\t\tthis.view_user_settings.filters.length\n\t\t) {\n\t\t\t// Priority 1: user_settings\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map((f) => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\t// build menu items\n\t\tthis.menu_items = this.menu_items.concat(this.get_menu_items());\n\n\t\tif (\n\t\t\tthis.view_user_settings.filters &&\n\t\t\tthis.view_user_settings.filters.length\n\t\t) {\n\t\t\t// Priority 1: saved filters\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map((f) => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\tif (this.view_name == 'List') this.toggle_paging = true;\n\n\t\tthis.patch_refresh_and_load_lib();\n\t\treturn this.get_list_view_settings();\n\t}\n\n\tget_list_view_settings() {\n\t\treturn frappe\n\t\t\t.call(\"frappe.desk.listview.get_list_settings\", {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t})\n\t\t\t.then((doc) => (this.list_view_settings = doc.message || {}));\n\t}\n\n\ton_sort_change(sort_by, sort_order) {\n\t\tthis.sort_by = sort_by;\n\t\tthis.sort_order = sort_order;\n\t\tsuper.on_sort_change();\n\t}\n\n\tvalidate_filters(filters) {\n\t\tlet valid_fields = this.meta.fields.map(df => df.fieldname);\n\t\tvalid_fields = valid_fields.concat(frappe.model.std_fields_list);\n\t\treturn filters\n\t\t\t.filter((f) => valid_fields.includes(f[1]))\n\t\t\t.uniqBy((f) => f[1]);\n\t}\n\n\tsetup_page() {\n\t\tthis.parent.list_view = this;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_page_head() {\n\t\tsuper.setup_page_head();\n\t\tthis.set_primary_action();\n\t\tthis.set_actions_menu_items();\n\t}\n\n\tset_actions_menu_items() {\n\t\tthis.actions_menu_items = this.get_actions_menu_items();\n\t\tthis.workflow_action_menu_items = this.get_workflow_action_menu_items();\n\t\tthis.workflow_action_items = {};\n\n\t\tconst actions = this.actions_menu_items.concat(\n\t\t\tthis.workflow_action_menu_items\n\t\t);\n\t\tactions.map((item) => {\n\t\t\tconst $item = this.page.add_actions_menu_item(\n\t\t\t\titem.label,\n\t\t\t\titem.action,\n\t\t\t\titem.standard\n\t\t\t);\n\t\t\tif (item.class) {\n\t\t\t\t$item.addClass(item.class);\n\t\t\t}\n\t\t\tif (item.is_workflow_action && $item) {\n\t\t\t\t// can be used to dynamically show or hide action\n\t\t\t\tthis.workflow_action_items[item.name] = $item;\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_restricted_list_indicator_if_applicable() {\n\t\tconst match_rules_list = frappe.perm.get_match_rules(this.doctype);\n\t\tif (match_rules_list.length) {\n\t\t\tthis.restricted_list = $(\n\t\t\t\t`<button class=\"btn btn-xs restricted-button flex align-center\">\n\t\t\t\t\t${frappe.utils.icon('restriction', 'xs')}\n\t\t\t\t</button>`\n\t\t\t).click(() => this.show_restrictions(match_rules_list)).appendTo(this.page.page_form);\n\t\t}\n\t}\n\n\tshow_restrictions(match_rules_list = []) {\n\t\tfrappe.msgprint(\n\t\t\tfrappe.render_template(\"list_view_permission_restrictions\", {\n\t\t\t\tcondition_list: match_rules_list,\n\t\t\t}),\n\t\t\t__(\"Restrictions\")\n\t\t);\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.get_fields_in_list_view(),\n\t\t\t[this.meta.title_field, this.meta.image_field],\n\t\t\tthis.settings.add_fields || [],\n\t\t\tthis.meta.track_seen ? \"_seen\" : null,\n\t\t\tthis.sort_by,\n\t\t\t\"enabled\",\n\t\t\t\"disabled\",\n\t\t\t\"color\"\n\t\t);\n\n\t\tfields.forEach((f) => this._add_field(f));\n\n\t\tthis.fields.forEach((f) => {\n\t\t\tconst df = frappe.meta.get_docfield(f[1], f[0]);\n\t\t\tif (\n\t\t\t\tdf &&\n\t\t\t\tdf.fieldtype === \"Currency\" &&\n\t\t\t\tdf.options &&\n\t\t\t\t!df.options.includes(\":\")\n\t\t\t) {\n\t\t\t\tthis._add_field(df.options);\n\t\t\t}\n\t\t});\n\t}\n\n\tpatch_refresh_and_load_lib() {\n\t\t// throttle refresh for 1s\n\t\tthis.refresh = this.refresh.bind(this);\n\t\tthis.refresh = frappe.utils.throttle(this.refresh, 1000);\n\t\tthis.load_lib = new Promise((resolve) => {\n\t\t\tif (this.required_libs) {\n\t\t\t\tfrappe.require(this.required_libs, resolve);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\t// call refresh every 5 minutes\n\t\tconst interval = 5 * 60 * 1000;\n\t\tsetInterval(() => {\n\t\t\t// don't call if route is different\n\t\t\tif (frappe.get_route_str() === this.page_name) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}, interval);\n\t}\n\n\tset_primary_action() {\n\t\tif (this.can_create) {\n\t\t\tthis.page.set_primary_action(\n\t\t\t\t`${__(\"Add\")} ${frappe.router.doctype_layout || __(this.doctype)}`,\n\t\t\t\t() => {\n\t\t\t\t\tif (this.settings.primary_action) {\n\t\t\t\t\t\tthis.settings.primary_action();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.make_new_doc();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"add\"\n\t\t\t);\n\t\t} else {\n\t\t\tthis.page.clear_primary_action();\n\t\t}\n\t}\n\n\tmake_new_doc() {\n\t\tconst doctype = this.doctype;\n\t\tconst options = {};\n\t\tthis.filter_area.get().forEach((f) => {\n\t\t\tif (f[2] === \"=\" && frappe.model.is_non_std_field(f[1])) {\n\t\t\t\toptions[f[1]] = f[3];\n\t\t\t}\n\t\t});\n\t\tfrappe.new_doc(doctype, options);\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_skeleton();\n\t\tthis.setup_events();\n\t\tthis.settings.onload && this.settings.onload(this);\n\t\tthis.show_restricted_list_indicator_if_applicable();\n\t}\n\n\trefresh_columns(meta, list_view_settings) {\n\t\tthis.meta = meta;\n\t\tthis.list_view_settings = list_view_settings;\n\n\t\tthis.setup_columns();\n\t\tthis.refresh(true);\n\t}\n\n\trefresh(refresh_header=false) {\n\t\tsuper.refresh().then(() => {\n\t\t\tthis.render_header(refresh_header);\n\t\t});\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $(\n\t\t\t`<div class=\"freeze flex justify-center align-center text-muted\">${__(\"Loading\")}...</div>`\n\t\t).hide();\n\t\tthis.$result.append(this.$freeze);\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\n\t\tconst get_df = frappe.meta.get_docfield.bind(null, this.doctype);\n\n\t\t// 1st column: title_field or name\n\t\tif (this.meta.title_field) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: \"Subject\",\n\t\t\t\tdf: get_df(this.meta.title_field),\n\t\t\t});\n\t\t} else {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: \"Subject\",\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __(\"Name\"),\n\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\n\t\tthis.columns.push({\n\t\t\ttype: \"Tag\"\n\t\t});\n\n\t\t// 2nd column: Status indicator\n\t\tif (frappe.has_indicator(this.doctype)) {\n\t\t\t// indicator\n\t\t\tthis.columns.push({\n\t\t\t\ttype: \"Status\",\n\t\t\t});\n\t\t}\n\n\t\tconst fields_in_list_view = this.get_fields_in_list_view();\n\t\t// Add rest from in_list_view docfields\n\t\tthis.columns = this.columns.concat(\n\t\t\tfields_in_list_view\n\t\t\t\t.filter((df) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfrappe.has_indicator(this.doctype) &&\n\t\t\t\t\t\tdf.fieldname === \"status\"\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!df.in_list_view) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn df.fieldname !== this.meta.title_field;\n\t\t\t\t})\n\t\t\t\t.map((df) => ({\n\t\t\t\t\ttype: \"Field\",\n\t\t\t\t\tdf,\n\t\t\t\t}))\n\t\t);\n\n\t\tif (this.list_view_settings.fields) {\n\t\t\tthis.columns = this.reorder_listview_fields();\n\t\t}\n\n\t\t// limit max to 8 columns if no total_fields is set in List View Settings\n\t\t// Screen with low density no of columns 4\n\t\t// Screen with medium density no of columns 6\n\t\t// Screen with high density no of columns 8\n\t\tlet total_fields = 6;\n\n\t\tif (window.innerWidth <= 1366) {\n\t\t\ttotal_fields = 4;\n\t\t} else if (window.innerWidth >= 1920) {\n\t\t\ttotal_fields = 8;\n\t\t}\n\n\t\tthis.columns = this.columns.slice(0, this.list_view_settings.total_fields || total_fields);\n\n\t\tif (\n\t\t\t!this.settings.hide_name_column &&\n\t\t\tthis.meta.title_field !== 'name'\n\t\t) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: \"Field\",\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __(\"Name\"),\n\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\treorder_listview_fields() {\n\t\tlet fields_order = [];\n\t\tlet fields = JSON.parse(this.list_view_settings.fields);\n\n\t\t//title and tags field is fixed\n\t\tfields_order.push(this.columns[0]);\n\t\tfields_order.push(this.columns[1]);\n\t\tthis.columns.splice(0, 2);\n\n\t\tfor (let fld in fields) {\n\t\t\tfor (let col in this.columns) {\n\t\t\t\tlet field = fields[fld];\n\t\t\t\tlet column = this.columns[col];\n\n\t\t\t\tif (column.type == \"Status\" && field.fieldname == \"status_field\") {\n\t\t\t\t\tfields_order.push(column);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (column.type == \"Field\" && field.fieldname === column.df.fieldname) {\n\t\t\t\t\tfields_order.push(column);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn fields_order;\n\t}\n\n\tget_documentation_link() {\n\t\tif (this.meta.documentation) {\n\t\t\treturn `<a href=\"${\n\t\t\t\tthis.meta.documentation\n\t\t\t}\" target=\"blank\" class=\"meta-description small text-muted\">Need Help?</a>`;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget_no_result_message() {\n\t\tlet help_link = this.get_documentation_link();\n\t\tlet filters = this.filter_area && this.filter_area.get();\n\t\tlet no_result_message = filters && filters.length\n\t\t\t? __(\"No {0} found\", [__(this.doctype)])\n\t\t\t: __(\"You haven't created a {0} yet\", [__(this.doctype)]);\n\t\tlet new_button_label = filters && filters.length\n\t\t\t? __(\"Create a new {0}\", [__(this.doctype)])\n\t\t\t: __(\"Create your first {0}\", [__(this.doctype)]);\n\t\tlet empty_state_image =\n\t\t\tthis.settings.empty_state_image ||\n\t\t\t\"/assets/frappe/images/ui-states/list-empty-state.svg\";\n\n\t\tconst new_button = this.can_create\n\t\t\t? `<p><button class=\"btn btn-primary btn-sm btn-new-doc hidden-xs\">\n\t\t\t\t${new_button_label}\n\t\t\t</button> <button class=\"btn btn-primary btn-new-doc visible-xs\">${__('Create New')}</button></p>`\n\t\t\t: \"\";\n\n\t\treturn `<div class=\"msg-box no-border\">\n\t\t\t<div>\n\t\t\t\t<img src=\"${empty_state_image}\" alt=\"Generic Empty State\" class=\"null-state\">\n\t\t\t</div>\n\t\t\t<p>${no_result_message}</p>\n\t\t\t${new_button}\n\t\t\t${help_link}\n\t\t</div>`;\n\t}\n\n\tfreeze() {\n\t\tif (this.list_view_settings && !this.list_view_settings.disable_count) {\n\t\t\tthis.$result\n\t\t\t\t.find(\".list-count\")\n\t\t\t\t.html(`<span>${__(\"Refreshing\")}...</span>`);\n\t\t}\n\t}\n\n\tget_args() {\n\t\tconst args = super.get_args();\n\n\t\treturn Object.assign(args, {\n\t\t\twith_comment_count: true,\n\t\t});\n\t}\n\n\tbefore_refresh() {\n\t\tif (frappe.route_options && this.filter_area) {\n\t\t\tthis.filters = this.parse_filters_from_route_options();\n\t\t\tfrappe.route_options = null;\n\n\t\t\tif (this.filters.length > 0) {\n\t\t\t\treturn this.filter_area\n\t\t\t\t\t.clear(false)\n\t\t\t\t\t.then(() => this.filter_area.set(this.filters));\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tparse_filters_from_settings() {\n\t\treturn (this.settings.filters || []).map((f) => {\n\t\t\tif (f.length === 3) {\n\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_actions_menu_button(\n\t\t\tthis.$result.find(\".list-row-check:checked\").length > 0\n\t\t);\n\t}\n\n\ttoggle_actions_menu_button(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.page.show_actions_menu();\n\t\t\tthis.page.clear_primary_action();\n\t\t\tthis.toggle_workflow_actions();\n\t\t} else {\n\t\t\tthis.page.hide_actions_menu();\n\t\t\tthis.set_primary_action();\n\t\t}\n\t}\n\n\trender_header(refresh_header=false) {\n\t\tif (refresh_header) {\n\t\t\tthis.$result.find('.list-row-head').remove();\n\t\t}\n\t\tif (this.$result.find(\".list-row-head\").length === 0) {\n\t\t\t// append header once\n\t\t\tthis.$result.prepend(this.get_header_html());\n\t\t}\n\t}\n\n\trender_skeleton() {\n\t\tconst $row = this.get_list_row_html_skeleton(\n\t\t\t'<div><input type=\"checkbox\" /></div>'\n\t\t);\n\t\tthis.$result.append($row);\n\t}\n\n\tbefore_render() {\n\t\tthis.settings.before_render && this.settings.before_render();\n\t\tfrappe.model.user_settings.save(\n\t\t\tthis.doctype,\n\t\t\t\"last_view\",\n\t\t\tthis.view_name\n\t\t);\n\t\tthis.save_view_user_settings({\n\t\t\tfilters: this.filter_area && this.filter_area.get(),\n\t\t\tsort_by: this.sort_selector && this.sort_selector.sort_by,\n\t\t\tsort_order: this.sort_selector && this.sort_selector.sort_order,\n\t\t});\n\t\tthis.toggle_paging && this.$paging_area.toggle(false);\n\t}\n\n\tafter_render() {\n\t\tthis.$no_result.html(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`);\n\t\tthis.setup_new_doc_event();\n\t\tthis.list_sidebar && this.list_sidebar.reload_stats();\n\t\tthis.toggle_paging && this.$paging_area.toggle(true);\n\t}\n\n\trender() {\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t}\n\n\trender_list() {\n\t\t// clear rows\n\t\tthis.$result.find(\".list-row-container\").remove();\n\t\tif (this.data.length > 0) {\n\t\t\t// append rows\n\t\t\tthis.$result.append(\n\t\t\t\tthis.data\n\t\t\t\t\t.map((doc, i) => {\n\t\t\t\t\t\tdoc._idx = i;\n\t\t\t\t\t\treturn this.get_list_row_html(doc);\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\")\n\t\t\t);\n\t\t}\n\t}\n\n\trender_count() {\n\t\tif (!this.list_view_settings.disable_count) {\n\t\t\tthis.get_count_str().then((str) => {\n\t\t\t\tthis.$result.find(\".list-count\").html(`<span>${str}</span>`);\n\t\t\t});\n\t\t}\n\t}\n\n\tget_header_html() {\n\t\tif (!this.columns) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst subject_field = this.columns[0].df;\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\n\t\t\t\t\"Select All\"\n\t\t\t)}\">\n\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t<span title=\"${__(\"Likes\")}\">${frappe.utils.icon('heart', 'sm', 'like-icon')}</span>\n\t\t\t</span>\n\t\t\t<span class=\"level-item\">${__(subject_field.label)}</span>\n\t\t`;\n\t\tconst $columns = this.columns\n\t\t\t.map(col => {\n\t\t\t\tlet classes = [\n\t\t\t\t\t\"list-row-col ellipsis\",\n\t\t\t\t\tcol.type == \"Subject\" ? \"list-subject level\" : \"hidden-xs\",\n\t\t\t\t\tcol.type == \"Tag\" ? \"tag-col hide\": \"\",\n\t\t\t\t\tfrappe.model.is_numeric_field(col.df) ? \"text-right\" : \"\",\n\t\t\t\t].join(\" \");\n\n\t\t\t\treturn `\n\t\t\t\t<div class=\"${classes}\">\n\t\t\t\t\t${\n\t\t\t\t\t\tcol.type === \"Subject\"\n\t\t\t\t\t\t\t? subject_html\n\t\t\t\t\t\t\t: `\n\t\t\t\t\t<span>${__((col.df && col.df.label) || col.type)}</span>`\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\treturn this.get_header_html_skeleton(\n\t\t\t$columns,\n\t\t\t'<span class=\"list-count\"></span>'\n\t\t);\n\t}\n\n\tget_header_html_skeleton(left = \"\", right = \"\") {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted\">\n\t\t\t\t<div class=\"level-left list-header-subject\">\n\t\t\t\t\t${left}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-left checkbox-actions\">\n\t\t\t\t\t<div class=\"level list-subject\">\n\t\t\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\n\t\t\t\t\t\t\t\"Select All\"\n\t\t\t\t\t\t)}\">\n\t\t\t\t\t\t<span class=\"level-item list-header-meta\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t${right}\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tget_left_html(doc) {\n\t\treturn this.columns\n\t\t\t.map((col) => this.get_column_html(col, doc))\n\t\t\t.join(\"\");\n\t}\n\n\tget_right_html(doc) {\n\t\treturn this.get_meta_html(doc);\n\t}\n\n\tget_list_row_html(doc) {\n\t\treturn this.get_list_row_html_skeleton(\n\t\t\tthis.get_left_html(doc),\n\t\t\tthis.get_right_html(doc)\n\t\t);\n\t}\n\n\tget_list_row_html_skeleton(left = \"\", right = \"\") {\n\t\treturn `\n\t\t\t<div class=\"list-row-container\" tabindex=\"1\">\n\t\t\t\t<div class=\"level list-row\">\n\t\t\t\t\t<div class=\"level-left ellipsis\">\n\t\t\t\t\t\t${left}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"level-right text-muted ellipsis\">\n\t\t\t\t\t\t${right}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_column_html(col, doc) {\n\t\tif (col.type === \"Status\") {\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col hidden-xs ellipsis\">\n\t\t\t\t\t${this.get_indicator_html(doc)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (col.type === \"Tag\") {\n\t\t\tconst tags_display_class = !this.tags_shown ? 'hide' : '';\n\t\t\tlet tags_html = doc._user_tags ? this.get_tags_html(doc._user_tags, 2) : '<div class=\"tags-empty\">-</div>';\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col tag-col ${tags_display_class} hidden-xs ellipsis\">\n\t\t\t\t\t${tags_html}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst df = col.df || {};\n\t\tconst label = df.label;\n\t\tconst fieldname = df.fieldname;\n\t\tconst value = doc[fieldname] || \"\";\n\n\t\tconst format = () => {\n\t\t\tif (df.fieldtype === \"Code\") {\n\t\t\t\treturn value;\n\t\t\t} else if (df.fieldtype === \"Percent\") {\n\t\t\t\treturn `<div class=\"progress\" style=\"margin: 0px;\">\n\t\t\t\t\t\t<div class=\"progress-bar bg-success\" role=\"progressbar\"\n\t\t\t\t\t\t\taria-valuenow=\"${value}\"\n\t\t\t\t\t\t\taria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: ${Math.round(value)}%;\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn frappe.format(value, df, null, doc);\n\t\t\t}\n\t\t};\n\n\t\tconst field_html = () => {\n\t\t\tlet html;\n\t\t\tlet _value;\n\t\t\t// listview_setting formatter\n\t\t\tlet strip_html_required =\n\t\t\t\tdf.fieldtype == \"Text Editor\" ||\n\t\t\t\t(df.fetch_from &&\n\t\t\t\t\t[\"Text\", \"Small Text\"].includes(df.fieldtype));\n\n\t\t\tif (strip_html_required) {\n\t\t\t\t_value = strip_html(value);\n\t\t\t} else {\n\t\t\t\t_value =\n\t\t\t\t\ttypeof value === \"string\"\n\t\t\t\t\t\t? frappe.utils.escape_html(value)\n\t\t\t\t\t\t: value;\n\t\t\t}\n\n\t\t\tif (df.fieldtype === \"Image\") {\n\t\t\t\thtml = df.options\n\t\t\t\t\t? `<img src=\"${\n\t\t\t\t\t\t\tdoc[df.options]\n\t\t\t\t\t  }\" style=\"max-height: 30px; max-width: 100%;\">`\n\t\t\t\t\t: `<div class=\"missing-image small\">\n\t\t\t\t\t\t${frappe.utils.icon('restriction')}\n\t\t\t\t\t</div>`;\n\t\t\t} else if (df.fieldtype === \"Select\") {\n\t\t\t\thtml = `<span class=\"filterable indicator-pill ${frappe.utils.guess_colour(\n\t\t\t\t\t_value\n\t\t\t\t)} ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t<span class=\"ellipsis\"> ${__(_value)} </span>\n\t\t\t\t</span>`;\n\t\t\t} else if (df.fieldtype === \"Link\") {\n\t\t\t\thtml = `<a class=\"filterable ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${_value}\n\t\t\t\t</a>`;\n\t\t\t} else if (\n\t\t\t\t[\"Text Editor\", \"Text\", \"Small Text\", \"HTML Editor\", \"Markdown Editor\"].includes(\n\t\t\t\t\tdf.fieldtype\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\thtml = `<span class=\"ellipsis\">\n\t\t\t\t\t${_value}\n\t\t\t\t</span>`;\n\t\t\t} else {\n\t\t\t\thtml = `<a class=\"filterable ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${frappe.utils.escape_html(value)}\">\n\t\t\t\t\t${format()}\n\t\t\t\t</a>`;\n\t\t\t}\n\n\t\t\treturn `<span class=\"ellipsis\"\n\t\t\t\ttitle=\"${__(label)}: ${frappe.utils.escape_html(_value)}\">\n\t\t\t\t${html}\n\t\t\t</span>`;\n\t\t};\n\n\t\tconst class_map = {\n\t\t\tSubject: \"list-subject level\",\n\t\t\tField: \"hidden-xs\",\n\t\t};\n\t\tconst css_class = [\n\t\t\t\"list-row-col ellipsis\",\n\t\t\tclass_map[col.type],\n\t\t\tfrappe.model.is_numeric_field(df) ? \"text-right\" : \"\",\n\t\t].join(\" \");\n\n\t\tconst html_map = {\n\t\t\tSubject: this.get_subject_html(doc),\n\t\t\tField: field_html(),\n\t\t};\n\t\tlet column_html = html_map[col.type];\n\n\t\t// listview_setting formatter\n\t\tif (\n\t\t\tthis.settings.formatters &&\n\t\t\tthis.settings.formatters[fieldname]\n\t\t) {\n\t\t\tcolumn_html = this.settings.formatters[fieldname](value, df, doc);\n\t\t}\n\n\t\treturn `\n\t\t\t<div class=\"${css_class}\">\n\t\t\t\t${column_html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_tags_html(user_tags, limit, colored=false) {\n\t\tlet get_tag_html = tag => {\n\t\t\tlet color = '', style = '';\n\t\t\tif (tag) {\n\t\t\t\tif (colored) {\n\t\t\t\t\tcolor = frappe.get_palette(tag);\n\t\t\t\t\tstyle = `background-color: var(${color[0]}); color: var(${color[1]})`;\n\t\t\t\t}\n\n\t\t\t\treturn `<div class=\"tag-pill ellipsis\" title=\"${tag}\" style=\"${style}\">${tag}</div>`;\n\t\t\t}\n\t\t}\n\t\treturn user_tags.split(',').slice(1, limit + 1).map(get_tag_html).join('');\n\t}\n\n\tget_meta_html(doc) {\n\t\tlet html = \"\";\n\n\t\tlet settings_button = null;\n\t\tif (this.settings.button && this.settings.button.show(doc)) {\n\t\t\tsettings_button = `\n\t\t\t\t<span class=\"list-actions\">\n\t\t\t\t\t<button class=\"btn btn-action btn-default btn-xs\"\n\t\t\t\t\t\tdata-name=\"${doc.name}\" data-idx=\"${doc._idx}\"\n\t\t\t\t\t\ttitle=\"${this.settings.button.get_description(doc)}\">\n\t\t\t\t\t\t${this.settings.button.get_label(doc)}\n\t\t\t\t\t</button>\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\tconst modified = comment_when(doc.modified, true);\n\n\t\tlet assigned_to = `<div class=\"list-assignments\">\n\t\t\t<span class=\"avatar avatar-small\">\n\t\t\t<span class=\"avatar-empty\"></span>\n\t\t</div>`;\n\n\t\tlet assigned_users = JSON.parse(doc._assign || \"[]\");\n\t\tif (assigned_users.length) {\n\t\t\tassigned_to = `<div class=\"list-assignments\">\n\t\t\t\t\t${frappe.avatar_group(assigned_users, 3, { filterable: true })[0].outerHTML}\n\t\t\t\t</div>`;\n\t\t}\n\n\t\tconst comment_count = `<span class=\"${\n\t\t\t!doc._comment_count ? \"text-extra-muted\" : \"\"\n\t\t} comment-count\">\n\t\t\t\t${frappe.utils.icon('small-message')}\n\t\t\t\t${doc._comment_count > 99 ? \"99+\" : doc._comment_count}\n\t\t\t</span>`;\n\n\t\thtml += `\n\t\t\t<div class=\"level-item list-row-activity hidden-xs\">\n\t\t\t\t<div class=\"hidden-md hidden-xs\">\n\t\t\t\t\t${settings_button || assigned_to}\n\t\t\t\t</div>\n\t\t\t\t${modified}\n\t\t\t\t${comment_count}\n\t\t\t</div>\n\t\t\t<div class=\"level-item visible-xs text-right\">\n\t\t\t\t${this.get_indicator_dot(doc)}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tget_count_str() {\n\t\tlet current_count = this.data.length;\n\t\tlet count_without_children = this.data.uniqBy((d) => d.name).length;\n\n\t\treturn frappe.db.count(this.doctype, {\n\t\t\tfilters: this.get_filters_for_args()\n\t\t}).then(total_count => {\n\t\t\tthis.total_count = total_count || current_count;\n\t\t\tlet str = __('{0} of {1}', [current_count, this.total_count]);\n\t\t\tif (count_without_children !== current_count) {\n\t\t\t\tstr = __('{0} of {1} ({2} rows with children)', [count_without_children, this.total_count, current_count]);\n\t\t\t}\n\t\t\treturn str;\n\t\t});\n\t}\n\n\tget_form_link(doc) {\n\t\tif (this.settings.get_form_link) {\n\t\t\treturn this.settings.get_form_link(doc);\n\t\t}\n\n\t\tconst docname = doc.name.match(/[%'\"\\s]/)\n\t\t\t? encodeURIComponent(doc.name)\n\t\t\t: doc.name;\n\n\t\treturn `/app/${frappe.router.slug(frappe.router.doctype_layout || this.doctype)}/${docname}`;\n\t}\n\n\tget_seen_class(doc) {\n\t\treturn JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t? ''\n\t\t\t: 'bold';\n\t}\n\n\tget_like_html(doc) {\n\t\tconst liked_by = JSON.parse(doc._liked_by || \"[]\");\n\t\tlet heart_class = liked_by.includes(frappe.session.user)\n\t\t\t? \"liked-by liked\"\n\t\t\t: \"not-liked\";\n\n\t\treturn `<span\n\t\t\tclass=\"like-action ${heart_class}\"\n\t\t\tdata-name=\"${doc.name}\" data-doctype=\"${this.doctype}\"\n\t\t\tdata-liked-by=\"${encodeURI(doc._liked_by) || \"[]\"}\"\n\t\t\ttitle=\"${liked_by.map(u => frappe.user_info(u).fullname).join(', ')}\">\n\t\t\t${frappe.utils.icon('heart', 'sm', 'like-icon')}\n\t\t</span>\n\t\t<span class=\"likes-count\">\n\t\t\t${liked_by.length > 99 ? __(\"99\") + \"+\" : __(liked_by.length || \"\")}\n\t\t</span>`;\n\t}\n\n\tget_subject_html(doc) {\n\t\tlet subject_field = this.columns[0].df;\n\t\tlet value = doc[subject_field.fieldname];\n\t\tif (this.settings.formatters && this.settings.formatters[subject_field.fieldname]) {\n\t\t\tlet formatter = this.settings.formatters[subject_field.fieldname];\n\t\t\tvalue = formatter(value, subject_field, doc);\n\t\t}\n\t\tif (!value) {\n\t\t\tvalue = doc.name;\n\t\t}\n\t\tlet subject = strip_html(value.toString());\n\t\tlet escaped_subject = frappe.utils.escape_html(subject);\n\n\t\tconst seen = this.get_seen_class(doc);\n\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${escape(\n\t\t\t\tdoc.name\n\t\t\t)}\">\n\t\t\t<span class=\"level-item\" style=\"margin-bottom: 1px;\">\n\t\t\t\t${this.get_like_html(doc)}\n\t\t\t</span>\n\t\t\t<span class=\"level-item ${seen} ellipsis\" title=\"${escaped_subject}\">\n\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(\n\t\t\t\t\tdoc\n\t\t\t\t)}\" title=\"${escaped_subject}\" data-doctype=\"${\n\t\t\tthis.doctype\n\t\t}\" data-name=\"${doc.name}\">\n\t\t\t\t${subject}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn subject_html;\n\t}\n\n\tget_indicator_html(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (indicator) {\n\t\t\treturn `<span class=\"indicator-pill ${indicator[1]} filterable ellipsis\"\n\t\t\t\tdata-filter='${indicator[2]}'>\n\t\t\t\t<span class=\"ellipsis\"> ${__(indicator[0])}</span>\n\t\t\t<span>`;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget_indicator_dot(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (!indicator) return \"\";\n\t\treturn `<span class='indicator ${indicator[1]}' title='${__(\n\t\t\tindicator[0]\n\t\t)}'></span>`;\n\t}\n\n\tget_image_url(doc) {\n\t\tlet url = doc.image ? doc.image : doc[this.meta.image_field];\n\t\t// absolute url for mobile\n\t\tif (window.cordova && !frappe.utils.is_url(url)) {\n\t\t\turl = frappe.base_url + url;\n\t\t}\n\t\treturn url || null;\n\t}\n\n\tsetup_events() {\n\t\tthis.setup_filterable();\n\t\tthis.setup_list_click();\n\t\tthis.setup_tag_event();\n\t\tthis.setup_new_doc_event();\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t\tthis.setup_realtime_updates();\n\t\tthis.setup_action_handler();\n\t\tthis.setup_keyboard_navigation();\n\t}\n\n\tsetup_keyboard_navigation() {\n\t\tlet focus_first_row = () => {\n\t\t\tthis.$result.find(\".list-row-container:first\").focus();\n\t\t};\n\t\tlet focus_next = () => {\n\t\t\t$(document.activeElement)\n\t\t\t\t.next()\n\t\t\t\t.focus();\n\t\t};\n\t\tlet focus_prev = () => {\n\t\t\t$(document.activeElement)\n\t\t\t\t.prev()\n\t\t\t\t.focus();\n\t\t};\n\t\tlet list_row_focused = () => {\n\t\t\treturn $(document.activeElement).is(\".list-row-container\");\n\t\t};\n\t\tlet check_row = ($row) => {\n\t\t\tlet $input = $row.find(\"input[type=checkbox]\");\n\t\t\t$input.click();\n\t\t};\n\t\tlet get_list_row_if_focused = () =>\n\t\t\tlist_row_focused() ? $(document.activeElement) : null;\n\n\t\tlet is_current_page = () => this.page.wrapper.is(\":visible\");\n\t\tlet is_input_focused = () => $(document.activeElement).is(\"input\");\n\n\t\tlet handle_navigation = (direction) => {\n\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\n\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\tif ($list_row) {\n\t\t\t\tdirection === \"down\" ? focus_next() : focus_prev();\n\t\t\t} else {\n\t\t\t\tfocus_first_row();\n\t\t\t}\n\t\t};\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"down\",\n\t\t\taction: () => handle_navigation(\"down\"),\n\t\t\tdescription: __(\"Navigate list down\"),\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"up\",\n\t\t\taction: () => handle_navigation(\"up\"),\n\t\t\tdescription: __(\"Navigate list up\"),\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+down\",\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_next();\n\t\t\t},\n\t\t\tdescription: __(\"Select multiple list items\"),\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+up\",\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_prev();\n\t\t\t},\n\t\t\tdescription: __(\"Select multiple list items\"),\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"enter\",\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\t$list_row.find(\"a[data-name]\")[0].click();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __(\"Open list item\"),\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"space\",\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\tcheck_row($list_row);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __(\"Select list item\"),\n\t\t\tpage: this.page,\n\t\t});\n\t}\n\n\tsetup_filterable() {\n\t\t// filterable events\n\t\tthis.$result.on(\"click\", \".filterable\", (e) => {\n\t\t\tif (e.metaKey || e.ctrlKey) return;\n\t\t\te.stopPropagation();\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\tconst filters = $this.attr(\"data-filter\").split(\"|\");\n\t\t\tconst filters_to_apply = filters.map((f) => {\n\t\t\t\tf = f.split(\",\");\n\t\t\t\tif (f[2] === \"Today\") {\n\t\t\t\t\tf[2] = frappe.datetime.get_today();\n\t\t\t\t} else if (f[2] == \"User\") {\n\t\t\t\t\tf[2] = frappe.session.user;\n\t\t\t\t}\n\t\t\t\tthis.filter_area.remove(f[0]);\n\t\t\t\treturn [this.doctype, f[0], f[1], f.slice(2).join(\",\")];\n\t\t\t});\n\t\t\tthis.filter_area.add(filters_to_apply);\n\t\t});\n\t}\n\n\tsetup_list_click() {\n\t\tthis.$result.on(\"click\", \".list-row, .image-view-header, .file-header\", (e) => {\n\t\t\tconst $target = $(e.target);\n\t\t\t// tick checkbox if Ctrl/Meta key is pressed\n\t\t\tif (e.ctrlKey || (e.metaKey && !$target.is(\"a\"))) {\n\t\t\t\tconst $list_row = $(e.currentTarget);\n\t\t\t\tconst $check = $list_row.find(\".list-row-checkbox\");\n\t\t\t\t$check.prop(\"checked\", !$check.prop(\"checked\"));\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.on_row_checked();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// don't open form when checkbox, like, filterable are clicked\n\t\t\tif (\n\t\t\t\t$target.hasClass(\"filterable\") ||\n\t\t\t\t$target.hasClass(\"icon-heart\") ||\n\t\t\t\t$target.is(\":checkbox\")\n\t\t\t) {\n\t\t\t\te.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// link, let the event be handled via set_route\n\t\t\tif ($target.is(\"a\")) return;\n\n\t\t\t// clicked on the row, open form\n\t\t\tconst $row = $(e.currentTarget);\n\t\t\tconst link = $row.find(\".list-subject a\").get(0);\n\t\t\tif (link) {\n\t\t\t\tfrappe.set_route(link.pathname);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_action_handler() {\n\t\tthis.$result.on(\"click\", \".btn-action\", (e) => {\n\t\t\tconst $button = $(e.currentTarget);\n\t\t\tconst doc = this.data[$button.attr(\"data-idx\")];\n\t\t\tthis.settings.button.action(doc);\n\t\t\te.stopPropagation();\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tsetup_check_events() {\n\t\tthis.$result.on(\"change\", \"input[type=checkbox]\", (e) => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\tif ($target.is(\".list-header-subject .list-check-all\")) {\n\t\t\t\tconst $check = this.$result.find(\n\t\t\t\t\t\".checkbox-actions .list-check-all\"\n\t\t\t\t);\n\t\t\t\t$check.prop(\"checked\", $target.prop(\"checked\"));\n\t\t\t\t$check.trigger(\"change\");\n\t\t\t} else if ($target.is(\".checkbox-actions .list-check-all\")) {\n\t\t\t\tconst $check = this.$result.find(\n\t\t\t\t\t\".list-header-subject .list-check-all\"\n\t\t\t\t);\n\t\t\t\t$check.prop(\"checked\", $target.prop(\"checked\"));\n\n\t\t\t\tthis.$result\n\t\t\t\t\t.find(\".list-row-checkbox\")\n\t\t\t\t\t.prop(\"checked\", $target.prop(\"checked\"));\n\t\t\t} else if ($target.attr('data-parent')) {\n\t\t\t\tthis.$result\n\t\t\t\t\t.find(`.${$target.attr('data-parent')}`)\n\t\t\t\t\t.find('.list-row-checkbox')\n\t\t\t\t\t.prop(\"checked\", $target.prop(\"checked\"));\n\t\t\t}\n\n\t\t\tthis.on_row_checked();\n\t\t});\n\n\t\tthis.$result.on(\"click\", \".list-row-checkbox\", (e) => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\t// shift select checkboxes\n\t\t\tif (\n\t\t\t\te.shiftKey &&\n\t\t\t\tthis.$checkbox_cursor &&\n\t\t\t\t!$target.is(this.$checkbox_cursor)\n\t\t\t) {\n\t\t\t\tconst name_1 = this.$checkbox_cursor.data().name;\n\t\t\t\tconst name_2 = $target.data().name;\n\t\t\t\tconst index_1 = this.data.findIndex((d) => d.name === name_1);\n\t\t\t\tconst index_2 = this.data.findIndex((d) => d.name === name_2);\n\t\t\t\tlet [min_index, max_index] = [index_1, index_2];\n\n\t\t\t\tif (min_index > max_index) {\n\t\t\t\t\t[min_index, max_index] = [max_index, min_index];\n\t\t\t\t}\n\n\t\t\t\tlet docnames = this.data\n\t\t\t\t\t.slice(min_index + 1, max_index)\n\t\t\t\t\t.map((d) => d.name);\n\t\t\t\tconst selector = docnames\n\t\t\t\t\t.map((name) => `.list-row-checkbox[data-name=\"${name}\"]`)\n\t\t\t\t\t.join(\",\");\n\t\t\t\tthis.$result.find(selector).prop(\"checked\", true);\n\t\t\t}\n\n\t\t\tthis.$checkbox_cursor = $target;\n\t\t});\n\t}\n\n\tsetup_like() {\n\t\tthis.$result.on(\"click\", \".like-action\", frappe.ui.click_toggle_like);\n\t\tthis.$result.on(\"click\", \".list-liked-by-me\", (e) => {\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\t$this.toggleClass(\"active\");\n\n\t\t\tif ($this.hasClass(\"active\")) {\n\t\t\t\tthis.filter_area.add(\n\t\t\t\t\tthis.doctype,\n\t\t\t\t\t\"_liked_by\",\n\t\t\t\t\t\"like\",\n\t\t\t\t\t\"%\" + frappe.session.user + \"%\"\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.filter_area.remove(\"_liked_by\");\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_new_doc_event() {\n\t\tthis.$no_result.find(\".btn-new-doc\").click(() => {\n\t\t\tif (this.settings.primary_action) {\n\t\t\t\tthis.settings.primary_action();\n\t\t\t} else {\n\t\t\t\tthis.make_new_doc();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_tag_event() {\n\t\tthis.tags_shown = false;\n\t\tthis.list_sidebar && this.list_sidebar.parent.on(\"click\", \".list-tag-preview\", () => {\n\t\t\tthis.tags_shown = !this.tags_shown;\n\t\t\tthis.toggle_tags();\n\t\t});\n\t}\n\n\tsetup_realtime_updates() {\n\t\tif (\n\t\t\tthis.list_view_settings &&\n\t\t\tthis.list_view_settings.disable_auto_refresh\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tfrappe.realtime.on(\"list_update\", (data) => {\n\t\t\tif (this.filter_area.is_being_edited()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { doctype, name } = data;\n\t\t\tif (doctype !== this.doctype) return;\n\n\t\t\t// filters to get only the doc with this name\n\t\t\tconst call_args = this.get_call_args();\n\t\t\tcall_args.args.filters.push([this.doctype, \"name\", \"=\", name]);\n\t\t\tcall_args.args.start = 0;\n\n\t\t\tfrappe.call(call_args).then(({ message }) => {\n\t\t\t\tif (!message) return;\n\t\t\t\tconst data = frappe.utils.dict(message.keys, message.values);\n\t\t\t\tif (!(data && data.length)) {\n\t\t\t\t\t// this doc was changed and should not be visible\n\t\t\t\t\t// in the listview according to filters applied\n\t\t\t\t\t// let's remove it manually\n\t\t\t\t\tthis.data = this.data.filter((d) => d.name !== name);\n\t\t\t\t\tthis.render_list();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst datum = data[0];\n\t\t\t\tconst index = this.data.findIndex((d) => d.name === datum.name);\n\n\t\t\t\tif (index === -1) {\n\t\t\t\t\t// append new data\n\t\t\t\t\tthis.data.push(datum);\n\t\t\t\t} else {\n\t\t\t\t\t// update this data in place\n\t\t\t\t\tthis.data[index] = datum;\n\t\t\t\t}\n\n\t\t\t\tthis.data.sort((a, b) => {\n\t\t\t\t\tconst a_value = a[this.sort_by] || \"\";\n\t\t\t\t\tconst b_value = b[this.sort_by] || \"\";\n\n\t\t\t\t\tlet return_value = 0;\n\t\t\t\t\tif (a_value > b_value) {\n\t\t\t\t\t\treturn_value = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (b_value > a_value) {\n\t\t\t\t\t\treturn_value = -1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.sort_order === \"desc\") {\n\t\t\t\t\t\treturn_value = -return_value;\n\t\t\t\t\t}\n\t\t\t\t\treturn return_value;\n\t\t\t\t});\n\t\t\t\tthis.toggle_result_area();\n\t\t\t\tthis.render_list();\n\t\t\t\tif (this.$checks && this.$checks.length) {\n\t\t\t\t\tthis.set_rows_as_checked();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_rows_as_checked() {\n\t\t$.each(this.$checks, (i, el) => {\n\t\t\tlet docname = $(el).attr(\"data-name\");\n\t\t\tthis.$result\n\t\t\t\t.find(`.list-row-checkbox[data-name='${docname}']`)\n\t\t\t\t.prop(\"checked\", true);\n\t\t});\n\t\tthis.on_row_checked();\n\t}\n\n\ton_row_checked() {\n\t\tthis.$list_head_subject =\n\t\t\tthis.$list_head_subject ||\n\t\t\tthis.$result.find(\"header .list-header-subject\");\n\t\tthis.$checkbox_actions =\n\t\t\tthis.$checkbox_actions ||\n\t\t\tthis.$result.find(\"header .checkbox-actions\");\n\n\t\tthis.$checks = this.$result.find(\".list-row-checkbox:checked\");\n\n\t\tthis.$list_head_subject.toggle(this.$checks.length === 0);\n\t\tthis.$checkbox_actions.toggle(this.$checks.length > 0);\n\n\t\tif (this.$checks.length === 0) {\n\t\t\tthis.$list_head_subject\n\t\t\t\t.find(\".list-check-all\")\n\t\t\t\t.prop(\"checked\", false);\n\t\t} else {\n\t\t\tthis.$checkbox_actions\n\t\t\t\t.find(\".list-header-meta\")\n\t\t\t\t.html(__(\"{0} items selected\", [this.$checks.length]));\n\t\t\tthis.$checkbox_actions.show();\n\t\t\tthis.$list_head_subject.hide();\n\t\t}\n\t\tthis.toggle_actions_menu_button(this.$checks.length > 0);\n\t}\n\n\ttoggle_tags() {\n\t\tthis.$result.find('.tag-col').toggleClass(\"hide\");\n\t\tconst preview_label = this.tags_shown ? __(\"Hide Tags\") : __(\"Show Tags\");\n\t\tthis.list_sidebar.parent.find(\".list-tag-preview\").text(preview_label);\n\t}\n\n\tget_checked_items(only_docnames) {\n\t\tconst docnames = Array.from(this.$checks || []).map((check) =>\n\t\t\tcstr(unescape($(check).data().name))\n\t\t);\n\n\t\tif (only_docnames) return docnames;\n\n\t\treturn this.data.filter((d) => docnames.includes(d.name));\n\t}\n\n\tsave_view_user_settings(obj) {\n\t\treturn frappe.model.user_settings.save(\n\t\t\tthis.doctype,\n\t\t\tthis.view_name,\n\t\t\tobj\n\t\t);\n\t}\n\n\ton_update() {}\n\n\tget_share_url() {\n\t\tconst query_params = this.get_filters_for_args()\n\t\t\t.map((filter) => {\n\t\t\t\tfilter[3] = encodeURIComponent(filter[3]);\n\t\t\t\tif (filter[2] === \"=\") {\n\t\t\t\t\treturn `${filter[1]}=${filter[3]}`;\n\t\t\t\t}\n\t\t\t\treturn [\n\t\t\t\t\tfilter[1],\n\t\t\t\t\t\"=\",\n\t\t\t\t\tJSON.stringify([filter[2], filter[3]]),\n\t\t\t\t].join(\"\");\n\t\t\t})\n\t\t\t.join(\"&\");\n\n\t\tlet full_url = window.location.href;\n\t\tif (query_params) {\n\t\t\tfull_url += \"?\" + query_params;\n\t\t}\n\t\treturn full_url;\n\t}\n\n\tshare_url() {\n\t\tconst d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share URL\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Code\",\n\t\t\t\t\tfieldname: \"url\",\n\t\t\t\t\tlabel: __(\"URL\"),\n\t\t\t\t\tdefault: this.get_share_url(),\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\td.show();\n\t}\n\n\tget_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst items = [];\n\n\t\tif (frappe.model.can_import(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"Import\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tfrappe.set_route(\"list\", \"data-import\", {\n\t\t\t\t\t\treference_doctype: doctype,\n\t\t\t\t\t}),\n\t\t\t\tstandard: true,\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.model.can_set_user_permissions(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"User Permissions\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tfrappe.set_route(\"list\", \"user-permission\", {\n\t\t\t\t\t\tallow: doctype,\n\t\t\t\t\t}),\n\t\t\t\tstandard: true,\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user_roles.includes(\"System Manager\")) {\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"Role Permissions Manager\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tfrappe.set_route(\"permission-manager\", {\n\t\t\t\t\t\tdoctype,\n\t\t\t\t\t}),\n\t\t\t\tstandard: true,\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"Customize\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tif (!this.meta) return;\n\t\t\t\t\tif (this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route(\"form\", \"doctype\", doctype);\n\t\t\t\t\t} else if (!this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route(\"form\", \"customize-form\", {\n\t\t\t\t\t\t\tdoc_type: doctype,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t\tshortcut: \"Ctrl+J\",\n\t\t\t});\n\t\t}\n\n\t\titems.push({\n\t\t\tlabel: __(\"Toggle Sidebar\"),\n\t\t\taction: () => this.toggle_side_bar(),\n\t\t\tcondition: () => !this.hide_sidebar,\n\t\t\tstandard: true,\n\t\t\tshortcut: \"Ctrl+K\",\n\t\t});\n\n\t\titems.push({\n\t\t\tlabel: __(\"Share URL\"),\n\t\t\taction: () => this.share_url(),\n\t\t\tstandard: true,\n\t\t\tshortcut: \"Ctrl+L\",\n\t\t});\n\n\t\tif (\n\t\t\tfrappe.user.has_role(\"System Manager\") &&\n\t\t\tfrappe.boot.developer_mode === 1\n\t\t) {\n\t\t\t// edit doctype\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"Edit DocType\"),\n\t\t\t\taction: () => frappe.set_route(\"form\", \"doctype\", doctype),\n\t\t\t\tstandard: true,\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user.has_role(\"System Manager\")) {\n\t\t\titems.push({\n\t\t\t\tlabel: __(\"List Settings\"),\n\t\t\t\taction: () => this.show_list_settings(),\n\t\t\t\tstandard: true,\n\t\t\t});\n\t\t}\n\t\treturn items;\n\t}\n\n\tshow_list_settings() {\n\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\tnew ListSettings({\n\t\t\t\tlistview: this,\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tsettings: this.list_view_settings,\n\t\t\t\tmeta: frappe.get_meta(this.doctype)\n\t\t\t});\n\t\t});\n\t}\n\n\tget_workflow_action_menu_items() {\n\t\tconst workflow_actions = [];\n\t\tif (frappe.model.has_workflow(this.doctype)) {\n\t\t\tconst actions = frappe.workflow.get_all_transition_actions(\n\t\t\t\tthis.doctype\n\t\t\t);\n\t\t\tactions.forEach((action) => {\n\t\t\t\tworkflow_actions.push({\n\t\t\t\t\tlabel: __(action),\n\t\t\t\t\tname: action,\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tfrappe.xcall(\n\t\t\t\t\t\t\t\"frappe.model.workflow.bulk_workflow_approval\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdocnames: this.get_checked_items(true),\n\t\t\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\t\t\taction: action,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tis_workflow_action: true,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn workflow_actions;\n\t}\n\n\ttoggle_workflow_actions() {\n\t\tif (!frappe.model.has_workflow(this.doctype)) return;\n\t\tconst checked_items = this.get_checked_items();\n\t\tfrappe\n\t\t\t.xcall(\"frappe.model.workflow.get_common_transition_actions\", {\n\t\t\t\tdocs: checked_items,\n\t\t\t\tdoctype: this.doctype,\n\t\t\t})\n\t\t\t.then((actions) => {\n\t\t\t\tObject.keys(this.workflow_action_items).forEach((key) => {\n\t\t\t\t\tthis.workflow_action_items[key].toggle(\n\t\t\t\t\t\tactions.includes(key)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tget_actions_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst actions_menu_items = [];\n\t\tconst bulk_operations = new BulkOperations({ doctype: this.doctype });\n\n\t\tconst is_field_editable = (field_doc) => {\n\t\t\treturn (\n\t\t\t\tfield_doc.fieldname &&\n\t\t\t\tfrappe.model.is_value_type(field_doc) &&\n\t\t\t\tfield_doc.fieldtype !== \"Read Only\" &&\n\t\t\t\t!field_doc.hidden &&\n\t\t\t\t!field_doc.read_only\n\t\t\t);\n\t\t};\n\n\t\tconst has_editable_fields = (doctype) => {\n\t\t\treturn frappe.meta\n\t\t\t\t.get_docfields(doctype)\n\t\t\t\t.some((field_doc) => is_field_editable(field_doc));\n\t\t};\n\n\t\tconst has_submit_permission = (doctype) => {\n\t\t\treturn frappe.perm.has_perm(doctype, 0, \"submit\");\n\t\t};\n\n\t\t// utility\n\t\tconst bulk_assignment = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Assign To\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tbulk_operations.assign(\n\t\t\t\t\t\tthis.get_checked_items(true),\n\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t),\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_assignment_rule = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Apply Assignment Rule\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tbulk_operations.apply_assignment_rule(\n\t\t\t\t\t\tthis.get_checked_items(true),\n\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t),\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_add_tags = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Add Tags\"),\n\t\t\t\taction: () =>\n\t\t\t\t\tbulk_operations.add_tags(\n\t\t\t\t\t\tthis.get_checked_items(true),\n\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t),\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_printing = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Print\"),\n\t\t\t\taction: () => bulk_operations.print(this.get_checked_items()),\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_delete = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Delete\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true).map(\n\t\t\t\t\t\t(docname) => docname.toString()\n\t\t\t\t\t);\n\t\t\t\t\tfrappe.confirm(\n\t\t\t\t\t\t__(\"Delete {0} items permanently?\", [docnames.length]),\n\t\t\t\t\t\t() => bulk_operations.delete(docnames, this.refresh)\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_cancel = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Cancel\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(\n\t\t\t\t\t\t\t__(\"Cancel {0} documents?\", [docnames.length]),\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\tbulk_operations.submit_or_cancel(\n\t\t\t\t\t\t\t\t\tdocnames,\n\t\t\t\t\t\t\t\t\t\"cancel\",\n\t\t\t\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_submit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Submit\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(\n\t\t\t\t\t\t\t__(\"Submit {0} documents?\", [docnames.length]),\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\tbulk_operations.submit_or_cancel(\n\t\t\t\t\t\t\t\t\tdocnames,\n\t\t\t\t\t\t\t\t\t\"submit\",\n\t\t\t\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_edit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __(\"Edit\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tlet field_mappings = {};\n\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((field_doc) => {\n\t\t\t\t\t\tif (is_field_editable(field_doc)) {\n\t\t\t\t\t\t\tfield_mappings[field_doc.label] = Object.assign(\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\tfield_doc\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\n\t\t\t\t\tbulk_operations.edit(\n\t\t\t\t\t\tdocnames,\n\t\t\t\t\t\tfield_mappings,\n\t\t\t\t\t\tthis.refresh\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\t// bulk edit\n\t\tif (has_editable_fields(doctype)) {\n\t\t\tactions_menu_items.push(bulk_edit());\n\t\t}\n\n\t\t// bulk assignment\n\t\tactions_menu_items.push(bulk_assignment());\n\n\t\tactions_menu_items.push(bulk_assignment_rule());\n\n\t\tactions_menu_items.push(bulk_add_tags());\n\n\t\t// bulk printing\n\t\tif (frappe.model.can_print(doctype)) {\n\t\t\tactions_menu_items.push(bulk_printing());\n\t\t}\n\n\t\t// bulk submit\n\t\tif (\n\t\t\tfrappe.model.is_submittable(doctype) &&\n\t\t\thas_submit_permission(doctype) &&\n\t\t\t!frappe.model.has_workflow(doctype)\n\t\t) {\n\t\t\tactions_menu_items.push(bulk_submit());\n\t\t}\n\n\t\t// bulk cancel\n\t\tif (\n\t\t\tfrappe.model.can_cancel(doctype) &&\n\t\t\t!frappe.model.has_workflow(doctype)\n\t\t) {\n\t\t\tactions_menu_items.push(bulk_cancel());\n\t\t}\n\n\t\t// bulk delete\n\t\tif (frappe.model.can_delete(doctype)) {\n\t\t\tactions_menu_items.push(bulk_delete());\n\t\t}\n\n\t\treturn actions_menu_items;\n\t}\n\n\tparse_filters_from_route_options() {\n\t\tconst filters = [];\n\n\t\tfor (let field in frappe.route_options) {\n\t\t\tlet doctype = null;\n\t\t\tlet value = frappe.route_options[field];\n\n\t\t\tlet value_array;\n\t\t\tif (\n\t\t\t\t$.isArray(value) &&\n\t\t\t\tvalue[0].startsWith(\"[\") &&\n\t\t\t\tvalue[0].endsWith(\"]\")\n\t\t\t) {\n\t\t\t\tvalue_array = [];\n\t\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\t\tvalue_array.push(JSON.parse(value[i]));\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\ttypeof value === \"string\" &&\n\t\t\t\tvalue.startsWith(\"[\") &&\n\t\t\t\tvalue.endsWith(\"]\")\n\t\t\t) {\n\t\t\t\tvalue = JSON.parse(value);\n\t\t\t}\n\n\t\t\t// if `Child DocType.fieldname`\n\t\t\tif (field.includes(\".\")) {\n\t\t\t\tdoctype = field.split(\".\")[0];\n\t\t\t\tfield = field.split(\".\")[1];\n\t\t\t}\n\n\t\t\t// find the table in which the key exists\n\t\t\t// for example the filter could be {\"item_code\": \"X\"}\n\t\t\t// where item_code is in the child table.\n\n\t\t\t// we can search all tables for mapping the doctype\n\t\t\tif (!doctype) {\n\t\t\t\tdoctype = frappe.meta.get_doctype_for_field(\n\t\t\t\t\tthis.doctype,\n\t\t\t\t\tfield\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (doctype) {\n\t\t\t\tif (value_array) {\n\t\t\t\t\tfor (var j = 0; j < value_array.length; j++) {\n\t\t\t\t\t\tif ($.isArray(value_array[j])) {\n\t\t\t\t\t\t\tfilters.push([\n\t\t\t\t\t\t\t\tdoctype,\n\t\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\t\tvalue_array[j][0],\n\t\t\t\t\t\t\t\tvalue_array[j][1],\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters.push([doctype, field, \"=\", value_array[j]]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ($.isArray(value)) {\n\t\t\t\t\tfilters.push([doctype, field, value[0], value[1]]);\n\t\t\t\t} else {\n\t\t\t\t\tfilters.push([doctype, field, \"=\", value]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tstatic trigger_list_update(data) {\n\t\tconst doctype = data.doctype;\n\t\tif (!doctype) return;\n\t\tfrappe.provide(\"frappe.views.trees\");\n\n\t\t// refresh tree view\n\t\tif (frappe.views.trees[doctype]) {\n\t\t\tfrappe.views.trees[doctype].tree.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\t// refresh list view\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst list_view = frappe.views.list_view[page_name];\n\t\tlist_view && list_view.on_update(data);\n\t}\n};\n\n$(document).on(\"save\", (event, doc) => {\n\tfrappe.views.ListView.trigger_list_update(doc);\n});\n\nfrappe.get_list_view = (doctype) => {\n\tlet route = `List/${doctype}/List`;\n\treturn frappe.views.list_view[route];\n};","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.list_view');\n\nwindow.cur_list = null;\nfrappe.views.ListFactory = class ListFactory extends frappe.views.Factory {\n\tmake (route) {\n\t\tvar me = this;\n\t\tvar doctype = route[1];\n\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tif (locals['DocType'][doctype].issingle) {\n\t\t\t\tfrappe.set_re_route('Form', doctype);\n\t\t\t} else {\n\t\t\t\t// List / Gantt / Kanban / etc\n\t\t\t\t// File is a special view\n\t\t\t\tconst view_name = doctype !== 'File' ? frappe.utils.to_title_case(route[2] || 'List') : 'File';\n\t\t\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\t\t\tif (!view_class) view_class = frappe.views.ListView;\n\n\t\t\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t\t\t// view can have custom routing logic\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.provide('frappe.views.list_view.' + doctype);\n\t\t\t\tconst page_name = frappe.get_route_str();\n\n\t\t\t\tif (!frappe.views.list_view[page_name]) {\n\t\t\t\t\tfrappe.views.list_view[page_name] = new view_class({\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tparent: me.make_page(true, page_name)\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\t}\n\t\t\t\tme.set_cur_list();\n\t\t\t}\n\t\t});\n\t}\n\n\tshow() {\n\t\tif (this.re_route_to_view()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.set_module_breadcrumb();\n\t\tsuper.show();\n\t\tthis.set_cur_list();\n\t\tcur_list && cur_list.show();\n\t}\n\n\tre_route_to_view() {\n\t\tvar route = frappe.get_route();\n\t\tvar doctype = route[1];\n\t\tvar last_route = frappe.route_history.slice(-2)[0];\n\t\tif (route[0] === 'List' && route.length === 2 && frappe.views.list_view[doctype]) {\n\t\t\tif(last_route && last_route[0]==='List' && last_route[1]===doctype) {\n\t\t\t\t// last route same as this route, so going back.\n\t\t\t\t// this happens because /app/List/Item will redirect to /app/List/Item/List\n\t\t\t\t// while coming from back button, the last 2 routes will be same, so\n\t\t\t\t// we know user is coming in the reverse direction (via back button)\n\n\t\t\t\t// example:\n\t\t\t\t// Step 1: /app/List/Item redirects to /app/List/Item/List\n\t\t\t\t// Step 2: User hits \"back\" comes back to /app/List/Item\n\t\t\t\t// Step 3: Now we cannot send the user back to /app/List/Item/List so go back one more step\n\t\t\t\twindow.history.go(-1);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t//TODO: Commonify with code in \"make\" method\n\t\tconst view_name = doctype !== 'File' ? frappe.utils.to_title_case(route[2] || 'List') : 'File';\n\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\tif (!view_class) view_class = frappe.views.ListView;\n\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t// view can have custom routing logic\n\t\t\treturn;\n\t\t}\n\t}\n\n\tset_module_breadcrumb() {\n\t\tif (frappe.route_history.length > 1) {\n\t\t\tvar prev_route = frappe.route_history[frappe.route_history.length - 2];\n\t\t\tif (prev_route[0] === 'modules') {\n\t\t\t\tvar doctype = frappe.get_route()[1],\n\t\t\t\t\tmodule = prev_route[1];\n\t\t\t\tif (frappe.module_links[module] && frappe.module_links[module].includes(doctype)) {\n\t\t\t\t\t// save the last page from the breadcrumb was accessed\n\t\t\t\t\tfrappe.breadcrumbs.set_doctype_module(doctype, module);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tset_cur_list() {\n\t\tvar route = frappe.get_route();\n\t\tvar page_name = frappe.get_route_str();\n\t\tcur_list = frappe.views.list_view[page_name];\n\t\tif (cur_list && cur_list.doctype !== route[1]) {\n\t\t\t// changing...\n\t\t\twindow.cur_list = null;\n\t\t}\n\t}\n}\n","frappe.provide(\"frappe.views\");\n\nfrappe.views.ListViewSelect = class ListViewSelect {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.set_current_view();\n\t\tthis.setup_views();\n\t}\n\n\tadd_view_to_menu(view, action) {\n\t\tlet $el = this.page.add_custom_menu_item(\n\t\t\tthis.parent,\n\t\t\t__(view),\n\t\t\taction,\n\t\t\ttrue,\n\t\t\tnull,\n\t\t\tthis.icon_map[view] || \"list\"\n\t\t);\n\t\t$el.parent().attr(\"data-view\", view);\n\t}\n\n\tset_current_view() {\n\t\tthis.current_view = \"List\";\n\t\tconst route = frappe.get_route();\n\t\tconst view_name = frappe.utils.to_title_case(route[2] || \"\");\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(view_name)) {\n\t\t\tthis.current_view = view_name;\n\n\t\t\tif (this.current_view === \"Kanban\") {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === \"Inbox\") {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\t}\n\n\tset_route(view, calendar_name) {\n\t\tconst route = [this.slug(), \"view\", view];\n\t\tif (calendar_name) route.push(calendar_name);\n\t\tfrappe.set_route(route);\n\t}\n\n\tsetup_views() {\n\t\tconst views = {\n\t\t\tList: {\n\t\t\t\tcondition: true,\n\t\t\t\taction: () => this.set_route(\"list\")\n\t\t\t},\n\t\t\tReport: {\n\t\t\t\tcondition: true,\n\t\t\t\taction: () => this.set_route(\"report\"),\n\t\t\t\tcurrent_view_handler: () => {\n\t\t\t\t\tconst reports = this.get_reports();\n\t\t\t\t\tlet default_action = {};\n\t\t\t\t\t// Only add action if current route is not report builder\n\t\t\t\t\tif (frappe.get_route().length > 3) {\n\t\t\t\t\t\tdefault_action = {\n\t\t\t\t\t\t\tlabel: __(\"Report Builder\"),\n\t\t\t\t\t\t\taction: () => this.set_route(\"report\")\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tthis.setup_dropdown_in_sidebar(\"Report\", reports, default_action);\n\t\t\t\t}\n\t\t\t},\n\t\t\tDashboard: {\n\t\t\t\tcondition: true,\n\t\t\t\taction: () => this.set_route(\"dashboard\")\n\t\t\t},\n\t\t\tCalendar: {\n\t\t\t\tcondition: frappe.views.calendar[this.doctype],\n\t\t\t\taction: () => this.set_route(\"calendar\"),\n\t\t\t\tcurrent_view_handler: () => {\n\t\t\t\t\tthis.get_calendars().then(calendars => {\n\t\t\t\t\t\tthis.setup_dropdown_in_sidebar(\"Calendar\", calendars);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tGantt: {\n\t\t\t\tcondition: frappe.views.calendar[this.doctype],\n\t\t\t\taction: () => this.set_route(\"gantt\")\n\t\t\t},\n\t\t\tInbox: {\n\t\t\t\tcondition:\n\t\t\t\t\tthis.doctype === \"Communication\" &&\n\t\t\t\t\tfrappe.boot.email_accounts.length,\n\t\t\t\taction: () => this.set_route(\"inbox\"),\n\t\t\t\tcurrent_view_handler: () => {\n\t\t\t\t\tconst accounts = this.get_email_accounts();\n\t\t\t\t\tlet default_action;\n\t\t\t\t\tif (\n\t\t\t\t\t\thas_common(frappe.user_roles, [\n\t\t\t\t\t\t\t\"System Manager\",\n\t\t\t\t\t\t\t\"Administrator\"\n\t\t\t\t\t\t])\n\t\t\t\t\t) {\n\t\t\t\t\t\tdefault_action = {\n\t\t\t\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t\t\t\t\taction: () => frappe.new_doc(\"Email Account\")\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tthis.setup_dropdown_in_sidebar(\n\t\t\t\t\t\t\"Inbox\",\n\t\t\t\t\t\taccounts,\n\t\t\t\t\t\tdefault_action\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\tImage: {\n\t\t\t\tcondition: this.list_view.meta.image_field,\n\t\t\t\taction: () => this.set_route(\"image\")\n\t\t\t},\n\t\t\tTree: {\n\t\t\t\tcondition:\n\t\t\t\t\tfrappe.treeview_settings[this.doctype] ||\n\t\t\t\t\tfrappe.get_meta(this.doctype).is_tree,\n\t\t\t\taction: () => this.set_route(\"tree\")\n\t\t\t},\n\t\t\tKanban: {\n\t\t\t\tcondition: true,\n\t\t\t\taction: () => this.setup_kanban_boards(),\n\t\t\t\tcurrent_view_handler: () => {\n\t\t\t\t\tfrappe.views.KanbanView.get_kanbans(this.doctype).then(\n\t\t\t\t\t\tkanbans => this.setup_kanban_switcher(kanbans)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\tMap: {\n\t\t\t\tcondition: this.list_view.meta.fields.filter(f => f.fieldtype === \"Geolocation\").length,\n\t\t\t\taction: () => this.set_route(\"map\")\n\t\t\t}\n\t\t}\n\n\t\tfrappe.views.view_modes.forEach(view => {\n\t\t\tif (this.current_view !== view && views[view].condition) {\n\t\t\t\tthis.add_view_to_menu(view, views[view].action);\n\t\t\t}\n\n\t\t\tif (this.current_view == view) {\n\t\t\t\tviews[view].current_view_handler &&\n\t\t\t\t\tviews[view].current_view_handler();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_dropdown_in_sidebar(view, items, default_action) {\n\t\tif (!this.sidebar) return;\n\t\tconst views_wrapper = this.sidebar.sidebar.find(\".views-section\");\n\t\tviews_wrapper.find(\".sidebar-label\").html(`${__(view)}`);\n\t\tconst $dropdown = views_wrapper.find(\".views-dropdown\");\n\n\t\tlet placeholder = __(\"Select {0}\", [__(view)]);\n\t\tlet html = ``;\n\n\t\tif (!items || !items.length) {\n\t\t\thtml = `<div class=\"empty-state\">\n\t\t\t\t\t\t${__(\"No {} Found\", [__(view)])}\n\t\t\t\t</div>`;\n\t\t} else {\n\t\t\tconst page_name = this.get_page_name();\n\t\t\titems.map(item => {\n\t\t\t\tif (item.name.toLowerCase() == page_name.toLowerCase()) {\n\t\t\t\t\tplaceholder = item.name;\n\t\t\t\t} else {\n\t\t\t\t\thtml += `<li><a class=\"dropdown-item\" href=\"${item.route}\">${\n\t\t\t\t\t\titem.name\n\t\t\t\t\t}</a></li>`;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tviews_wrapper.find(\".selected-view\").html(placeholder);\n\n\t\tif (default_action) {\n\t\t\tviews_wrapper.find(\".sidebar-action a\").html(default_action.label);\n\t\t\tviews_wrapper\n\t\t\t\t.find(\".sidebar-action a\")\n\t\t\t\t.click(() => default_action.action());\n\t\t}\n\n\t\t$dropdown.html(html);\n\n\t\tviews_wrapper.removeClass(\"hide\");\n\t}\n\n\tsetup_kanban_switcher(kanbans) {\n\t\tconst kanban_switcher = this.page.add_custom_button_group(\n\t\t\t__(\"Select Kanban\"),\n\t\t\tnull,\n\t\t\tthis.list_view.$filter_section\n\t\t);\n\n\t\tkanbans.map(k => {\n\t\t\tthis.page.add_custom_menu_item(\n\t\t\t\tkanban_switcher,\n\t\t\t\tk.name,\n\t\t\t\t() => this.set_route(\"kanban\", k.name),\n\t\t\t\tfalse\n\t\t\t);\n\t\t});\n\n\t\tthis.page.add_custom_menu_item(\n\t\t\tkanban_switcher,\n\t\t\t__(\"Create New Kanban Board\"),\n\t\t\t() => frappe.views.KanbanView.show_kanban_dialog(this.doctype),\n\t\t\ttrue\n\t\t);\n\t}\n\n\tget_page_name() {\n\t\treturn frappe.utils.to_title_case(\n\t\t\tfrappe.get_route().slice(-1)[0] || \"\"\n\t\t);\n\t}\n\n\tget_reports() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tlet added = [];\n\t\tlet reports_to_add = [];\n\n\t\tlet add_reports = reports => {\n\t\t\treports.map(r => {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == this.doctype) {\n\t\t\t\t\tconst report_type =\n\t\t\t\t\t\tr.report_type === \"Report Builder\"\n\t\t\t\t\t\t\t? `/app/list/${r.ref_doctype}/report`\n\t\t\t\t\t\t\t: \"/app/query-report\";\n\n\t\t\t\t\tconst route =\n\t\t\t\t\t\tr.route || report_type + \"/\" + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\t\t\t\t\t\treports_to_add.push({\n\t\t\t\t\t\t\tname: r.title || r.name,\n\t\t\t\t\t\t\troute: route\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// Sort reports alphabetically\n\t\tvar reports =\n\t\t\tObject.values(frappe.boot.user.all_reports).sort((a, b) =>\n\t\t\t\ta.title.localeCompare(b.title)\n\t\t\t) || [];\n\n\t\t// from specially tagged reports\n\t\tadd_reports(reports);\n\n\t\treturn reports_to_add;\n\t}\n\n\tsetup_kanban_boards() {\n\t\tconst last_opened_kanban =\n\t\t\tfrappe.model.user_settings[this.doctype][\"Kanban\"] &&\n\t\t\tfrappe.model.user_settings[this.doctype][\"Kanban\"]\n\t\t\t\t.last_kanban_board;\n\n\t\tif (last_opened_kanban) {\n\t\t\tfrappe.set_route(\n\t\t\t\t\"list\",\n\t\t\t\tthis.doctype,\n\t\t\t\t\"kanban\",\n\t\t\t\tlast_opened_kanban\n\t\t\t);\n\t\t} else {\n\t\t\tfrappe.views.KanbanView.show_kanban_dialog(this.doctype, true);\n\t\t}\n\t}\n\n\tget_calendars() {\n\t\tconst doctype = this.doctype;\n\t\tlet calendars = [];\n\n\t\treturn frappe.db\n\t\t\t.get_list(\"Calendar View\", {\n\t\t\t\tfilters: {\n\t\t\t\t\treference_doctype: doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(result => {\n\t\t\t\tif (!(result && Array.isArray(result) && result.length)) return;\n\n\t\t\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\t\t\t// has standard calendar view\n\t\t\t\t\tcalendars.push({\n\t\t\t\t\t\tname: \"Default\",\n\t\t\t\t\t\troute: `/app/${this.slug()}/view/calendar/default`\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tresult.map(calendar => {\n\t\t\t\t\tcalendars.push({\n\t\t\t\t\t\tname: calendar.name,\n\t\t\t\t\t\troute: `/app/${this.slug()}/view/calendar/${\n\t\t\t\t\t\t\tcalendar.name\n\t\t\t\t\t\t}`\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn calendars;\n\t\t\t});\n\t}\n\n\tget_email_accounts() {\n\t\tlet accounts_to_add = [];\n\t\tlet accounts = frappe.boot.email_accounts;\n\t\taccounts.forEach(account => {\n\t\t\tlet email_account =\n\t\t\t\taccount.email_id == \"All Accounts\"\n\t\t\t\t\t? \"All Accounts\"\n\t\t\t\t\t: account.email_account;\n\t\t\tlet route = `/app/communication/inbox/${email_account}`;\n\t\t\tlet display_name = [\n\t\t\t\t\"All Accounts\",\n\t\t\t\t\"Sent Mail\",\n\t\t\t\t\"Spam\",\n\t\t\t\t\"Trash\"\n\t\t\t].includes(account.email_id)\n\t\t\t\t? __(account.email_id)\n\t\t\t\t: account.email_account;\n\n\t\t\taccounts_to_add.push({\n\t\t\t\tname: display_name,\n\t\t\t\troute: route\n\t\t\t});\n\t\t});\n\n\t\treturn accounts_to_add;\n\t}\n\n\tslug() {\n\t\treturn frappe.router.slug(frappe.router.doctype_layout || this.doctype);\n\t}\n}","frappe.provide('frappe.ui');\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role([\n\t\t\t'System Manager',\n\t\t\t'Administrator',\n\t\t]);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html(`\n\t\t\t<li class=\"input-area\"></li>\n\t\t\t<li class=\"sidebar-action\">\n\t\t\t\t<a class=\"saved-filters-preview\">${__('Show Saved')}</a>\n\t\t\t</li>\n\t\t\t<div class=\"saved-filters\"></div>\n\t\t`);\n\n\t\tthis.$input_area = this.wrapper.find('.input-area');\n\t\tthis.$list_filters = this.wrapper.find('.list-filters');\n\t\tthis.$saved_filters = this.wrapper.find('.saved-filters').hide();\n\t\tthis.saved_filters_hidden = true;\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Filter Name'),\n\t\t\t\tinput_class: 'input-xs',\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tlabel: __('Is Global'),\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_toggle_saved_filters();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters().then(() => {\n\t\t\tconst html = this.filters.map(filter => this.filter_template(filter));\n\t\t\tthis.wrapper.find('.filter-pill').remove();\n\t\t\tthis.$saved_filters.append(html);\n\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description('');\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<div class=\"list-link filter-pill list-sidebar-button btn btn-default\" data-name=\"${\n\t\t\tfilter.name\n\t\t}\">\n\t\t\t<a class=\"ellipsis filter-name\">${filter.filter_name}</a>\n\t\t\t<a class=\"remove\">${frappe.utils.icon('close')}</a>\n\t\t</div>`;\n\t}\n\n\tbind_toggle_saved_filters() {\n\t\tthis.wrapper.find('.saved-filters-preview').click(() => {\n\t\t\tthis.toggle_saved_filters(this.saved_filters_hidden);\n\t\t});\n\t}\n\n\ttoggle_saved_filters(show) {\n\t\tthis.$saved_filters.toggle(show);\n\t\tconst label = show ? __('Hide Saved') : __('Show Saved');\n\t\tthis.wrapper.find('.saved-filters-preview').text(label);\n\t\tthis.saved_filters_hidden = !this.saved_filters_hidden;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on('click', '.filter-pill .filter-name', (e) => {\n\t\t\tlet $filter = $(e.currentTarget).parent('.filter-pill');\n\t\t\tthis.set_applied_filter($filter);\n\n\t\t\tconst name = $filter.attr('data-name');\n\t\t\tthis.list_view.filter_area.clear().then(() => {\n\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on('click', '.filter-pill .remove', (e) => {\n\t\t\tconst $li = $(e.currentTarget).closest('.filter-pill');\n\t\t\tconst name = $li.attr('data-name');\n\t\t\tconst applied_filters = this.get_filters_values(name);\n\t\t\t$li.remove();\n\t\t\tthis.remove_filter(name).then(() => this.refresh());\n\t\t\tthis.list_view.filter_area.remove_filters(applied_filters);\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(\n\t\t\tfrappe.utils.debounce((e) => {\n\t\t\t\tconst value = this.filter_input.get_value();\n\t\t\t\tconst has_value = Boolean(value);\n\n\t\t\t\tif (e.which === frappe.ui.keyCode['ENTER']) {\n\t\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\t\tthis.filter_input.set_value('');\n\t\t\t\t\tthis.save_filter(value)\n\t\t\t\t\t\t.then(() => this.refresh());\n\t\t\t\t\tthis.toggle_saved_filters(true);\n\t\t\t\t} else {\n\t\t\t\t\tlet help_text = __('Press Enter to save');\n\n\t\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\t\thelp_text = __('Duplicate Filter Name');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.filter_input.set_description(has_value ? help_text : '');\n\n\t\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 300)\n\t\t);\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: 'List Filter',\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? '' : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters()),\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc('List Filter', name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find((filter) => filter.name === name);\n\t\treturn JSON.parse(filter.filters || '[]');\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find((f) => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\tif (frappe.session.user === 'Guest') return Promise.resolve();\n\t\treturn frappe.db\n\t\t\t.get_list('List Filter', {\n\t\t\t\tfields: ['name', 'filter_name', 'for_user', 'filters'],\n\t\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\t\tor_filters: [\n\t\t\t\t\t['for_user', '=', frappe.session.user],\n\t\t\t\t\t['for_user', '=', '']\n\t\t\t\t]\n\t\t\t}).then((filters) => {\n\t\t\t\tthis.filters = filters || [];\n\t\t\t});\n\t}\n\n\tset_applied_filter($filter) {\n\t\tthis.$saved_filters\n\t\t\t.find('.btn-primary-light')\n\t\t\t.toggleClass('btn-primary-light btn-default');\n\t\t$filter.toggleClass('btn-default btn-primary-light');\n\t}\n}\n","// Copyright (c) 2019, Dokos SAS and Contributors\n// MIT License. See license.txt\nimport ListFilter from './list_filter';\nfrappe.provide('frappe.views');\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n// set_filter = function called on click\n\nfrappe.views.ListSidebar = class ListSidebar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_list_filter();\n\t\tthis.setup_list_group_by();\n\n\t\t// do not remove\n\t\t// used to trigger custom scripts\n\t\t$(document).trigger('list_sidebar_setup');\n\n\t\tif (this.list_view.list_view_settings && this.list_view.list_view_settings.disable_sidebar_stats) {\n\t\t\tthis.sidebar.find('.sidebar-stat').remove();\n\t\t} else {\n\t\t\tthis.sidebar.find('.list-stats').on('click', (e) => {\n\t\t\t\tthis.reload_stats();\n\t\t\t});\n\t\t}\n\n\t}\n\n\tsetup_list_group_by() {\n\t\tthis.list_group_by = new frappe.views.ListGroupBy({\n\t\t\tdoctype: this.doctype,\n\t\t\tsidebar: this,\n\t\t\tlist_view: this.list_view,\n\t\t\tpage: this.page\n\t\t});\n\t}\n\n\tsetup_list_filter() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find('.list-filters'),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view\n\t\t});\n\t}\n\n\tget_stats() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.reportview.get_sidebar_stats',\n\t\t\ttype: 'GET',\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\t// wait for list filter area to be generated before getting filters, or fallback to default filters\n\t\t\t\tfilters: (me.list_view.filter_area ? me.list_view.get_filters_for_args() : me.default_filters) || []\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_stat((r.message.stats || {})[\"_user_tags\"]);\n\t\t\t\tlet stats_dropdown = me.sidebar.find('.list-stats-dropdown');\n\t\t\t\tfrappe.utils.setup_search(stats_dropdown, '.stat-link', '.stat-label');\n\t\t\t}\n\t\t});\n\t}\n\n\trender_stat(stats) {\n\t\tlet args = {\n\t\t\tstats: stats,\n\t\t\tlabel: __(\"Tags\")\n\t\t};\n\n\t\tlet tag_list = $(frappe.render_template(\"list_sidebar_stat\", args)).on(\"click\", \".stat-link\", (e) => {\n\t\t\tlet fieldname = $(e.currentTarget).attr('data-field');\n\t\t\tlet label = $(e.currentTarget).attr('data-label');\n\t\t\tlet condition = \"like\";\n\t\t\tlet existing = this.list_view.filter_area.filter_list.get_filter(fieldname);\n\t\t\tif (existing) {\n\t\t\t\texisting.remove();\n\t\t\t}\n\t\t\tif (label == \"No Tags\") {\n\t\t\t\tlabel = \"%,%\";\n\t\t\t\tcondition = \"not like\";\n\t\t\t}\n\t\t\tthis.list_view.filter_area.add(\n\t\t\t\tthis.doctype,\n\t\t\t\tfieldname,\n\t\t\t\tcondition,\n\t\t\t\tlabel\n\t\t\t);\n\t\t});\n\n\t\tthis.sidebar.find(\".list-stats-dropdown .stat-result\").html(tag_list);\n\t}\n\n\treload_stats() {\n\t\tthis.sidebar.find(\".stat-link\").remove();\n\t\tthis.sidebar.find(\".stat-no-records\").remove();\n\t\tthis.get_stats();\n\t}\n};","frappe.provide('frappe.views');\n\nfrappe.views.ListGroupBy = class ListGroupBy {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make_wrapper();\n\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\t\tthis.group_by_fields = ['assigned_to', 'owner'];\n\t\tif (this.user_settings.group_by_fields) {\n\t\t\tthis.group_by_fields = this.group_by_fields.concat(\n\t\t\t\tthis.user_settings.group_by_fields\n\t\t\t);\n\t\t}\n\t\tthis.render_group_by_items();\n\t\tthis.make_group_by_fields_modal();\n\t\tthis.setup_dropdown();\n\t\tthis.setup_filter_by();\n\t}\n\n\tmake_group_by_fields_modal() {\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Select Filters'),\n\t\t\tfields: this.get_group_by_dropdown_fields(),\n\t\t});\n\n\t\td.set_primary_action(__('Save'), ({ group_by_fields }) => {\n\t\t\tfrappe.model.user_settings.save(\n\t\t\t\tthis.doctype,\n\t\t\t\t'group_by_fields',\n\t\t\t\tgroup_by_fields || null\n\t\t\t);\n\t\t\tthis.group_by_fields = group_by_fields\n\t\t\t\t? ['assigned_to', 'owner', ...group_by_fields]\n\t\t\t\t: ['assigned_to', 'owner'];\n\t\t\tthis.render_group_by_items();\n\t\t\tthis.setup_dropdown();\n\t\t\td.hide();\n\t\t});\n\n\t\td.$body.prepend(`\n\t\t\t<div class=\"filters-search\">\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tplaceholder=\"${__('Search')}\"\n\t\t\t\t\tdata-element=\"search\" class=\"form-control input-xs\">\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.page.sidebar.find('.add-list-group-by a').on('click', () => {\n\t\t\tfrappe.utils.setup_search(d.$body, '.unit-checkbox', '.label-area');\n\t\t\td.show();\n\t\t});\n\t}\n\n\tmake_wrapper() {\n\t\tthis.$wrapper = this.sidebar.sidebar.find('.list-group-by');\n\t\tlet html = `\n\t\t\t<div class=\"list-group-by-fields\">\n\t\t\t</div>\n\t\t\t<li class=\"add-list-group-by sidebar-action\">\n\t\t\t\t<a class=\"add-group-by\">\n\t\t\t\t\t${__('Edit Filters')}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t`;\n\t\tthis.$wrapper.html(html);\n\t}\n\n\trender_group_by_items() {\n\t\tlet get_item_html = (fieldname) => {\n\t\t\tlet label, fieldtype;\n\t\t\tif (fieldname === 'assigned_to') {\n\t\t\t\tlabel = __('Assigned To');\n\t\t\t} else if (fieldname === 'owner') {\n\t\t\t\tlabel = __('Created By');\n\t\t\t} else {\n\t\t\t\tlabel = frappe.meta.get_label(this.doctype, fieldname);\n\t\t\t\tlet docfield = frappe.meta.get_docfield(this.doctype, fieldname);\n\t\t\t\tif (!docfield) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfieldtype = docfield.fieldtype;\n\t\t\t}\n\n\t\t\treturn `<li class=\"group-by-field list-link\">\n\t\t\t\t\t<a class=\"btn btn-default btn-sm list-sidebar-button\" data-toggle=\"dropdown\"\n\t\t\t\t\taria-haspopup=\"true\" aria-expanded=\"false\"\n\t\t\t\t\tdata-label=\"${label}\" data-fieldname=\"${fieldname}\" data-fieldtype=\"${fieldtype}\"\n\t\t\t\t\thref=\"#\" onclick=\"return false;\">\n\t\t\t\t\t\t<span class=\"ellipsis\">${__(label)}</span>\n\t\t\t\t\t\t<span>${frappe.utils.icon('select', 'xs')}</span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu group-by-dropdown\" role=\"menu\">\n\t\t\t\t\t</ul>\n\t\t\t</li>`;\n\t\t};\n\t\tlet html = this.group_by_fields.map(get_item_html).join('');\n\t\tthis.$wrapper.find('.list-group-by-fields').html(html);\n\t}\n\n\tsetup_dropdown() {\n\t\tthis.$wrapper.find('.group-by-field').on('show.bs.dropdown', (e) => {\n\t\t\tlet $dropdown = $(e.currentTarget).find('.group-by-dropdown');\n\t\t\tthis.set_loading_state($dropdown);\n\t\t\tlet fieldname = $(e.currentTarget)\n\t\t\t\t.find('a')\n\t\t\t\t.attr('data-fieldname');\n\t\t\tlet fieldtype = $(e.currentTarget)\n\t\t\t\t.find('a')\n\t\t\t\t.attr('data-fieldtype');\n\t\t\tthis.get_group_by_count(fieldname).then((field_count_list) => {\n\t\t\t\tif (field_count_list.length) {\n\t\t\t\t\tlet applied_filter = this.list_view.get_filter_value(\n\t\t\t\t\t\tfieldname == 'assigned_to' ? '_assign' : fieldname\n\t\t\t\t\t);\n\t\t\t\t\tthis.render_dropdown_items(\n\t\t\t\t\t\tfield_count_list,\n\t\t\t\t\t\tfieldtype,\n\t\t\t\t\t\t$dropdown,\n\t\t\t\t\t\tapplied_filter\n\t\t\t\t\t);\n\t\t\t\t\tthis.setup_search($dropdown);\n\t\t\t\t} else {\n\t\t\t\t\tthis.set_empty_state($dropdown);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_loading_state($dropdown) {\n\t\t$dropdown.html(`<li>\n\t\t\t<div class=\"empty-state group-by-loading\">\n\t\t\t\t${__('Loading...')}\n\t\t\t</div>\n\t\t</li>`);\n\t}\n\n\tset_empty_state($dropdown) {\n\t\t$dropdown.html(\n\t\t\t`<div class=\"empty-state group-by-empty\">\n\t\t\t\t${__('No filters found')}\n\t\t\t</div>`\n\t\t);\n\t}\n\n\tsetup_search($dropdown) {\n\t\tfrappe.utils.setup_search(\n\t\t\t$dropdown,\n\t\t\t'.group-by-item',\n\t\t\t'.group-by-value',\n\t\t\t'data-name'\n\t\t);\n\t}\n\n\tget_group_by_dropdown_fields() {\n\t\tlet group_by_fields = [];\n\t\tlet fields = this.list_view.meta.fields.filter((f) =>\n\t\t\t['Select', 'Link', 'Data', 'Int', 'Check'].includes(f.fieldtype)\n\t\t);\n\t\tgroup_by_fields.push({\n\t\t\tlabel: __(this.doctype),\n\t\t\tfieldname: 'group_by_fields',\n\t\t\tfieldtype: 'MultiCheck',\n\t\t\tcolumns: 2,\n\t\t\toptions: fields.map((df) => ({\n\t\t\t\tlabel: __(df.label),\n\t\t\t\tvalue: df.fieldname,\n\t\t\t\tchecked: this.group_by_fields.includes(df.fieldname),\n\t\t\t})),\n\t\t});\n\t\treturn group_by_fields;\n\t}\n\n\tget_group_by_count(field) {\n\t\tlet current_filters = this.list_view.get_filters_for_args();\n\n\t\t// remove filter of the current field\n\t\tcurrent_filters = current_filters.filter(\n\t\t\t(f_arr) => !f_arr.includes(field === 'assigned_to' ? '_assign' : field)\n\t\t);\n\n\t\tlet args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tcurrent_filters: current_filters,\n\t\t\tfield: field,\n\t\t};\n\n\t\treturn frappe\n\t\t\t.call('frappe.desk.listview.get_group_by_count', args)\n\t\t\t.then((r) => {\n\t\t\t\tlet field_counts = r.message || [];\n\t\t\t\tfield_counts = field_counts.filter((f) => f.count !== 0);\n\t\t\t\tlet current_user = field_counts.find(\n\t\t\t\t\t(f) => f.name === frappe.session.user\n\t\t\t\t);\n\t\t\t\tfield_counts = field_counts.filter(\n\t\t\t\t\t(f) =>\n\t\t\t\t\t\t!['Guest', 'Administrator', frappe.session.user].includes(f.name)\n\t\t\t\t);\n\t\t\t\t// Set frappe.session.user on top of the list\n\t\t\t\tif (current_user) field_counts.unshift(current_user);\n\t\t\t\treturn field_counts;\n\t\t\t});\n\t}\n\n\trender_dropdown_items(fields, fieldtype, $dropdown, applied_filter) {\n\t\tlet standard_html = `\n\t\t\t<div class=\"dropdown-search\">\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tplaceholder=\"${__('Search')}\"\n\t\t\t\t\tdata-element=\"search\"\n\t\t\t\t\tclass=\"dropdown-search-input form-control input-xs\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t`;\n\t\tlet applied_filter_html='';\n\t\tlet dropdown_items_html = '';\n\n\t\tfields.map(field => {\n\t\t\tif (field.name === applied_filter) {\n\t\t\t\tapplied_filter_html = this.get_dropdown_html(field, fieldtype, true);\n\t\t\t} else {\n\t\t\t\tdropdown_items_html += this.get_dropdown_html(field, fieldtype);\n\t\t\t}\n\t\t});\n\n\t\tlet dropdown_html = standard_html + applied_filter_html + dropdown_items_html;\n\t\t$dropdown.toggleClass('has-selected', Boolean(applied_filter_html));\n\t\t$dropdown.html(dropdown_html);\n\t}\n\n\tget_dropdown_html(field, fieldtype, applied=false) {\n\t\tlet label = field.name == null ? __('Not Set') : field.name;\n\t\tif (label === frappe.session.user) {\n\t\t\tlabel = __('Me');\n\t\t} else if (fieldtype && fieldtype == 'Check') {\n\t\t\tlabel = label == '0' ? __('No') : __('Yes');\n\t\t}\n\t\tlet value = field.name == null ? '' : encodeURIComponent(field.name);\n\n\t\tlet applied_html = applied ? `<span class=\"applied\"> ${frappe.utils.icon('tick', 'xs')} </span>` : '';\n\t\treturn `<li class=\"group-by-item ${applied ? 'selected': ''}\" data-value=\"${value}\">\n\t\t\t<a class=\"dropdown-item\" href=\"#\" onclick=\"return false;\">\n\t\t\t\t${applied_html}\n\t\t\t\t<span class=\"group-by-value ellipsis\" data-name=\"${field.name}\">${label}</span>\n\t\t\t\t<span class=\"group-by-count\">${field.count}</span>\n\t\t\t</a>\n\t\t</li>`;\n\t}\n\n\tsetup_filter_by() {\n\t\tthis.$wrapper.on('click', '.group-by-item', (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tlet is_selected = $target.hasClass('selected');\n\n\t\t\tlet fieldname = $target\n\t\t\t\t.parents('.group-by-field')\n\t\t\t\t.find('a')\n\t\t\t\t.data('fieldname');\n\t\t\tlet value =\n\t\t\t\ttypeof $target.data('value') === 'string'\n\t\t\t\t\t? decodeURIComponent($target.data('value').trim())\n\t\t\t\t\t: $target.data('value');\n\t\t\tfieldname = fieldname === 'assigned_to' ? '_assign' : fieldname;\n\n\t\t\treturn this.list_view.filter_area.remove(fieldname).then(() => {\n\t\t\t\tif (is_selected) return;\n\t\t\t\treturn this.apply_filter(fieldname, value);\n\t\t\t});\n\t\t});\n\t}\n\n\tapply_filter(fieldname, value) {\n\t\tlet operator = '=';\n\t\tif (value === '') {\n\t\t\toperator = 'is';\n\t\t\tvalue = 'not set';\n\t\t}\n\t\tif (fieldname === '_assign') {\n\t\t\toperator = 'like';\n\t\t\tvalue = `%${value}%`;\n\t\t}\n\t\treturn this.list_view.filter_area.add(\n\t\t\tthis.doctype,\n\t\t\tfieldname,\n\t\t\toperator,\n\t\t\tvalue\n\t\t);\n\t}\n};","frappe.provide('frappe.views');\n\nfrappe.views.GanttView = class GanttView extends frappe.views.ListView {\n\tget view_name() {\n\t\t// __(\"Gantt\")\n\t\treturn 'Gantt';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = this.page_title + ' ' + __('Gantt');\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\n\t\tif (typeof this.calendar_settings.gantt == 'object') {\n\t\t\tObject.assign(this.calendar_settings, this.calendar_settings.gantt);\n\t\t}\n\n\t\tif (this.calendar_settings.order_by) {\n\t\t\tthis.sort_by = this.calendar_settings.order_by;\n\t\t\tthis.sort_order = 'asc';\n\t\t} else {\n\t\t\tthis.sort_by = this.view_user_settings.sort_by || this.calendar_settings.field_map.start;\n\t\t\tthis.sort_order = this.view_user_settings.sort_order || 'asc';\n\t\t}\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.prepare_tasks();\n\t}\n\n\tprepare_tasks() {\n\t\tvar me = this;\n\t\tvar meta = this.meta;\n\t\tvar field_map = this.calendar_settings.field_map;\n\n\t\tthis.tasks = this.data.map(function (item) {\n\t\t\t// set progress\n\t\t\tvar progress = 0;\n\t\t\tif (field_map.progress && $.isFunction(field_map.progress)) {\n\t\t\t\tprogress = field_map.progress(item);\n\t\t\t} else if (field_map.progress) {\n\t\t\t\tprogress = item[field_map.progress];\n\t\t\t}\n\n\t\t\t// title\n\t\t\tvar label;\n\t\t\tif (meta.title_field) {\n\t\t\t\tlabel = item.progress\n\t\t\t\t\t? __(\"{0} ({1}) - {2}%\", [item[meta.title_field], item.name, item.progress])\n\t\t\t\t\t: __(\"{0} ({1})\", [item[meta.title_field], item.name]);\n\t\t\t} else {\n\t\t\t\tlabel = item[field_map.title];\n\t\t\t}\n\n\t\t\tvar r = {\n\t\t\t\tstart: item[field_map.start],\n\t\t\t\tend: item[field_map.end],\n\t\t\t\tname: label,\n\t\t\t\tid: item[field_map.id || 'name'],\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tprogress: progress,\n\t\t\t\tdependencies: item.depends_on_tasks || \"\"\n\t\t\t};\n\n\t\t\tif (item.color && frappe.ui.color.validate_hex(item.color)) {\n\t\t\t\tr['custom_class'] = 'color-' + item.color.substr(1);\n\t\t\t}\n\n\t\t\tif (item.is_milestone) {\n\t\t\t\tr['custom_class'] = 'bar-milestone';\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.load_lib.then(() => {\n\t\t\tthis.render_gantt();\n\t\t});\n\t}\n\n\trender_header() {\n\t}\n\n\trender_gantt() {\n\t\tconst me = this;\n\t\tconst gantt_view_mode = this.view_user_settings.gantt_view_mode || 'Day';\n\t\tconst field_map = this.calendar_settings.field_map;\n\t\tconst date_format = 'YYYY-MM-DD';\n\n\t\tthis.$result.empty();\n\t\tthis.$result.addClass('gantt-modern');\n\n\t\tthis.gantt = new Gantt(this.$result[0], this.tasks, {\n\t\t\tbar_height: 35,\n\t\t\tbar_corner_radius: 4,\n\t\t\tresize_handle_width: 8,\n\t\t\tresize_handle_height: 28,\n\t\t\tresize_handle_corner_radius: 3,\n\t\t\tresize_handle_offset: 4,\n\t\t\tview_mode: gantt_view_mode,\n\t\t\tdate_format: \"YYYY-MM-DD\",\n\t\t\ton_click: task => {\n\t\t\t\tfrappe.set_route('Form', task.doctype, task.id);\n\t\t\t},\n\t\t\ton_date_change: (task, start, end) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t[field_map.start]: moment(start).format(date_format),\n\t\t\t\t\t[field_map.end]: moment(end).format(date_format)\n\t\t\t\t});\n\t\t\t},\n\t\t\ton_progress_change: (task, progress) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tvar progress_fieldname = 'progress';\n\n\t\t\t\tif ($.isFunction(field_map.progress)) {\n\t\t\t\t\tprogress_fieldname = null;\n\t\t\t\t} else if (field_map.progress) {\n\t\t\t\t\tprogress_fieldname = field_map.progress;\n\t\t\t\t}\n\n\t\t\t\tif (progress_fieldname) {\n\t\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t\t[progress_fieldname]: parseInt(progress)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ton_view_change: mode => {\n\t\t\t\t// save view mode\n\t\t\t\tme.save_view_user_settings({\n\t\t\t\t\tgantt_view_mode: mode\n\t\t\t\t});\n\t\t\t},\n\t\t\tcustom_popup_html: task => {\n\t\t\t\tvar item = me.get_item(task.id);\n\n\t\t\t\tvar html =\n\t\t\t\t\t`<div class=\"title\">${task.name}</div>\n\t\t\t\t\t<div class=\"subtitle\">${moment(task._start).format('MMM D')} - ${moment(task._end).format('MMM D')}</div>`;\n\n\t\t\t\t// custom html in doctype settings\n\t\t\t\tvar custom = me.settings.gantt_custom_popup_html;\n\t\t\t\tif (custom && $.isFunction(custom)) {\n\t\t\t\t\tvar ganttobj = task;\n\t\t\t\t\thtml = custom(ganttobj, item);\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"details-container\">' + html + '</div>';\n\t\t\t}\n\t\t});\n\t\tthis.setup_view_mode_buttons();\n\t\tthis.set_colors();\n\t}\n\n\tsetup_view_mode_buttons() {\n\t\t// view modes (for translation) __(\"Day\"), __(\"Week\"), __(\"Month\"),\n\t\t//__(\"Half Day\"), __(\"Quarter Day\")\n\n\t\tlet $btn_group = this.$paging_area.find('.gantt-view-mode');\n\t\tif ($btn_group.length > 0) return;\n\n\t\tconst view_modes = this.gantt.options.view_modes || [];\n\t\tconst active_class = view_mode => this.gantt.view_is(view_mode) ? 'btn-info' : '';\n\t\tconst html =\n\t\t\t`<div class=\"btn-group gantt-view-mode\">\n\t\t\t\t${view_modes.map(value => `<button type=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-default btn-sm btn-view-mode ${active_class(value)}\"\n\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t${__(value)}\n\t\t\t\t\t</button>`).join('')}\n\t\t\t</div>`;\n\n\t\tthis.$paging_area.find('.level-left').append(html);\n\n\t\t// change view mode asynchronously\n\t\tconst change_view_mode = (value) => setTimeout(() => this.gantt.change_view_mode(value), 0);\n\n\t\tthis.$paging_area.on('click', '.btn-view-mode', e => {\n\t\t\tconst $btn = $(e.currentTarget);\n\t\t\tthis.$paging_area.find('.btn-view-mode').removeClass('btn-info');\n\t\t\t$btn.addClass('btn-info');\n\n\t\t\tconst value = $btn.data().value;\n\t\t\tchange_view_mode(value);\n\t\t});\n\t}\n\n\tset_colors() {\n\t\tconst classes = this.tasks\n\t\t\t.map(t => t.custom_class)\n\t\t\t.filter(c => c && c.startsWith('color-'));\n\n\t\tlet style = classes.map(c => {\n\t\t\tconst class_name = c.replace('#', '');\n\t\t\tconst bar_color = '#' + c.substr(6);\n\t\t\tconst progress_color = frappe.ui.color.get_contrast_color(bar_color);\n\t\t\treturn `\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar {\n\t\t\t\t\tfill: ${bar_color};\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar-progress {\n\t\t\t\t\tfill: ${progress_color};\n\t\t\t\t}\n\t\t\t`;\n\t\t}).join(\"\");\n\n\t\tstyle = `<style>${style}</style>`;\n\t\tthis.$result.prepend(style);\n\t}\n\n\tget_item(name) {\n\t\treturn this.data.find(item => item.name === name);\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css\",\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js\"\n\t\t];\n\t}\n};\n\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","var n,l,u,i,t,r,o,f={},e=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function s(n,l){for(var u in l)n[u]=l[u];return n}function a(n){var l=n.parentNode;l&&l.removeChild(n)}function v(n,l,u){var i,t=arguments,r={};for(i in l)\"key\"!==i&&\"ref\"!==i&&(r[i]=l[i]);if(arguments.length>3)for(u=[u],i=3;i<arguments.length;i++)u.push(t[i]);if(null!=u&&(r.children=u),\"function\"==typeof n&&null!=n.defaultProps)for(i in n.defaultProps)void 0===r[i]&&(r[i]=n.defaultProps[i]);return h(n,r,l&&l.key,l&&l.ref,null)}function h(l,u,i,t,r){var o={type:l,props:u,key:i,ref:t,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:r};return null==r&&(o.__v=o),n.vnode&&n.vnode(o),o}function y(){return{current:null}}function p(n){return n.children}function d(n,l){this.props=n,this.context=l}function _(n,l){if(null==l)return n.__?_(n.__,n.__.__k.indexOf(n)+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?_(n):null}function k(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return k(n)}}function w(l){(!l.__d&&(l.__d=!0)&&u.push(l)&&!m.__r++||t!==n.debounceRendering)&&((t=n.debounceRendering)||i)(m)}function m(){for(var n;m.__r=u.length;)n=u.sort(function(n,l){return n.__v.__b-l.__v.__b}),u=[],n.some(function(n){var l,u,i,t,r,o,f;n.__d&&(o=(r=(l=n).__v).__e,(f=l.__P)&&(u=[],(i=s({},r)).__v=i,t=T(f,r,i,l.__n,void 0!==f.ownerSVGElement,null,u,null==o?_(r):o),$(u,r),t!=o&&k(r)))})}function g(n,l,u,i,t,r,o,c,s,v){var y,d,k,w,m,g,b,A=i&&i.__k||e,P=A.length;for(s==f&&(s=null!=o?o[0]:P?_(i,0):null),u.__k=[],y=0;y<l.length;y++)if(null!=(w=u.__k[y]=null==(w=l[y])||\"boolean\"==typeof w?null:\"string\"==typeof w||\"number\"==typeof w?h(null,w,null,null,w):Array.isArray(w)?h(p,{children:w},null,null,null):null!=w.__e||null!=w.__c?h(w.type,w.props,w.key,null,w.__v):w)){if(w.__=u,w.__b=u.__b+1,null===(k=A[y])||k&&w.key==k.key&&w.type===k.type)A[y]=void 0;else for(d=0;d<P;d++){if((k=A[d])&&w.key==k.key&&w.type===k.type){A[d]=void 0;break}k=null}m=T(n,w,k=k||f,t,r,o,c,s,v),(d=w.ref)&&k.ref!=d&&(b||(b=[]),k.ref&&b.push(k.ref,null,w),b.push(d,w.__c||m,w)),null!=m?(null==g&&(g=m),s=x(n,w,k,A,o,m,s),\"option\"==u.type?n.value=\"\":\"function\"==typeof u.type&&(u.__d=s)):s&&k.__e==s&&s.parentNode!=n&&(s=_(k))}if(u.__e=g,null!=o&&\"function\"!=typeof u.type)for(y=o.length;y--;)null!=o[y]&&a(o[y]);for(y=P;y--;)null!=A[y]&&I(A[y],A[y]);if(b)for(y=0;y<b.length;y++)H(b[y],b[++y],b[++y])}function b(n){return null==n||\"boolean\"==typeof n?[]:Array.isArray(n)?e.concat.apply([],n.map(b)):[n]}function x(n,l,u,i,t,r,o){var f,e,c;if(void 0!==l.__d)f=l.__d,l.__d=void 0;else if(t==u||r!=o||null==r.parentNode)n:if(null==o||o.parentNode!==n)n.appendChild(r),f=null;else{for(e=o,c=0;(e=e.nextSibling)&&c<i.length;c+=2)if(e==r)break n;n.insertBefore(r,o),f=o}return void 0!==f?f:r.nextSibling}function A(n,l,u,i,t){var r;for(r in u)\"children\"===r||\"key\"===r||r in l||C(n,r,null,u[r],i);for(r in l)t&&\"function\"!=typeof l[r]||\"children\"===r||\"key\"===r||\"value\"===r||\"checked\"===r||u[r]===l[r]||C(n,r,l[r],u[r],i)}function P(n,l,u){\"-\"===l[0]?n.setProperty(l,u):n[l]=\"number\"==typeof u&&!1===c.test(l)?u+\"px\":null==u?\"\":u}function C(n,l,u,i,t){var r,o,f,e,c;if(t?\"className\"===l&&(l=\"class\"):\"class\"===l&&(l=\"className\"),\"style\"===l)if(r=n.style,\"string\"==typeof u)r.cssText=u;else{if(\"string\"==typeof i&&(r.cssText=\"\",i=null),i)for(e in i)u&&e in u||P(r,e,\"\");if(u)for(c in u)i&&u[c]===i[c]||P(r,c,u[c])}else\"o\"===l[0]&&\"n\"===l[1]?(o=l!==(l=l.replace(/Capture$/,\"\")),f=l.toLowerCase(),l=(f in n?f:l).slice(2),u?(i||n.addEventListener(l,N,o),(n.l||(n.l={}))[l]=u):n.removeEventListener(l,N,o)):\"list\"!==l&&\"tagName\"!==l&&\"form\"!==l&&\"type\"!==l&&\"size\"!==l&&!t&&l in n?n[l]=null==u?\"\":u:\"function\"!=typeof u&&\"dangerouslySetInnerHTML\"!==l&&(l!==(l=l.replace(/^xlink:?/,\"\"))?null==u||!1===u?n.removeAttributeNS(\"http://www.w3.org/1999/xlink\",l.toLowerCase()):n.setAttributeNS(\"http://www.w3.org/1999/xlink\",l.toLowerCase(),u):null==u||!1===u&&!/^ar/.test(l)?n.removeAttribute(l):n.setAttribute(l,u))}function N(l){this.l[l.type](n.event?n.event(l):l)}function z(n,l,u){var i,t;for(i=0;i<n.__k.length;i++)(t=n.__k[i])&&(t.__=n,t.__e&&(\"function\"==typeof t.type&&t.__k.length>1&&z(t,l,u),l=x(u,t,t,n.__k,null,t.__e,l),\"function\"==typeof n.type&&(n.__d=l)))}function T(l,u,i,t,r,o,f,e,c){var a,v,h,y,_,k,w,m,b,x,A,P=u.type;if(void 0!==u.constructor)return null;(a=n.__b)&&a(u);try{n:if(\"function\"==typeof P){if(m=u.props,b=(a=P.contextType)&&t[a.__c],x=a?b?b.props.value:a.__:t,i.__c?w=(v=u.__c=i.__c).__=v.__E:(\"prototype\"in P&&P.prototype.render?u.__c=v=new P(m,x):(u.__c=v=new d(m,x),v.constructor=P,v.render=L),b&&b.sub(v),v.props=m,v.state||(v.state={}),v.context=x,v.__n=t,h=v.__d=!0,v.__h=[]),null==v.__s&&(v.__s=v.state),null!=P.getDerivedStateFromProps&&(v.__s==v.state&&(v.__s=s({},v.__s)),s(v.__s,P.getDerivedStateFromProps(m,v.__s))),y=v.props,_=v.state,h)null==P.getDerivedStateFromProps&&null!=v.componentWillMount&&v.componentWillMount(),null!=v.componentDidMount&&v.__h.push(v.componentDidMount);else{if(null==P.getDerivedStateFromProps&&m!==y&&null!=v.componentWillReceiveProps&&v.componentWillReceiveProps(m,x),!v.__e&&null!=v.shouldComponentUpdate&&!1===v.shouldComponentUpdate(m,v.__s,x)||u.__v===i.__v){v.props=m,v.state=v.__s,u.__v!==i.__v&&(v.__d=!1),v.__v=u,u.__e=i.__e,u.__k=i.__k,v.__h.length&&f.push(v),z(u,e,l);break n}null!=v.componentWillUpdate&&v.componentWillUpdate(m,v.__s,x),null!=v.componentDidUpdate&&v.__h.push(function(){v.componentDidUpdate(y,_,k)})}v.context=x,v.props=m,v.state=v.__s,(a=n.__r)&&a(u),v.__d=!1,v.__v=u,v.__P=l,a=v.render(v.props,v.state,v.context),v.state=v.__s,null!=v.getChildContext&&(t=s(s({},t),v.getChildContext())),h||null==v.getSnapshotBeforeUpdate||(k=v.getSnapshotBeforeUpdate(y,_)),A=null!=a&&a.type==p&&null==a.key?a.props.children:a,g(l,Array.isArray(A)?A:[A],u,i,t,r,o,f,e,c),v.base=u.__e,v.__h.length&&f.push(v),w&&(v.__E=v.__=null),v.__e=!1}else null==o&&u.__v===i.__v?(u.__k=i.__k,u.__e=i.__e):u.__e=j(i.__e,u,i,t,r,o,f,c);(a=n.diffed)&&a(u)}catch(l){u.__v=null,n.__e(l,u,i)}return u.__e}function $(l,u){n.__c&&n.__c(u,l),l.some(function(u){try{l=u.__h,u.__h=[],l.some(function(n){n.call(u)})}catch(l){n.__e(l,u.__v)}})}function j(n,l,u,i,t,r,o,c){var s,a,v,h,y,p=u.props,d=l.props;if(t=\"svg\"===l.type||t,null!=r)for(s=0;s<r.length;s++)if(null!=(a=r[s])&&((null===l.type?3===a.nodeType:a.localName===l.type)||n==a)){n=a,r[s]=null;break}if(null==n){if(null===l.type)return document.createTextNode(d);n=t?document.createElementNS(\"http://www.w3.org/2000/svg\",l.type):document.createElement(l.type,d.is&&{is:d.is}),r=null,c=!1}if(null===l.type)p!==d&&n.data!=d&&(n.data=d);else{if(null!=r&&(r=e.slice.call(n.childNodes)),v=(p=u.props||f).dangerouslySetInnerHTML,h=d.dangerouslySetInnerHTML,!c){if(null!=r)for(p={},y=0;y<n.attributes.length;y++)p[n.attributes[y].name]=n.attributes[y].value;(h||v)&&(h&&v&&h.__html==v.__html||(n.innerHTML=h&&h.__html||\"\"))}A(n,d,p,t,c),h?l.__k=[]:(s=l.props.children,g(n,Array.isArray(s)?s:[s],l,u,i,\"foreignObject\"!==l.type&&t,r,o,f,c)),c||(\"value\"in d&&void 0!==(s=d.value)&&s!==n.value&&C(n,\"value\",s,p.value,!1),\"checked\"in d&&void 0!==(s=d.checked)&&s!==n.checked&&C(n,\"checked\",s,p.checked,!1))}return n}function H(l,u,i){try{\"function\"==typeof l?l(u):l.current=u}catch(l){n.__e(l,i)}}function I(l,u,i){var t,r,o;if(n.unmount&&n.unmount(l),(t=l.ref)&&(t.current&&t.current!==l.__e||H(t,null,u)),i||\"function\"==typeof l.type||(i=null!=(r=l.__e)),l.__e=l.__d=void 0,null!=(t=l.__c)){if(t.componentWillUnmount)try{t.componentWillUnmount()}catch(l){n.__e(l,u)}t.base=t.__P=null}if(t=l.__k)for(o=0;o<t.length;o++)t[o]&&I(t[o],u,i);null!=r&&a(r)}function L(n,l,u){return this.constructor(n,u)}function M(l,u,i){var t,o,c;n.__&&n.__(l,u),o=(t=i===r)?null:i&&i.__k||u.__k,l=v(p,null,[l]),c=[],T(u,(t?u:i||u).__k=l,o||f,f,void 0!==u.ownerSVGElement,i&&!t?[i]:o?null:u.childNodes.length?e.slice.call(u.childNodes):null,c,i||f,t),$(c,l)}function O(n,l){M(n,l,r)}function S(n,l){var u,i;for(i in l=s(s({},n.props),l),arguments.length>2&&(l.children=e.slice.call(arguments,2)),u={},l)\"key\"!==i&&\"ref\"!==i&&(u[i]=l[i]);return h(n.type,u,l.key||n.key,l.ref||n.ref,null)}function q(n){var l={},u={__c:\"__cC\"+o++,__:n,Consumer:function(n,l){return n.children(l)},Provider:function(n){var i,t=this;return this.getChildContext||(i=[],this.getChildContext=function(){return l[u.__c]=t,l},this.shouldComponentUpdate=function(n){t.props.value!==n.value&&i.some(function(l){l.context=n.value,w(l)})},this.sub=function(n){i.push(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){i.splice(i.indexOf(n),1),l&&l.call(n)}}),n.children}};return u.Consumer.contextType=u,u.Provider.__=u,u}n={__e:function(n,l){for(var u,i;l=l.__;)if((u=l.__c)&&!u.__)try{if(u.constructor&&null!=u.constructor.getDerivedStateFromError&&(i=!0,u.setState(u.constructor.getDerivedStateFromError(n))),null!=u.componentDidCatch&&(i=!0,u.componentDidCatch(n)),i)return w(u.__E=u)}catch(l){n=l}throw n}},l=function(n){return null!=n&&void 0===n.constructor},d.prototype.setState=function(n,l){var u;u=this.__s!==this.state?this.__s:this.__s=s({},this.state),\"function\"==typeof n&&(n=n(u,this.props)),n&&s(u,n),null!=n&&this.__v&&(l&&this.__h.push(l),w(this))},d.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),w(this))},d.prototype.render=p,u=[],i=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,r=f,o=0;export{M as render,O as hydrate,v as createElement,v as h,p as Fragment,y as createRef,l as isValidElement,d as Component,S as cloneElement,q as createContext,b as toChildArray,I as __u,n as options};\n//# sourceMappingURL=preact.module.js.map\n","import { __extends } from \"tslib\";\nimport * as preact from 'preact';\n(typeof globalThis !== 'undefined' ? globalThis : window).FullCalendarVDom = {\n    Component: preact.Component,\n    createElement: preact.createElement,\n    render: preact.render,\n    createRef: preact.createRef,\n    Fragment: preact.Fragment,\n    createContext: createContext,\n    flushToDom: flushToDom\n};\n\n\n\nfunction flushToDom() {\n    var oldDebounceRendering = preact.options.debounceRendering; \n    var callbackQ = [];\n    function execCallbackSync(callback) {\n        callbackQ.push(callback);\n    }\n    preact.options.debounceRendering = execCallbackSync;\n    preact.render(preact.createElement(FakeComponent, {}), document.createElement('div'));\n    while (callbackQ.length) {\n        callbackQ.shift()();\n    }\n    preact.options.debounceRendering = oldDebounceRendering;\n}\nvar FakeComponent = /** @class */ (function (_super) {\n    __extends(FakeComponent, _super);\n    function FakeComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FakeComponent.prototype.render = function () { return preact.createElement('div', {}); };\n    FakeComponent.prototype.componentDidMount = function () { this.setState({}); };\n    return FakeComponent;\n}(preact.Component));\nfunction createContext(defaultValue) {\n    var ContextType = preact.createContext(defaultValue);\n    var origProvider = ContextType.Provider;\n    ContextType.Provider = function () {\n        var _this = this;\n        var isNew = !this.getChildContext;\n        var children = origProvider.apply(this, arguments);\n        if (isNew) {\n            var subs_1 = [];\n            this.shouldComponentUpdate = function (_props) {\n                if (_this.props.value !== _props.value) {\n                    subs_1.some(function (c) {\n                        c.context = _props.value;\n                        c.forceUpdate();\n                    });\n                }\n            };\n            this.sub = function (c) {\n                subs_1.push(c);\n                var old = c.componentWillUnmount;\n                c.componentWillUnmount = function () {\n                    subs_1.splice(subs_1.indexOf(c), 1);\n                    old && old.call(c);\n                };\n            };\n        }\n        return children;\n    };\n    return ContextType;\n}\n","\nif (typeof FullCalendarVDom === 'undefined') {\n    throw new Error('Please import the top-level fullcalendar lib before attempting to import a plugin.');\n}\nexport var Component = FullCalendarVDom.Component;\nexport var createElement = FullCalendarVDom.createElement;\nexport var render = FullCalendarVDom.render;\nexport var createRef = FullCalendarVDom.createRef;\nexport var Fragment = FullCalendarVDom.Fragment;\nexport var createContext = FullCalendarVDom.createContext;\nexport var flushToDom = FullCalendarVDom.flushToDom;\n","/*!\nFullCalendar v5.3.1\nDocs & License: https://fullcalendar.io/\n(c) 2020 Adam Shaw\n*/\nimport './main.css';\n\nimport { __assign, __spreadArrays, __extends } from 'tslib';\nimport { createContext, Component, createRef, createElement, Fragment } from './vdom';\nexport * from './vdom';\n\n// no public types yet. when there are, export from:\n// import {} from './api-type-deps'\nvar EventSourceApi = /** @class */ (function () {\n    function EventSourceApi(context, internalEventSource // rename?\n    ) {\n        this.context = context;\n        this.internalEventSource = internalEventSource;\n    }\n    EventSourceApi.prototype.remove = function () {\n        this.context.dispatch({\n            type: 'REMOVE_EVENT_SOURCE',\n            sourceId: this.internalEventSource.sourceId\n        });\n    };\n    EventSourceApi.prototype.refetch = function () {\n        this.context.dispatch({\n            type: 'FETCH_EVENT_SOURCES',\n            sourceIds: [this.internalEventSource.sourceId]\n        });\n    };\n    Object.defineProperty(EventSourceApi.prototype, \"id\", {\n        get: function () {\n            return this.internalEventSource.publicId;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventSourceApi.prototype, \"url\", {\n        // only relevant to json-feed event sources\n        get: function () {\n            return this.internalEventSource.meta.url;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return EventSourceApi;\n}());\n\nfunction removeElement(el) {\n    if (el.parentNode) {\n        el.parentNode.removeChild(el);\n    }\n}\n// Querying\n// ----------------------------------------------------------------------------------------------------------------\nfunction elementClosest(el, selector) {\n    if (el.closest) {\n        return el.closest(selector);\n        // really bad fallback for IE\n        // from https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n    }\n    else {\n        if (!document.documentElement.contains(el)) {\n            return null;\n        }\n        do {\n            if (elementMatches(el, selector)) {\n                return el;\n            }\n            el = (el.parentElement || el.parentNode);\n        } while (el !== null && el.nodeType === 1);\n        return null;\n    }\n}\nfunction elementMatches(el, selector) {\n    var method = el.matches || el.matchesSelector || el.msMatchesSelector;\n    return method.call(el, selector);\n}\n// accepts multiple subject els\n// returns a real array. good for methods like forEach\n// TODO: accept the document\nfunction findElements(container, selector) {\n    var containers = container instanceof HTMLElement ? [container] : container;\n    var allMatches = [];\n    for (var i = 0; i < containers.length; i++) {\n        var matches = containers[i].querySelectorAll(selector);\n        for (var j = 0; j < matches.length; j++) {\n            allMatches.push(matches[j]);\n        }\n    }\n    return allMatches;\n}\n// accepts multiple subject els\n// only queries direct child elements // TODO: rename to findDirectChildren!\nfunction findDirectChildren(parent, selector) {\n    var parents = parent instanceof HTMLElement ? [parent] : parent;\n    var allMatches = [];\n    for (var i = 0; i < parents.length; i++) {\n        var childNodes = parents[i].children; // only ever elements\n        for (var j = 0; j < childNodes.length; j++) {\n            var childNode = childNodes[j];\n            if (!selector || elementMatches(childNode, selector)) {\n                allMatches.push(childNode);\n            }\n        }\n    }\n    return allMatches;\n}\n// Style\n// ----------------------------------------------------------------------------------------------------------------\nvar PIXEL_PROP_RE = /(top|left|right|bottom|width|height)$/i;\nfunction applyStyle(el, props) {\n    for (var propName in props) {\n        applyStyleProp(el, propName, props[propName]);\n    }\n}\nfunction applyStyleProp(el, name, val) {\n    if (val == null) {\n        el.style[name] = '';\n    }\n    else if (typeof val === 'number' && PIXEL_PROP_RE.test(name)) {\n        el.style[name] = val + 'px';\n    }\n    else {\n        el.style[name] = val;\n    }\n}\n\n// Stops a mouse/touch event from doing it's native browser action\nfunction preventDefault(ev) {\n    ev.preventDefault();\n}\n// Event Delegation\n// ----------------------------------------------------------------------------------------------------------------\nfunction buildDelegationHandler(selector, handler) {\n    return function (ev) {\n        var matchedChild = elementClosest(ev.target, selector);\n        if (matchedChild) {\n            handler.call(matchedChild, ev, matchedChild);\n        }\n    };\n}\nfunction listenBySelector(container, eventType, selector, handler) {\n    var attachedHandler = buildDelegationHandler(selector, handler);\n    container.addEventListener(eventType, attachedHandler);\n    return function () {\n        container.removeEventListener(eventType, attachedHandler);\n    };\n}\nfunction listenToHoverBySelector(container, selector, onMouseEnter, onMouseLeave) {\n    var currentMatchedChild;\n    return listenBySelector(container, 'mouseover', selector, function (ev, matchedChild) {\n        if (matchedChild !== currentMatchedChild) {\n            currentMatchedChild = matchedChild;\n            onMouseEnter(ev, matchedChild);\n            var realOnMouseLeave_1 = function (ev) {\n                currentMatchedChild = null;\n                onMouseLeave(ev, matchedChild);\n                matchedChild.removeEventListener('mouseleave', realOnMouseLeave_1);\n            };\n            // listen to the next mouseleave, and then unattach\n            matchedChild.addEventListener('mouseleave', realOnMouseLeave_1);\n        }\n    });\n}\n// Animation\n// ----------------------------------------------------------------------------------------------------------------\nvar transitionEventNames = [\n    'webkitTransitionEnd',\n    'otransitionend',\n    'oTransitionEnd',\n    'msTransitionEnd',\n    'transitionend'\n];\n// triggered only when the next single subsequent transition finishes\nfunction whenTransitionDone(el, callback) {\n    var realCallback = function (ev) {\n        callback(ev);\n        transitionEventNames.forEach(function (eventName) {\n            el.removeEventListener(eventName, realCallback);\n        });\n    };\n    transitionEventNames.forEach(function (eventName) {\n        el.addEventListener(eventName, realCallback); // cross-browser way to determine when the transition finishes\n    });\n}\n\nvar guidNumber = 0;\nfunction guid() {\n    return String(guidNumber++);\n}\n/* FullCalendar-specific DOM Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n// Make the mouse cursor express that an event is not allowed in the current area\nfunction disableCursor() {\n    document.body.classList.add('fc-not-allowed');\n}\n// Returns the mouse cursor to its original look\nfunction enableCursor() {\n    document.body.classList.remove('fc-not-allowed');\n}\n/* Selection\n----------------------------------------------------------------------------------------------------------------------*/\nfunction preventSelection(el) {\n    el.classList.add('fc-unselectable');\n    el.addEventListener('selectstart', preventDefault);\n}\nfunction allowSelection(el) {\n    el.classList.remove('fc-unselectable');\n    el.removeEventListener('selectstart', preventDefault);\n}\n/* Context Menu\n----------------------------------------------------------------------------------------------------------------------*/\nfunction preventContextMenu(el) {\n    el.addEventListener('contextmenu', preventDefault);\n}\nfunction allowContextMenu(el) {\n    el.removeEventListener('contextmenu', preventDefault);\n}\nfunction parseFieldSpecs(input) {\n    var specs = [];\n    var tokens = [];\n    var i;\n    var token;\n    if (typeof input === 'string') {\n        tokens = input.split(/\\s*,\\s*/);\n    }\n    else if (typeof input === 'function') {\n        tokens = [input];\n    }\n    else if (Array.isArray(input)) {\n        tokens = input;\n    }\n    for (i = 0; i < tokens.length; i++) {\n        token = tokens[i];\n        if (typeof token === 'string') {\n            specs.push(token.charAt(0) === '-' ?\n                { field: token.substring(1), order: -1 } :\n                { field: token, order: 1 });\n        }\n        else if (typeof token === 'function') {\n            specs.push({ func: token });\n        }\n    }\n    return specs;\n}\nfunction compareByFieldSpecs(obj0, obj1, fieldSpecs) {\n    var i;\n    var cmp;\n    for (i = 0; i < fieldSpecs.length; i++) {\n        cmp = compareByFieldSpec(obj0, obj1, fieldSpecs[i]);\n        if (cmp) {\n            return cmp;\n        }\n    }\n    return 0;\n}\nfunction compareByFieldSpec(obj0, obj1, fieldSpec) {\n    if (fieldSpec.func) {\n        return fieldSpec.func(obj0, obj1);\n    }\n    return flexibleCompare(obj0[fieldSpec.field], obj1[fieldSpec.field])\n        * (fieldSpec.order || 1);\n}\nfunction flexibleCompare(a, b) {\n    if (!a && !b) {\n        return 0;\n    }\n    if (b == null) {\n        return -1;\n    }\n    if (a == null) {\n        return 1;\n    }\n    if (typeof a === 'string' || typeof b === 'string') {\n        return String(a).localeCompare(String(b));\n    }\n    return a - b;\n}\n/* String Utilities\n----------------------------------------------------------------------------------------------------------------------*/\nfunction padStart(val, len) {\n    var s = String(val);\n    return '000'.substr(0, len - s.length) + s;\n}\n/* Number Utilities\n----------------------------------------------------------------------------------------------------------------------*/\nfunction compareNumbers(a, b) {\n    return a - b;\n}\nfunction isInt(n) {\n    return n % 1 === 0;\n}\n/* FC-specific DOM dimension stuff\n----------------------------------------------------------------------------------------------------------------------*/\nfunction computeSmallestCellWidth(cellEl) {\n    var allWidthEl = cellEl.querySelector('.fc-scrollgrid-shrink-frame');\n    var contentWidthEl = cellEl.querySelector('.fc-scrollgrid-shrink-cushion');\n    if (!allWidthEl) {\n        throw new Error('needs fc-scrollgrid-shrink-frame className'); // TODO: use const\n    }\n    if (!contentWidthEl) {\n        throw new Error('needs fc-scrollgrid-shrink-cushion className');\n    }\n    return cellEl.getBoundingClientRect().width - allWidthEl.getBoundingClientRect().width + // the cell padding+border\n        contentWidthEl.getBoundingClientRect().width;\n}\n\nvar DAY_IDS = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];\n// Adding\nfunction addWeeks(m, n) {\n    var a = dateToUtcArray(m);\n    a[2] += n * 7;\n    return arrayToUtcDate(a);\n}\nfunction addDays(m, n) {\n    var a = dateToUtcArray(m);\n    a[2] += n;\n    return arrayToUtcDate(a);\n}\nfunction addMs(m, n) {\n    var a = dateToUtcArray(m);\n    a[6] += n;\n    return arrayToUtcDate(a);\n}\n// Diffing (all return floats)\n// TODO: why not use ranges?\nfunction diffWeeks(m0, m1) {\n    return diffDays(m0, m1) / 7;\n}\nfunction diffDays(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60 * 24);\n}\nfunction diffHours(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60);\n}\nfunction diffMinutes(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60);\n}\nfunction diffSeconds(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / 1000;\n}\nfunction diffDayAndTime(m0, m1) {\n    var m0day = startOfDay(m0);\n    var m1day = startOfDay(m1);\n    return {\n        years: 0,\n        months: 0,\n        days: Math.round(diffDays(m0day, m1day)),\n        milliseconds: (m1.valueOf() - m1day.valueOf()) - (m0.valueOf() - m0day.valueOf())\n    };\n}\n// Diffing Whole Units\nfunction diffWholeWeeks(m0, m1) {\n    var d = diffWholeDays(m0, m1);\n    if (d !== null && d % 7 === 0) {\n        return d / 7;\n    }\n    return null;\n}\nfunction diffWholeDays(m0, m1) {\n    if (timeAsMs(m0) === timeAsMs(m1)) {\n        return Math.round(diffDays(m0, m1));\n    }\n    return null;\n}\n// Start-Of\nfunction startOfDay(m) {\n    return arrayToUtcDate([\n        m.getUTCFullYear(),\n        m.getUTCMonth(),\n        m.getUTCDate()\n    ]);\n}\nfunction startOfHour(m) {\n    return arrayToUtcDate([\n        m.getUTCFullYear(),\n        m.getUTCMonth(),\n        m.getUTCDate(),\n        m.getUTCHours()\n    ]);\n}\nfunction startOfMinute(m) {\n    return arrayToUtcDate([\n        m.getUTCFullYear(),\n        m.getUTCMonth(),\n        m.getUTCDate(),\n        m.getUTCHours(),\n        m.getUTCMinutes()\n    ]);\n}\nfunction startOfSecond(m) {\n    return arrayToUtcDate([\n        m.getUTCFullYear(),\n        m.getUTCMonth(),\n        m.getUTCDate(),\n        m.getUTCHours(),\n        m.getUTCMinutes(),\n        m.getUTCSeconds()\n    ]);\n}\n// Week Computation\nfunction weekOfYear(marker, dow, doy) {\n    var y = marker.getUTCFullYear();\n    var w = weekOfGivenYear(marker, y, dow, doy);\n    if (w < 1) {\n        return weekOfGivenYear(marker, y - 1, dow, doy);\n    }\n    var nextW = weekOfGivenYear(marker, y + 1, dow, doy);\n    if (nextW >= 1) {\n        return Math.min(w, nextW);\n    }\n    return w;\n}\nfunction weekOfGivenYear(marker, year, dow, doy) {\n    var firstWeekStart = arrayToUtcDate([year, 0, 1 + firstWeekOffset(year, dow, doy)]);\n    var dayStart = startOfDay(marker);\n    var days = Math.round(diffDays(firstWeekStart, dayStart));\n    return Math.floor(days / 7) + 1; // zero-indexed\n}\n// start-of-first-week - start-of-year\nfunction firstWeekOffset(year, dow, doy) {\n    // first-week day -- which january is always in the first week (4 for iso, 1 for other)\n    var fwd = 7 + dow - doy;\n    // first-week day local weekday -- which local weekday is fwd\n    var fwdlw = (7 + arrayToUtcDate([year, 0, fwd]).getUTCDay() - dow) % 7;\n    return -fwdlw + fwd - 1;\n}\n// Array Conversion\nfunction dateToLocalArray(date) {\n    return [\n        date.getFullYear(),\n        date.getMonth(),\n        date.getDate(),\n        date.getHours(),\n        date.getMinutes(),\n        date.getSeconds(),\n        date.getMilliseconds()\n    ];\n}\nfunction arrayToLocalDate(a) {\n    return new Date(a[0], a[1] || 0, a[2] == null ? 1 : a[2], // day of month\n    a[3] || 0, a[4] || 0, a[5] || 0);\n}\nfunction dateToUtcArray(date) {\n    return [\n        date.getUTCFullYear(),\n        date.getUTCMonth(),\n        date.getUTCDate(),\n        date.getUTCHours(),\n        date.getUTCMinutes(),\n        date.getUTCSeconds(),\n        date.getUTCMilliseconds()\n    ];\n}\nfunction arrayToUtcDate(a) {\n    // according to web standards (and Safari), a month index is required.\n    // massage if only given a year.\n    if (a.length === 1) {\n        a = a.concat([0]);\n    }\n    return new Date(Date.UTC.apply(Date, a));\n}\n// Other Utils\nfunction isValidDate(m) {\n    return !isNaN(m.valueOf());\n}\nfunction timeAsMs(m) {\n    return m.getUTCHours() * 1000 * 60 * 60 +\n        m.getUTCMinutes() * 1000 * 60 +\n        m.getUTCSeconds() * 1000 +\n        m.getUTCMilliseconds();\n}\n\nfunction createEventInstance(defId, range, forcedStartTzo, forcedEndTzo) {\n    return {\n        instanceId: guid(),\n        defId: defId,\n        range: range,\n        forcedStartTzo: forcedStartTzo == null ? null : forcedStartTzo,\n        forcedEndTzo: forcedEndTzo == null ? null : forcedEndTzo\n    };\n}\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n// Merges an array of objects into a single object.\n// The second argument allows for an array of property names who's object values will be merged together.\nfunction mergeProps(propObjs, complexPropsMap) {\n    var dest = {};\n    if (complexPropsMap) {\n        for (var name_1 in complexPropsMap) {\n            var complexObjs = [];\n            // collect the trailing object values, stopping when a non-object is discovered\n            for (var i = propObjs.length - 1; i >= 0; i--) {\n                var val = propObjs[i][name_1];\n                if (typeof val === 'object' && val) { // non-null object\n                    complexObjs.unshift(val);\n                }\n                else if (val !== undefined) {\n                    dest[name_1] = val; // if there were no objects, this value will be used\n                    break;\n                }\n            }\n            // if the trailing values were objects, use the merged value\n            if (complexObjs.length) {\n                dest[name_1] = mergeProps(complexObjs);\n            }\n        }\n    }\n    // copy values into the destination, going from last to first\n    for (var i = propObjs.length - 1; i >= 0; i--) {\n        var props = propObjs[i];\n        for (var name_2 in props) {\n            if (!(name_2 in dest)) { // if already assigned by previous props or complex props, don't reassign\n                dest[name_2] = props[name_2];\n            }\n        }\n    }\n    return dest;\n}\nfunction filterHash(hash, func) {\n    var filtered = {};\n    for (var key in hash) {\n        if (func(hash[key], key)) {\n            filtered[key] = hash[key];\n        }\n    }\n    return filtered;\n}\nfunction mapHash(hash, func) {\n    var newHash = {};\n    for (var key in hash) {\n        newHash[key] = func(hash[key], key);\n    }\n    return newHash;\n}\nfunction arrayToHash(a) {\n    var hash = {};\n    for (var _i = 0, a_1 = a; _i < a_1.length; _i++) {\n        var item = a_1[_i];\n        hash[item] = true;\n    }\n    return hash;\n}\nfunction buildHashFromArray(a, func) {\n    var hash = {};\n    for (var i = 0; i < a.length; i++) {\n        var tuple = func(a[i], i);\n        hash[tuple[0]] = tuple[1];\n    }\n    return hash;\n}\nfunction hashValuesToArray(obj) {\n    var a = [];\n    for (var key in obj) {\n        a.push(obj[key]);\n    }\n    return a;\n}\nfunction isPropsEqual(obj0, obj1) {\n    if (obj0 === obj1) {\n        return true;\n    }\n    for (var key in obj0) {\n        if (hasOwnProperty.call(obj0, key)) {\n            if (!(key in obj1)) {\n                return false;\n            }\n        }\n    }\n    for (var key in obj1) {\n        if (hasOwnProperty.call(obj1, key)) {\n            if (obj0[key] !== obj1[key]) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction getUnequalProps(obj0, obj1) {\n    var keys = [];\n    for (var key in obj0) {\n        if (hasOwnProperty.call(obj0, key)) {\n            if (!(key in obj1)) {\n                keys.push(key);\n            }\n        }\n    }\n    for (var key in obj1) {\n        if (hasOwnProperty.call(obj1, key)) {\n            if (obj0[key] !== obj1[key]) {\n                keys.push(key);\n            }\n        }\n    }\n    return keys;\n}\nfunction compareObjs(oldProps, newProps, equalityFuncs) {\n    if (equalityFuncs === void 0) { equalityFuncs = {}; }\n    if (oldProps === newProps) {\n        return true;\n    }\n    for (var key in newProps) {\n        if (key in oldProps && isObjValsEqual(oldProps[key], newProps[key], equalityFuncs[key])) ;\n        else {\n            return false;\n        }\n    }\n    // check for props that were omitted in the new\n    for (var key in oldProps) {\n        if (!(key in newProps)) {\n            return false;\n        }\n    }\n    return true;\n}\n/*\nassumed \"true\" equality for handler names like \"onReceiveSomething\"\n*/\nfunction isObjValsEqual(val0, val1, comparator) {\n    if (val0 === val1 || comparator === true) {\n        return true;\n    }\n    if (comparator) {\n        return comparator(val0, val1);\n    }\n    return false;\n}\nfunction collectFromHash(hash, startIndex, endIndex, step) {\n    if (startIndex === void 0) { startIndex = 0; }\n    if (step === void 0) { step = 1; }\n    var res = [];\n    if (endIndex == null) {\n        endIndex = Object.keys(hash).length;\n    }\n    for (var i = startIndex; i < endIndex; i += step) {\n        var val = hash[i];\n        if (val !== undefined) { // will disregard undefined for sparse arrays\n            res.push(val);\n        }\n    }\n    return res;\n}\n\nfunction parseRecurring(refined, defaultAllDay, dateEnv, recurringTypes) {\n    for (var i = 0; i < recurringTypes.length; i++) {\n        var parsed = recurringTypes[i].parse(refined, dateEnv);\n        if (parsed) {\n            var allDay = refined.allDay;\n            if (allDay == null) {\n                allDay = defaultAllDay;\n                if (allDay == null) {\n                    allDay = parsed.allDayGuess;\n                    if (allDay == null) {\n                        allDay = false;\n                    }\n                }\n            }\n            return {\n                allDay: allDay,\n                duration: parsed.duration,\n                typeData: parsed.typeData,\n                typeId: i\n            };\n        }\n    }\n    return null;\n}\nfunction expandRecurring(eventStore, framingRange, context) {\n    var dateEnv = context.dateEnv, pluginHooks = context.pluginHooks, options = context.options;\n    var defs = eventStore.defs, instances = eventStore.instances;\n    // remove existing recurring instances\n    // TODO: bad. always expand events as a second step\n    instances = filterHash(instances, function (instance) {\n        return !defs[instance.defId].recurringDef;\n    });\n    for (var defId in defs) {\n        var def = defs[defId];\n        if (def.recurringDef) {\n            var duration = def.recurringDef.duration;\n            if (!duration) {\n                duration = def.allDay ?\n                    options.defaultAllDayEventDuration :\n                    options.defaultTimedEventDuration;\n            }\n            var starts = expandRecurringRanges(def, duration, framingRange, dateEnv, pluginHooks.recurringTypes);\n            for (var _i = 0, starts_1 = starts; _i < starts_1.length; _i++) {\n                var start = starts_1[_i];\n                var instance = createEventInstance(defId, {\n                    start: start,\n                    end: dateEnv.add(start, duration)\n                });\n                instances[instance.instanceId] = instance;\n            }\n        }\n    }\n    return { defs: defs, instances: instances };\n}\n/*\nEvent MUST have a recurringDef\n*/\nfunction expandRecurringRanges(eventDef, duration, framingRange, dateEnv, recurringTypes) {\n    var typeDef = recurringTypes[eventDef.recurringDef.typeId];\n    var markers = typeDef.expand(eventDef.recurringDef.typeData, {\n        start: dateEnv.subtract(framingRange.start, duration),\n        end: framingRange.end\n    }, dateEnv);\n    // the recurrence plugins don't guarantee that all-day events are start-of-day, so we have to\n    if (eventDef.allDay) {\n        markers = markers.map(startOfDay);\n    }\n    return markers;\n}\n\nvar INTERNAL_UNITS = ['years', 'months', 'days', 'milliseconds'];\nvar PARSE_RE = /^(-?)(?:(\\d+)\\.)?(\\d+):(\\d\\d)(?::(\\d\\d)(?:\\.(\\d\\d\\d))?)?/;\n// Parsing and Creation\nfunction createDuration(input, unit) {\n    var _a;\n    if (typeof input === 'string') {\n        return parseString(input);\n    }\n    else if (typeof input === 'object' && input) { // non-null object\n        return parseObject(input);\n    }\n    else if (typeof input === 'number') {\n        return parseObject((_a = {}, _a[unit || 'milliseconds'] = input, _a));\n    }\n    else {\n        return null;\n    }\n}\nfunction parseString(s) {\n    var m = PARSE_RE.exec(s);\n    if (m) {\n        var sign = m[1] ? -1 : 1;\n        return {\n            years: 0,\n            months: 0,\n            days: sign * (m[2] ? parseInt(m[2], 10) : 0),\n            milliseconds: sign * ((m[3] ? parseInt(m[3], 10) : 0) * 60 * 60 * 1000 + // hours\n                (m[4] ? parseInt(m[4], 10) : 0) * 60 * 1000 + // minutes\n                (m[5] ? parseInt(m[5], 10) : 0) * 1000 + // seconds\n                (m[6] ? parseInt(m[6], 10) : 0) // ms\n            )\n        };\n    }\n    return null;\n}\nfunction parseObject(obj) {\n    var duration = {\n        years: obj.years || obj.year || 0,\n        months: obj.months || obj.month || 0,\n        days: obj.days || obj.day || 0,\n        milliseconds: (obj.hours || obj.hour || 0) * 60 * 60 * 1000 + // hours\n            (obj.minutes || obj.minute || 0) * 60 * 1000 + // minutes\n            (obj.seconds || obj.second || 0) * 1000 + // seconds\n            (obj.milliseconds || obj.millisecond || obj.ms || 0) // ms\n    };\n    var weeks = obj.weeks || obj.week;\n    if (weeks) {\n        duration.days += weeks * 7;\n        duration.specifiedWeeks = true;\n    }\n    return duration;\n}\n// Equality\nfunction durationsEqual(d0, d1) {\n    return d0.years === d1.years &&\n        d0.months === d1.months &&\n        d0.days === d1.days &&\n        d0.milliseconds === d1.milliseconds;\n}\nfunction asCleanDays(dur) {\n    if (!dur.years && !dur.months && !dur.milliseconds) {\n        return dur.days;\n    }\n    return 0;\n}\n// Simple Math\nfunction addDurations(d0, d1) {\n    return {\n        years: d0.years + d1.years,\n        months: d0.months + d1.months,\n        days: d0.days + d1.days,\n        milliseconds: d0.milliseconds + d1.milliseconds\n    };\n}\nfunction subtractDurations(d1, d0) {\n    return {\n        years: d1.years - d0.years,\n        months: d1.months - d0.months,\n        days: d1.days - d0.days,\n        milliseconds: d1.milliseconds - d0.milliseconds\n    };\n}\nfunction multiplyDuration(d, n) {\n    return {\n        years: d.years * n,\n        months: d.months * n,\n        days: d.days * n,\n        milliseconds: d.milliseconds * n\n    };\n}\n// Conversions\n// \"Rough\" because they are based on average-case Gregorian months/years\nfunction asRoughYears(dur) {\n    return asRoughDays(dur) / 365;\n}\nfunction asRoughMonths(dur) {\n    return asRoughDays(dur) / 30;\n}\nfunction asRoughDays(dur) {\n    return asRoughMs(dur) / 864e5;\n}\nfunction asRoughMinutes(dur) {\n    return asRoughMs(dur) / (1000 * 60);\n}\nfunction asRoughSeconds(dur) {\n    return asRoughMs(dur) / 1000;\n}\nfunction asRoughMs(dur) {\n    return dur.years * (365 * 864e5) +\n        dur.months * (30 * 864e5) +\n        dur.days * 864e5 +\n        dur.milliseconds;\n}\n// Advanced Math\nfunction wholeDivideDurations(numerator, denominator) {\n    var res = null;\n    for (var i = 0; i < INTERNAL_UNITS.length; i++) {\n        var unit = INTERNAL_UNITS[i];\n        if (denominator[unit]) {\n            var localRes = numerator[unit] / denominator[unit];\n            if (!isInt(localRes) || (res !== null && res !== localRes)) {\n                return null;\n            }\n            res = localRes;\n        }\n        else if (numerator[unit]) {\n            // needs to divide by something but can't!\n            return null;\n        }\n    }\n    return res;\n}\nfunction greatestDurationDenominator(dur) {\n    var ms = dur.milliseconds;\n    if (ms) {\n        if (ms % 1000 !== 0) {\n            return { unit: 'millisecond', value: ms };\n        }\n        if (ms % (1000 * 60) !== 0) {\n            return { unit: 'second', value: ms / 1000 };\n        }\n        if (ms % (1000 * 60 * 60) !== 0) {\n            return { unit: 'minute', value: ms / (1000 * 60) };\n        }\n        if (ms) {\n            return { unit: 'hour', value: ms / (1000 * 60 * 60) };\n        }\n    }\n    if (dur.days) {\n        if (dur.specifiedWeeks && dur.days % 7 === 0) {\n            return { unit: 'week', value: dur.days / 7 };\n        }\n        return { unit: 'day', value: dur.days };\n    }\n    if (dur.months) {\n        return { unit: 'month', value: dur.months };\n    }\n    if (dur.years) {\n        return { unit: 'year', value: dur.years };\n    }\n    return { unit: 'millisecond', value: 0 };\n}\n\n// timeZoneOffset is in minutes\nfunction buildIsoString(marker, timeZoneOffset, stripZeroTime) {\n    if (stripZeroTime === void 0) { stripZeroTime = false; }\n    var s = marker.toISOString();\n    s = s.replace('.000', '');\n    if (stripZeroTime) {\n        s = s.replace('T00:00:00Z', '');\n    }\n    if (s.length > 10) { // time part wasn't stripped, can add timezone info\n        if (timeZoneOffset == null) {\n            s = s.replace('Z', '');\n        }\n        else if (timeZoneOffset !== 0) {\n            s = s.replace('Z', formatTimeZoneOffset(timeZoneOffset, true));\n        }\n        // otherwise, its UTC-0 and we want to keep the Z\n    }\n    return s;\n}\n// formats the date, but with no time part\n// TODO: somehow merge with buildIsoString and stripZeroTime\n// TODO: rename. omit \"string\"\nfunction formatDayString(marker) {\n    return marker.toISOString().replace(/T.*$/, '');\n}\n// TODO: use Date::toISOString and use everything after the T?\nfunction formatIsoTimeString(marker) {\n    return padStart(marker.getUTCHours(), 2) + ':' +\n        padStart(marker.getUTCMinutes(), 2) + ':' +\n        padStart(marker.getUTCSeconds(), 2);\n}\nfunction formatTimeZoneOffset(minutes, doIso) {\n    if (doIso === void 0) { doIso = false; }\n    var sign = minutes < 0 ? '-' : '+';\n    var abs = Math.abs(minutes);\n    var hours = Math.floor(abs / 60);\n    var mins = Math.round(abs % 60);\n    if (doIso) {\n        return sign + padStart(hours, 2) + ':' + padStart(mins, 2);\n    }\n    else {\n        return 'GMT' + sign + hours + (mins ? ':' + padStart(mins, 2) : '');\n    }\n}\n\n// TODO: new util arrayify?\nfunction removeExact(array, exactVal) {\n    var removeCnt = 0;\n    var i = 0;\n    while (i < array.length) {\n        if (array[i] === exactVal) {\n            array.splice(i, 1);\n            removeCnt++;\n        }\n        else {\n            i++;\n        }\n    }\n    return removeCnt;\n}\nfunction isArraysEqual(a0, a1, equalityFunc) {\n    if (a0 === a1) {\n        return true;\n    }\n    var len = a0.length;\n    var i;\n    if (len !== a1.length) { // not array? or not same length?\n        return false;\n    }\n    for (i = 0; i < len; i++) {\n        if (!(equalityFunc ? equalityFunc(a0[i], a1[i]) : a0[i] === a1[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction memoize(workerFunc, resEquality, teardownFunc) {\n    var currentArgs;\n    var currentRes;\n    return function () {\n        var newArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            newArgs[_i] = arguments[_i];\n        }\n        if (!currentArgs) {\n            currentRes = workerFunc.apply(this, newArgs);\n        }\n        else if (!isArraysEqual(currentArgs, newArgs)) {\n            if (teardownFunc) {\n                teardownFunc(currentRes);\n            }\n            var res = workerFunc.apply(this, newArgs);\n            if (!resEquality || !resEquality(res, currentRes)) {\n                currentRes = res;\n            }\n        }\n        currentArgs = newArgs;\n        return currentRes;\n    };\n}\nfunction memoizeObjArg(workerFunc, resEquality, teardownFunc) {\n    var currentArg;\n    var currentRes;\n    return function (newArg) {\n        if (!currentArg) {\n            currentRes = workerFunc.call(this, newArg);\n        }\n        else if (!isPropsEqual(currentArg, newArg)) {\n            if (teardownFunc) {\n                teardownFunc(currentRes);\n            }\n            var res = workerFunc.call(this, newArg);\n            if (!resEquality || !resEquality(res, currentRes)) {\n                currentRes = res;\n            }\n        }\n        currentArg = newArg;\n        return currentRes;\n    };\n}\nfunction memoizeArraylike(// used at all?\nworkerFunc, resEquality, teardownFunc) {\n    var currentArgSets = [];\n    var currentResults = [];\n    return function (newArgSets) {\n        var currentLen = currentArgSets.length;\n        var newLen = newArgSets.length;\n        var i = 0;\n        for (; i < currentLen; i++) {\n            if (!newArgSets[i]) { // one of the old sets no longer exists\n                if (teardownFunc) {\n                    teardownFunc(currentResults[i]);\n                }\n            }\n            else if (!isArraysEqual(currentArgSets[i], newArgSets[i])) {\n                if (teardownFunc) {\n                    teardownFunc(currentResults[i]);\n                }\n                var res = workerFunc.apply(this, newArgSets[i]);\n                if (!resEquality || !resEquality(res, currentResults[i])) {\n                    currentResults[i] = res;\n                }\n            }\n        }\n        for (; i < newLen; i++) {\n            currentResults[i] = workerFunc.apply(this, newArgSets[i]);\n        }\n        currentArgSets = newArgSets;\n        currentResults.splice(newLen); // remove excess\n        return currentResults;\n    };\n}\nfunction memoizeHashlike(// used?\nworkerFunc, resEquality, teardownFunc // TODO: change arg order\n) {\n    var currentArgHash = {};\n    var currentResHash = {};\n    return function (newArgHash) {\n        var newResHash = {};\n        for (var key in newArgHash) {\n            if (!currentResHash[key]) {\n                newResHash[key] = workerFunc.apply(this, newArgHash[key]);\n            }\n            else if (!isArraysEqual(currentArgHash[key], newArgHash[key])) {\n                if (teardownFunc) {\n                    teardownFunc(currentResHash[key]);\n                }\n                var res = workerFunc.apply(this, newArgHash[key]);\n                newResHash[key] = (resEquality && resEquality(res, currentResHash[key]))\n                    ? currentResHash[key]\n                    : res;\n            }\n            else {\n                newResHash[key] = currentResHash[key];\n            }\n        }\n        currentArgHash = newArgHash;\n        currentResHash = newResHash;\n        return newResHash;\n    };\n}\n\nvar EXTENDED_SETTINGS_AND_SEVERITIES = {\n    week: 3,\n    separator: 0,\n    omitZeroMinute: 0,\n    meridiem: 0,\n    omitCommas: 0\n};\nvar STANDARD_DATE_PROP_SEVERITIES = {\n    timeZoneName: 7,\n    era: 6,\n    year: 5,\n    month: 4,\n    day: 2,\n    weekday: 2,\n    hour: 1,\n    minute: 1,\n    second: 1\n};\nvar MERIDIEM_RE = /\\s*([ap])\\.?m\\.?/i; // eats up leading spaces too\nvar COMMA_RE = /,/g; // we need re for globalness\nvar MULTI_SPACE_RE = /\\s+/g;\nvar LTR_RE = /\\u200e/g; // control character\nvar UTC_RE = /UTC|GMT/;\nvar NativeFormatter = /** @class */ (function () {\n    function NativeFormatter(formatSettings) {\n        var standardDateProps = {};\n        var extendedSettings = {};\n        var severity = 0;\n        for (var name_1 in formatSettings) {\n            if (name_1 in EXTENDED_SETTINGS_AND_SEVERITIES) {\n                extendedSettings[name_1] = formatSettings[name_1];\n                severity = Math.max(EXTENDED_SETTINGS_AND_SEVERITIES[name_1], severity);\n            }\n            else {\n                standardDateProps[name_1] = formatSettings[name_1];\n                if (name_1 in STANDARD_DATE_PROP_SEVERITIES) { // TODO: what about hour12? no severity\n                    severity = Math.max(STANDARD_DATE_PROP_SEVERITIES[name_1], severity);\n                }\n            }\n        }\n        this.standardDateProps = standardDateProps;\n        this.extendedSettings = extendedSettings;\n        this.severity = severity;\n        this.buildFormattingFunc = memoize(buildFormattingFunc);\n    }\n    NativeFormatter.prototype.format = function (date, context) {\n        return this.buildFormattingFunc(this.standardDateProps, this.extendedSettings, context)(date);\n    };\n    NativeFormatter.prototype.formatRange = function (start, end, context, betterDefaultSeparator) {\n        var _a = this, standardDateProps = _a.standardDateProps, extendedSettings = _a.extendedSettings;\n        var diffSeverity = computeMarkerDiffSeverity(start.marker, end.marker, context.calendarSystem);\n        if (!diffSeverity) {\n            return this.format(start, context);\n        }\n        var biggestUnitForPartial = diffSeverity;\n        if (biggestUnitForPartial > 1 && // the two dates are different in a way that's larger scale than time\n            (standardDateProps.year === 'numeric' || standardDateProps.year === '2-digit') &&\n            (standardDateProps.month === 'numeric' || standardDateProps.month === '2-digit') &&\n            (standardDateProps.day === 'numeric' || standardDateProps.day === '2-digit')) {\n            biggestUnitForPartial = 1; // make it look like the dates are only different in terms of time\n        }\n        var full0 = this.format(start, context);\n        var full1 = this.format(end, context);\n        if (full0 === full1) {\n            return full0;\n        }\n        var partialDateProps = computePartialFormattingOptions(standardDateProps, biggestUnitForPartial);\n        var partialFormattingFunc = buildFormattingFunc(partialDateProps, extendedSettings, context);\n        var partial0 = partialFormattingFunc(start);\n        var partial1 = partialFormattingFunc(end);\n        var insertion = findCommonInsertion(full0, partial0, full1, partial1);\n        var separator = extendedSettings.separator || betterDefaultSeparator || context.defaultSeparator || '';\n        if (insertion) {\n            return insertion.before + partial0 + separator + partial1 + insertion.after;\n        }\n        return full0 + separator + full1;\n    };\n    NativeFormatter.prototype.getLargestUnit = function () {\n        switch (this.severity) {\n            case 7:\n            case 6:\n            case 5:\n                return 'year';\n            case 4:\n                return 'month';\n            case 3:\n                return 'week';\n            case 2:\n                return 'day';\n            default:\n                return 'time'; // really?\n        }\n    };\n    return NativeFormatter;\n}());\nfunction buildFormattingFunc(standardDateProps, extendedSettings, context) {\n    var standardDatePropCnt = Object.keys(standardDateProps).length;\n    if (standardDatePropCnt === 1 && standardDateProps.timeZoneName === 'short') {\n        return function (date) {\n            return formatTimeZoneOffset(date.timeZoneOffset);\n        };\n    }\n    if (standardDatePropCnt === 0 && extendedSettings.week) {\n        return function (date) {\n            return formatWeekNumber(context.computeWeekNumber(date.marker), context.weekText, context.locale, extendedSettings.week);\n        };\n    }\n    return buildNativeFormattingFunc(standardDateProps, extendedSettings, context);\n}\nfunction buildNativeFormattingFunc(standardDateProps, extendedSettings, context) {\n    standardDateProps = __assign({}, standardDateProps); // copy\n    extendedSettings = __assign({}, extendedSettings); // copy\n    sanitizeSettings(standardDateProps, extendedSettings);\n    standardDateProps.timeZone = 'UTC'; // we leverage the only guaranteed timeZone for our UTC markers\n    var normalFormat = new Intl.DateTimeFormat(context.locale.codes, standardDateProps);\n    var zeroFormat; // needed?\n    if (extendedSettings.omitZeroMinute) {\n        var zeroProps = __assign({}, standardDateProps);\n        delete zeroProps.minute; // seconds and ms were already considered in sanitizeSettings\n        zeroFormat = new Intl.DateTimeFormat(context.locale.codes, zeroProps);\n    }\n    return function (date) {\n        var marker = date.marker;\n        var format;\n        if (zeroFormat && !marker.getUTCMinutes()) {\n            format = zeroFormat;\n        }\n        else {\n            format = normalFormat;\n        }\n        var s = format.format(marker);\n        return postProcess(s, date, standardDateProps, extendedSettings, context);\n    };\n}\nfunction sanitizeSettings(standardDateProps, extendedSettings) {\n    // deal with a browser inconsistency where formatting the timezone\n    // requires that the hour/minute be present.\n    if (standardDateProps.timeZoneName) {\n        if (!standardDateProps.hour) {\n            standardDateProps.hour = '2-digit';\n        }\n        if (!standardDateProps.minute) {\n            standardDateProps.minute = '2-digit';\n        }\n    }\n    // only support short timezone names\n    if (standardDateProps.timeZoneName === 'long') {\n        standardDateProps.timeZoneName = 'short';\n    }\n    // if requesting to display seconds, MUST display minutes\n    if (extendedSettings.omitZeroMinute && (standardDateProps.second || standardDateProps.millisecond)) {\n        delete extendedSettings.omitZeroMinute;\n    }\n}\nfunction postProcess(s, date, standardDateProps, extendedSettings, context) {\n    s = s.replace(LTR_RE, ''); // remove left-to-right control chars. do first. good for other regexes\n    if (standardDateProps.timeZoneName === 'short') {\n        s = injectTzoStr(s, (context.timeZone === 'UTC' || date.timeZoneOffset == null) ?\n            'UTC' : // important to normalize for IE, which does \"GMT\"\n            formatTimeZoneOffset(date.timeZoneOffset));\n    }\n    if (extendedSettings.omitCommas) {\n        s = s.replace(COMMA_RE, '').trim();\n    }\n    if (extendedSettings.omitZeroMinute) {\n        s = s.replace(':00', ''); // zeroFormat doesn't always achieve this\n    }\n    // ^ do anything that might create adjacent spaces before this point,\n    // because MERIDIEM_RE likes to eat up loading spaces\n    if (extendedSettings.meridiem === false) {\n        s = s.replace(MERIDIEM_RE, '').trim();\n    }\n    else if (extendedSettings.meridiem === 'narrow') { // a/p\n        s = s.replace(MERIDIEM_RE, function (m0, m1) {\n            return m1.toLocaleLowerCase();\n        });\n    }\n    else if (extendedSettings.meridiem === 'short') { // am/pm\n        s = s.replace(MERIDIEM_RE, function (m0, m1) {\n            return m1.toLocaleLowerCase() + 'm';\n        });\n    }\n    else if (extendedSettings.meridiem === 'lowercase') { // other meridiem transformers already converted to lowercase\n        s = s.replace(MERIDIEM_RE, function (m0) {\n            return m0.toLocaleLowerCase();\n        });\n    }\n    s = s.replace(MULTI_SPACE_RE, ' ');\n    s = s.trim();\n    return s;\n}\nfunction injectTzoStr(s, tzoStr) {\n    var replaced = false;\n    s = s.replace(UTC_RE, function () {\n        replaced = true;\n        return tzoStr;\n    });\n    // IE11 doesn't include UTC/GMT in the original string, so append to end\n    if (!replaced) {\n        s += ' ' + tzoStr;\n    }\n    return s;\n}\nfunction formatWeekNumber(num, weekText, locale, display) {\n    var parts = [];\n    if (display === 'narrow') {\n        parts.push(weekText);\n    }\n    else if (display === 'short') {\n        parts.push(weekText, ' ');\n    }\n    // otherwise, considered 'numeric'\n    parts.push(locale.simpleNumberFormat.format(num));\n    if (locale.options.direction === 'rtl') { // TODO: use control characters instead?\n        parts.reverse();\n    }\n    return parts.join('');\n}\n// Range Formatting Utils\n// 0 = exactly the same\n// 1 = different by time\n// and bigger\nfunction computeMarkerDiffSeverity(d0, d1, ca) {\n    if (ca.getMarkerYear(d0) !== ca.getMarkerYear(d1)) {\n        return 5;\n    }\n    if (ca.getMarkerMonth(d0) !== ca.getMarkerMonth(d1)) {\n        return 4;\n    }\n    if (ca.getMarkerDay(d0) !== ca.getMarkerDay(d1)) {\n        return 2;\n    }\n    if (timeAsMs(d0) !== timeAsMs(d1)) {\n        return 1;\n    }\n    return 0;\n}\nfunction computePartialFormattingOptions(options, biggestUnit) {\n    var partialOptions = {};\n    for (var name_2 in options) {\n        if (!(name_2 in STANDARD_DATE_PROP_SEVERITIES) || // not a date part prop (like timeZone)\n            STANDARD_DATE_PROP_SEVERITIES[name_2] <= biggestUnit) {\n            partialOptions[name_2] = options[name_2];\n        }\n    }\n    return partialOptions;\n}\nfunction findCommonInsertion(full0, partial0, full1, partial1) {\n    var i0 = 0;\n    while (i0 < full0.length) {\n        var found0 = full0.indexOf(partial0, i0);\n        if (found0 === -1) {\n            break;\n        }\n        var before0 = full0.substr(0, found0);\n        i0 = found0 + partial0.length;\n        var after0 = full0.substr(i0);\n        var i1 = 0;\n        while (i1 < full1.length) {\n            var found1 = full1.indexOf(partial1, i1);\n            if (found1 === -1) {\n                break;\n            }\n            var before1 = full1.substr(0, found1);\n            i1 = found1 + partial1.length;\n            var after1 = full1.substr(i1);\n            if (before0 === before1 && after0 === after1) {\n                return {\n                    before: before0,\n                    after: after0\n                };\n            }\n        }\n    }\n    return null;\n}\n\nfunction expandZonedMarker(dateInfo, calendarSystem) {\n    var a = calendarSystem.markerToArray(dateInfo.marker);\n    return {\n        marker: dateInfo.marker,\n        timeZoneOffset: dateInfo.timeZoneOffset,\n        array: a,\n        year: a[0],\n        month: a[1],\n        day: a[2],\n        hour: a[3],\n        minute: a[4],\n        second: a[5],\n        millisecond: a[6]\n    };\n}\n\nfunction createVerboseFormattingArg(start, end, context, betterDefaultSeparator) {\n    var startInfo = expandZonedMarker(start, context.calendarSystem);\n    var endInfo = end ? expandZonedMarker(end, context.calendarSystem) : null;\n    return {\n        date: startInfo,\n        start: startInfo,\n        end: endInfo,\n        timeZone: context.timeZone,\n        localeCodes: context.locale.codes,\n        defaultSeparator: betterDefaultSeparator || context.defaultSeparator\n    };\n}\n\n/*\nTODO: fix the terminology of \"formatter\" vs \"formatting func\"\n*/\n/*\nAt the time of instantiation, this object does not know which cmd-formatting system it will use.\nIt receives this at the time of formatting, as a setting.\n*/\nvar CmdFormatter = /** @class */ (function () {\n    function CmdFormatter(cmdStr) {\n        this.cmdStr = cmdStr;\n    }\n    CmdFormatter.prototype.format = function (date, context, betterDefaultSeparator) {\n        return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(date, null, context, betterDefaultSeparator));\n    };\n    CmdFormatter.prototype.formatRange = function (start, end, context, betterDefaultSeparator) {\n        return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(start, end, context, betterDefaultSeparator));\n    };\n    return CmdFormatter;\n}());\n\nvar FuncFormatter = /** @class */ (function () {\n    function FuncFormatter(func) {\n        this.func = func;\n    }\n    FuncFormatter.prototype.format = function (date, context, betterDefaultSeparator) {\n        return this.func(createVerboseFormattingArg(date, null, context, betterDefaultSeparator));\n    };\n    FuncFormatter.prototype.formatRange = function (start, end, context, betterDefaultSeparator) {\n        return this.func(createVerboseFormattingArg(start, end, context, betterDefaultSeparator));\n    };\n    return FuncFormatter;\n}());\n\nfunction createFormatter(input) {\n    if (typeof input === 'object' && input) { // non-null object\n        return new NativeFormatter(input);\n    }\n    else if (typeof input === 'string') {\n        return new CmdFormatter(input);\n    }\n    else if (typeof input === 'function') {\n        return new FuncFormatter(input);\n    }\n}\n\n// base options\n// ------------\nvar BASE_OPTION_REFINERS = {\n    navLinkDayClick: identity,\n    navLinkWeekClick: identity,\n    duration: createDuration,\n    bootstrapFontAwesome: identity,\n    buttonIcons: identity,\n    customButtons: identity,\n    defaultAllDayEventDuration: createDuration,\n    defaultTimedEventDuration: createDuration,\n    nextDayThreshold: createDuration,\n    scrollTime: createDuration,\n    slotMinTime: createDuration,\n    slotMaxTime: createDuration,\n    dayPopoverFormat: createFormatter,\n    slotDuration: createDuration,\n    snapDuration: createDuration,\n    headerToolbar: identity,\n    footerToolbar: identity,\n    defaultRangeSeparator: String,\n    titleRangeSeparator: String,\n    forceEventDuration: Boolean,\n    dayHeaders: Boolean,\n    dayHeaderFormat: createFormatter,\n    dayHeaderClassNames: identity,\n    dayHeaderContent: identity,\n    dayHeaderDidMount: identity,\n    dayHeaderWillUnmount: identity,\n    dayCellClassNames: identity,\n    dayCellContent: identity,\n    dayCellDidMount: identity,\n    dayCellWillUnmount: identity,\n    initialView: String,\n    aspectRatio: Number,\n    weekends: Boolean,\n    weekNumberCalculation: identity,\n    weekNumbers: Boolean,\n    weekNumberClassNames: identity,\n    weekNumberContent: identity,\n    weekNumberDidMount: identity,\n    weekNumberWillUnmount: identity,\n    editable: Boolean,\n    viewClassNames: identity,\n    viewDidMount: identity,\n    viewWillUnmount: identity,\n    nowIndicator: Boolean,\n    nowIndicatorClassNames: identity,\n    nowIndicatorContent: identity,\n    nowIndicatorDidMount: identity,\n    nowIndicatorWillUnmount: identity,\n    showNonCurrentDates: Boolean,\n    lazyFetching: Boolean,\n    startParam: String,\n    endParam: String,\n    timeZoneParam: String,\n    timeZone: String,\n    locales: identity,\n    locale: identity,\n    themeSystem: String,\n    dragRevertDuration: Number,\n    dragScroll: Boolean,\n    allDayMaintainDuration: Boolean,\n    unselectAuto: Boolean,\n    dropAccept: identity,\n    eventOrder: parseFieldSpecs,\n    handleWindowResize: Boolean,\n    windowResizeDelay: Number,\n    longPressDelay: Number,\n    eventDragMinDistance: Number,\n    expandRows: Boolean,\n    height: identity,\n    contentHeight: identity,\n    direction: String,\n    weekNumberFormat: createFormatter,\n    eventResizableFromStart: Boolean,\n    displayEventTime: Boolean,\n    displayEventEnd: Boolean,\n    weekText: String,\n    progressiveEventRendering: Boolean,\n    businessHours: identity,\n    initialDate: identity,\n    now: identity,\n    eventDataTransform: identity,\n    stickyHeaderDates: identity,\n    stickyFooterScrollbar: identity,\n    viewHeight: identity,\n    defaultAllDay: Boolean,\n    eventSourceFailure: identity,\n    eventSourceSuccess: identity,\n    eventDisplay: String,\n    eventStartEditable: Boolean,\n    eventDurationEditable: Boolean,\n    eventOverlap: identity,\n    eventConstraint: identity,\n    eventAllow: identity,\n    eventBackgroundColor: String,\n    eventBorderColor: String,\n    eventTextColor: String,\n    eventColor: String,\n    eventClassNames: identity,\n    eventContent: identity,\n    eventDidMount: identity,\n    eventWillUnmount: identity,\n    selectConstraint: identity,\n    selectOverlap: identity,\n    selectAllow: identity,\n    droppable: Boolean,\n    unselectCancel: String,\n    slotLabelFormat: identity,\n    slotLaneClassNames: identity,\n    slotLaneContent: identity,\n    slotLaneDidMount: identity,\n    slotLaneWillUnmount: identity,\n    slotLabelClassNames: identity,\n    slotLabelContent: identity,\n    slotLabelDidMount: identity,\n    slotLabelWillUnmount: identity,\n    dayMaxEvents: identity,\n    dayMaxEventRows: identity,\n    dayMinWidth: Number,\n    slotLabelInterval: createDuration,\n    allDayText: String,\n    allDayClassNames: identity,\n    allDayContent: identity,\n    allDayDidMount: identity,\n    allDayWillUnmount: identity,\n    slotMinWidth: Number,\n    navLinks: Boolean,\n    eventTimeFormat: createFormatter,\n    rerenderDelay: Number,\n    moreLinkText: identity,\n    selectMinDistance: Number,\n    selectable: Boolean,\n    selectLongPressDelay: Number,\n    eventLongPressDelay: Number,\n    selectMirror: Boolean,\n    eventMinHeight: Number,\n    slotEventOverlap: Boolean,\n    plugins: identity,\n    firstDay: Number,\n    dayCount: Number,\n    dateAlignment: String,\n    dateIncrement: createDuration,\n    hiddenDays: identity,\n    monthMode: Boolean,\n    fixedWeekCount: Boolean,\n    validRange: identity,\n    visibleRange: identity,\n    titleFormat: identity,\n    // only used by list-view, but languages define the value, so we need it in base options\n    noEventsText: String\n};\n// do NOT give a type here. need `typeof BASE_OPTION_DEFAULTS` to give real results.\n// raw values.\nvar BASE_OPTION_DEFAULTS = {\n    eventDisplay: 'auto',\n    defaultRangeSeparator: ' - ',\n    titleRangeSeparator: ' \\u2013 ',\n    defaultTimedEventDuration: '01:00:00',\n    defaultAllDayEventDuration: { day: 1 },\n    forceEventDuration: false,\n    nextDayThreshold: '00:00:00',\n    dayHeaders: true,\n    initialView: '',\n    aspectRatio: 1.35,\n    headerToolbar: {\n        start: 'title',\n        center: '',\n        end: 'today prev,next'\n    },\n    weekends: true,\n    weekNumbers: false,\n    weekNumberCalculation: 'local',\n    editable: false,\n    nowIndicator: false,\n    scrollTime: '06:00:00',\n    slotMinTime: '00:00:00',\n    slotMaxTime: '24:00:00',\n    showNonCurrentDates: true,\n    lazyFetching: true,\n    startParam: 'start',\n    endParam: 'end',\n    timeZoneParam: 'timeZone',\n    timeZone: 'local',\n    locales: [],\n    locale: '',\n    themeSystem: 'standard',\n    dragRevertDuration: 500,\n    dragScroll: true,\n    allDayMaintainDuration: false,\n    unselectAuto: true,\n    dropAccept: '*',\n    eventOrder: 'start,-duration,allDay,title',\n    dayPopoverFormat: { month: 'long', day: 'numeric', year: 'numeric' },\n    handleWindowResize: true,\n    windowResizeDelay: 100,\n    longPressDelay: 1000,\n    eventDragMinDistance: 5,\n    expandRows: false,\n    navLinks: false,\n    selectable: false\n};\n// calendar listeners\n// ------------------\nvar CALENDAR_LISTENER_REFINERS = {\n    datesSet: identity,\n    eventsSet: identity,\n    eventAdd: identity,\n    eventChange: identity,\n    eventRemove: identity,\n    windowResize: identity,\n    eventClick: identity,\n    eventMouseEnter: identity,\n    eventMouseLeave: identity,\n    select: identity,\n    unselect: identity,\n    loading: identity,\n    // internal\n    _unmount: identity,\n    _beforeprint: identity,\n    _afterprint: identity,\n    _noEventDrop: identity,\n    _noEventResize: identity,\n    _resize: identity,\n    _scrollRequest: identity\n};\n// calendar-specific options\n// -------------------------\nvar CALENDAR_OPTION_REFINERS = {\n    buttonText: identity,\n    views: identity,\n    plugins: identity,\n    initialEvents: identity,\n    events: identity,\n    eventSources: identity\n};\nvar COMPLEX_OPTION_COMPARATORS = {\n    headerToolbar: isBoolComplexEqual,\n    footerToolbar: isBoolComplexEqual,\n    buttonText: isBoolComplexEqual,\n    buttonIcons: isBoolComplexEqual\n};\nfunction isBoolComplexEqual(a, b) {\n    if (typeof a === 'object' && typeof b === 'object' && a && b) { // both non-null objects\n        return isPropsEqual(a, b);\n    }\n    else {\n        return a === b;\n    }\n}\n// view-specific options\n// ---------------------\nvar VIEW_OPTION_REFINERS = {\n    type: String,\n    component: identity,\n    buttonText: String,\n    buttonTextKey: String,\n    dateProfileGeneratorClass: identity,\n    usesMinMaxTime: Boolean,\n    classNames: identity,\n    content: identity,\n    didMount: identity,\n    willUnmount: identity\n};\n// util funcs\n// ----------------------------------------------------------------------------------------------------\nfunction mergeRawOptions(optionSets) {\n    return mergeProps(optionSets, COMPLEX_OPTION_COMPARATORS);\n}\nfunction refineProps(input, refiners) {\n    var refined = {};\n    var extra = {};\n    for (var propName in refiners) {\n        if (propName in input) {\n            refined[propName] = refiners[propName](input[propName]);\n        }\n    }\n    for (var propName in input) {\n        if (!(propName in refiners)) {\n            extra[propName] = input[propName];\n        }\n    }\n    return { refined: refined, extra: extra };\n}\nfunction identity(raw) {\n    return raw;\n}\n\nfunction parseEvents(rawEvents, eventSource, context, allowOpenRange) {\n    var eventStore = createEmptyEventStore();\n    var eventRefiners = buildEventRefiners(context);\n    for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n        var rawEvent = rawEvents_1[_i];\n        var tuple = parseEvent(rawEvent, eventSource, context, allowOpenRange, eventRefiners);\n        if (tuple) {\n            eventTupleToStore(tuple, eventStore);\n        }\n    }\n    return eventStore;\n}\nfunction eventTupleToStore(tuple, eventStore) {\n    if (eventStore === void 0) { eventStore = createEmptyEventStore(); }\n    eventStore.defs[tuple.def.defId] = tuple.def;\n    if (tuple.instance) {\n        eventStore.instances[tuple.instance.instanceId] = tuple.instance;\n    }\n    return eventStore;\n}\n// retrieves events that have the same groupId as the instance specified by `instanceId`\n// or they are the same as the instance.\n// why might instanceId not be in the store? an event from another calendar?\nfunction getRelevantEvents(eventStore, instanceId) {\n    var instance = eventStore.instances[instanceId];\n    if (instance) {\n        var def_1 = eventStore.defs[instance.defId];\n        // get events/instances with same group\n        var newStore = filterEventStoreDefs(eventStore, function (lookDef) {\n            return isEventDefsGrouped(def_1, lookDef);\n        });\n        // add the original\n        // TODO: wish we could use eventTupleToStore or something like it\n        newStore.defs[def_1.defId] = def_1;\n        newStore.instances[instance.instanceId] = instance;\n        return newStore;\n    }\n    return createEmptyEventStore();\n}\nfunction isEventDefsGrouped(def0, def1) {\n    return Boolean(def0.groupId && def0.groupId === def1.groupId);\n}\nfunction createEmptyEventStore() {\n    return { defs: {}, instances: {} };\n}\nfunction mergeEventStores(store0, store1) {\n    return {\n        defs: __assign(__assign({}, store0.defs), store1.defs),\n        instances: __assign(__assign({}, store0.instances), store1.instances)\n    };\n}\nfunction filterEventStoreDefs(eventStore, filterFunc) {\n    var defs = filterHash(eventStore.defs, filterFunc);\n    var instances = filterHash(eventStore.instances, function (instance) {\n        return defs[instance.defId]; // still exists?\n    });\n    return { defs: defs, instances: instances };\n}\nfunction excludeSubEventStore(master, sub) {\n    var defs = master.defs, instances = master.instances;\n    var filteredDefs = {};\n    var filteredInstances = {};\n    for (var defId in defs) {\n        if (!sub.defs[defId]) { // not explicitly excluded\n            filteredDefs[defId] = defs[defId];\n        }\n    }\n    for (var instanceId in instances) {\n        if (!sub.instances[instanceId] && // not explicitly excluded\n            filteredDefs[instances[instanceId].defId] // def wasn't filtered away\n        ) {\n            filteredInstances[instanceId] = instances[instanceId];\n        }\n    }\n    return {\n        defs: filteredDefs,\n        instances: filteredInstances\n    };\n}\n\nfunction normalizeConstraint(input, context) {\n    if (Array.isArray(input)) {\n        return parseEvents(input, null, context, true); // allowOpenRange=true\n    }\n    else if (typeof input === 'object' && input) { // non-null object\n        return parseEvents([input], null, context, true); // allowOpenRange=true\n    }\n    else if (input != null) {\n        return String(input);\n    }\n    else {\n        return null;\n    }\n}\n\nfunction parseClassNames(raw) {\n    if (Array.isArray(raw)) {\n        return raw;\n    }\n    else if (typeof raw === 'string') {\n        return raw.split(/\\s+/);\n    }\n    else {\n        return [];\n    }\n}\n\n// TODO: better called \"EventSettings\" or \"EventConfig\"\n// TODO: move this file into structs\n// TODO: separate constraint/overlap/allow, because selection uses only that, not other props\nvar EVENT_UI_REFINERS = {\n    display: String,\n    editable: Boolean,\n    startEditable: Boolean,\n    durationEditable: Boolean,\n    constraint: identity,\n    overlap: identity,\n    allow: identity,\n    className: parseClassNames,\n    classNames: parseClassNames,\n    color: String,\n    backgroundColor: String,\n    borderColor: String,\n    textColor: String\n};\nfunction createEventUi(refined, context) {\n    var constraint = normalizeConstraint(refined.constraint, context);\n    return {\n        display: refined.display || null,\n        startEditable: refined.startEditable != null ? refined.startEditable : refined.editable,\n        durationEditable: refined.durationEditable != null ? refined.durationEditable : refined.editable,\n        constraints: constraint != null ? [constraint] : [],\n        overlap: refined.overlap != null ? refined.overlap : null,\n        allows: refined.allow != null ? [refined.allow] : [],\n        backgroundColor: refined.backgroundColor || refined.color || '',\n        borderColor: refined.borderColor || refined.color || '',\n        textColor: refined.textColor || '',\n        classNames: (refined.className || []).concat(refined.classNames || []) // join singular and plural\n    };\n}\n// TODO: prevent against problems with <2 args!\nfunction combineEventUis(uis) {\n    return uis.reduce(combineTwoEventUis, EMPTY_EVENT_UI);\n}\nfunction combineTwoEventUis(item0, item1) {\n    return {\n        display: item1.display != null ? item1.display : item0.display,\n        startEditable: item1.startEditable != null ? item1.startEditable : item0.startEditable,\n        durationEditable: item1.durationEditable != null ? item1.durationEditable : item0.durationEditable,\n        constraints: item0.constraints.concat(item1.constraints),\n        overlap: typeof item1.overlap === 'boolean' ? item1.overlap : item0.overlap,\n        allows: item0.allows.concat(item1.allows),\n        backgroundColor: item1.backgroundColor || item0.backgroundColor,\n        borderColor: item1.borderColor || item0.borderColor,\n        textColor: item1.textColor || item0.textColor,\n        classNames: item0.classNames.concat(item1.classNames)\n    };\n}\nvar EMPTY_EVENT_UI = {\n    display: null,\n    startEditable: null,\n    durationEditable: null,\n    constraints: [],\n    overlap: null,\n    allows: [],\n    backgroundColor: '',\n    borderColor: '',\n    textColor: '',\n    classNames: []\n};\n\nvar EVENT_NON_DATE_REFINERS = {\n    id: String,\n    groupId: String,\n    title: String,\n    url: String\n};\nvar EVENT_DATE_REFINERS = {\n    start: identity,\n    end: identity,\n    date: identity,\n    allDay: Boolean\n};\nvar EVENT_REFINERS = __assign(__assign(__assign({}, EVENT_NON_DATE_REFINERS), EVENT_DATE_REFINERS), { extendedProps: identity });\nfunction parseEvent(raw, eventSource, context, allowOpenRange, refiners) {\n    if (refiners === void 0) { refiners = buildEventRefiners(context); }\n    var _a = refineEventDef(raw, context, refiners), refined = _a.refined, extra = _a.extra;\n    var defaultAllDay = computeIsDefaultAllDay(eventSource, context);\n    var recurringRes = parseRecurring(refined, defaultAllDay, context.dateEnv, context.pluginHooks.recurringTypes);\n    if (recurringRes) {\n        var def = parseEventDef(refined, extra, eventSource ? eventSource.sourceId : '', recurringRes.allDay, Boolean(recurringRes.duration), context);\n        def.recurringDef = {\n            typeId: recurringRes.typeId,\n            typeData: recurringRes.typeData,\n            duration: recurringRes.duration\n        };\n        return { def: def, instance: null };\n    }\n    else {\n        var singleRes = parseSingle(refined, defaultAllDay, context, allowOpenRange);\n        if (singleRes) {\n            var def = parseEventDef(refined, extra, eventSource ? eventSource.sourceId : '', singleRes.allDay, singleRes.hasEnd, context);\n            var instance = createEventInstance(def.defId, singleRes.range, singleRes.forcedStartTzo, singleRes.forcedEndTzo);\n            return { def: def, instance: instance };\n        }\n    }\n    return null;\n}\nfunction refineEventDef(raw, context, refiners) {\n    if (refiners === void 0) { refiners = buildEventRefiners(context); }\n    return refineProps(raw, refiners);\n}\nfunction buildEventRefiners(context) {\n    return __assign(__assign(__assign({}, EVENT_UI_REFINERS), EVENT_REFINERS), context.pluginHooks.eventRefiners);\n}\n/*\nWill NOT populate extendedProps with the leftover properties.\nWill NOT populate date-related props.\n*/\nfunction parseEventDef(refined, extra, sourceId, allDay, hasEnd, context) {\n    var def = {\n        title: refined.title || '',\n        groupId: refined.groupId || '',\n        publicId: refined.id || '',\n        url: refined.url || '',\n        recurringDef: null,\n        defId: guid(),\n        sourceId: sourceId,\n        allDay: allDay,\n        hasEnd: hasEnd,\n        ui: createEventUi(refined, context),\n        extendedProps: __assign(__assign({}, (refined.extendedProps || {})), extra)\n    };\n    for (var _i = 0, _a = context.pluginHooks.eventDefMemberAdders; _i < _a.length; _i++) {\n        var memberAdder = _a[_i];\n        __assign(def, memberAdder(refined));\n    }\n    // help out EventApi from having user modify props\n    Object.freeze(def.ui.classNames);\n    Object.freeze(def.extendedProps);\n    return def;\n}\nfunction parseSingle(refined, defaultAllDay, context, allowOpenRange) {\n    var allDay = refined.allDay;\n    var startMeta;\n    var startMarker = null;\n    var hasEnd = false;\n    var endMeta;\n    var endMarker = null;\n    var startInput = refined.start != null ? refined.start : refined.date;\n    startMeta = context.dateEnv.createMarkerMeta(startInput);\n    if (startMeta) {\n        startMarker = startMeta.marker;\n    }\n    else if (!allowOpenRange) {\n        return null;\n    }\n    if (refined.end != null) {\n        endMeta = context.dateEnv.createMarkerMeta(refined.end);\n    }\n    if (allDay == null) {\n        if (defaultAllDay != null) {\n            allDay = defaultAllDay;\n        }\n        else {\n            // fall back to the date props LAST\n            allDay = (!startMeta || startMeta.isTimeUnspecified) &&\n                (!endMeta || endMeta.isTimeUnspecified);\n        }\n    }\n    if (allDay && startMarker) {\n        startMarker = startOfDay(startMarker);\n    }\n    if (endMeta) {\n        endMarker = endMeta.marker;\n        if (allDay) {\n            endMarker = startOfDay(endMarker);\n        }\n        if (startMarker && endMarker <= startMarker) {\n            endMarker = null;\n        }\n    }\n    if (endMarker) {\n        hasEnd = true;\n    }\n    else if (!allowOpenRange) {\n        hasEnd = context.options.forceEventDuration || false;\n        endMarker = context.dateEnv.add(startMarker, allDay ?\n            context.options.defaultAllDayEventDuration :\n            context.options.defaultTimedEventDuration);\n    }\n    return {\n        allDay: allDay,\n        hasEnd: hasEnd,\n        range: { start: startMarker, end: endMarker },\n        forcedStartTzo: startMeta ? startMeta.forcedTzo : null,\n        forcedEndTzo: endMeta ? endMeta.forcedTzo : null\n    };\n}\nfunction computeIsDefaultAllDay(eventSource, context) {\n    var res = null;\n    if (eventSource) {\n        res = eventSource.defaultAllDay;\n    }\n    if (res == null) {\n        res = context.options.defaultAllDay;\n    }\n    return res;\n}\n\n/* Date stuff that doesn't belong in datelib core\n----------------------------------------------------------------------------------------------------------------------*/\n// given a timed range, computes an all-day range that has the same exact duration,\n// but whose start time is aligned with the start of the day.\nfunction computeAlignedDayRange(timedRange) {\n    var dayCnt = Math.floor(diffDays(timedRange.start, timedRange.end)) || 1;\n    var start = startOfDay(timedRange.start);\n    var end = addDays(start, dayCnt);\n    return { start: start, end: end };\n}\n// given a timed range, computes an all-day range based on how for the end date bleeds into the next day\n// TODO: give nextDayThreshold a default arg\nfunction computeVisibleDayRange(timedRange, nextDayThreshold) {\n    if (nextDayThreshold === void 0) { nextDayThreshold = createDuration(0); }\n    var startDay = null;\n    var endDay = null;\n    if (timedRange.end) {\n        endDay = startOfDay(timedRange.end);\n        var endTimeMS = timedRange.end.valueOf() - endDay.valueOf(); // # of milliseconds into `endDay`\n        // If the end time is actually inclusively part of the next day and is equal to or\n        // beyond the next day threshold, adjust the end to be the exclusive end of `endDay`.\n        // Otherwise, leaving it as inclusive will cause it to exclude `endDay`.\n        if (endTimeMS && endTimeMS >= asRoughMs(nextDayThreshold)) {\n            endDay = addDays(endDay, 1);\n        }\n    }\n    if (timedRange.start) {\n        startDay = startOfDay(timedRange.start); // the beginning of the day the range starts\n        // If end is within `startDay` but not past nextDayThreshold, assign the default duration of one day.\n        if (endDay && endDay <= startDay) {\n            endDay = addDays(startDay, 1);\n        }\n    }\n    return { start: startDay, end: endDay };\n}\n// spans from one day into another?\nfunction isMultiDayRange(range) {\n    var visibleRange = computeVisibleDayRange(range);\n    return diffDays(visibleRange.start, visibleRange.end) > 1;\n}\nfunction diffDates(date0, date1, dateEnv, largeUnit) {\n    if (largeUnit === 'year') {\n        return createDuration(dateEnv.diffWholeYears(date0, date1), 'year');\n    }\n    else if (largeUnit === 'month') {\n        return createDuration(dateEnv.diffWholeMonths(date0, date1), 'month');\n    }\n    else {\n        return diffDayAndTime(date0, date1); // returns a duration\n    }\n}\n\nfunction parseRange(input, dateEnv) {\n    var start = null;\n    var end = null;\n    if (input.start) {\n        start = dateEnv.createMarker(input.start);\n    }\n    if (input.end) {\n        end = dateEnv.createMarker(input.end);\n    }\n    if (!start && !end) {\n        return null;\n    }\n    if (start && end && end < start) {\n        return null;\n    }\n    return { start: start, end: end };\n}\n// SIDE-EFFECT: will mutate ranges.\n// Will return a new array result.\nfunction invertRanges(ranges, constraintRange) {\n    var invertedRanges = [];\n    var start = constraintRange.start; // the end of the previous range. the start of the new range\n    var i;\n    var dateRange;\n    // ranges need to be in order. required for our date-walking algorithm\n    ranges.sort(compareRanges);\n    for (i = 0; i < ranges.length; i++) {\n        dateRange = ranges[i];\n        // add the span of time before the event (if there is any)\n        if (dateRange.start > start) { // compare millisecond time (skip any ambig logic)\n            invertedRanges.push({ start: start, end: dateRange.start });\n        }\n        if (dateRange.end > start) {\n            start = dateRange.end;\n        }\n    }\n    // add the span of time after the last event (if there is any)\n    if (start < constraintRange.end) { // compare millisecond time (skip any ambig logic)\n        invertedRanges.push({ start: start, end: constraintRange.end });\n    }\n    return invertedRanges;\n}\nfunction compareRanges(range0, range1) {\n    return range0.start.valueOf() - range1.start.valueOf(); // earlier ranges go first\n}\nfunction intersectRanges(range0, range1) {\n    var start = range0.start;\n    var end = range0.end;\n    var newRange = null;\n    if (range1.start !== null) {\n        if (start === null) {\n            start = range1.start;\n        }\n        else {\n            start = new Date(Math.max(start.valueOf(), range1.start.valueOf()));\n        }\n    }\n    if (range1.end != null) {\n        if (end === null) {\n            end = range1.end;\n        }\n        else {\n            end = new Date(Math.min(end.valueOf(), range1.end.valueOf()));\n        }\n    }\n    if (start === null || end === null || start < end) {\n        newRange = { start: start, end: end };\n    }\n    return newRange;\n}\nfunction rangesEqual(range0, range1) {\n    return (range0.start === null ? null : range0.start.valueOf()) === (range1.start === null ? null : range1.start.valueOf()) &&\n        (range0.end === null ? null : range0.end.valueOf()) === (range1.end === null ? null : range1.end.valueOf());\n}\nfunction rangesIntersect(range0, range1) {\n    return (range0.end === null || range1.start === null || range0.end > range1.start) &&\n        (range0.start === null || range1.end === null || range0.start < range1.end);\n}\nfunction rangeContainsRange(outerRange, innerRange) {\n    return (outerRange.start === null || (innerRange.start !== null && innerRange.start >= outerRange.start)) &&\n        (outerRange.end === null || (innerRange.end !== null && innerRange.end <= outerRange.end));\n}\nfunction rangeContainsMarker(range, date) {\n    return (range.start === null || date >= range.start) &&\n        (range.end === null || date < range.end);\n}\n// If the given date is not within the given range, move it inside.\n// (If it's past the end, make it one millisecond before the end).\nfunction constrainMarkerToRange(date, range) {\n    if (range.start != null && date < range.start) {\n        return range.start;\n    }\n    if (range.end != null && date >= range.end) {\n        return new Date(range.end.valueOf() - 1);\n    }\n    return date;\n}\n\n/*\nSpecifying nextDayThreshold signals that all-day ranges should be sliced.\n*/\nfunction sliceEventStore(eventStore, eventUiBases, framingRange, nextDayThreshold) {\n    var inverseBgByGroupId = {};\n    var inverseBgByDefId = {};\n    var defByGroupId = {};\n    var bgRanges = [];\n    var fgRanges = [];\n    var eventUis = compileEventUis(eventStore.defs, eventUiBases);\n    for (var defId in eventStore.defs) {\n        var def = eventStore.defs[defId];\n        var ui = eventUis[def.defId];\n        if (ui.display === 'inverse-background') {\n            if (def.groupId) {\n                inverseBgByGroupId[def.groupId] = [];\n                if (!defByGroupId[def.groupId]) {\n                    defByGroupId[def.groupId] = def;\n                }\n            }\n            else {\n                inverseBgByDefId[defId] = [];\n            }\n        }\n    }\n    for (var instanceId in eventStore.instances) {\n        var instance = eventStore.instances[instanceId];\n        var def = eventStore.defs[instance.defId];\n        var ui = eventUis[def.defId];\n        var origRange = instance.range;\n        var normalRange = (!def.allDay && nextDayThreshold) ?\n            computeVisibleDayRange(origRange, nextDayThreshold) :\n            origRange;\n        var slicedRange = intersectRanges(normalRange, framingRange);\n        if (slicedRange) {\n            if (ui.display === 'inverse-background') {\n                if (def.groupId) {\n                    inverseBgByGroupId[def.groupId].push(slicedRange);\n                }\n                else {\n                    inverseBgByDefId[instance.defId].push(slicedRange);\n                }\n            }\n            else if (ui.display !== 'none') {\n                (ui.display === 'background' ? bgRanges : fgRanges).push({\n                    def: def,\n                    ui: ui,\n                    instance: instance,\n                    range: slicedRange,\n                    isStart: normalRange.start && normalRange.start.valueOf() === slicedRange.start.valueOf(),\n                    isEnd: normalRange.end && normalRange.end.valueOf() === slicedRange.end.valueOf()\n                });\n            }\n        }\n    }\n    for (var groupId in inverseBgByGroupId) { // BY GROUP\n        var ranges = inverseBgByGroupId[groupId];\n        var invertedRanges = invertRanges(ranges, framingRange);\n        for (var _i = 0, invertedRanges_1 = invertedRanges; _i < invertedRanges_1.length; _i++) {\n            var invertedRange = invertedRanges_1[_i];\n            var def = defByGroupId[groupId];\n            var ui = eventUis[def.defId];\n            bgRanges.push({\n                def: def,\n                ui: ui,\n                instance: null,\n                range: invertedRange,\n                isStart: false,\n                isEnd: false\n            });\n        }\n    }\n    for (var defId in inverseBgByDefId) {\n        var ranges = inverseBgByDefId[defId];\n        var invertedRanges = invertRanges(ranges, framingRange);\n        for (var _a = 0, invertedRanges_2 = invertedRanges; _a < invertedRanges_2.length; _a++) {\n            var invertedRange = invertedRanges_2[_a];\n            bgRanges.push({\n                def: eventStore.defs[defId],\n                ui: eventUis[defId],\n                instance: null,\n                range: invertedRange,\n                isStart: false,\n                isEnd: false\n            });\n        }\n    }\n    return { bg: bgRanges, fg: fgRanges };\n}\nfunction hasBgRendering(def) {\n    return def.ui.display === 'background' || def.ui.display === 'inverse-background';\n}\nfunction setElSeg(el, seg) {\n    el.fcSeg = seg;\n}\nfunction getElSeg(el) {\n    return el.fcSeg ||\n        el.parentNode.fcSeg || // for the harness\n        null;\n}\n// event ui computation\nfunction compileEventUis(eventDefs, eventUiBases) {\n    return mapHash(eventDefs, function (eventDef) {\n        return compileEventUi(eventDef, eventUiBases);\n    });\n}\nfunction compileEventUi(eventDef, eventUiBases) {\n    var uis = [];\n    if (eventUiBases['']) {\n        uis.push(eventUiBases['']);\n    }\n    if (eventUiBases[eventDef.defId]) {\n        uis.push(eventUiBases[eventDef.defId]);\n    }\n    uis.push(eventDef.ui);\n    return combineEventUis(uis);\n}\nfunction sortEventSegs(segs, eventOrderSpecs) {\n    var objs = segs.map(buildSegCompareObj);\n    objs.sort(function (obj0, obj1) {\n        return compareByFieldSpecs(obj0, obj1, eventOrderSpecs);\n    });\n    return objs.map(function (c) {\n        return c._seg;\n    });\n}\n// returns a object with all primitive props that can be compared\nfunction buildSegCompareObj(seg) {\n    var eventRange = seg.eventRange;\n    var eventDef = eventRange.def;\n    var range = eventRange.instance ? eventRange.instance.range : eventRange.range;\n    var start = range.start ? range.start.valueOf() : 0; // TODO: better support for open-range events\n    var end = range.end ? range.end.valueOf() : 0; // \"\n    return __assign(__assign(__assign({}, eventDef.extendedProps), eventDef), { id: eventDef.publicId, start: start,\n        end: end, duration: end - start, allDay: Number(eventDef.allDay), _seg: seg // for later retrieval\n     });\n}\nfunction computeSegDraggable(seg, context) {\n    var pluginHooks = context.pluginHooks;\n    var transformers = pluginHooks.isDraggableTransformers;\n    var _a = seg.eventRange, def = _a.def, ui = _a.ui;\n    var val = ui.startEditable;\n    for (var _i = 0, transformers_1 = transformers; _i < transformers_1.length; _i++) {\n        var transformer = transformers_1[_i];\n        val = transformer(val, def, ui, context);\n    }\n    return val;\n}\nfunction computeSegStartResizable(seg, context) {\n    return seg.isStart && seg.eventRange.ui.durationEditable && context.options.eventResizableFromStart;\n}\nfunction computeSegEndResizable(seg, context) {\n    return seg.isEnd && seg.eventRange.ui.durationEditable;\n}\nfunction buildSegTimeText(seg, timeFormat, context, defaultDisplayEventTime, // defaults to true\ndefaultDisplayEventEnd, // defaults to true\nstartOverride, endOverride) {\n    var dateEnv = context.dateEnv, options = context.options;\n    var displayEventTime = options.displayEventTime, displayEventEnd = options.displayEventEnd;\n    var eventDef = seg.eventRange.def;\n    var eventInstance = seg.eventRange.instance;\n    if (displayEventTime == null) {\n        displayEventTime = defaultDisplayEventTime !== false;\n    }\n    if (displayEventEnd == null) {\n        displayEventEnd = defaultDisplayEventEnd !== false;\n    }\n    if (displayEventTime && !eventDef.allDay && (seg.isStart || seg.isEnd)) {\n        var segStart = startOverride || (seg.isStart ? eventInstance.range.start : (seg.start || seg.eventRange.range.start));\n        var segEnd = endOverride || (seg.isEnd ? eventInstance.range.end : (seg.end || seg.eventRange.range.end));\n        if (displayEventEnd && eventDef.hasEnd) {\n            return dateEnv.formatRange(segStart, segEnd, timeFormat, {\n                forcedStartTzo: startOverride ? null : eventInstance.forcedStartTzo,\n                forcedEndTzo: endOverride ? null : eventInstance.forcedEndTzo\n            });\n        }\n        else {\n            return dateEnv.format(segStart, timeFormat, {\n                forcedTzo: startOverride ? null : eventInstance.forcedStartTzo // nooooo, same\n            });\n        }\n    }\n    return '';\n}\nfunction getSegMeta(seg, todayRange, nowDate) {\n    var segRange = seg.eventRange.range;\n    return {\n        isPast: segRange.end < (nowDate || todayRange.start),\n        isFuture: segRange.start >= (nowDate || todayRange.end),\n        isToday: todayRange && rangeContainsMarker(todayRange, segRange.start)\n    };\n}\nfunction getEventClassNames(props) {\n    var classNames = ['fc-event'];\n    if (props.isMirror) {\n        classNames.push('fc-event-mirror');\n    }\n    if (props.isDraggable) {\n        classNames.push('fc-event-draggable');\n    }\n    if (props.isStartResizable || props.isEndResizable) {\n        classNames.push('fc-event-resizable');\n    }\n    if (props.isDragging) {\n        classNames.push('fc-event-dragging');\n    }\n    if (props.isResizing) {\n        classNames.push('fc-event-resizing');\n    }\n    if (props.isSelected) {\n        classNames.push('fc-event-selected');\n    }\n    if (props.isStart) {\n        classNames.push('fc-event-start');\n    }\n    if (props.isEnd) {\n        classNames.push('fc-event-end');\n    }\n    if (props.isPast) {\n        classNames.push('fc-event-past');\n    }\n    if (props.isToday) {\n        classNames.push('fc-event-today');\n    }\n    if (props.isFuture) {\n        classNames.push('fc-event-future');\n    }\n    return classNames;\n}\nfunction buildEventRangeKey(eventRange) {\n    return eventRange.instance\n        ? eventRange.instance.instanceId\n        : eventRange.def.defId + ':' + eventRange.range.start.toISOString();\n    // inverse-background events don't have specific instances. TODO: better solution\n}\n\nvar STANDARD_PROPS = {\n    start: identity,\n    end: identity,\n    allDay: Boolean\n};\nfunction parseDateSpan(raw, dateEnv, defaultDuration) {\n    var span = parseOpenDateSpan(raw, dateEnv);\n    var range = span.range;\n    if (!range.start) {\n        return null;\n    }\n    if (!range.end) {\n        if (defaultDuration == null) {\n            return null;\n        }\n        else {\n            range.end = dateEnv.add(range.start, defaultDuration);\n        }\n    }\n    return span;\n}\n/*\nTODO: somehow combine with parseRange?\nWill return null if the start/end props were present but parsed invalidly.\n*/\nfunction parseOpenDateSpan(raw, dateEnv) {\n    var _a = refineProps(raw, STANDARD_PROPS), standardProps = _a.refined, extra = _a.extra;\n    var startMeta = standardProps.start ? dateEnv.createMarkerMeta(standardProps.start) : null;\n    var endMeta = standardProps.end ? dateEnv.createMarkerMeta(standardProps.end) : null;\n    var allDay = standardProps.allDay;\n    if (allDay == null) {\n        allDay = (startMeta && startMeta.isTimeUnspecified) &&\n            (!endMeta || endMeta.isTimeUnspecified);\n    }\n    return __assign({ range: {\n            start: startMeta ? startMeta.marker : null,\n            end: endMeta ? endMeta.marker : null,\n        }, allDay: allDay }, extra);\n}\nfunction isDateSpansEqual(span0, span1) {\n    return rangesEqual(span0.range, span1.range) &&\n        span0.allDay === span1.allDay &&\n        isSpanPropsEqual(span0, span1);\n}\n// the NON-DATE-RELATED props\nfunction isSpanPropsEqual(span0, span1) {\n    for (var propName in span1) {\n        if (propName !== 'range' && propName !== 'allDay') {\n            if (span0[propName] !== span1[propName]) {\n                return false;\n            }\n        }\n    }\n    // are there any props that span0 has that span1 DOESN'T have?\n    // both have range/allDay, so no need to special-case.\n    for (var propName in span0) {\n        if (!(propName in span1)) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction buildDateSpanApi(span, dateEnv) {\n    return __assign(__assign({}, buildRangeApi(span.range, dateEnv, span.allDay)), { allDay: span.allDay });\n}\nfunction buildRangeApiWithTimeZone(range, dateEnv, omitTime) {\n    return __assign(__assign({}, buildRangeApi(range, dateEnv, omitTime)), { timeZone: dateEnv.timeZone });\n}\nfunction buildRangeApi(range, dateEnv, omitTime) {\n    return {\n        start: dateEnv.toDate(range.start),\n        end: dateEnv.toDate(range.end),\n        startStr: dateEnv.formatIso(range.start, { omitTime: omitTime }),\n        endStr: dateEnv.formatIso(range.end, { omitTime: omitTime })\n    };\n}\nfunction fabricateEventRange(dateSpan, eventUiBases, context) {\n    var res = refineEventDef({ editable: false }, context);\n    var def = parseEventDef(res.refined, res.extra, '', // sourceId\n    dateSpan.allDay, true, // hasEnd\n    context);\n    return {\n        def: def,\n        ui: compileEventUi(def, eventUiBases),\n        instance: createEventInstance(def.defId, dateSpan.range),\n        range: dateSpan.range,\n        isStart: true,\n        isEnd: true\n    };\n}\n\nfunction triggerDateSelect(selection, pev, context) {\n    context.emitter.trigger('select', __assign(__assign({}, buildDateSpanApiWithContext(selection, context)), { jsEvent: pev ? pev.origEvent : null, view: context.viewApi || context.calendarApi.view }));\n}\nfunction triggerDateUnselect(pev, context) {\n    context.emitter.trigger('unselect', {\n        jsEvent: pev ? pev.origEvent : null,\n        view: context.viewApi || context.calendarApi.view\n    });\n}\nfunction buildDateSpanApiWithContext(dateSpan, context) {\n    var props = {};\n    for (var _i = 0, _a = context.pluginHooks.dateSpanTransforms; _i < _a.length; _i++) {\n        var transform = _a[_i];\n        __assign(props, transform(dateSpan, context));\n    }\n    __assign(props, buildDateSpanApi(dateSpan, context.dateEnv));\n    return props;\n}\n// Given an event's allDay status and start date, return what its fallback end date should be.\n// TODO: rename to computeDefaultEventEnd\nfunction getDefaultEventEnd(allDay, marker, context) {\n    var dateEnv = context.dateEnv, options = context.options;\n    var end = marker;\n    if (allDay) {\n        end = startOfDay(end);\n        end = dateEnv.add(end, options.defaultAllDayEventDuration);\n    }\n    else {\n        end = dateEnv.add(end, options.defaultTimedEventDuration);\n    }\n    return end;\n}\n\n// applies the mutation to ALL defs/instances within the event store\nfunction applyMutationToEventStore(eventStore, eventConfigBase, mutation, context) {\n    var eventConfigs = compileEventUis(eventStore.defs, eventConfigBase);\n    var dest = createEmptyEventStore();\n    for (var defId in eventStore.defs) {\n        var def = eventStore.defs[defId];\n        dest.defs[defId] = applyMutationToEventDef(def, eventConfigs[defId], mutation, context);\n    }\n    for (var instanceId in eventStore.instances) {\n        var instance = eventStore.instances[instanceId];\n        var def = dest.defs[instance.defId]; // important to grab the newly modified def\n        dest.instances[instanceId] = applyMutationToEventInstance(instance, def, eventConfigs[instance.defId], mutation, context);\n    }\n    return dest;\n}\nfunction applyMutationToEventDef(eventDef, eventConfig, mutation, context) {\n    var standardProps = mutation.standardProps || {};\n    // if hasEnd has not been specified, guess a good value based on deltas.\n    // if duration will change, there's no way the default duration will persist,\n    // and thus, we need to mark the event as having a real end\n    if (standardProps.hasEnd == null &&\n        eventConfig.durationEditable &&\n        (mutation.startDelta || mutation.endDelta)) {\n        standardProps.hasEnd = true; // TODO: is this mutation okay?\n    }\n    var copy = __assign(__assign(__assign({}, eventDef), standardProps), { ui: __assign(__assign({}, eventDef.ui), standardProps.ui) });\n    if (mutation.extendedProps) {\n        copy.extendedProps = __assign(__assign({}, copy.extendedProps), mutation.extendedProps);\n    }\n    for (var _i = 0, _a = context.pluginHooks.eventDefMutationAppliers; _i < _a.length; _i++) {\n        var applier = _a[_i];\n        applier(copy, mutation, context);\n    }\n    if (!copy.hasEnd && context.options.forceEventDuration) {\n        copy.hasEnd = true;\n    }\n    return copy;\n}\nfunction applyMutationToEventInstance(eventInstance, eventDef, // must first be modified by applyMutationToEventDef\neventConfig, mutation, context) {\n    var dateEnv = context.dateEnv;\n    var forceAllDay = mutation.standardProps && mutation.standardProps.allDay === true;\n    var clearEnd = mutation.standardProps && mutation.standardProps.hasEnd === false;\n    var copy = __assign({}, eventInstance);\n    if (forceAllDay) {\n        copy.range = computeAlignedDayRange(copy.range);\n    }\n    if (mutation.datesDelta && eventConfig.startEditable) {\n        copy.range = {\n            start: dateEnv.add(copy.range.start, mutation.datesDelta),\n            end: dateEnv.add(copy.range.end, mutation.datesDelta)\n        };\n    }\n    if (mutation.startDelta && eventConfig.durationEditable) {\n        copy.range = {\n            start: dateEnv.add(copy.range.start, mutation.startDelta),\n            end: copy.range.end\n        };\n    }\n    if (mutation.endDelta && eventConfig.durationEditable) {\n        copy.range = {\n            start: copy.range.start,\n            end: dateEnv.add(copy.range.end, mutation.endDelta)\n        };\n    }\n    if (clearEnd) {\n        copy.range = {\n            start: copy.range.start,\n            end: getDefaultEventEnd(eventDef.allDay, copy.range.start, context)\n        };\n    }\n    // in case event was all-day but the supplied deltas were not\n    // better util for this?\n    if (eventDef.allDay) {\n        copy.range = {\n            start: startOfDay(copy.range.start),\n            end: startOfDay(copy.range.end)\n        };\n    }\n    // handle invalid durations\n    if (copy.range.end < copy.range.start) {\n        copy.range.end = getDefaultEventEnd(eventDef.allDay, copy.range.start, context);\n    }\n    return copy;\n}\n\n// no public types yet. when there are, export from:\n// import {} from './api-type-deps'\nvar ViewApi = /** @class */ (function () {\n    function ViewApi(type, getCurrentData, dateEnv) {\n        this.type = type;\n        this.getCurrentData = getCurrentData;\n        this.dateEnv = dateEnv;\n    }\n    Object.defineProperty(ViewApi.prototype, \"calendar\", {\n        get: function () {\n            return this.getCurrentData().calendarApi;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewApi.prototype, \"title\", {\n        get: function () {\n            return this.getCurrentData().viewTitle;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewApi.prototype, \"activeStart\", {\n        get: function () {\n            return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewApi.prototype, \"activeEnd\", {\n        get: function () {\n            return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewApi.prototype, \"currentStart\", {\n        get: function () {\n            return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewApi.prototype, \"currentEnd\", {\n        get: function () {\n            return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewApi.prototype.getOption = function (name) {\n        return this.getCurrentData().options[name]; // are the view-specific options\n    };\n    return ViewApi;\n}());\n\nvar EVENT_SOURCE_REFINERS = {\n    id: String,\n    defaultAllDay: Boolean,\n    url: String,\n    events: identity,\n    eventDataTransform: identity,\n    // for any network-related sources\n    success: identity,\n    failure: identity,\n};\nfunction parseEventSource(raw, context, refiners) {\n    if (refiners === void 0) { refiners = buildEventSourceRefiners(context); }\n    var rawObj;\n    if (typeof raw === 'string') {\n        rawObj = { url: raw };\n    }\n    else if (typeof raw === 'function' || Array.isArray(raw)) {\n        rawObj = { events: raw };\n    }\n    else if (typeof raw === 'object' && raw) { // not null\n        rawObj = raw;\n    }\n    if (rawObj) {\n        var _a = refineProps(rawObj, refiners), refined = _a.refined, extra = _a.extra;\n        var metaRes = buildEventSourceMeta(refined, context);\n        if (metaRes) {\n            return {\n                _raw: raw,\n                isFetching: false,\n                latestFetchId: '',\n                fetchRange: null,\n                defaultAllDay: refined.defaultAllDay,\n                eventDataTransform: refined.eventDataTransform,\n                success: refined.success,\n                failure: refined.failure,\n                publicId: refined.id || '',\n                sourceId: guid(),\n                sourceDefId: metaRes.sourceDefId,\n                meta: metaRes.meta,\n                ui: createEventUi(refined, context),\n                extendedProps: extra\n            };\n        }\n    }\n    return null;\n}\nfunction buildEventSourceRefiners(context) {\n    return __assign(__assign(__assign({}, EVENT_UI_REFINERS), EVENT_SOURCE_REFINERS), context.pluginHooks.eventSourceRefiners);\n}\nfunction buildEventSourceMeta(raw, context) {\n    var defs = context.pluginHooks.eventSourceDefs;\n    for (var i = defs.length - 1; i >= 0; i--) { // later-added plugins take precedence\n        var def = defs[i];\n        var meta = def.parseMeta(raw);\n        if (meta) {\n            return { sourceDefId: i, meta: meta };\n        }\n    }\n    return null;\n}\n\nfunction reduceCurrentDate(currentDate, action) {\n    switch (action.type) {\n        case 'CHANGE_DATE':\n            return action.dateMarker;\n        default:\n            return currentDate;\n    }\n}\nfunction getInitialDate(options, dateEnv) {\n    var initialDateInput = options.initialDate;\n    // compute the initial ambig-timezone date\n    if (initialDateInput != null) {\n        return dateEnv.createMarker(initialDateInput);\n    }\n    else {\n        return getNow(options.now, dateEnv); // getNow already returns unzoned\n    }\n}\nfunction getNow(nowInput, dateEnv) {\n    if (typeof nowInput === 'function') {\n        nowInput = nowInput();\n    }\n    if (nowInput == null) {\n        return dateEnv.createNowMarker();\n    }\n    return dateEnv.createMarker(nowInput);\n}\n\nvar CalendarApi = /** @class */ (function () {\n    function CalendarApi() {\n    }\n    CalendarApi.prototype.getCurrentData = function () {\n        return this.currentDataManager.getCurrentData();\n    };\n    CalendarApi.prototype.dispatch = function (action) {\n        return this.currentDataManager.dispatch(action);\n    };\n    Object.defineProperty(CalendarApi.prototype, \"view\", {\n        get: function () { return this.getCurrentData().viewApi; } // for public API\n        ,\n        enumerable: false,\n        configurable: true\n    });\n    CalendarApi.prototype.batchRendering = function (callback) {\n        callback();\n    };\n    CalendarApi.prototype.updateSize = function () {\n        this.trigger('_resize', true);\n    };\n    // Options\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.setOption = function (name, val) {\n        this.dispatch({\n            type: 'SET_OPTION',\n            optionName: name,\n            rawOptionValue: val\n        });\n    };\n    CalendarApi.prototype.getOption = function (name) {\n        return this.currentDataManager.currentCalendarOptionsInput[name];\n    };\n    CalendarApi.prototype.getAvailableLocaleCodes = function () {\n        return Object.keys(this.getCurrentData().availableRawLocales);\n    };\n    // Trigger\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.on = function (handlerName, handler) {\n        var currentDataManager = this.currentDataManager;\n        if (currentDataManager.currentCalendarOptionsRefiners[handlerName]) {\n            currentDataManager.emitter.on(handlerName, handler);\n        }\n        else {\n            console.warn(\"Unknown listener name '\" + handlerName + \"'\");\n        }\n    };\n    CalendarApi.prototype.off = function (handlerName, handler) {\n        this.currentDataManager.emitter.off(handlerName, handler);\n    };\n    // not meant for public use\n    CalendarApi.prototype.trigger = function (handlerName) {\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        (_a = this.currentDataManager.emitter).trigger.apply(_a, __spreadArrays([handlerName], args));\n    };\n    // View\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.changeView = function (viewType, dateOrRange) {\n        var _this = this;\n        this.batchRendering(function () {\n            _this.unselect();\n            if (dateOrRange) {\n                if (dateOrRange.start && dateOrRange.end) { // a range\n                    _this.dispatch({\n                        type: 'CHANGE_VIEW_TYPE',\n                        viewType: viewType,\n                    });\n                    _this.dispatch({\n                        type: 'SET_OPTION',\n                        optionName: 'visibleRange',\n                        rawOptionValue: dateOrRange\n                    });\n                }\n                else {\n                    var dateEnv = _this.getCurrentData().dateEnv;\n                    _this.dispatch({\n                        type: 'CHANGE_VIEW_TYPE',\n                        viewType: viewType,\n                        dateMarker: dateEnv.createMarker(dateOrRange)\n                    });\n                }\n            }\n            else {\n                _this.dispatch({\n                    type: 'CHANGE_VIEW_TYPE',\n                    viewType: viewType\n                });\n            }\n        });\n    };\n    // Forces navigation to a view for the given date.\n    // `viewType` can be a specific view name or a generic one like \"week\" or \"day\".\n    // needs to change\n    CalendarApi.prototype.zoomTo = function (dateMarker, viewType) {\n        var state = this.getCurrentData();\n        var spec;\n        viewType = viewType || 'day'; // day is default zoom\n        spec = state.viewSpecs[viewType] || this.getUnitViewSpec(viewType);\n        this.unselect();\n        if (spec) {\n            this.dispatch({\n                type: 'CHANGE_VIEW_TYPE',\n                viewType: spec.type,\n                dateMarker: dateMarker\n            });\n        }\n        else {\n            this.dispatch({\n                type: 'CHANGE_DATE',\n                dateMarker: dateMarker\n            });\n        }\n    };\n    // Given a duration singular unit, like \"week\" or \"day\", finds a matching view spec.\n    // Preference is given to views that have corresponding buttons.\n    CalendarApi.prototype.getUnitViewSpec = function (unit) {\n        var _a = this.getCurrentData(), viewSpecs = _a.viewSpecs, toolbarConfig = _a.toolbarConfig;\n        var viewTypes = [].concat(toolbarConfig.viewsWithButtons);\n        var i;\n        var spec;\n        for (var viewType in viewSpecs) {\n            viewTypes.push(viewType);\n        }\n        for (i = 0; i < viewTypes.length; i++) {\n            spec = viewSpecs[viewTypes[i]];\n            if (spec) {\n                if (spec.singleUnit === unit) {\n                    return spec;\n                }\n            }\n        }\n    };\n    // Current Date\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.prev = function () {\n        this.unselect();\n        this.dispatch({ type: 'PREV' });\n    };\n    CalendarApi.prototype.next = function () {\n        this.unselect();\n        this.dispatch({ type: 'NEXT' });\n    };\n    CalendarApi.prototype.prevYear = function () {\n        var state = this.getCurrentData();\n        this.unselect();\n        this.dispatch({\n            type: 'CHANGE_DATE',\n            dateMarker: state.dateEnv.addYears(state.currentDate, -1)\n        });\n    };\n    CalendarApi.prototype.nextYear = function () {\n        var state = this.getCurrentData();\n        this.unselect();\n        this.dispatch({\n            type: 'CHANGE_DATE',\n            dateMarker: state.dateEnv.addYears(state.currentDate, 1)\n        });\n    };\n    CalendarApi.prototype.today = function () {\n        var state = this.getCurrentData();\n        this.unselect();\n        this.dispatch({\n            type: 'CHANGE_DATE',\n            dateMarker: getNow(state.calendarOptions.now, state.dateEnv)\n        });\n    };\n    CalendarApi.prototype.gotoDate = function (zonedDateInput) {\n        var state = this.getCurrentData();\n        this.unselect();\n        this.dispatch({\n            type: 'CHANGE_DATE',\n            dateMarker: state.dateEnv.createMarker(zonedDateInput)\n        });\n    };\n    CalendarApi.prototype.incrementDate = function (deltaInput) {\n        var state = this.getCurrentData();\n        var delta = createDuration(deltaInput);\n        if (delta) { // else, warn about invalid input?\n            this.unselect();\n            this.dispatch({\n                type: 'CHANGE_DATE',\n                dateMarker: state.dateEnv.add(state.currentDate, delta)\n            });\n        }\n    };\n    // for external API\n    CalendarApi.prototype.getDate = function () {\n        var state = this.getCurrentData();\n        return state.dateEnv.toDate(state.currentDate);\n    };\n    // Date Formatting Utils\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.formatDate = function (d, formatter) {\n        var dateEnv = this.getCurrentData().dateEnv;\n        return dateEnv.format(dateEnv.createMarker(d), createFormatter(formatter));\n    };\n    // `settings` is for formatter AND isEndExclusive\n    CalendarApi.prototype.formatRange = function (d0, d1, settings) {\n        var dateEnv = this.getCurrentData().dateEnv;\n        return dateEnv.formatRange(dateEnv.createMarker(d0), dateEnv.createMarker(d1), createFormatter(settings), settings);\n    };\n    CalendarApi.prototype.formatIso = function (d, omitTime) {\n        var dateEnv = this.getCurrentData().dateEnv;\n        return dateEnv.formatIso(dateEnv.createMarker(d), { omitTime: omitTime });\n    };\n    // Date Selection / Event Selection / DayClick\n    // -----------------------------------------------------------------------------------------------------------------\n    // this public method receives start/end dates in any format, with any timezone\n    // NOTE: args were changed from v3\n    CalendarApi.prototype.select = function (dateOrObj, endDate) {\n        var selectionInput;\n        if (endDate == null) {\n            if (dateOrObj.start != null) {\n                selectionInput = dateOrObj;\n            }\n            else {\n                selectionInput = {\n                    start: dateOrObj,\n                    end: null\n                };\n            }\n        }\n        else {\n            selectionInput = {\n                start: dateOrObj,\n                end: endDate\n            };\n        }\n        var state = this.getCurrentData();\n        var selection = parseDateSpan(selectionInput, state.dateEnv, createDuration({ days: 1 }) // TODO: cache this?\n        );\n        if (selection) { // throw parse error otherwise?\n            this.dispatch({ type: 'SELECT_DATES', selection: selection });\n            triggerDateSelect(selection, null, state);\n        }\n    };\n    // public method\n    CalendarApi.prototype.unselect = function (pev) {\n        var state = this.getCurrentData();\n        if (state.dateSelection) {\n            this.dispatch({ type: 'UNSELECT_DATES' });\n            triggerDateUnselect(pev, state);\n        }\n    };\n    // Public Events API\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.addEvent = function (eventInput, sourceInput) {\n        if (eventInput instanceof EventApi) {\n            var def = eventInput._def;\n            var instance = eventInput._instance;\n            var currentData = this.getCurrentData();\n            // not already present? don't want to add an old snapshot\n            if (!currentData.eventStore.defs[def.defId]) {\n                this.dispatch({\n                    type: 'ADD_EVENTS',\n                    eventStore: eventTupleToStore({ def: def, instance: instance }) // TODO: better util for two args?\n                });\n                this.triggerEventAdd(eventInput);\n            }\n            return eventInput;\n        }\n        var state = this.getCurrentData();\n        var eventSource;\n        if (sourceInput instanceof EventSourceApi) {\n            eventSource = sourceInput.internalEventSource;\n        }\n        else if (typeof sourceInput === 'boolean') {\n            if (sourceInput) { // true. part of the first event source\n                eventSource = hashValuesToArray(state.eventSources)[0];\n            }\n        }\n        else if (sourceInput != null) { // an ID. accepts a number too\n            var sourceApi = this.getEventSourceById(sourceInput); // TODO: use an internal function\n            if (!sourceApi) {\n                console.warn('Could not find an event source with ID \"' + sourceInput + '\"'); // TODO: test\n                return null;\n            }\n            else {\n                eventSource = sourceApi.internalEventSource;\n            }\n        }\n        var tuple = parseEvent(eventInput, eventSource, state, false);\n        if (tuple) {\n            var newEventApi = new EventApi(state, tuple.def, tuple.def.recurringDef ? null : tuple.instance);\n            this.dispatch({\n                type: 'ADD_EVENTS',\n                eventStore: eventTupleToStore(tuple)\n            });\n            this.triggerEventAdd(newEventApi);\n            return newEventApi;\n        }\n        return null;\n    };\n    CalendarApi.prototype.triggerEventAdd = function (eventApi) {\n        var _this = this;\n        var emitter = this.getCurrentData().emitter;\n        emitter.trigger('eventAdd', {\n            event: eventApi,\n            relatedEvents: [],\n            revert: function () {\n                _this.dispatch({\n                    type: 'REMOVE_EVENTS',\n                    eventStore: eventApiToStore(eventApi)\n                });\n            }\n        });\n    };\n    // TODO: optimize\n    CalendarApi.prototype.getEventById = function (id) {\n        var state = this.getCurrentData();\n        var _a = state.eventStore, defs = _a.defs, instances = _a.instances;\n        id = String(id);\n        for (var defId in defs) {\n            var def = defs[defId];\n            if (def.publicId === id) {\n                if (def.recurringDef) {\n                    return new EventApi(state, def, null);\n                }\n                else {\n                    for (var instanceId in instances) {\n                        var instance = instances[instanceId];\n                        if (instance.defId === def.defId) {\n                            return new EventApi(state, def, instance);\n                        }\n                    }\n                }\n            }\n        }\n        return null;\n    };\n    CalendarApi.prototype.getEvents = function () {\n        var currentData = this.getCurrentData();\n        return buildEventApis(currentData.eventStore, currentData);\n    };\n    CalendarApi.prototype.removeAllEvents = function () {\n        this.dispatch({ type: 'REMOVE_ALL_EVENTS' });\n    };\n    // Public Event Sources API\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.getEventSources = function () {\n        var state = this.getCurrentData();\n        var sourceHash = state.eventSources;\n        var sourceApis = [];\n        for (var internalId in sourceHash) {\n            sourceApis.push(new EventSourceApi(state, sourceHash[internalId]));\n        }\n        return sourceApis;\n    };\n    CalendarApi.prototype.getEventSourceById = function (id) {\n        var state = this.getCurrentData();\n        var sourceHash = state.eventSources;\n        id = String(id);\n        for (var sourceId in sourceHash) {\n            if (sourceHash[sourceId].publicId === id) {\n                return new EventSourceApi(state, sourceHash[sourceId]);\n            }\n        }\n        return null;\n    };\n    CalendarApi.prototype.addEventSource = function (sourceInput) {\n        var state = this.getCurrentData();\n        if (sourceInput instanceof EventSourceApi) {\n            // not already present? don't want to add an old snapshot\n            if (!state.eventSources[sourceInput.internalEventSource.sourceId]) {\n                this.dispatch({\n                    type: 'ADD_EVENT_SOURCES',\n                    sources: [sourceInput.internalEventSource]\n                });\n            }\n            return sourceInput;\n        }\n        var eventSource = parseEventSource(sourceInput, state);\n        if (eventSource) { // TODO: error otherwise?\n            this.dispatch({ type: 'ADD_EVENT_SOURCES', sources: [eventSource] });\n            return new EventSourceApi(state, eventSource);\n        }\n        return null;\n    };\n    CalendarApi.prototype.removeAllEventSources = function () {\n        this.dispatch({ type: 'REMOVE_ALL_EVENT_SOURCES' });\n    };\n    CalendarApi.prototype.refetchEvents = function () {\n        this.dispatch({ type: 'FETCH_EVENT_SOURCES' });\n    };\n    // Scroll\n    // -----------------------------------------------------------------------------------------------------------------\n    CalendarApi.prototype.scrollToTime = function (timeInput) {\n        var time = createDuration(timeInput);\n        if (time) {\n            this.trigger('_scrollRequest', { time: time });\n        }\n    };\n    return CalendarApi;\n}());\n\nvar EventApi = /** @class */ (function () {\n    // instance will be null if expressing a recurring event that has no current instances,\n    // OR if trying to validate an incoming external event that has no dates assigned\n    function EventApi(context, def, instance) {\n        this._context = context;\n        this._def = def;\n        this._instance = instance || null;\n    }\n    /*\n    TODO: make event struct more responsible for this\n    */\n    EventApi.prototype.setProp = function (name, val) {\n        var _a, _b;\n        if (name in EVENT_DATE_REFINERS) {\n            console.warn(\"Could not set date-related prop 'name'. Use one of the date-related methods instead.\");\n        }\n        else if (name in EVENT_NON_DATE_REFINERS) {\n            val = EVENT_NON_DATE_REFINERS[name](val);\n            this.mutate({\n                standardProps: (_a = {}, _a[name] = val, _a)\n            });\n        }\n        else if (name in EVENT_UI_REFINERS) {\n            var ui = EVENT_UI_REFINERS[name](val);\n            if (name === 'color') {\n                ui = { backgroundColor: val, borderColor: val };\n            }\n            else if (name === 'editable') {\n                ui = { startEditable: val, durationEditable: val };\n            }\n            else {\n                ui = (_b = {}, _b[name] = val, _b);\n            }\n            this.mutate({\n                standardProps: { ui: ui }\n            });\n        }\n        else {\n            console.warn(\"Could not set prop '\" + name + \"'. Use setExtendedProp instead.\");\n        }\n    };\n    EventApi.prototype.setExtendedProp = function (name, val) {\n        var _a;\n        this.mutate({\n            extendedProps: (_a = {}, _a[name] = val, _a)\n        });\n    };\n    EventApi.prototype.setStart = function (startInput, options) {\n        if (options === void 0) { options = {}; }\n        var dateEnv = this._context.dateEnv;\n        var start = dateEnv.createMarker(startInput);\n        if (start && this._instance) { // TODO: warning if parsed bad\n            var instanceRange = this._instance.range;\n            var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity); // what if parsed bad!?\n            if (options.maintainDuration) {\n                this.mutate({ datesDelta: startDelta });\n            }\n            else {\n                this.mutate({ startDelta: startDelta });\n            }\n        }\n    };\n    EventApi.prototype.setEnd = function (endInput, options) {\n        if (options === void 0) { options = {}; }\n        var dateEnv = this._context.dateEnv;\n        var end;\n        if (endInput != null) {\n            end = dateEnv.createMarker(endInput);\n            if (!end) {\n                return; // TODO: warning if parsed bad\n            }\n        }\n        if (this._instance) {\n            if (end) {\n                var endDelta = diffDates(this._instance.range.end, end, dateEnv, options.granularity);\n                this.mutate({ endDelta: endDelta });\n            }\n            else {\n                this.mutate({ standardProps: { hasEnd: false } });\n            }\n        }\n    };\n    EventApi.prototype.setDates = function (startInput, endInput, options) {\n        if (options === void 0) { options = {}; }\n        var dateEnv = this._context.dateEnv;\n        var standardProps = { allDay: options.allDay };\n        var start = dateEnv.createMarker(startInput);\n        var end;\n        if (!start) {\n            return; // TODO: warning if parsed bad\n        }\n        if (endInput != null) {\n            end = dateEnv.createMarker(endInput);\n            if (!end) { // TODO: warning if parsed bad\n                return;\n            }\n        }\n        if (this._instance) {\n            var instanceRange = this._instance.range;\n            // when computing the diff for an event being converted to all-day,\n            // compute diff off of the all-day values the way event-mutation does.\n            if (options.allDay === true) {\n                instanceRange = computeAlignedDayRange(instanceRange);\n            }\n            var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity);\n            if (end) {\n                var endDelta = diffDates(instanceRange.end, end, dateEnv, options.granularity);\n                if (durationsEqual(startDelta, endDelta)) {\n                    this.mutate({ datesDelta: startDelta, standardProps: standardProps });\n                }\n                else {\n                    this.mutate({ startDelta: startDelta, endDelta: endDelta, standardProps: standardProps });\n                }\n            }\n            else { // means \"clear the end\"\n                standardProps.hasEnd = false;\n                this.mutate({ datesDelta: startDelta, standardProps: standardProps });\n            }\n        }\n    };\n    EventApi.prototype.moveStart = function (deltaInput) {\n        var delta = createDuration(deltaInput);\n        if (delta) { // TODO: warning if parsed bad\n            this.mutate({ startDelta: delta });\n        }\n    };\n    EventApi.prototype.moveEnd = function (deltaInput) {\n        var delta = createDuration(deltaInput);\n        if (delta) { // TODO: warning if parsed bad\n            this.mutate({ endDelta: delta });\n        }\n    };\n    EventApi.prototype.moveDates = function (deltaInput) {\n        var delta = createDuration(deltaInput);\n        if (delta) { // TODO: warning if parsed bad\n            this.mutate({ datesDelta: delta });\n        }\n    };\n    EventApi.prototype.setAllDay = function (allDay, options) {\n        if (options === void 0) { options = {}; }\n        var standardProps = { allDay: allDay };\n        var maintainDuration = options.maintainDuration;\n        if (maintainDuration == null) {\n            maintainDuration = this._context.options.allDayMaintainDuration;\n        }\n        if (this._def.allDay !== allDay) {\n            standardProps.hasEnd = maintainDuration;\n        }\n        this.mutate({ standardProps: standardProps });\n    };\n    EventApi.prototype.formatRange = function (formatInput) {\n        var dateEnv = this._context.dateEnv;\n        var instance = this._instance;\n        var formatter = createFormatter(formatInput);\n        if (this._def.hasEnd) {\n            return dateEnv.formatRange(instance.range.start, instance.range.end, formatter, {\n                forcedStartTzo: instance.forcedStartTzo,\n                forcedEndTzo: instance.forcedEndTzo\n            });\n        }\n        else {\n            return dateEnv.format(instance.range.start, formatter, {\n                forcedTzo: instance.forcedStartTzo\n            });\n        }\n    };\n    EventApi.prototype.mutate = function (mutation) {\n        var instance = this._instance;\n        if (instance) {\n            var def = this._def;\n            var context_1 = this._context;\n            var eventStore = context_1.getCurrentData().eventStore;\n            var relevantEvents_1 = getRelevantEvents(eventStore, instance.instanceId);\n            var eventConfigBase = {\n                '': {\n                    display: '',\n                    startEditable: true,\n                    durationEditable: true,\n                    constraints: [],\n                    overlap: null,\n                    allows: [],\n                    backgroundColor: '',\n                    borderColor: '',\n                    textColor: '',\n                    classNames: []\n                }\n            };\n            relevantEvents_1 = applyMutationToEventStore(relevantEvents_1, eventConfigBase, mutation, context_1);\n            var oldEvent = new EventApi(context_1, def, instance); // snapshot\n            this._def = relevantEvents_1.defs[def.defId];\n            this._instance = relevantEvents_1.instances[instance.instanceId];\n            context_1.dispatch({\n                type: 'MERGE_EVENTS',\n                eventStore: relevantEvents_1\n            });\n            context_1.emitter.trigger('eventChange', {\n                oldEvent: oldEvent,\n                event: this,\n                relatedEvents: buildEventApis(relevantEvents_1, context_1, instance),\n                revert: function () {\n                    context_1.dispatch({\n                        type: 'REMOVE_EVENTS',\n                        eventStore: relevantEvents_1\n                    });\n                }\n            });\n        }\n    };\n    EventApi.prototype.remove = function () {\n        var context = this._context;\n        var asStore = eventApiToStore(this);\n        context.dispatch({\n            type: 'REMOVE_EVENTS',\n            eventStore: asStore\n        });\n        context.emitter.trigger('eventRemove', {\n            event: this,\n            relatedEvents: [],\n            revert: function () {\n                context.dispatch({\n                    type: 'MERGE_EVENTS',\n                    eventStore: asStore\n                });\n            }\n        });\n    };\n    Object.defineProperty(EventApi.prototype, \"source\", {\n        get: function () {\n            var sourceId = this._def.sourceId;\n            if (sourceId) {\n                return new EventSourceApi(this._context, this._context.getCurrentData().eventSources[sourceId]);\n            }\n            return null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"start\", {\n        get: function () {\n            return this._instance ?\n                this._context.dateEnv.toDate(this._instance.range.start) :\n                null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"end\", {\n        get: function () {\n            return (this._instance && this._def.hasEnd) ?\n                this._context.dateEnv.toDate(this._instance.range.end) :\n                null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"startStr\", {\n        get: function () {\n            var instance = this._instance;\n            if (instance) {\n                return this._context.dateEnv.formatIso(instance.range.start, {\n                    omitTime: this._def.allDay,\n                    forcedTzo: instance.forcedStartTzo\n                });\n            }\n            return '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"endStr\", {\n        get: function () {\n            var instance = this._instance;\n            if (instance && this._def.hasEnd) {\n                return this._context.dateEnv.formatIso(instance.range.end, {\n                    omitTime: this._def.allDay,\n                    forcedTzo: instance.forcedEndTzo\n                });\n            }\n            return '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"id\", {\n        // computable props that all access the def\n        // TODO: find a TypeScript-compatible way to do this at scale\n        get: function () { return this._def.publicId; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"groupId\", {\n        get: function () { return this._def.groupId; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"allDay\", {\n        get: function () { return this._def.allDay; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"title\", {\n        get: function () { return this._def.title; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"url\", {\n        get: function () { return this._def.url; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"display\", {\n        get: function () { return this._def.ui.display || 'auto'; } // bad. just normalize the type earlier\n        ,\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"startEditable\", {\n        get: function () { return this._def.ui.startEditable; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"durationEditable\", {\n        get: function () { return this._def.ui.durationEditable; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"constraint\", {\n        get: function () { return this._def.ui.constraints[0] || null; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"overlap\", {\n        get: function () { return this._def.ui.overlap; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"allow\", {\n        get: function () { return this._def.ui.allows[0] || null; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"backgroundColor\", {\n        get: function () { return this._def.ui.backgroundColor; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"borderColor\", {\n        get: function () { return this._def.ui.borderColor; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"textColor\", {\n        get: function () { return this._def.ui.textColor; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"classNames\", {\n        // NOTE: user can't modify these because Object.freeze was called in event-def parsing\n        get: function () { return this._def.ui.classNames; },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"extendedProps\", {\n        get: function () { return this._def.extendedProps; },\n        enumerable: false,\n        configurable: true\n    });\n    EventApi.prototype.toPlainObject = function (settings) {\n        if (settings === void 0) { settings = {}; }\n        var def = this._def;\n        var ui = def.ui;\n        var _a = this, startStr = _a.startStr, endStr = _a.endStr;\n        var res = {};\n        if (def.title) {\n            res.title = def.title;\n        }\n        if (startStr) {\n            res.start = startStr;\n        }\n        if (endStr) {\n            res.end = endStr;\n        }\n        if (def.publicId) {\n            res.id = def.publicId;\n        }\n        if (def.groupId) {\n            res.groupId = def.groupId;\n        }\n        if (def.url) {\n            res.url = def.url;\n        }\n        if (ui.display && ui.display !== 'auto') {\n            res.display = ui.display;\n        }\n        // TODO: what about recurring-event properties???\n        // TODO: include startEditable/durationEditable/constraint/overlap/allow\n        if (settings.collapseColor && ui.backgroundColor && ui.backgroundColor === ui.borderColor) {\n            res.color = ui.backgroundColor;\n        }\n        else {\n            if (ui.backgroundColor) {\n                res.backgroundColor = ui.backgroundColor;\n            }\n            if (ui.borderColor) {\n                res.borderColor = ui.borderColor;\n            }\n        }\n        if (ui.textColor) {\n            res.textColor = ui.textColor;\n        }\n        if (ui.classNames.length) {\n            res.classNames = ui.classNames;\n        }\n        if (Object.keys(def.extendedProps).length) {\n            if (settings.collapseExtendedProps) {\n                __assign(res, def.extendedProps);\n            }\n            else {\n                res.extendedProps = def.extendedProps;\n            }\n        }\n        return res;\n    };\n    EventApi.prototype.toJSON = function () {\n        return this.toPlainObject();\n    };\n    return EventApi;\n}());\nfunction eventApiToStore(eventApi) {\n    var _a, _b;\n    var def = eventApi._def;\n    var instance = eventApi._instance;\n    return {\n        defs: (_a = {}, _a[def.defId] = def, _a),\n        instances: instance\n            ? (_b = {}, _b[instance.instanceId] = instance, _b) : {}\n    };\n}\nfunction buildEventApis(eventStore, context, excludeInstance) {\n    var defs = eventStore.defs, instances = eventStore.instances;\n    var eventApis = [];\n    var excludeInstanceId = excludeInstance ? excludeInstance.instanceId : '';\n    for (var id in instances) {\n        var instance = instances[id];\n        var def = defs[instance.defId];\n        if (instance.instanceId !== excludeInstanceId) {\n            eventApis.push(new EventApi(context, def, instance));\n        }\n    }\n    return eventApis;\n}\n\nvar calendarSystemClassMap = {};\nfunction registerCalendarSystem(name, theClass) {\n    calendarSystemClassMap[name] = theClass;\n}\nfunction createCalendarSystem(name) {\n    return new calendarSystemClassMap[name]();\n}\nvar GregorianCalendarSystem = /** @class */ (function () {\n    function GregorianCalendarSystem() {\n    }\n    GregorianCalendarSystem.prototype.getMarkerYear = function (d) {\n        return d.getUTCFullYear();\n    };\n    GregorianCalendarSystem.prototype.getMarkerMonth = function (d) {\n        return d.getUTCMonth();\n    };\n    GregorianCalendarSystem.prototype.getMarkerDay = function (d) {\n        return d.getUTCDate();\n    };\n    GregorianCalendarSystem.prototype.arrayToMarker = function (arr) {\n        return arrayToUtcDate(arr);\n    };\n    GregorianCalendarSystem.prototype.markerToArray = function (marker) {\n        return dateToUtcArray(marker);\n    };\n    return GregorianCalendarSystem;\n}());\nregisterCalendarSystem('gregory', GregorianCalendarSystem);\n\nvar ISO_RE = /^\\s*(\\d{4})(-?(\\d{2})(-?(\\d{2})([T ](\\d{2}):?(\\d{2})(:?(\\d{2})(\\.(\\d+))?)?(Z|(([-+])(\\d{2})(:?(\\d{2}))?))?)?)?)?$/;\nfunction parse(str) {\n    var m = ISO_RE.exec(str);\n    if (m) {\n        var marker = new Date(Date.UTC(Number(m[1]), m[3] ? Number(m[3]) - 1 : 0, Number(m[5] || 1), Number(m[7] || 0), Number(m[8] || 0), Number(m[10] || 0), m[12] ? Number('0.' + m[12]) * 1000 : 0));\n        if (isValidDate(marker)) {\n            var timeZoneOffset = null;\n            if (m[13]) {\n                timeZoneOffset = (m[15] === '-' ? -1 : 1) * (Number(m[16] || 0) * 60 +\n                    Number(m[18] || 0));\n            }\n            return {\n                marker: marker,\n                isTimeUnspecified: !m[6],\n                timeZoneOffset: timeZoneOffset\n            };\n        }\n    }\n    return null;\n}\n\nvar DateEnv = /** @class */ (function () {\n    function DateEnv(settings) {\n        var timeZone = this.timeZone = settings.timeZone;\n        var isNamedTimeZone = timeZone !== 'local' && timeZone !== 'UTC';\n        if (settings.namedTimeZoneImpl && isNamedTimeZone) {\n            this.namedTimeZoneImpl = new settings.namedTimeZoneImpl(timeZone);\n        }\n        this.canComputeOffset = Boolean(!isNamedTimeZone || this.namedTimeZoneImpl);\n        this.calendarSystem = createCalendarSystem(settings.calendarSystem);\n        this.locale = settings.locale;\n        this.weekDow = settings.locale.week.dow;\n        this.weekDoy = settings.locale.week.doy;\n        if (settings.weekNumberCalculation === 'ISO') {\n            this.weekDow = 1;\n            this.weekDoy = 4;\n        }\n        if (typeof settings.firstDay === 'number') {\n            this.weekDow = settings.firstDay;\n        }\n        if (typeof settings.weekNumberCalculation === 'function') {\n            this.weekNumberFunc = settings.weekNumberCalculation;\n        }\n        this.weekText = settings.weekText != null ? settings.weekText : settings.locale.options.weekText;\n        this.cmdFormatter = settings.cmdFormatter;\n        this.defaultSeparator = settings.defaultSeparator;\n    }\n    // Creating / Parsing\n    DateEnv.prototype.createMarker = function (input) {\n        var meta = this.createMarkerMeta(input);\n        if (meta === null) {\n            return null;\n        }\n        return meta.marker;\n    };\n    DateEnv.prototype.createNowMarker = function () {\n        if (this.canComputeOffset) {\n            return this.timestampToMarker(new Date().valueOf());\n        }\n        else {\n            // if we can't compute the current date val for a timezone,\n            // better to give the current local date vals than UTC\n            return arrayToUtcDate(dateToLocalArray(new Date()));\n        }\n    };\n    DateEnv.prototype.createMarkerMeta = function (input) {\n        if (typeof input === 'string') {\n            return this.parse(input);\n        }\n        var marker = null;\n        if (typeof input === 'number') {\n            marker = this.timestampToMarker(input);\n        }\n        else if (input instanceof Date) {\n            input = input.valueOf();\n            if (!isNaN(input)) {\n                marker = this.timestampToMarker(input);\n            }\n        }\n        else if (Array.isArray(input)) {\n            marker = arrayToUtcDate(input);\n        }\n        if (marker === null || !isValidDate(marker)) {\n            return null;\n        }\n        return { marker: marker, isTimeUnspecified: false, forcedTzo: null };\n    };\n    DateEnv.prototype.parse = function (s) {\n        var parts = parse(s);\n        if (parts === null) {\n            return null;\n        }\n        var marker = parts.marker;\n        var forcedTzo = null;\n        if (parts.timeZoneOffset !== null) {\n            if (this.canComputeOffset) {\n                marker = this.timestampToMarker(marker.valueOf() - parts.timeZoneOffset * 60 * 1000);\n            }\n            else {\n                forcedTzo = parts.timeZoneOffset;\n            }\n        }\n        return { marker: marker, isTimeUnspecified: parts.isTimeUnspecified, forcedTzo: forcedTzo };\n    };\n    // Accessors\n    DateEnv.prototype.getYear = function (marker) {\n        return this.calendarSystem.getMarkerYear(marker);\n    };\n    DateEnv.prototype.getMonth = function (marker) {\n        return this.calendarSystem.getMarkerMonth(marker);\n    };\n    // Adding / Subtracting\n    DateEnv.prototype.add = function (marker, dur) {\n        var a = this.calendarSystem.markerToArray(marker);\n        a[0] += dur.years;\n        a[1] += dur.months;\n        a[2] += dur.days;\n        a[6] += dur.milliseconds;\n        return this.calendarSystem.arrayToMarker(a);\n    };\n    DateEnv.prototype.subtract = function (marker, dur) {\n        var a = this.calendarSystem.markerToArray(marker);\n        a[0] -= dur.years;\n        a[1] -= dur.months;\n        a[2] -= dur.days;\n        a[6] -= dur.milliseconds;\n        return this.calendarSystem.arrayToMarker(a);\n    };\n    DateEnv.prototype.addYears = function (marker, n) {\n        var a = this.calendarSystem.markerToArray(marker);\n        a[0] += n;\n        return this.calendarSystem.arrayToMarker(a);\n    };\n    DateEnv.prototype.addMonths = function (marker, n) {\n        var a = this.calendarSystem.markerToArray(marker);\n        a[1] += n;\n        return this.calendarSystem.arrayToMarker(a);\n    };\n    // Diffing Whole Units\n    DateEnv.prototype.diffWholeYears = function (m0, m1) {\n        var calendarSystem = this.calendarSystem;\n        if (timeAsMs(m0) === timeAsMs(m1) &&\n            calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1) &&\n            calendarSystem.getMarkerMonth(m0) === calendarSystem.getMarkerMonth(m1)) {\n            return calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0);\n        }\n        return null;\n    };\n    DateEnv.prototype.diffWholeMonths = function (m0, m1) {\n        var calendarSystem = this.calendarSystem;\n        if (timeAsMs(m0) === timeAsMs(m1) &&\n            calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1)) {\n            return (calendarSystem.getMarkerMonth(m1) - calendarSystem.getMarkerMonth(m0)) +\n                (calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0)) * 12;\n        }\n        return null;\n    };\n    // Range / Duration\n    DateEnv.prototype.greatestWholeUnit = function (m0, m1) {\n        var n = this.diffWholeYears(m0, m1);\n        if (n !== null) {\n            return { unit: 'year', value: n };\n        }\n        n = this.diffWholeMonths(m0, m1);\n        if (n !== null) {\n            return { unit: 'month', value: n };\n        }\n        n = diffWholeWeeks(m0, m1);\n        if (n !== null) {\n            return { unit: 'week', value: n };\n        }\n        n = diffWholeDays(m0, m1);\n        if (n !== null) {\n            return { unit: 'day', value: n };\n        }\n        n = diffHours(m0, m1);\n        if (isInt(n)) {\n            return { unit: 'hour', value: n };\n        }\n        n = diffMinutes(m0, m1);\n        if (isInt(n)) {\n            return { unit: 'minute', value: n };\n        }\n        n = diffSeconds(m0, m1);\n        if (isInt(n)) {\n            return { unit: 'second', value: n };\n        }\n        return { unit: 'millisecond', value: m1.valueOf() - m0.valueOf() };\n    };\n    DateEnv.prototype.countDurationsBetween = function (m0, m1, d) {\n        // TODO: can use greatestWholeUnit\n        var diff;\n        if (d.years) {\n            diff = this.diffWholeYears(m0, m1);\n            if (diff !== null) {\n                return diff / asRoughYears(d);\n            }\n        }\n        if (d.months) {\n            diff = this.diffWholeMonths(m0, m1);\n            if (diff !== null) {\n                return diff / asRoughMonths(d);\n            }\n        }\n        if (d.days) {\n            diff = diffWholeDays(m0, m1);\n            if (diff !== null) {\n                return diff / asRoughDays(d);\n            }\n        }\n        return (m1.valueOf() - m0.valueOf()) / asRoughMs(d);\n    };\n    // Start-Of\n    // these DON'T return zoned-dates. only UTC start-of dates\n    DateEnv.prototype.startOf = function (m, unit) {\n        if (unit === 'year') {\n            return this.startOfYear(m);\n        }\n        else if (unit === 'month') {\n            return this.startOfMonth(m);\n        }\n        else if (unit === 'week') {\n            return this.startOfWeek(m);\n        }\n        else if (unit === 'day') {\n            return startOfDay(m);\n        }\n        else if (unit === 'hour') {\n            return startOfHour(m);\n        }\n        else if (unit === 'minute') {\n            return startOfMinute(m);\n        }\n        else if (unit === 'second') {\n            return startOfSecond(m);\n        }\n    };\n    DateEnv.prototype.startOfYear = function (m) {\n        return this.calendarSystem.arrayToMarker([\n            this.calendarSystem.getMarkerYear(m)\n        ]);\n    };\n    DateEnv.prototype.startOfMonth = function (m) {\n        return this.calendarSystem.arrayToMarker([\n            this.calendarSystem.getMarkerYear(m),\n            this.calendarSystem.getMarkerMonth(m)\n        ]);\n    };\n    DateEnv.prototype.startOfWeek = function (m) {\n        return this.calendarSystem.arrayToMarker([\n            this.calendarSystem.getMarkerYear(m),\n            this.calendarSystem.getMarkerMonth(m),\n            m.getUTCDate() - ((m.getUTCDay() - this.weekDow + 7) % 7)\n        ]);\n    };\n    // Week Number\n    DateEnv.prototype.computeWeekNumber = function (marker) {\n        if (this.weekNumberFunc) {\n            return this.weekNumberFunc(this.toDate(marker));\n        }\n        else {\n            return weekOfYear(marker, this.weekDow, this.weekDoy);\n        }\n    };\n    // TODO: choke on timeZoneName: long\n    DateEnv.prototype.format = function (marker, formatter, dateOptions) {\n        if (dateOptions === void 0) { dateOptions = {}; }\n        return formatter.format({\n            marker: marker,\n            timeZoneOffset: dateOptions.forcedTzo != null ?\n                dateOptions.forcedTzo :\n                this.offsetForMarker(marker)\n        }, this);\n    };\n    DateEnv.prototype.formatRange = function (start, end, formatter, dateOptions) {\n        if (dateOptions === void 0) { dateOptions = {}; }\n        if (dateOptions.isEndExclusive) {\n            end = addMs(end, -1);\n        }\n        return formatter.formatRange({\n            marker: start,\n            timeZoneOffset: dateOptions.forcedStartTzo != null ?\n                dateOptions.forcedStartTzo :\n                this.offsetForMarker(start)\n        }, {\n            marker: end,\n            timeZoneOffset: dateOptions.forcedEndTzo != null ?\n                dateOptions.forcedEndTzo :\n                this.offsetForMarker(end)\n        }, this, dateOptions.defaultSeparator);\n    };\n    /*\n    DUMB: the omitTime arg is dumb. if we omit the time, we want to omit the timezone offset. and if we do that,\n    might as well use buildIsoString or some other util directly\n    */\n    DateEnv.prototype.formatIso = function (marker, extraOptions) {\n        if (extraOptions === void 0) { extraOptions = {}; }\n        var timeZoneOffset = null;\n        if (!extraOptions.omitTimeZoneOffset) {\n            if (extraOptions.forcedTzo != null) {\n                timeZoneOffset = extraOptions.forcedTzo;\n            }\n            else {\n                timeZoneOffset = this.offsetForMarker(marker);\n            }\n        }\n        return buildIsoString(marker, timeZoneOffset, extraOptions.omitTime);\n    };\n    // TimeZone\n    DateEnv.prototype.timestampToMarker = function (ms) {\n        if (this.timeZone === 'local') {\n            return arrayToUtcDate(dateToLocalArray(new Date(ms)));\n        }\n        else if (this.timeZone === 'UTC' || !this.namedTimeZoneImpl) {\n            return new Date(ms);\n        }\n        else {\n            return arrayToUtcDate(this.namedTimeZoneImpl.timestampToArray(ms));\n        }\n    };\n    DateEnv.prototype.offsetForMarker = function (m) {\n        if (this.timeZone === 'local') {\n            return -arrayToLocalDate(dateToUtcArray(m)).getTimezoneOffset(); // convert \"inverse\" offset to \"normal\" offset\n        }\n        else if (this.timeZone === 'UTC') {\n            return 0;\n        }\n        else if (this.namedTimeZoneImpl) {\n            return this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m));\n        }\n        return null;\n    };\n    // Conversion\n    DateEnv.prototype.toDate = function (m, forcedTzo) {\n        if (this.timeZone === 'local') {\n            return arrayToLocalDate(dateToUtcArray(m));\n        }\n        else if (this.timeZone === 'UTC') {\n            return new Date(m.valueOf()); // make sure it's a copy\n        }\n        else if (!this.namedTimeZoneImpl) {\n            return new Date(m.valueOf() - (forcedTzo || 0));\n        }\n        else {\n            return new Date(m.valueOf() -\n                this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m)) * 1000 * 60 // convert minutes -> ms\n            );\n        }\n    };\n    return DateEnv;\n}());\n\nvar globalLocales = [];\n\nvar RAW_EN_LOCALE = {\n    code: 'en',\n    week: {\n        dow: 0,\n        doy: 4 // 4 days need to be within the year to be considered the first week\n    },\n    direction: 'ltr',\n    buttonText: {\n        prev: 'prev',\n        next: 'next',\n        prevYear: 'prev year',\n        nextYear: 'next year',\n        year: 'year',\n        today: 'today',\n        month: 'month',\n        week: 'week',\n        day: 'day',\n        list: 'list'\n    },\n    weekText: 'W',\n    allDayText: 'all-day',\n    moreLinkText: 'more',\n    noEventsText: 'No events to display'\n};\nfunction organizeRawLocales(explicitRawLocales) {\n    var defaultCode = explicitRawLocales.length > 0 ? explicitRawLocales[0].code : 'en';\n    var allRawLocales = globalLocales.concat(explicitRawLocales);\n    var rawLocaleMap = {\n        en: RAW_EN_LOCALE // necessary?\n    };\n    for (var _i = 0, allRawLocales_1 = allRawLocales; _i < allRawLocales_1.length; _i++) {\n        var rawLocale = allRawLocales_1[_i];\n        rawLocaleMap[rawLocale.code] = rawLocale;\n    }\n    return {\n        map: rawLocaleMap,\n        defaultCode: defaultCode\n    };\n}\nfunction buildLocale(inputSingular, available) {\n    if (typeof inputSingular === 'object' && !Array.isArray(inputSingular)) {\n        return parseLocale(inputSingular.code, [inputSingular.code], inputSingular);\n    }\n    else {\n        return queryLocale(inputSingular, available);\n    }\n}\nfunction queryLocale(codeArg, available) {\n    var codes = [].concat(codeArg || []); // will convert to array\n    var raw = queryRawLocale(codes, available) || RAW_EN_LOCALE;\n    return parseLocale(codeArg, codes, raw);\n}\nfunction queryRawLocale(codes, available) {\n    for (var i = 0; i < codes.length; i++) {\n        var parts = codes[i].toLocaleLowerCase().split('-');\n        for (var j = parts.length; j > 0; j--) {\n            var simpleId = parts.slice(0, j).join('-');\n            if (available[simpleId]) {\n                return available[simpleId];\n            }\n        }\n    }\n    return null;\n}\nfunction parseLocale(codeArg, codes, raw) {\n    var merged = mergeProps([RAW_EN_LOCALE, raw], ['buttonText']);\n    delete merged.code; // don't want this part of the options\n    var week = merged.week;\n    delete merged.week;\n    return {\n        codeArg: codeArg,\n        codes: codes,\n        week: week,\n        simpleNumberFormat: new Intl.NumberFormat(codeArg),\n        options: merged\n    };\n}\n\nfunction formatDate(dateInput, options) {\n    if (options === void 0) { options = {}; }\n    var dateEnv = buildDateEnv(options);\n    var formatter = createFormatter(options);\n    var dateMeta = dateEnv.createMarkerMeta(dateInput);\n    if (!dateMeta) { // TODO: warning?\n        return '';\n    }\n    return dateEnv.format(dateMeta.marker, formatter, {\n        forcedTzo: dateMeta.forcedTzo\n    });\n}\nfunction formatRange(startInput, endInput, options // mixture of env and formatter settings\n) {\n    var dateEnv = buildDateEnv(typeof options === 'object' && options ? options : {}); // pass in if non-null object\n    var formatter = createFormatter(options);\n    var startMeta = dateEnv.createMarkerMeta(startInput);\n    var endMeta = dateEnv.createMarkerMeta(endInput);\n    if (!startMeta || !endMeta) { // TODO: warning?\n        return '';\n    }\n    return dateEnv.formatRange(startMeta.marker, endMeta.marker, formatter, {\n        forcedStartTzo: startMeta.forcedTzo,\n        forcedEndTzo: endMeta.forcedTzo,\n        isEndExclusive: options.isEndExclusive,\n        defaultSeparator: BASE_OPTION_DEFAULTS.defaultRangeSeparator\n    });\n}\n// TODO: more DRY and optimized\nfunction buildDateEnv(settings) {\n    var locale = buildLocale(settings.locale || 'en', organizeRawLocales([]).map); // TODO: don't hardcode 'en' everywhere\n    return new DateEnv(__assign(__assign({ timeZone: BASE_OPTION_DEFAULTS.timeZone, calendarSystem: 'gregory' }, settings), { locale: locale }));\n}\n\nvar DEF_DEFAULTS = {\n    startTime: '09:00',\n    endTime: '17:00',\n    daysOfWeek: [1, 2, 3, 4, 5],\n    display: 'inverse-background',\n    classNames: 'fc-non-business',\n    groupId: '_businessHours' // so multiple defs get grouped\n};\n/*\nTODO: pass around as EventDefHash!!!\n*/\nfunction parseBusinessHours(input, context) {\n    return parseEvents(refineInputs(input), null, context);\n}\nfunction refineInputs(input) {\n    var rawDefs;\n    if (input === true) {\n        rawDefs = [{}]; // will get DEF_DEFAULTS verbatim\n    }\n    else if (Array.isArray(input)) {\n        // if specifying an array, every sub-definition NEEDS a day-of-week\n        rawDefs = input.filter(function (rawDef) {\n            return rawDef.daysOfWeek;\n        });\n    }\n    else if (typeof input === 'object' && input) { // non-null object\n        rawDefs = [input];\n    }\n    else { // is probably false\n        rawDefs = [];\n    }\n    rawDefs = rawDefs.map(function (rawDef) {\n        return __assign(__assign({}, DEF_DEFAULTS), rawDef);\n    });\n    return rawDefs;\n}\n\nfunction pointInsideRect(point, rect) {\n    return point.left >= rect.left &&\n        point.left < rect.right &&\n        point.top >= rect.top &&\n        point.top < rect.bottom;\n}\n// Returns a new rectangle that is the intersection of the two rectangles. If they don't intersect, returns false\nfunction intersectRects(rect1, rect2) {\n    var res = {\n        left: Math.max(rect1.left, rect2.left),\n        right: Math.min(rect1.right, rect2.right),\n        top: Math.max(rect1.top, rect2.top),\n        bottom: Math.min(rect1.bottom, rect2.bottom)\n    };\n    if (res.left < res.right && res.top < res.bottom) {\n        return res;\n    }\n    return false;\n}\nfunction translateRect(rect, deltaX, deltaY) {\n    return {\n        left: rect.left + deltaX,\n        right: rect.right + deltaX,\n        top: rect.top + deltaY,\n        bottom: rect.bottom + deltaY\n    };\n}\n// Returns a new point that will have been moved to reside within the given rectangle\nfunction constrainPoint(point, rect) {\n    return {\n        left: Math.min(Math.max(point.left, rect.left), rect.right),\n        top: Math.min(Math.max(point.top, rect.top), rect.bottom)\n    };\n}\n// Returns a point that is the center of the given rectangle\nfunction getRectCenter(rect) {\n    return {\n        left: (rect.left + rect.right) / 2,\n        top: (rect.top + rect.bottom) / 2\n    };\n}\n// Subtracts point2's coordinates from point1's coordinates, returning a delta\nfunction diffPoints(point1, point2) {\n    return {\n        left: point1.left - point2.left,\n        top: point1.top - point2.top\n    };\n}\n\nvar canVGrowWithinCell;\nfunction getCanVGrowWithinCell() {\n    if (canVGrowWithinCell == null) {\n        canVGrowWithinCell = computeCanVGrowWithinCell();\n    }\n    return canVGrowWithinCell;\n}\nfunction computeCanVGrowWithinCell() {\n    // for SSR, because this function is call immediately at top-level\n    // TODO: just make this logic execute top-level, immediately, instead of doing lazily\n    if (typeof document === 'undefined') {\n        return true;\n    }\n    var el = document.createElement('div');\n    el.style.position = 'absolute';\n    el.style.top = '0px';\n    el.style.left = '0px';\n    el.innerHTML = '<table><tr><td><div></div></td></tr></table>';\n    el.querySelector('table').style.height = '100px';\n    el.querySelector('div').style.height = '100%';\n    document.body.appendChild(el);\n    var div = el.querySelector('div');\n    var possible = div.offsetHeight > 0;\n    document.body.removeChild(el);\n    return possible;\n}\n\nvar EMPTY_EVENT_STORE = createEmptyEventStore(); // for purecomponents. TODO: keep elsewhere\nvar Splitter = /** @class */ (function () {\n    function Splitter() {\n        this.getKeysForEventDefs = memoize(this._getKeysForEventDefs);\n        this.splitDateSelection = memoize(this._splitDateSpan);\n        this.splitEventStore = memoize(this._splitEventStore);\n        this.splitIndividualUi = memoize(this._splitIndividualUi);\n        this.splitEventDrag = memoize(this._splitInteraction);\n        this.splitEventResize = memoize(this._splitInteraction);\n        this.eventUiBuilders = {}; // TODO: typescript protection\n    }\n    Splitter.prototype.splitProps = function (props) {\n        var _this = this;\n        var keyInfos = this.getKeyInfo(props);\n        var defKeys = this.getKeysForEventDefs(props.eventStore);\n        var dateSelections = this.splitDateSelection(props.dateSelection);\n        var individualUi = this.splitIndividualUi(props.eventUiBases, defKeys); // the individual *bases*\n        var eventStores = this.splitEventStore(props.eventStore, defKeys);\n        var eventDrags = this.splitEventDrag(props.eventDrag);\n        var eventResizes = this.splitEventResize(props.eventResize);\n        var splitProps = {};\n        this.eventUiBuilders = mapHash(keyInfos, function (info, key) {\n            return _this.eventUiBuilders[key] || memoize(buildEventUiForKey);\n        });\n        for (var key in keyInfos) {\n            var keyInfo = keyInfos[key];\n            var eventStore = eventStores[key] || EMPTY_EVENT_STORE;\n            var buildEventUi = this.eventUiBuilders[key];\n            splitProps[key] = {\n                businessHours: keyInfo.businessHours || props.businessHours,\n                dateSelection: dateSelections[key] || null,\n                eventStore: eventStore,\n                eventUiBases: buildEventUi(props.eventUiBases[''], keyInfo.ui, individualUi[key]),\n                eventSelection: eventStore.instances[props.eventSelection] ? props.eventSelection : '',\n                eventDrag: eventDrags[key] || null,\n                eventResize: eventResizes[key] || null\n            };\n        }\n        return splitProps;\n    };\n    Splitter.prototype._splitDateSpan = function (dateSpan) {\n        var dateSpans = {};\n        if (dateSpan) {\n            var keys = this.getKeysForDateSpan(dateSpan);\n            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n                var key = keys_1[_i];\n                dateSpans[key] = dateSpan;\n            }\n        }\n        return dateSpans;\n    };\n    Splitter.prototype._getKeysForEventDefs = function (eventStore) {\n        var _this = this;\n        return mapHash(eventStore.defs, function (eventDef) {\n            return _this.getKeysForEventDef(eventDef);\n        });\n    };\n    Splitter.prototype._splitEventStore = function (eventStore, defKeys) {\n        var defs = eventStore.defs, instances = eventStore.instances;\n        var splitStores = {};\n        for (var defId in defs) {\n            for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n                var key = _a[_i];\n                if (!splitStores[key]) {\n                    splitStores[key] = createEmptyEventStore();\n                }\n                splitStores[key].defs[defId] = defs[defId];\n            }\n        }\n        for (var instanceId in instances) {\n            var instance = instances[instanceId];\n            for (var _b = 0, _c = defKeys[instance.defId]; _b < _c.length; _b++) {\n                var key = _c[_b];\n                if (splitStores[key]) { // must have already been created\n                    splitStores[key].instances[instanceId] = instance;\n                }\n            }\n        }\n        return splitStores;\n    };\n    Splitter.prototype._splitIndividualUi = function (eventUiBases, defKeys) {\n        var splitHashes = {};\n        for (var defId in eventUiBases) {\n            if (defId) { // not the '' key\n                for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n                    var key = _a[_i];\n                    if (!splitHashes[key]) {\n                        splitHashes[key] = {};\n                    }\n                    splitHashes[key][defId] = eventUiBases[defId];\n                }\n            }\n        }\n        return splitHashes;\n    };\n    Splitter.prototype._splitInteraction = function (interaction) {\n        var splitStates = {};\n        if (interaction) {\n            var affectedStores_1 = this._splitEventStore(interaction.affectedEvents, this._getKeysForEventDefs(interaction.affectedEvents) // can't use cached. might be events from other calendar\n            );\n            // can't rely on defKeys because event data is mutated\n            var mutatedKeysByDefId = this._getKeysForEventDefs(interaction.mutatedEvents);\n            var mutatedStores_1 = this._splitEventStore(interaction.mutatedEvents, mutatedKeysByDefId);\n            var populate = function (key) {\n                if (!splitStates[key]) {\n                    splitStates[key] = {\n                        affectedEvents: affectedStores_1[key] || EMPTY_EVENT_STORE,\n                        mutatedEvents: mutatedStores_1[key] || EMPTY_EVENT_STORE,\n                        isEvent: interaction.isEvent\n                    };\n                }\n            };\n            for (var key in affectedStores_1) {\n                populate(key);\n            }\n            for (var key in mutatedStores_1) {\n                populate(key);\n            }\n        }\n        return splitStates;\n    };\n    return Splitter;\n}());\nfunction buildEventUiForKey(allUi, eventUiForKey, individualUi) {\n    var baseParts = [];\n    if (allUi) {\n        baseParts.push(allUi);\n    }\n    if (eventUiForKey) {\n        baseParts.push(eventUiForKey);\n    }\n    var stuff = {\n        '': combineEventUis(baseParts)\n    };\n    if (individualUi) {\n        __assign(stuff, individualUi);\n    }\n    return stuff;\n}\n\nfunction getDateMeta(date, todayRange, nowDate, dateProfile) {\n    return {\n        dow: date.getUTCDay(),\n        isDisabled: Boolean(dateProfile && !rangeContainsMarker(dateProfile.activeRange, date)),\n        isOther: Boolean(dateProfile && !rangeContainsMarker(dateProfile.currentRange, date)),\n        isToday: Boolean(todayRange && rangeContainsMarker(todayRange, date)),\n        isPast: Boolean(nowDate ? (date < nowDate) : todayRange ? (date < todayRange.start) : false),\n        isFuture: Boolean(nowDate ? (date > nowDate) : todayRange ? (date >= todayRange.end) : false)\n    };\n}\nfunction getDayClassNames(meta, theme) {\n    var classNames = [\n        'fc-day',\n        'fc-day-' + DAY_IDS[meta.dow]\n    ];\n    if (meta.isDisabled) {\n        classNames.push('fc-day-disabled');\n    }\n    else {\n        if (meta.isToday) {\n            classNames.push('fc-day-today');\n            classNames.push(theme.getClass('today'));\n        }\n        if (meta.isPast) {\n            classNames.push('fc-day-past');\n        }\n        if (meta.isFuture) {\n            classNames.push('fc-day-future');\n        }\n        if (meta.isOther) {\n            classNames.push('fc-day-other');\n        }\n    }\n    return classNames;\n}\nfunction getSlotClassNames(meta, theme) {\n    var classNames = [\n        'fc-slot',\n        'fc-slot-' + DAY_IDS[meta.dow]\n    ];\n    if (meta.isDisabled) {\n        classNames.push('fc-slot-disabled');\n    }\n    else {\n        if (meta.isToday) {\n            classNames.push('fc-slot-today');\n            classNames.push(theme.getClass('today'));\n        }\n        if (meta.isPast) {\n            classNames.push('fc-slot-past');\n        }\n        if (meta.isFuture) {\n            classNames.push('fc-slot-future');\n        }\n    }\n    return classNames;\n}\n\nfunction buildNavLinkData(date, type) {\n    if (type === void 0) { type = 'day'; }\n    return JSON.stringify({\n        date: formatDayString(date),\n        type: type\n    });\n}\n\nvar _isRtlScrollbarOnLeft = null;\nfunction getIsRtlScrollbarOnLeft() {\n    if (_isRtlScrollbarOnLeft === null) {\n        _isRtlScrollbarOnLeft = computeIsRtlScrollbarOnLeft();\n    }\n    return _isRtlScrollbarOnLeft;\n}\nfunction computeIsRtlScrollbarOnLeft() {\n    var outerEl = document.createElement('div');\n    applyStyle(outerEl, {\n        position: 'absolute',\n        top: -1000,\n        left: 0,\n        border: 0,\n        padding: 0,\n        overflow: 'scroll',\n        direction: 'rtl'\n    });\n    outerEl.innerHTML = '<div></div>';\n    document.body.appendChild(outerEl);\n    var innerEl = outerEl.firstChild;\n    var res = innerEl.getBoundingClientRect().left > outerEl.getBoundingClientRect().left;\n    removeElement(outerEl);\n    return res;\n}\n\nvar _scrollbarWidths;\nfunction getScrollbarWidths() {\n    if (!_scrollbarWidths) {\n        _scrollbarWidths = computeScrollbarWidths();\n    }\n    return _scrollbarWidths;\n}\nfunction computeScrollbarWidths() {\n    var el = document.createElement('div');\n    el.style.overflow = 'scroll';\n    document.body.appendChild(el);\n    var res = computeScrollbarWidthsForEl(el);\n    document.body.removeChild(el);\n    return res;\n}\n// WARNING: will include border\nfunction computeScrollbarWidthsForEl(el) {\n    return {\n        x: el.offsetHeight - el.clientHeight,\n        y: el.offsetWidth - el.clientWidth\n    };\n}\n\nfunction computeEdges(el, getPadding) {\n    if (getPadding === void 0) { getPadding = false; }\n    var computedStyle = window.getComputedStyle(el);\n    var borderLeft = parseInt(computedStyle.borderLeftWidth, 10) || 0;\n    var borderRight = parseInt(computedStyle.borderRightWidth, 10) || 0;\n    var borderTop = parseInt(computedStyle.borderTopWidth, 10) || 0;\n    var borderBottom = parseInt(computedStyle.borderBottomWidth, 10) || 0;\n    var badScrollbarWidths = computeScrollbarWidthsForEl(el); // includes border!\n    var scrollbarLeftRight = badScrollbarWidths.y - borderLeft - borderRight;\n    var scrollbarBottom = badScrollbarWidths.x - borderTop - borderBottom;\n    var res = {\n        borderLeft: borderLeft,\n        borderRight: borderRight,\n        borderTop: borderTop,\n        borderBottom: borderBottom,\n        scrollbarBottom: scrollbarBottom,\n        scrollbarLeft: 0,\n        scrollbarRight: 0\n    };\n    if (getIsRtlScrollbarOnLeft() && computedStyle.direction === 'rtl') { // is the scrollbar on the left side?\n        res.scrollbarLeft = scrollbarLeftRight;\n    }\n    else {\n        res.scrollbarRight = scrollbarLeftRight;\n    }\n    if (getPadding) {\n        res.paddingLeft = parseInt(computedStyle.paddingLeft, 10) || 0;\n        res.paddingRight = parseInt(computedStyle.paddingRight, 10) || 0;\n        res.paddingTop = parseInt(computedStyle.paddingTop, 10) || 0;\n        res.paddingBottom = parseInt(computedStyle.paddingBottom, 10) || 0;\n    }\n    return res;\n}\nfunction computeInnerRect(el, goWithinPadding, doFromWindowViewport) {\n    if (goWithinPadding === void 0) { goWithinPadding = false; }\n    var outerRect = doFromWindowViewport ? el.getBoundingClientRect() : computeRect(el);\n    var edges = computeEdges(el, goWithinPadding);\n    var res = {\n        left: outerRect.left + edges.borderLeft + edges.scrollbarLeft,\n        right: outerRect.right - edges.borderRight - edges.scrollbarRight,\n        top: outerRect.top + edges.borderTop,\n        bottom: outerRect.bottom - edges.borderBottom - edges.scrollbarBottom\n    };\n    if (goWithinPadding) {\n        res.left += edges.paddingLeft;\n        res.right -= edges.paddingRight;\n        res.top += edges.paddingTop;\n        res.bottom -= edges.paddingBottom;\n    }\n    return res;\n}\nfunction computeRect(el) {\n    var rect = el.getBoundingClientRect();\n    return {\n        left: rect.left + window.pageXOffset,\n        top: rect.top + window.pageYOffset,\n        right: rect.right + window.pageXOffset,\n        bottom: rect.bottom + window.pageYOffset\n    };\n}\nfunction computeHeightAndMargins(el) {\n    return el.getBoundingClientRect().height + computeVMargins(el);\n}\nfunction computeVMargins(el) {\n    var computed = window.getComputedStyle(el);\n    return parseInt(computed.marginTop, 10) +\n        parseInt(computed.marginBottom, 10);\n}\n// does not return window\nfunction getClippingParents(el) {\n    var parents = [];\n    while (el instanceof HTMLElement) { // will stop when gets to document or null\n        var computedStyle = window.getComputedStyle(el);\n        if (computedStyle.position === 'fixed') {\n            break;\n        }\n        if ((/(auto|scroll)/).test(computedStyle.overflow + computedStyle.overflowY + computedStyle.overflowX)) {\n            parents.push(el);\n        }\n        el = el.parentNode;\n    }\n    return parents;\n}\n\n// given a function that resolves a result asynchronously.\n// the function can either call passed-in success and failure callbacks,\n// or it can return a promise.\n// if you need to pass additional params to func, bind them first.\nfunction unpromisify(func, success, failure) {\n    // guard against success/failure callbacks being called more than once\n    // and guard against a promise AND callback being used together.\n    var isResolved = false;\n    var wrappedSuccess = function () {\n        if (!isResolved) {\n            isResolved = true;\n            success.apply(this, arguments);\n        }\n    };\n    var wrappedFailure = function () {\n        if (!isResolved) {\n            isResolved = true;\n            if (failure) {\n                failure.apply(this, arguments);\n            }\n        }\n    };\n    var res = func(wrappedSuccess, wrappedFailure);\n    if (res && typeof res.then === 'function') {\n        res.then(wrappedSuccess, wrappedFailure);\n    }\n}\n\nvar Emitter = /** @class */ (function () {\n    function Emitter() {\n        this.handlers = {};\n        this.thisContext = null;\n    }\n    Emitter.prototype.setThisContext = function (thisContext) {\n        this.thisContext = thisContext;\n    };\n    Emitter.prototype.setOptions = function (options) {\n        this.options = options;\n    };\n    Emitter.prototype.on = function (type, handler) {\n        addToHash(this.handlers, type, handler);\n    };\n    Emitter.prototype.off = function (type, handler) {\n        removeFromHash(this.handlers, type, handler);\n    };\n    Emitter.prototype.trigger = function (type) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var attachedHandlers = this.handlers[type] || [];\n        var optionHandler = this.options && this.options[type];\n        var handlers = [].concat(optionHandler || [], attachedHandlers);\n        for (var _a = 0, handlers_1 = handlers; _a < handlers_1.length; _a++) {\n            var handler = handlers_1[_a];\n            handler.apply(this.thisContext, args);\n        }\n    };\n    Emitter.prototype.hasHandlers = function (type) {\n        return (this.handlers[type] && this.handlers[type].length) ||\n            (this.options && this.options[type]);\n    };\n    return Emitter;\n}());\nfunction addToHash(hash, type, handler) {\n    (hash[type] || (hash[type] = []))\n        .push(handler);\n}\nfunction removeFromHash(hash, type, handler) {\n    if (handler) {\n        if (hash[type]) {\n            hash[type] = hash[type].filter(function (func) {\n                return func !== handler;\n            });\n        }\n    }\n    else {\n        delete hash[type]; // remove all handler funcs for this type\n    }\n}\n\n/*\nRecords offset information for a set of elements, relative to an origin element.\nCan record the left/right OR the top/bottom OR both.\nProvides methods for querying the cache by position.\n*/\nvar PositionCache = /** @class */ (function () {\n    function PositionCache(originEl, els, isHorizontal, isVertical) {\n        this.els = els;\n        var originClientRect = this.originClientRect = originEl.getBoundingClientRect(); // relative to viewport top-left\n        if (isHorizontal) {\n            this.buildElHorizontals(originClientRect.left);\n        }\n        if (isVertical) {\n            this.buildElVerticals(originClientRect.top);\n        }\n    }\n    // Populates the left/right internal coordinate arrays\n    PositionCache.prototype.buildElHorizontals = function (originClientLeft) {\n        var lefts = [];\n        var rights = [];\n        for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n            var el = _a[_i];\n            var rect = el.getBoundingClientRect();\n            lefts.push(rect.left - originClientLeft);\n            rights.push(rect.right - originClientLeft);\n        }\n        this.lefts = lefts;\n        this.rights = rights;\n    };\n    // Populates the top/bottom internal coordinate arrays\n    PositionCache.prototype.buildElVerticals = function (originClientTop) {\n        var tops = [];\n        var bottoms = [];\n        for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n            var el = _a[_i];\n            var rect = el.getBoundingClientRect();\n            tops.push(rect.top - originClientTop);\n            bottoms.push(rect.bottom - originClientTop);\n        }\n        this.tops = tops;\n        this.bottoms = bottoms;\n    };\n    // Given a left offset (from document left), returns the index of the el that it horizontally intersects.\n    // If no intersection is made, returns undefined.\n    PositionCache.prototype.leftToIndex = function (leftPosition) {\n        var lefts = this.lefts;\n        var rights = this.rights;\n        var len = lefts.length;\n        var i;\n        for (i = 0; i < len; i++) {\n            if (leftPosition >= lefts[i] && leftPosition < rights[i]) {\n                return i;\n            }\n        }\n    };\n    // Given a top offset (from document top), returns the index of the el that it vertically intersects.\n    // If no intersection is made, returns undefined.\n    PositionCache.prototype.topToIndex = function (topPosition) {\n        var tops = this.tops;\n        var bottoms = this.bottoms;\n        var len = tops.length;\n        var i;\n        for (i = 0; i < len; i++) {\n            if (topPosition >= tops[i] && topPosition < bottoms[i]) {\n                return i;\n            }\n        }\n    };\n    // Gets the width of the element at the given index\n    PositionCache.prototype.getWidth = function (leftIndex) {\n        return this.rights[leftIndex] - this.lefts[leftIndex];\n    };\n    // Gets the height of the element at the given index\n    PositionCache.prototype.getHeight = function (topIndex) {\n        return this.bottoms[topIndex] - this.tops[topIndex];\n    };\n    return PositionCache;\n}());\n\n/*\nAn object for getting/setting scroll-related information for an element.\nInternally, this is done very differently for window versus DOM element,\nso this object serves as a common interface.\n*/\nvar ScrollController = /** @class */ (function () {\n    function ScrollController() {\n    }\n    ScrollController.prototype.getMaxScrollTop = function () {\n        return this.getScrollHeight() - this.getClientHeight();\n    };\n    ScrollController.prototype.getMaxScrollLeft = function () {\n        return this.getScrollWidth() - this.getClientWidth();\n    };\n    ScrollController.prototype.canScrollVertically = function () {\n        return this.getMaxScrollTop() > 0;\n    };\n    ScrollController.prototype.canScrollHorizontally = function () {\n        return this.getMaxScrollLeft() > 0;\n    };\n    ScrollController.prototype.canScrollUp = function () {\n        return this.getScrollTop() > 0;\n    };\n    ScrollController.prototype.canScrollDown = function () {\n        return this.getScrollTop() < this.getMaxScrollTop();\n    };\n    ScrollController.prototype.canScrollLeft = function () {\n        return this.getScrollLeft() > 0;\n    };\n    ScrollController.prototype.canScrollRight = function () {\n        return this.getScrollLeft() < this.getMaxScrollLeft();\n    };\n    return ScrollController;\n}());\nvar ElementScrollController = /** @class */ (function (_super) {\n    __extends(ElementScrollController, _super);\n    function ElementScrollController(el) {\n        var _this = _super.call(this) || this;\n        _this.el = el;\n        return _this;\n    }\n    ElementScrollController.prototype.getScrollTop = function () {\n        return this.el.scrollTop;\n    };\n    ElementScrollController.prototype.getScrollLeft = function () {\n        return this.el.scrollLeft;\n    };\n    ElementScrollController.prototype.setScrollTop = function (top) {\n        this.el.scrollTop = top;\n    };\n    ElementScrollController.prototype.setScrollLeft = function (left) {\n        this.el.scrollLeft = left;\n    };\n    ElementScrollController.prototype.getScrollWidth = function () {\n        return this.el.scrollWidth;\n    };\n    ElementScrollController.prototype.getScrollHeight = function () {\n        return this.el.scrollHeight;\n    };\n    ElementScrollController.prototype.getClientHeight = function () {\n        return this.el.clientHeight;\n    };\n    ElementScrollController.prototype.getClientWidth = function () {\n        return this.el.clientWidth;\n    };\n    return ElementScrollController;\n}(ScrollController));\nvar WindowScrollController = /** @class */ (function (_super) {\n    __extends(WindowScrollController, _super);\n    function WindowScrollController() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    WindowScrollController.prototype.getScrollTop = function () {\n        return window.pageYOffset;\n    };\n    WindowScrollController.prototype.getScrollLeft = function () {\n        return window.pageXOffset;\n    };\n    WindowScrollController.prototype.setScrollTop = function (n) {\n        window.scroll(window.pageXOffset, n);\n    };\n    WindowScrollController.prototype.setScrollLeft = function (n) {\n        window.scroll(n, window.pageYOffset);\n    };\n    WindowScrollController.prototype.getScrollWidth = function () {\n        return document.documentElement.scrollWidth;\n    };\n    WindowScrollController.prototype.getScrollHeight = function () {\n        return document.documentElement.scrollHeight;\n    };\n    WindowScrollController.prototype.getClientHeight = function () {\n        return document.documentElement.clientHeight;\n    };\n    WindowScrollController.prototype.getClientWidth = function () {\n        return document.documentElement.clientWidth;\n    };\n    return WindowScrollController;\n}(ScrollController));\n\nvar Theme = /** @class */ (function () {\n    function Theme(calendarOptions) {\n        if (this.iconOverrideOption) {\n            this.setIconOverride(calendarOptions[this.iconOverrideOption]);\n        }\n    }\n    Theme.prototype.setIconOverride = function (iconOverrideHash) {\n        var iconClassesCopy;\n        var buttonName;\n        if (typeof iconOverrideHash === 'object' && iconOverrideHash) { // non-null object\n            iconClassesCopy = __assign({}, this.iconClasses);\n            for (buttonName in iconOverrideHash) {\n                iconClassesCopy[buttonName] = this.applyIconOverridePrefix(iconOverrideHash[buttonName]);\n            }\n            this.iconClasses = iconClassesCopy;\n        }\n        else if (iconOverrideHash === false) {\n            this.iconClasses = {};\n        }\n    };\n    Theme.prototype.applyIconOverridePrefix = function (className) {\n        var prefix = this.iconOverridePrefix;\n        if (prefix && className.indexOf(prefix) !== 0) { // if not already present\n            className = prefix + className;\n        }\n        return className;\n    };\n    Theme.prototype.getClass = function (key) {\n        return this.classes[key] || '';\n    };\n    Theme.prototype.getIconClass = function (buttonName, isRtl) {\n        var className;\n        if (isRtl && this.rtlIconClasses) {\n            className = this.rtlIconClasses[buttonName] || this.iconClasses[buttonName];\n        }\n        else {\n            className = this.iconClasses[buttonName];\n        }\n        if (className) {\n            return this.baseIconClass + ' ' + className;\n        }\n        return '';\n    };\n    Theme.prototype.getCustomButtonIconClass = function (customButtonProps) {\n        var className;\n        if (this.iconOverrideCustomButtonOption) {\n            className = customButtonProps[this.iconOverrideCustomButtonOption];\n            if (className) {\n                return this.baseIconClass + ' ' + this.applyIconOverridePrefix(className);\n            }\n        }\n        return '';\n    };\n    return Theme;\n}());\nTheme.prototype.classes = {};\nTheme.prototype.iconClasses = {};\nTheme.prototype.baseIconClass = '';\nTheme.prototype.iconOverridePrefix = '';\n\nvar ScrollResponder = /** @class */ (function () {\n    function ScrollResponder(execFunc, emitter, scrollTime) {\n        var _this = this;\n        this.execFunc = execFunc;\n        this.emitter = emitter;\n        this.scrollTime = scrollTime;\n        this.handleScrollRequest = function (request) {\n            _this.queuedRequest = __assign({}, _this.queuedRequest || {}, request);\n            _this.drain();\n        };\n        emitter.on('_scrollRequest', this.handleScrollRequest);\n        this.fireInitialScroll();\n    }\n    ScrollResponder.prototype.detach = function () {\n        this.emitter.off('_scrollRequest', this.handleScrollRequest);\n    };\n    ScrollResponder.prototype.update = function (isDatesNew) {\n        if (isDatesNew) {\n            this.fireInitialScroll(); // will drain\n        }\n        else {\n            this.drain();\n        }\n    };\n    ScrollResponder.prototype.fireInitialScroll = function () {\n        this.handleScrollRequest({\n            time: this.scrollTime\n        });\n    };\n    ScrollResponder.prototype.drain = function () {\n        if (this.queuedRequest && this.execFunc(this.queuedRequest)) {\n            this.queuedRequest = null;\n        }\n    };\n    return ScrollResponder;\n}());\n\nvar ViewContextType = createContext({}); // for Components\nfunction buildViewContext(viewSpec, viewApi, viewOptions, dateProfileGenerator, dateEnv, theme, pluginHooks, dispatch, getCurrentData, emitter, calendarApi, registerInteractiveComponent, unregisterInteractiveComponent) {\n    return {\n        dateEnv: dateEnv,\n        options: viewOptions,\n        pluginHooks: pluginHooks,\n        emitter: emitter,\n        dispatch: dispatch,\n        getCurrentData: getCurrentData,\n        calendarApi: calendarApi,\n        viewSpec: viewSpec,\n        viewApi: viewApi,\n        dateProfileGenerator: dateProfileGenerator,\n        theme: theme,\n        isRtl: viewOptions.direction === 'rtl',\n        addResizeHandler: function (handler) {\n            emitter.on('_resize', handler);\n        },\n        removeResizeHandler: function (handler) {\n            emitter.off('_resize', handler);\n        },\n        createScrollResponder: function (execFunc) {\n            return new ScrollResponder(execFunc, emitter, createDuration(viewOptions.scrollTime));\n        },\n        registerInteractiveComponent: registerInteractiveComponent,\n        unregisterInteractiveComponent: unregisterInteractiveComponent\n    };\n}\n\nvar PureComponent = /** @class */ (function (_super) {\n    __extends(PureComponent, _super);\n    function PureComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PureComponent.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n        if (this.debug) {\n            console.log(getUnequalProps(nextProps, this.props), getUnequalProps(nextState, this.state));\n        }\n        return !compareObjs(this.props, nextProps, this.propEquality) ||\n            !compareObjs(this.state, nextState, this.stateEquality);\n    };\n    PureComponent.addPropsEquality = addPropsEquality;\n    PureComponent.addStateEquality = addStateEquality;\n    PureComponent.contextType = ViewContextType;\n    return PureComponent;\n}(Component));\nPureComponent.prototype.propEquality = {};\nPureComponent.prototype.stateEquality = {};\nvar BaseComponent = /** @class */ (function (_super) {\n    __extends(BaseComponent, _super);\n    function BaseComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BaseComponent.contextType = ViewContextType;\n    return BaseComponent;\n}(PureComponent));\nfunction addPropsEquality(propEquality) {\n    var hash = Object.create(this.prototype.propEquality);\n    __assign(hash, propEquality);\n    this.prototype.propEquality = hash;\n}\nfunction addStateEquality(stateEquality) {\n    var hash = Object.create(this.prototype.stateEquality);\n    __assign(hash, stateEquality);\n    this.prototype.stateEquality = hash;\n}\n// use other one\nfunction setRef(ref, current) {\n    if (typeof ref === 'function') {\n        ref(current);\n    }\n    else if (ref) {\n        // see https://github.com/facebook/react/issues/13029\n        ref.current = current;\n    }\n}\n\nfunction reduceEventStore(eventStore, action, eventSources, dateProfile, context) {\n    switch (action.type) {\n        case 'RECEIVE_EVENTS': // raw\n            return receiveRawEvents(eventStore, eventSources[action.sourceId], action.fetchId, action.fetchRange, action.rawEvents, context);\n        case 'ADD_EVENTS': // already parsed, but not expanded\n            return addEvent(eventStore, action.eventStore, // new ones\n            dateProfile ? dateProfile.activeRange : null, context);\n        case 'MERGE_EVENTS': // already parsed and expanded\n            return mergeEventStores(eventStore, action.eventStore);\n        case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n        case 'NEXT':\n        case 'CHANGE_DATE':\n        case 'CHANGE_VIEW_TYPE':\n            if (dateProfile) {\n                return expandRecurring(eventStore, dateProfile.activeRange, context);\n            }\n            else {\n                return eventStore;\n            }\n        case 'REMOVE_EVENTS':\n            return excludeSubEventStore(eventStore, action.eventStore);\n        case 'REMOVE_EVENT_SOURCE':\n            return excludeEventsBySourceId(eventStore, action.sourceId);\n        case 'REMOVE_ALL_EVENT_SOURCES':\n            return filterEventStoreDefs(eventStore, function (eventDef) {\n                return !eventDef.sourceId; // only keep events with no source id\n            });\n        case 'REMOVE_ALL_EVENTS':\n            return createEmptyEventStore();\n        default:\n            return eventStore;\n    }\n}\nfunction receiveRawEvents(eventStore, eventSource, fetchId, fetchRange, rawEvents, context) {\n    if (eventSource && // not already removed\n        fetchId === eventSource.latestFetchId // TODO: wish this logic was always in event-sources\n    ) {\n        var subset = parseEvents(transformRawEvents(rawEvents, eventSource, context), eventSource, context);\n        if (fetchRange) {\n            subset = expandRecurring(subset, fetchRange, context);\n        }\n        return mergeEventStores(excludeEventsBySourceId(eventStore, eventSource.sourceId), subset);\n    }\n    return eventStore;\n}\nfunction transformRawEvents(rawEvents, eventSource, context) {\n    var calEachTransform = context.options.eventDataTransform;\n    var sourceEachTransform = eventSource ? eventSource.eventDataTransform : null;\n    if (sourceEachTransform) {\n        rawEvents = transformEachRawEvent(rawEvents, sourceEachTransform);\n    }\n    if (calEachTransform) {\n        rawEvents = transformEachRawEvent(rawEvents, calEachTransform);\n    }\n    return rawEvents;\n}\nfunction transformEachRawEvent(rawEvents, func) {\n    var refinedEvents;\n    if (!func) {\n        refinedEvents = rawEvents;\n    }\n    else {\n        refinedEvents = [];\n        for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n            var rawEvent = rawEvents_1[_i];\n            var refinedEvent = func(rawEvent);\n            if (refinedEvent) {\n                refinedEvents.push(refinedEvent);\n            }\n            else if (refinedEvent == null) {\n                refinedEvents.push(rawEvent);\n            } // if a different falsy value, do nothing\n        }\n    }\n    return refinedEvents;\n}\nfunction addEvent(eventStore, subset, expandRange, context) {\n    if (expandRange) {\n        subset = expandRecurring(subset, expandRange, context);\n    }\n    return mergeEventStores(eventStore, subset);\n}\nfunction rezoneEventStoreDates(eventStore, oldDateEnv, newDateEnv) {\n    var defs = eventStore.defs;\n    var instances = mapHash(eventStore.instances, function (instance) {\n        var def = defs[instance.defId];\n        if (def.allDay || def.recurringDef) {\n            return instance; // isn't dependent on timezone\n        }\n        else {\n            return __assign(__assign({}, instance), { range: {\n                    start: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.start, instance.forcedStartTzo)),\n                    end: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.end, instance.forcedEndTzo))\n                }, forcedStartTzo: newDateEnv.canComputeOffset ? null : instance.forcedStartTzo, forcedEndTzo: newDateEnv.canComputeOffset ? null : instance.forcedEndTzo });\n        }\n    });\n    return { defs: defs, instances: instances };\n}\nfunction excludeEventsBySourceId(eventStore, sourceId) {\n    return filterEventStoreDefs(eventStore, function (eventDef) {\n        return eventDef.sourceId !== sourceId;\n    });\n}\n// QUESTION: why not just return instances? do a general object-property-exclusion util\nfunction excludeInstances(eventStore, removals) {\n    return {\n        defs: eventStore.defs,\n        instances: filterHash(eventStore.instances, function (instance) {\n            return !removals[instance.instanceId];\n        })\n    };\n}\n\n// high-level segmenting-aware tester functions\n// ------------------------------------------------------------------------------------------------------------------------\nfunction isInteractionValid(interaction, context) {\n    return isNewPropsValid({ eventDrag: interaction }, context); // HACK: the eventDrag props is used for ALL interactions\n}\nfunction isDateSelectionValid(dateSelection, context) {\n    return isNewPropsValid({ dateSelection: dateSelection }, context);\n}\nfunction isNewPropsValid(newProps, context) {\n    var calendarState = context.getCurrentData();\n    var props = __assign({ businessHours: calendarState.businessHours, dateSelection: '', eventStore: calendarState.eventStore, eventUiBases: calendarState.eventUiBases, eventSelection: '', eventDrag: null, eventResize: null }, newProps);\n    return (context.pluginHooks.isPropsValid || isPropsValid)(props, context);\n}\nfunction isPropsValid(state, context, dateSpanMeta, filterConfig) {\n    if (dateSpanMeta === void 0) { dateSpanMeta = {}; }\n    if (state.eventDrag && !isInteractionPropsValid(state, context, dateSpanMeta, filterConfig)) {\n        return false;\n    }\n    if (state.dateSelection && !isDateSelectionPropsValid(state, context, dateSpanMeta, filterConfig)) {\n        return false;\n    }\n    return true;\n}\n// Moving Event Validation\n// ------------------------------------------------------------------------------------------------------------------------\nfunction isInteractionPropsValid(state, context, dateSpanMeta, filterConfig) {\n    var currentState = context.getCurrentData();\n    var interaction = state.eventDrag; // HACK: the eventDrag props is used for ALL interactions\n    var subjectEventStore = interaction.mutatedEvents;\n    var subjectDefs = subjectEventStore.defs;\n    var subjectInstances = subjectEventStore.instances;\n    var subjectConfigs = compileEventUis(subjectDefs, interaction.isEvent ?\n        state.eventUiBases :\n        { '': currentState.selectionConfig } // if not a real event, validate as a selection\n    );\n    if (filterConfig) {\n        subjectConfigs = mapHash(subjectConfigs, filterConfig);\n    }\n    var otherEventStore = excludeInstances(state.eventStore, interaction.affectedEvents.instances); // exclude the subject events. TODO: exclude defs too?\n    var otherDefs = otherEventStore.defs;\n    var otherInstances = otherEventStore.instances;\n    var otherConfigs = compileEventUis(otherDefs, state.eventUiBases);\n    for (var subjectInstanceId in subjectInstances) {\n        var subjectInstance = subjectInstances[subjectInstanceId];\n        var subjectRange = subjectInstance.range;\n        var subjectConfig = subjectConfigs[subjectInstance.defId];\n        var subjectDef = subjectDefs[subjectInstance.defId];\n        // constraint\n        if (!allConstraintsPass(subjectConfig.constraints, subjectRange, otherEventStore, state.businessHours, context)) {\n            return false;\n        }\n        // overlap\n        var eventOverlap = context.options.eventOverlap;\n        var eventOverlapFunc = typeof eventOverlap === 'function' ? eventOverlap : null;\n        for (var otherInstanceId in otherInstances) {\n            var otherInstance = otherInstances[otherInstanceId];\n            // intersect! evaluate\n            if (rangesIntersect(subjectRange, otherInstance.range)) {\n                var otherOverlap = otherConfigs[otherInstance.defId].overlap;\n                // consider the other event's overlap. only do this if the subject event is a \"real\" event\n                if (otherOverlap === false && interaction.isEvent) {\n                    return false;\n                }\n                if (subjectConfig.overlap === false) {\n                    return false;\n                }\n                if (eventOverlapFunc && !eventOverlapFunc(new EventApi(context, otherDefs[otherInstance.defId], otherInstance), // still event\n                new EventApi(context, subjectDef, subjectInstance) // moving event\n                )) {\n                    return false;\n                }\n            }\n        }\n        // allow (a function)\n        var calendarEventStore = currentState.eventStore; // need global-to-calendar, not local to component (splittable)state\n        for (var _i = 0, _a = subjectConfig.allows; _i < _a.length; _i++) {\n            var subjectAllow = _a[_i];\n            var subjectDateSpan = __assign(__assign({}, dateSpanMeta), { range: subjectInstance.range, allDay: subjectDef.allDay });\n            var origDef = calendarEventStore.defs[subjectDef.defId];\n            var origInstance = calendarEventStore.instances[subjectInstanceId];\n            var eventApi = void 0;\n            if (origDef) { // was previously in the calendar\n                eventApi = new EventApi(context, origDef, origInstance);\n            }\n            else { // was an external event\n                eventApi = new EventApi(context, subjectDef); // no instance, because had no dates\n            }\n            if (!subjectAllow(buildDateSpanApiWithContext(subjectDateSpan, context), eventApi)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n// Date Selection Validation\n// ------------------------------------------------------------------------------------------------------------------------\nfunction isDateSelectionPropsValid(state, context, dateSpanMeta, filterConfig) {\n    var relevantEventStore = state.eventStore;\n    var relevantDefs = relevantEventStore.defs;\n    var relevantInstances = relevantEventStore.instances;\n    var selection = state.dateSelection;\n    var selectionRange = selection.range;\n    var selectionConfig = context.getCurrentData().selectionConfig;\n    if (filterConfig) {\n        selectionConfig = filterConfig(selectionConfig);\n    }\n    // constraint\n    if (!allConstraintsPass(selectionConfig.constraints, selectionRange, relevantEventStore, state.businessHours, context)) {\n        return false;\n    }\n    // overlap\n    var selectOverlap = context.options.selectOverlap;\n    var selectOverlapFunc = typeof selectOverlap === 'function' ? selectOverlap : null;\n    for (var relevantInstanceId in relevantInstances) {\n        var relevantInstance = relevantInstances[relevantInstanceId];\n        // intersect! evaluate\n        if (rangesIntersect(selectionRange, relevantInstance.range)) {\n            if (selectionConfig.overlap === false) {\n                return false;\n            }\n            if (selectOverlapFunc && !selectOverlapFunc(new EventApi(context, relevantDefs[relevantInstance.defId], relevantInstance), null)) {\n                return false;\n            }\n        }\n    }\n    // allow (a function)\n    for (var _i = 0, _a = selectionConfig.allows; _i < _a.length; _i++) {\n        var selectionAllow = _a[_i];\n        var fullDateSpan = __assign(__assign({}, dateSpanMeta), selection);\n        if (!selectionAllow(buildDateSpanApiWithContext(fullDateSpan, context), null)) {\n            return false;\n        }\n    }\n    return true;\n}\n// Constraint Utils\n// ------------------------------------------------------------------------------------------------------------------------\nfunction allConstraintsPass(constraints, subjectRange, otherEventStore, businessHoursUnexpanded, context) {\n    for (var _i = 0, constraints_1 = constraints; _i < constraints_1.length; _i++) {\n        var constraint = constraints_1[_i];\n        if (!anyRangesContainRange(constraintToRanges(constraint, subjectRange, otherEventStore, businessHoursUnexpanded, context), subjectRange)) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction constraintToRanges(constraint, subjectRange, // for expanding a recurring constraint, or expanding business hours\notherEventStore, // for if constraint is an even group ID\nbusinessHoursUnexpanded, // for if constraint is 'businessHours'\ncontext // for expanding businesshours\n) {\n    if (constraint === 'businessHours') {\n        return eventStoreToRanges(expandRecurring(businessHoursUnexpanded, subjectRange, context));\n    }\n    else if (typeof constraint === 'string') { // an group ID\n        return eventStoreToRanges(filterEventStoreDefs(otherEventStore, function (eventDef) {\n            return eventDef.groupId === constraint;\n        }));\n    }\n    else if (typeof constraint === 'object' && constraint) { // non-null object\n        return eventStoreToRanges(expandRecurring(constraint, subjectRange, context));\n    }\n    return []; // if it's false\n}\n// TODO: move to event-store file?\nfunction eventStoreToRanges(eventStore) {\n    var instances = eventStore.instances;\n    var ranges = [];\n    for (var instanceId in instances) {\n        ranges.push(instances[instanceId].range);\n    }\n    return ranges;\n}\n// TODO: move to geom file?\nfunction anyRangesContainRange(outerRanges, innerRange) {\n    for (var _i = 0, outerRanges_1 = outerRanges; _i < outerRanges_1.length; _i++) {\n        var outerRange = outerRanges_1[_i];\n        if (rangeContainsRange(outerRange, innerRange)) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/*\nan INTERACTABLE date component\n\nPURPOSES:\n- hook up to fg, fill, and mirror renderers\n- interface for dragging and hits\n*/\nvar DateComponent = /** @class */ (function (_super) {\n    __extends(DateComponent, _super);\n    function DateComponent() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.uid = guid();\n        return _this;\n    }\n    // Hit System\n    // -----------------------------------------------------------------------------------------------------------------\n    DateComponent.prototype.prepareHits = function () {\n    };\n    DateComponent.prototype.queryHit = function (positionLeft, positionTop, elWidth, elHeight) {\n        return null; // this should be abstract\n    };\n    // Validation\n    // -----------------------------------------------------------------------------------------------------------------\n    DateComponent.prototype.isInteractionValid = function (interaction) {\n        var dateProfile = this.props.dateProfile; // HACK\n        var instances = interaction.mutatedEvents.instances;\n        if (dateProfile) { // HACK for MorePopover\n            for (var instanceId in instances) {\n                if (!rangeContainsRange(dateProfile.validRange, instances[instanceId].range)) {\n                    return false;\n                }\n            }\n        }\n        return isInteractionValid(interaction, this.context);\n    };\n    DateComponent.prototype.isDateSelectionValid = function (selection) {\n        var dateProfile = this.props.dateProfile; // HACK\n        if (dateProfile && // HACK for MorePopover\n            !rangeContainsRange(dateProfile.validRange, selection.range)) {\n            return false;\n        }\n        return isDateSelectionValid(selection, this.context);\n    };\n    // Pointer Interaction Utils\n    // -----------------------------------------------------------------------------------------------------------------\n    DateComponent.prototype.isValidSegDownEl = function (el) {\n        return !this.props.eventDrag && // HACK\n            !this.props.eventResize && // HACK\n            !elementClosest(el, '.fc-event-mirror') &&\n            (this.isPopover() || !this.isInPopover(el));\n        // ^above line ensures we don't detect a seg interaction within a nested component.\n        // it's a HACK because it only supports a popover as the nested component.\n    };\n    DateComponent.prototype.isValidDateDownEl = function (el) {\n        return !elementClosest(el, '.fc-event:not(.fc-bg-event)') &&\n            !elementClosest(el, '.fc-daygrid-more-link') && // a \"more..\" link\n            !elementClosest(el, 'a[data-navlink]') && // a clickable nav link\n            !this.isInPopover(el);\n    };\n    DateComponent.prototype.isPopover = function () {\n        return false;\n    };\n    DateComponent.prototype.isInPopover = function (el) {\n        return Boolean(elementClosest(el, '.fc-popover'));\n    };\n    return DateComponent;\n}(BaseComponent));\n\n// TODO: easier way to add new hooks? need to update a million things\nfunction createPlugin(input) {\n    return {\n        id: guid(),\n        deps: input.deps || [],\n        reducers: input.reducers || [],\n        contextInit: [].concat(input.contextInit || []),\n        eventRefiners: input.eventRefiners || {},\n        eventDefMemberAdders: input.eventDefMemberAdders || [],\n        eventSourceRefiners: input.eventSourceRefiners || {},\n        isDraggableTransformers: input.isDraggableTransformers || [],\n        eventDragMutationMassagers: input.eventDragMutationMassagers || [],\n        eventDefMutationAppliers: input.eventDefMutationAppliers || [],\n        dateSelectionTransformers: input.dateSelectionTransformers || [],\n        datePointTransforms: input.datePointTransforms || [],\n        dateSpanTransforms: input.dateSpanTransforms || [],\n        views: input.views || {},\n        viewPropsTransformers: input.viewPropsTransformers || [],\n        isPropsValid: input.isPropsValid || null,\n        externalDefTransforms: input.externalDefTransforms || [],\n        eventResizeJoinTransforms: input.eventResizeJoinTransforms || [],\n        viewContainerAppends: input.viewContainerAppends || [],\n        eventDropTransformers: input.eventDropTransformers || [],\n        componentInteractions: input.componentInteractions || [],\n        calendarInteractions: input.calendarInteractions || [],\n        themeClasses: input.themeClasses || {},\n        eventSourceDefs: input.eventSourceDefs || [],\n        cmdFormatter: input.cmdFormatter,\n        recurringTypes: input.recurringTypes || [],\n        namedTimeZonedImpl: input.namedTimeZonedImpl,\n        initialView: input.initialView || '',\n        elementDraggingImpl: input.elementDraggingImpl,\n        optionChangeHandlers: input.optionChangeHandlers || {},\n        scrollGridImpl: input.scrollGridImpl || null,\n        contentTypeHandlers: input.contentTypeHandlers || {},\n        listenerRefiners: input.listenerRefiners || {},\n        optionRefiners: input.optionRefiners || {},\n        propSetHandlers: input.propSetHandlers || {}\n    };\n}\nfunction buildPluginHooks(pluginDefs, globalDefs) {\n    var isAdded = {};\n    var hooks = {\n        reducers: [],\n        contextInit: [],\n        eventRefiners: {},\n        eventDefMemberAdders: [],\n        eventSourceRefiners: {},\n        isDraggableTransformers: [],\n        eventDragMutationMassagers: [],\n        eventDefMutationAppliers: [],\n        dateSelectionTransformers: [],\n        datePointTransforms: [],\n        dateSpanTransforms: [],\n        views: {},\n        viewPropsTransformers: [],\n        isPropsValid: null,\n        externalDefTransforms: [],\n        eventResizeJoinTransforms: [],\n        viewContainerAppends: [],\n        eventDropTransformers: [],\n        componentInteractions: [],\n        calendarInteractions: [],\n        themeClasses: {},\n        eventSourceDefs: [],\n        cmdFormatter: null,\n        recurringTypes: [],\n        namedTimeZonedImpl: null,\n        initialView: '',\n        elementDraggingImpl: null,\n        optionChangeHandlers: {},\n        scrollGridImpl: null,\n        contentTypeHandlers: {},\n        listenerRefiners: {},\n        optionRefiners: {},\n        propSetHandlers: {}\n    };\n    function addDefs(defs) {\n        for (var _i = 0, defs_1 = defs; _i < defs_1.length; _i++) {\n            var def = defs_1[_i];\n            if (!isAdded[def.id]) {\n                isAdded[def.id] = true;\n                addDefs(def.deps);\n                hooks = combineHooks(hooks, def);\n            }\n        }\n    }\n    if (pluginDefs) {\n        addDefs(pluginDefs);\n    }\n    addDefs(globalDefs);\n    return hooks;\n}\nfunction buildBuildPluginHooks() {\n    var currentOverrideDefs = [];\n    var currentGlobalDefs = [];\n    var currentHooks;\n    return function (overrideDefs, globalDefs) {\n        if (!currentHooks || !isArraysEqual(overrideDefs, currentOverrideDefs) || !isArraysEqual(globalDefs, currentGlobalDefs)) {\n            currentHooks = buildPluginHooks(overrideDefs, globalDefs);\n        }\n        currentOverrideDefs = overrideDefs;\n        currentGlobalDefs = globalDefs;\n        return currentHooks;\n    };\n}\nfunction combineHooks(hooks0, hooks1) {\n    return {\n        reducers: hooks0.reducers.concat(hooks1.reducers),\n        contextInit: hooks0.contextInit.concat(hooks1.contextInit),\n        eventRefiners: __assign(__assign({}, hooks0.eventRefiners), hooks1.eventRefiners),\n        eventDefMemberAdders: hooks0.eventDefMemberAdders.concat(hooks1.eventDefMemberAdders),\n        eventSourceRefiners: __assign(__assign({}, hooks0.eventSourceRefiners), hooks1.eventSourceRefiners),\n        isDraggableTransformers: hooks0.isDraggableTransformers.concat(hooks1.isDraggableTransformers),\n        eventDragMutationMassagers: hooks0.eventDragMutationMassagers.concat(hooks1.eventDragMutationMassagers),\n        eventDefMutationAppliers: hooks0.eventDefMutationAppliers.concat(hooks1.eventDefMutationAppliers),\n        dateSelectionTransformers: hooks0.dateSelectionTransformers.concat(hooks1.dateSelectionTransformers),\n        datePointTransforms: hooks0.datePointTransforms.concat(hooks1.datePointTransforms),\n        dateSpanTransforms: hooks0.dateSpanTransforms.concat(hooks1.dateSpanTransforms),\n        views: __assign(__assign({}, hooks0.views), hooks1.views),\n        viewPropsTransformers: hooks0.viewPropsTransformers.concat(hooks1.viewPropsTransformers),\n        isPropsValid: hooks1.isPropsValid || hooks0.isPropsValid,\n        externalDefTransforms: hooks0.externalDefTransforms.concat(hooks1.externalDefTransforms),\n        eventResizeJoinTransforms: hooks0.eventResizeJoinTransforms.concat(hooks1.eventResizeJoinTransforms),\n        viewContainerAppends: hooks0.viewContainerAppends.concat(hooks1.viewContainerAppends),\n        eventDropTransformers: hooks0.eventDropTransformers.concat(hooks1.eventDropTransformers),\n        calendarInteractions: hooks0.calendarInteractions.concat(hooks1.calendarInteractions),\n        componentInteractions: hooks0.componentInteractions.concat(hooks1.componentInteractions),\n        themeClasses: __assign(__assign({}, hooks0.themeClasses), hooks1.themeClasses),\n        eventSourceDefs: hooks0.eventSourceDefs.concat(hooks1.eventSourceDefs),\n        cmdFormatter: hooks1.cmdFormatter || hooks0.cmdFormatter,\n        recurringTypes: hooks0.recurringTypes.concat(hooks1.recurringTypes),\n        namedTimeZonedImpl: hooks1.namedTimeZonedImpl || hooks0.namedTimeZonedImpl,\n        initialView: hooks0.initialView || hooks1.initialView,\n        elementDraggingImpl: hooks0.elementDraggingImpl || hooks1.elementDraggingImpl,\n        optionChangeHandlers: __assign(__assign({}, hooks0.optionChangeHandlers), hooks1.optionChangeHandlers),\n        scrollGridImpl: hooks1.scrollGridImpl || hooks0.scrollGridImpl,\n        contentTypeHandlers: __assign(__assign({}, hooks0.contentTypeHandlers), hooks1.contentTypeHandlers),\n        listenerRefiners: __assign(__assign({}, hooks0.listenerRefiners), hooks1.listenerRefiners),\n        optionRefiners: __assign(__assign({}, hooks0.optionRefiners), hooks1.optionRefiners),\n        propSetHandlers: __assign(__assign({}, hooks0.propSetHandlers), hooks1.propSetHandlers)\n    };\n}\n\nvar StandardTheme = /** @class */ (function (_super) {\n    __extends(StandardTheme, _super);\n    function StandardTheme() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return StandardTheme;\n}(Theme));\nStandardTheme.prototype.classes = {\n    root: 'fc-theme-standard',\n    tableCellShaded: 'fc-cell-shaded',\n    buttonGroup: 'fc-button-group',\n    button: 'fc-button fc-button-primary',\n    buttonActive: 'fc-button-active'\n};\nStandardTheme.prototype.baseIconClass = 'fc-icon';\nStandardTheme.prototype.iconClasses = {\n    close: 'fc-icon-x',\n    prev: 'fc-icon-chevron-left',\n    next: 'fc-icon-chevron-right',\n    prevYear: 'fc-icon-chevrons-left',\n    nextYear: 'fc-icon-chevrons-right'\n};\nStandardTheme.prototype.rtlIconClasses = {\n    prev: 'fc-icon-chevron-right',\n    next: 'fc-icon-chevron-left',\n    prevYear: 'fc-icon-chevrons-right',\n    nextYear: 'fc-icon-chevrons-left'\n};\nStandardTheme.prototype.iconOverrideOption = 'buttonIcons'; // TODO: make TS-friendly\nStandardTheme.prototype.iconOverrideCustomButtonOption = 'icon';\nStandardTheme.prototype.iconOverridePrefix = 'fc-icon-';\n\nfunction compileViewDefs(defaultConfigs, overrideConfigs) {\n    var hash = {};\n    var viewType;\n    for (viewType in defaultConfigs) {\n        ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n    for (viewType in overrideConfigs) {\n        ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n    return hash;\n}\nfunction ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    if (hash[viewType]) {\n        return hash[viewType];\n    }\n    var viewDef = buildViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    if (viewDef) {\n        hash[viewType] = viewDef;\n    }\n    return viewDef;\n}\nfunction buildViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    var defaultConfig = defaultConfigs[viewType];\n    var overrideConfig = overrideConfigs[viewType];\n    var queryProp = function (name) {\n        return (defaultConfig && defaultConfig[name] !== null) ? defaultConfig[name] :\n            ((overrideConfig && overrideConfig[name] !== null) ? overrideConfig[name] : null);\n    };\n    var theComponent = queryProp('component');\n    var superType = queryProp('superType');\n    var superDef = null;\n    if (superType) {\n        if (superType === viewType) {\n            throw new Error('Can\\'t have a custom view type that references itself');\n        }\n        superDef = ensureViewDef(superType, hash, defaultConfigs, overrideConfigs);\n    }\n    if (!theComponent && superDef) {\n        theComponent = superDef.component;\n    }\n    if (!theComponent) {\n        return null; // don't throw a warning, might be settings for a single-unit view\n    }\n    return {\n        type: viewType,\n        component: theComponent,\n        defaults: __assign(__assign({}, (superDef ? superDef.defaults : {})), (defaultConfig ? defaultConfig.rawOptions : {})),\n        overrides: __assign(__assign({}, (superDef ? superDef.overrides : {})), (overrideConfig ? overrideConfig.rawOptions : {}))\n    };\n}\n\n// NOTE: in JSX, you should always use this class with <HookProps> arg. otherwise, will default to any???\nvar RenderHook = /** @class */ (function (_super) {\n    __extends(RenderHook, _super);\n    function RenderHook() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.rootElRef = createRef();\n        _this.handleRootEl = function (el) {\n            setRef(_this.rootElRef, el);\n            if (_this.props.elRef) {\n                setRef(_this.props.elRef, el);\n            }\n        };\n        return _this;\n    }\n    RenderHook.prototype.render = function () {\n        var _this = this;\n        var props = this.props;\n        var hookProps = props.hookProps;\n        return (createElement(MountHook, { hookProps: hookProps, didMount: props.didMount, willUnmount: props.willUnmount, elRef: this.handleRootEl }, function (rootElRef) { return (createElement(ContentHook, { hookProps: hookProps, content: props.content, defaultContent: props.defaultContent, backupElRef: _this.rootElRef }, function (innerElRef, innerContent) { return props.children(rootElRef, normalizeClassNames(props.classNames, hookProps), innerElRef, innerContent); })); }));\n    };\n    return RenderHook;\n}(BaseComponent));\n// for forcing rerender of components that use the ContentHook\nvar CustomContentRenderContext = createContext(0);\nfunction ContentHook(props) {\n    return (createElement(CustomContentRenderContext.Consumer, null, function (renderId) { return (createElement(ContentHookInner, __assign({ renderId: renderId }, props))); }));\n}\nvar ContentHookInner = /** @class */ (function (_super) {\n    __extends(ContentHookInner, _super);\n    function ContentHookInner() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.innerElRef = createRef();\n        return _this;\n    }\n    ContentHookInner.prototype.render = function () {\n        return this.props.children(this.innerElRef, this.renderInnerContent());\n    };\n    ContentHookInner.prototype.componentDidMount = function () {\n        this.updateCustomContent();\n    };\n    ContentHookInner.prototype.componentDidUpdate = function () {\n        this.updateCustomContent();\n    };\n    ContentHookInner.prototype.renderInnerContent = function () {\n        var contentTypeHandlers = this.context.pluginHooks.contentTypeHandlers;\n        var _a = this, props = _a.props, customContentInfo = _a.customContentInfo;\n        var rawVal = props.content;\n        var innerContent = normalizeContent(rawVal, props.hookProps);\n        var innerContentVDom = null;\n        if (innerContent === undefined) { // use the default\n            innerContent = normalizeContent(props.defaultContent, props.hookProps);\n        }\n        if (innerContent !== undefined) { // we allow custom content handlers to return nothing\n            if (customContentInfo) {\n                customContentInfo.contentVal = innerContent[customContentInfo.contentKey];\n            }\n            else if (typeof innerContent === 'object') {\n                // look for a prop that would indicate a custom content handler is needed\n                for (var contentKey in contentTypeHandlers) {\n                    if (innerContent[contentKey] !== undefined) {\n                        customContentInfo = this.customContentInfo = {\n                            contentKey: contentKey,\n                            contentVal: innerContent[contentKey],\n                            handler: contentTypeHandlers[contentKey]()\n                        };\n                        break;\n                    }\n                }\n            }\n            if (customContentInfo) {\n                innerContentVDom = []; // signal that something was specified\n            }\n            else {\n                innerContentVDom = innerContent; // assume a [p]react vdom node. use it\n            }\n        }\n        return innerContentVDom;\n    };\n    ContentHookInner.prototype.updateCustomContent = function () {\n        if (this.customContentInfo) {\n            this.customContentInfo.handler(this.innerElRef.current || this.props.backupElRef.current, // the element to render into\n            this.customContentInfo.contentVal);\n        }\n    };\n    return ContentHookInner;\n}(BaseComponent));\nvar MountHook = /** @class */ (function (_super) {\n    __extends(MountHook, _super);\n    function MountHook() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.handleRootEl = function (rootEl) {\n            _this.rootEl = rootEl;\n            if (_this.props.elRef) {\n                setRef(_this.props.elRef, rootEl);\n            }\n        };\n        return _this;\n    }\n    MountHook.prototype.render = function () {\n        return this.props.children(this.handleRootEl);\n    };\n    MountHook.prototype.componentDidMount = function () {\n        var callback = this.props.didMount;\n        callback && callback(__assign(__assign({}, this.props.hookProps), { el: this.rootEl }));\n    };\n    MountHook.prototype.componentWillUnmount = function () {\n        var callback = this.props.willUnmount;\n        callback && callback(__assign(__assign({}, this.props.hookProps), { el: this.rootEl }));\n    };\n    return MountHook;\n}(BaseComponent));\nfunction buildClassNameNormalizer() {\n    var currentGenerator;\n    var currentHookProps;\n    var currentClassNames = [];\n    return function (generator, hookProps) {\n        if (!currentHookProps || !isPropsEqual(currentHookProps, hookProps) || generator !== currentGenerator) {\n            currentGenerator = generator;\n            currentHookProps = hookProps;\n            currentClassNames = normalizeClassNames(generator, hookProps);\n        }\n        return currentClassNames;\n    };\n}\nfunction normalizeClassNames(classNames, hookProps) {\n    if (typeof classNames === 'function') {\n        classNames = classNames(hookProps);\n    }\n    return parseClassNames(classNames);\n}\nfunction normalizeContent(input, hookProps) {\n    if (typeof input === 'function') {\n        return input(hookProps, createElement); // give the function the vdom-creation func\n    }\n    else {\n        return input;\n    }\n}\n\nvar ViewRoot = /** @class */ (function (_super) {\n    __extends(ViewRoot, _super);\n    function ViewRoot() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.normalizeClassNames = buildClassNameNormalizer();\n        return _this;\n    }\n    ViewRoot.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var options = context.options;\n        var hookProps = { view: context.viewApi };\n        var customClassNames = this.normalizeClassNames(options.viewClassNames, hookProps);\n        return (createElement(MountHook, { hookProps: hookProps, didMount: options.viewDidMount, willUnmount: options.viewWillUnmount, elRef: props.elRef }, function (rootElRef) { return props.children(rootElRef, [\"fc-\" + props.viewSpec.type + \"-view\", 'fc-view'].concat(customClassNames)); }));\n    };\n    return ViewRoot;\n}(BaseComponent));\n\nfunction parseViewConfigs(inputs) {\n    return mapHash(inputs, parseViewConfig);\n}\nfunction parseViewConfig(input) {\n    var rawOptions = typeof input === 'function' ?\n        { component: input } :\n        input;\n    var component = rawOptions.component;\n    if (rawOptions.content) {\n        component = createViewHookComponent(rawOptions);\n        // TODO: remove content/classNames/didMount/etc from options?\n    }\n    return {\n        superType: rawOptions.type,\n        component: component,\n        rawOptions: rawOptions // includes type and component too :(\n    };\n}\nfunction createViewHookComponent(options) {\n    return function (viewProps) {\n        return (createElement(ViewContextType.Consumer, null, function (context) { return (createElement(ViewRoot, { viewSpec: context.viewSpec }, function (rootElRef, viewClassNames) {\n            var hookProps = __assign(__assign({}, viewProps), { nextDayThreshold: context.options.nextDayThreshold });\n            return (createElement(RenderHook, { hookProps: hookProps, classNames: options.classNames, content: options.content, didMount: options.didMount, willUnmount: options.willUnmount, elRef: rootElRef }, function (rootElRef, customClassNames, innerElRef, innerContent) { return (createElement(\"div\", { className: viewClassNames.concat(customClassNames).join(' '), ref: rootElRef }, innerContent)); }));\n        })); }));\n    };\n}\n\nfunction buildViewSpecs(defaultInputs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n    var defaultConfigs = parseViewConfigs(defaultInputs);\n    var overrideConfigs = parseViewConfigs(optionOverrides.views);\n    var viewDefs = compileViewDefs(defaultConfigs, overrideConfigs);\n    return mapHash(viewDefs, function (viewDef) {\n        return buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults);\n    });\n}\nfunction buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n    var durationInput = viewDef.overrides.duration ||\n        viewDef.defaults.duration ||\n        dynamicOptionOverrides.duration ||\n        optionOverrides.duration;\n    var duration = null;\n    var durationUnit = '';\n    var singleUnit = '';\n    var singleUnitOverrides = {};\n    if (durationInput) {\n        duration = createDurationCached(durationInput);\n        if (duration) { // valid?\n            var denom = greatestDurationDenominator(duration);\n            durationUnit = denom.unit;\n            if (denom.value === 1) {\n                singleUnit = durationUnit;\n                singleUnitOverrides = overrideConfigs[durationUnit] ? overrideConfigs[durationUnit].rawOptions : {};\n            }\n        }\n    }\n    var queryButtonText = function (optionsSubset) {\n        var buttonTextMap = optionsSubset.buttonText || {};\n        var buttonTextKey = viewDef.defaults.buttonTextKey;\n        if (buttonTextKey != null && buttonTextMap[buttonTextKey] != null) {\n            return buttonTextMap[buttonTextKey];\n        }\n        if (buttonTextMap[viewDef.type] != null) {\n            return buttonTextMap[viewDef.type];\n        }\n        if (buttonTextMap[singleUnit] != null) {\n            return buttonTextMap[singleUnit];\n        }\n    };\n    return {\n        type: viewDef.type,\n        component: viewDef.component,\n        duration: duration,\n        durationUnit: durationUnit,\n        singleUnit: singleUnit,\n        optionDefaults: viewDef.defaults,\n        optionOverrides: __assign(__assign({}, singleUnitOverrides), viewDef.overrides),\n        buttonTextOverride: queryButtonText(dynamicOptionOverrides) ||\n            queryButtonText(optionOverrides) || // constructor-specified buttonText lookup hash takes precedence\n            viewDef.overrides.buttonText,\n        buttonTextDefault: queryButtonText(localeDefaults) ||\n            viewDef.defaults.buttonText ||\n            queryButtonText(BASE_OPTION_DEFAULTS) ||\n            viewDef.type // fall back to given view name\n    };\n}\n// hack to get memoization working\nvar durationInputMap = {};\nfunction createDurationCached(durationInput) {\n    var json = JSON.stringify(durationInput);\n    var res = durationInputMap[json];\n    if (res === undefined) {\n        res = createDuration(durationInput);\n        durationInputMap[json] = res;\n    }\n    return res;\n}\n\nvar DateProfileGenerator = /** @class */ (function () {\n    function DateProfileGenerator(props) {\n        this.props = props;\n        this.nowDate = getNow(props.nowInput, props.dateEnv);\n        this.initHiddenDays();\n    }\n    /* Date Range Computation\n    ------------------------------------------------------------------------------------------------------------------*/\n    // Builds a structure with info about what the dates/ranges will be for the \"prev\" view.\n    DateProfileGenerator.prototype.buildPrev = function (currentDateProfile, currentDate, forceToValid) {\n        var dateEnv = this.props.dateEnv;\n        var prevDate = dateEnv.subtract(dateEnv.startOf(currentDate, currentDateProfile.currentRangeUnit), // important for start-of-month\n        currentDateProfile.dateIncrement);\n        return this.build(prevDate, -1, forceToValid);\n    };\n    // Builds a structure with info about what the dates/ranges will be for the \"next\" view.\n    DateProfileGenerator.prototype.buildNext = function (currentDateProfile, currentDate, forceToValid) {\n        var dateEnv = this.props.dateEnv;\n        var nextDate = dateEnv.add(dateEnv.startOf(currentDate, currentDateProfile.currentRangeUnit), // important for start-of-month\n        currentDateProfile.dateIncrement);\n        return this.build(nextDate, 1, forceToValid);\n    };\n    // Builds a structure holding dates/ranges for rendering around the given date.\n    // Optional direction param indicates whether the date is being incremented/decremented\n    // from its previous value. decremented = -1, incremented = 1 (default).\n    DateProfileGenerator.prototype.build = function (currentDate, direction, forceToValid) {\n        if (forceToValid === void 0) { forceToValid = true; }\n        var props = this.props;\n        var validRange;\n        var currentInfo;\n        var isRangeAllDay;\n        var renderRange;\n        var activeRange;\n        var isValid;\n        validRange = this.buildValidRange();\n        validRange = this.trimHiddenDays(validRange);\n        if (forceToValid) {\n            currentDate = constrainMarkerToRange(currentDate, validRange);\n        }\n        currentInfo = this.buildCurrentRangeInfo(currentDate, direction);\n        isRangeAllDay = /^(year|month|week|day)$/.test(currentInfo.unit);\n        renderRange = this.buildRenderRange(this.trimHiddenDays(currentInfo.range), currentInfo.unit, isRangeAllDay);\n        renderRange = this.trimHiddenDays(renderRange);\n        activeRange = renderRange;\n        if (!props.showNonCurrentDates) {\n            activeRange = intersectRanges(activeRange, currentInfo.range);\n        }\n        activeRange = this.adjustActiveRange(activeRange);\n        activeRange = intersectRanges(activeRange, validRange); // might return null\n        // it's invalid if the originally requested date is not contained,\n        // or if the range is completely outside of the valid range.\n        isValid = rangesIntersect(currentInfo.range, validRange);\n        return {\n            // constraint for where prev/next operations can go and where events can be dragged/resized to.\n            // an object with optional start and end properties.\n            validRange: validRange,\n            // range the view is formally responsible for.\n            // for example, a month view might have 1st-31st, excluding padded dates\n            currentRange: currentInfo.range,\n            // name of largest unit being displayed, like \"month\" or \"week\"\n            currentRangeUnit: currentInfo.unit,\n            isRangeAllDay: isRangeAllDay,\n            // dates that display events and accept drag-n-drop\n            // will be `null` if no dates accept events\n            activeRange: activeRange,\n            // date range with a rendered skeleton\n            // includes not-active days that need some sort of DOM\n            renderRange: renderRange,\n            // Duration object that denotes the first visible time of any given day\n            slotMinTime: props.slotMinTime,\n            // Duration object that denotes the exclusive visible end time of any given day\n            slotMaxTime: props.slotMaxTime,\n            isValid: isValid,\n            // how far the current date will move for a prev/next operation\n            dateIncrement: this.buildDateIncrement(currentInfo.duration)\n            // pass a fallback (might be null) ^\n        };\n    };\n    // Builds an object with optional start/end properties.\n    // Indicates the minimum/maximum dates to display.\n    // not responsible for trimming hidden days.\n    DateProfileGenerator.prototype.buildValidRange = function () {\n        var input = this.props.validRangeInput;\n        var simpleInput = typeof input === 'function'\n            ? input.call(this.props.calendarApi, this.nowDate)\n            : input;\n        return this.refineRange(simpleInput) ||\n            { start: null, end: null }; // completely open-ended\n    };\n    // Builds a structure with info about the \"current\" range, the range that is\n    // highlighted as being the current month for example.\n    // See build() for a description of `direction`.\n    // Guaranteed to have `range` and `unit` properties. `duration` is optional.\n    DateProfileGenerator.prototype.buildCurrentRangeInfo = function (date, direction) {\n        var props = this.props;\n        var duration = null;\n        var unit = null;\n        var range = null;\n        var dayCount;\n        if (props.duration) {\n            duration = props.duration;\n            unit = props.durationUnit;\n            range = this.buildRangeFromDuration(date, direction, duration, unit);\n        }\n        else if ((dayCount = this.props.dayCount)) {\n            unit = 'day';\n            range = this.buildRangeFromDayCount(date, direction, dayCount);\n        }\n        else if ((range = this.buildCustomVisibleRange(date))) {\n            unit = props.dateEnv.greatestWholeUnit(range.start, range.end).unit;\n        }\n        else {\n            duration = this.getFallbackDuration();\n            unit = greatestDurationDenominator(duration).unit;\n            range = this.buildRangeFromDuration(date, direction, duration, unit);\n        }\n        return { duration: duration, unit: unit, range: range };\n    };\n    DateProfileGenerator.prototype.getFallbackDuration = function () {\n        return createDuration({ day: 1 });\n    };\n    // Returns a new activeRange to have time values (un-ambiguate)\n    // slotMinTime or slotMaxTime causes the range to expand.\n    DateProfileGenerator.prototype.adjustActiveRange = function (range) {\n        var _a = this.props, dateEnv = _a.dateEnv, usesMinMaxTime = _a.usesMinMaxTime, slotMinTime = _a.slotMinTime, slotMaxTime = _a.slotMaxTime;\n        var start = range.start;\n        var end = range.end;\n        if (usesMinMaxTime) {\n            // expand active range if slotMinTime is negative (why not when positive?)\n            if (asRoughDays(slotMinTime) < 0) {\n                start = startOfDay(start); // necessary?\n                start = dateEnv.add(start, slotMinTime);\n            }\n            // expand active range if slotMaxTime is beyond one day (why not when negative?)\n            if (asRoughDays(slotMaxTime) > 1) {\n                end = startOfDay(end); // necessary?\n                end = addDays(end, -1);\n                end = dateEnv.add(end, slotMaxTime);\n            }\n        }\n        return { start: start, end: end };\n    };\n    // Builds the \"current\" range when it is specified as an explicit duration.\n    // `unit` is the already-computed greatestDurationDenominator unit of duration.\n    DateProfileGenerator.prototype.buildRangeFromDuration = function (date, direction, duration, unit) {\n        var _a = this.props, dateEnv = _a.dateEnv, dateAlignment = _a.dateAlignment;\n        var start;\n        var end;\n        var res;\n        // compute what the alignment should be\n        if (!dateAlignment) {\n            var dateIncrement = this.props.dateIncrement;\n            if (dateIncrement) {\n                // use the smaller of the two units\n                if (asRoughMs(dateIncrement) < asRoughMs(duration)) {\n                    dateAlignment = greatestDurationDenominator(dateIncrement).unit;\n                }\n                else {\n                    dateAlignment = unit;\n                }\n            }\n            else {\n                dateAlignment = unit;\n            }\n        }\n        // if the view displays a single day or smaller\n        if (asRoughDays(duration) <= 1) {\n            if (this.isHiddenDay(start)) {\n                start = this.skipHiddenDays(start, direction);\n                start = startOfDay(start);\n            }\n        }\n        function computeRes() {\n            start = dateEnv.startOf(date, dateAlignment);\n            end = dateEnv.add(start, duration);\n            res = { start: start, end: end };\n        }\n        computeRes();\n        // if range is completely enveloped by hidden days, go past the hidden days\n        if (!this.trimHiddenDays(res)) {\n            date = this.skipHiddenDays(date, direction);\n            computeRes();\n        }\n        return res;\n    };\n    // Builds the \"current\" range when a dayCount is specified.\n    DateProfileGenerator.prototype.buildRangeFromDayCount = function (date, direction, dayCount) {\n        var _a = this.props, dateEnv = _a.dateEnv, dateAlignment = _a.dateAlignment;\n        var runningCount = 0;\n        var start = date;\n        var end;\n        if (dateAlignment) {\n            start = dateEnv.startOf(start, dateAlignment);\n        }\n        start = startOfDay(start);\n        start = this.skipHiddenDays(start, direction);\n        end = start;\n        do {\n            end = addDays(end, 1);\n            if (!this.isHiddenDay(end)) {\n                runningCount++;\n            }\n        } while (runningCount < dayCount);\n        return { start: start, end: end };\n    };\n    // Builds a normalized range object for the \"visible\" range,\n    // which is a way to define the currentRange and activeRange at the same time.\n    DateProfileGenerator.prototype.buildCustomVisibleRange = function (date) {\n        var props = this.props;\n        var input = props.visibleRangeInput;\n        var simpleInput = typeof input === 'function'\n            ? input.call(props.calendarApi, props.dateEnv.toDate(date))\n            : input;\n        var range = this.refineRange(simpleInput);\n        if (range && (range.start == null || range.end == null)) {\n            return null;\n        }\n        return range;\n    };\n    // Computes the range that will represent the element/cells for *rendering*,\n    // but which may have voided days/times.\n    // not responsible for trimming hidden days.\n    DateProfileGenerator.prototype.buildRenderRange = function (currentRange, currentRangeUnit, isRangeAllDay) {\n        return currentRange;\n    };\n    // Compute the duration value that should be added/substracted to the current date\n    // when a prev/next operation happens.\n    DateProfileGenerator.prototype.buildDateIncrement = function (fallback) {\n        var dateIncrement = this.props.dateIncrement;\n        var customAlignment;\n        if (dateIncrement) {\n            return dateIncrement;\n        }\n        else if ((customAlignment = this.props.dateAlignment)) {\n            return createDuration(1, customAlignment);\n        }\n        else if (fallback) {\n            return fallback;\n        }\n        else {\n            return createDuration({ days: 1 });\n        }\n    };\n    DateProfileGenerator.prototype.refineRange = function (rangeInput) {\n        if (rangeInput) {\n            var range = parseRange(rangeInput, this.props.dateEnv);\n            if (range) {\n                range = computeVisibleDayRange(range);\n            }\n            return range;\n        }\n        return null;\n    };\n    /* Hidden Days\n    ------------------------------------------------------------------------------------------------------------------*/\n    // Initializes internal variables related to calculating hidden days-of-week\n    DateProfileGenerator.prototype.initHiddenDays = function () {\n        var hiddenDays = this.props.hiddenDays || []; // array of day-of-week indices that are hidden\n        var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n        var dayCnt = 0;\n        var i;\n        if (this.props.weekends === false) {\n            hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n        }\n        for (i = 0; i < 7; i++) {\n            if (!(isHiddenDayHash[i] = hiddenDays.indexOf(i) !== -1)) {\n                dayCnt++;\n            }\n        }\n        if (!dayCnt) {\n            throw new Error('invalid hiddenDays'); // all days were hidden? bad.\n        }\n        this.isHiddenDayHash = isHiddenDayHash;\n    };\n    // Remove days from the beginning and end of the range that are computed as hidden.\n    // If the whole range is trimmed off, returns null\n    DateProfileGenerator.prototype.trimHiddenDays = function (range) {\n        var start = range.start;\n        var end = range.end;\n        if (start) {\n            start = this.skipHiddenDays(start);\n        }\n        if (end) {\n            end = this.skipHiddenDays(end, -1, true);\n        }\n        if (start == null || end == null || start < end) {\n            return { start: start, end: end };\n        }\n        return null;\n    };\n    // Is the current day hidden?\n    // `day` is a day-of-week index (0-6), or a Date (used for UTC)\n    DateProfileGenerator.prototype.isHiddenDay = function (day) {\n        if (day instanceof Date) {\n            day = day.getUTCDay();\n        }\n        return this.isHiddenDayHash[day];\n    };\n    // Incrementing the current day until it is no longer a hidden day, returning a copy.\n    // DOES NOT CONSIDER validRange!\n    // If the initial value of `date` is not a hidden day, don't do anything.\n    // Pass `isExclusive` as `true` if you are dealing with an end date.\n    // `inc` defaults to `1` (increment one day forward each time)\n    DateProfileGenerator.prototype.skipHiddenDays = function (date, inc, isExclusive) {\n        if (inc === void 0) { inc = 1; }\n        if (isExclusive === void 0) { isExclusive = false; }\n        while (this.isHiddenDayHash[(date.getUTCDay() + (isExclusive ? inc : 0) + 7) % 7]) {\n            date = addDays(date, inc);\n        }\n        return date;\n    };\n    return DateProfileGenerator;\n}());\n\nfunction reduceViewType(viewType, action) {\n    switch (action.type) {\n        case 'CHANGE_VIEW_TYPE':\n            return viewType = action.viewType;\n    }\n    return viewType;\n}\n\nfunction reduceDynamicOptionOverrides(dynamicOptionOverrides, action) {\n    var _a;\n    switch (action.type) {\n        case 'SET_OPTION':\n            return __assign(__assign({}, dynamicOptionOverrides), (_a = {}, _a[action.optionName] = action.rawOptionValue, _a));\n        default:\n            return dynamicOptionOverrides;\n    }\n}\n\nfunction reduceDateProfile(currentDateProfile, action, currentDate, dateProfileGenerator) {\n    var dp;\n    switch (action.type) {\n        case 'CHANGE_VIEW_TYPE':\n            return dateProfileGenerator.build(action.dateMarker || currentDate);\n        case 'CHANGE_DATE':\n            if (!currentDateProfile.activeRange ||\n                !rangeContainsMarker(currentDateProfile.currentRange, action.dateMarker) // don't move if date already in view\n            ) {\n                return dateProfileGenerator.build(action.dateMarker);\n            }\n            break;\n        case 'PREV':\n            dp = dateProfileGenerator.buildPrev(currentDateProfile, currentDate);\n            if (dp.isValid) {\n                return dp;\n            }\n            break;\n        case 'NEXT':\n            dp = dateProfileGenerator.buildNext(currentDateProfile, currentDate);\n            if (dp.isValid) {\n                return dp;\n            }\n            break;\n    }\n    return currentDateProfile;\n}\n\nfunction initEventSources(calendarOptions, dateProfile, context) {\n    var activeRange = dateProfile ? dateProfile.activeRange : null;\n    return addSources({}, parseInitialSources(calendarOptions, context), activeRange, context);\n}\nfunction reduceEventSources(eventSources, action, dateProfile, context) {\n    var activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n    switch (action.type) {\n        case 'ADD_EVENT_SOURCES': // already parsed\n            return addSources(eventSources, action.sources, activeRange, context);\n        case 'REMOVE_EVENT_SOURCE':\n            return removeSource(eventSources, action.sourceId);\n        case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n        case 'NEXT':\n        case 'CHANGE_DATE':\n        case 'CHANGE_VIEW_TYPE':\n            if (dateProfile) {\n                return fetchDirtySources(eventSources, activeRange, context);\n            }\n            else {\n                return eventSources;\n            }\n        case 'FETCH_EVENT_SOURCES':\n            return fetchSourcesByIds(eventSources, action.sourceIds ? // why no type?\n                arrayToHash(action.sourceIds) :\n                excludeStaticSources(eventSources, context), activeRange, context);\n        case 'RECEIVE_EVENTS':\n        case 'RECEIVE_EVENT_ERROR':\n            return receiveResponse(eventSources, action.sourceId, action.fetchId, action.fetchRange);\n        case 'REMOVE_ALL_EVENT_SOURCES':\n            return {};\n        default:\n            return eventSources;\n    }\n}\nfunction reduceEventSourcesNewTimeZone(eventSources, dateProfile, context) {\n    var activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n    return fetchSourcesByIds(eventSources, excludeStaticSources(eventSources, context), activeRange, context);\n}\nfunction computeEventSourceLoadingLevel(eventSources) {\n    var cnt = 0;\n    for (var sourceId in eventSources) {\n        if (eventSources[sourceId].isFetching) {\n            cnt++;\n        }\n    }\n    return cnt;\n}\nfunction addSources(eventSourceHash, sources, fetchRange, context) {\n    var hash = {};\n    for (var _i = 0, sources_1 = sources; _i < sources_1.length; _i++) {\n        var source = sources_1[_i];\n        hash[source.sourceId] = source;\n    }\n    if (fetchRange) {\n        hash = fetchDirtySources(hash, fetchRange, context);\n    }\n    return __assign(__assign({}, eventSourceHash), hash);\n}\nfunction removeSource(eventSourceHash, sourceId) {\n    return filterHash(eventSourceHash, function (eventSource) {\n        return eventSource.sourceId !== sourceId;\n    });\n}\nfunction fetchDirtySources(sourceHash, fetchRange, context) {\n    return fetchSourcesByIds(sourceHash, filterHash(sourceHash, function (eventSource) {\n        return isSourceDirty(eventSource, fetchRange, context);\n    }), fetchRange, context);\n}\nfunction isSourceDirty(eventSource, fetchRange, context) {\n    if (!doesSourceNeedRange(eventSource, context)) {\n        return !eventSource.latestFetchId;\n    }\n    else {\n        return !context.options.lazyFetching ||\n            !eventSource.fetchRange ||\n            eventSource.isFetching || // always cancel outdated in-progress fetches\n            fetchRange.start < eventSource.fetchRange.start ||\n            fetchRange.end > eventSource.fetchRange.end;\n    }\n}\nfunction fetchSourcesByIds(prevSources, sourceIdHash, fetchRange, context) {\n    var nextSources = {};\n    for (var sourceId in prevSources) {\n        var source = prevSources[sourceId];\n        if (sourceIdHash[sourceId]) {\n            nextSources[sourceId] = fetchSource(source, fetchRange, context);\n        }\n        else {\n            nextSources[sourceId] = source;\n        }\n    }\n    return nextSources;\n}\nfunction fetchSource(eventSource, fetchRange, context) {\n    var options = context.options, calendarApi = context.calendarApi;\n    var sourceDef = context.pluginHooks.eventSourceDefs[eventSource.sourceDefId];\n    var fetchId = guid();\n    sourceDef.fetch({\n        eventSource: eventSource,\n        range: fetchRange,\n        context: context\n    }, function (res) {\n        var rawEvents = res.rawEvents;\n        if (options.eventSourceSuccess) {\n            rawEvents = options.eventSourceSuccess.call(calendarApi, rawEvents, res.xhr) || rawEvents;\n        }\n        if (eventSource.success) {\n            rawEvents = eventSource.success.call(calendarApi, rawEvents, res.xhr) || rawEvents;\n        }\n        context.dispatch({\n            type: 'RECEIVE_EVENTS',\n            sourceId: eventSource.sourceId,\n            fetchId: fetchId,\n            fetchRange: fetchRange,\n            rawEvents: rawEvents\n        });\n    }, function (error) {\n        console.warn(error.message, error);\n        if (options.eventSourceFailure) {\n            options.eventSourceFailure.call(calendarApi, error);\n        }\n        if (eventSource.failure) {\n            eventSource.failure(error);\n        }\n        context.dispatch({\n            type: 'RECEIVE_EVENT_ERROR',\n            sourceId: eventSource.sourceId,\n            fetchId: fetchId,\n            fetchRange: fetchRange,\n            error: error\n        });\n    });\n    return __assign(__assign({}, eventSource), { isFetching: true, latestFetchId: fetchId });\n}\nfunction receiveResponse(sourceHash, sourceId, fetchId, fetchRange) {\n    var _a;\n    var eventSource = sourceHash[sourceId];\n    if (eventSource && // not already removed\n        fetchId === eventSource.latestFetchId) {\n        return __assign(__assign({}, sourceHash), (_a = {}, _a[sourceId] = __assign(__assign({}, eventSource), { isFetching: false, fetchRange: fetchRange // also serves as a marker that at least one fetch has completed\n         }), _a));\n    }\n    return sourceHash;\n}\nfunction excludeStaticSources(eventSources, context) {\n    return filterHash(eventSources, function (eventSource) {\n        return doesSourceNeedRange(eventSource, context);\n    });\n}\nfunction parseInitialSources(rawOptions, context) {\n    var refiners = buildEventSourceRefiners(context);\n    var rawSources = [].concat(rawOptions.eventSources || []);\n    var sources = []; // parsed\n    if (rawOptions.initialEvents) {\n        rawSources.unshift(rawOptions.initialEvents);\n    }\n    if (rawOptions.events) {\n        rawSources.unshift(rawOptions.events);\n    }\n    for (var _i = 0, rawSources_1 = rawSources; _i < rawSources_1.length; _i++) {\n        var rawSource = rawSources_1[_i];\n        var source = parseEventSource(rawSource, context, refiners);\n        if (source) {\n            sources.push(source);\n        }\n    }\n    return sources;\n}\nfunction doesSourceNeedRange(eventSource, context) {\n    var defs = context.pluginHooks.eventSourceDefs;\n    return !defs[eventSource.sourceDefId].ignoreRange;\n}\n\nfunction reduceDateSelection(currentSelection, action) {\n    switch (action.type) {\n        case 'UNSELECT_DATES':\n            return null;\n        case 'SELECT_DATES':\n            return action.selection;\n        default:\n            return currentSelection;\n    }\n}\n\nfunction reduceSelectedEvent(currentInstanceId, action) {\n    switch (action.type) {\n        case 'UNSELECT_EVENT':\n            return '';\n        case 'SELECT_EVENT':\n            return action.eventInstanceId;\n        default:\n            return currentInstanceId;\n    }\n}\n\nfunction reduceEventDrag(currentDrag, action) {\n    var newDrag;\n    switch (action.type) {\n        case 'UNSET_EVENT_DRAG':\n            return null;\n        case 'SET_EVENT_DRAG':\n            newDrag = action.state;\n            return {\n                affectedEvents: newDrag.affectedEvents,\n                mutatedEvents: newDrag.mutatedEvents,\n                isEvent: newDrag.isEvent\n            };\n        default:\n            return currentDrag;\n    }\n}\n\nfunction reduceEventResize(currentResize, action) {\n    var newResize;\n    switch (action.type) {\n        case 'UNSET_EVENT_RESIZE':\n            return null;\n        case 'SET_EVENT_RESIZE':\n            newResize = action.state;\n            return {\n                affectedEvents: newResize.affectedEvents,\n                mutatedEvents: newResize.mutatedEvents,\n                isEvent: newResize.isEvent\n            };\n        default:\n            return currentResize;\n    }\n}\n\nfunction parseToolbars(calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) {\n    var viewsWithButtons = [];\n    var headerToolbar = calendarOptions.headerToolbar ? parseToolbar(calendarOptions.headerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi, viewsWithButtons) : null;\n    var footerToolbar = calendarOptions.footerToolbar ? parseToolbar(calendarOptions.footerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi, viewsWithButtons) : null;\n    return { headerToolbar: headerToolbar, footerToolbar: footerToolbar, viewsWithButtons: viewsWithButtons };\n}\nfunction parseToolbar(sectionStrHash, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi, viewsWithButtons // dump side effects\n) {\n    return mapHash(sectionStrHash, function (sectionStr) { return parseSection(sectionStr, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi, viewsWithButtons); });\n}\n/*\nBAD: querying icons and text here. should be done at render time\n*/\nfunction parseSection(sectionStr, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi, viewsWithButtons // dump side effects\n) {\n    var isRtl = calendarOptions.direction === 'rtl';\n    var calendarCustomButtons = calendarOptions.customButtons || {};\n    var calendarButtonTextOverrides = calendarOptionOverrides.buttonText || {};\n    var calendarButtonText = calendarOptions.buttonText || {};\n    var sectionSubstrs = sectionStr ? sectionStr.split(' ') : [];\n    return sectionSubstrs.map(function (buttonGroupStr) {\n        return buttonGroupStr.split(',').map(function (buttonName) {\n            if (buttonName === 'title') {\n                return { buttonName: buttonName };\n            }\n            else {\n                var customButtonProps_1;\n                var viewSpec = void 0;\n                var buttonClick = void 0;\n                var buttonIcon = void 0; // only one of these will be set\n                var buttonText = void 0; // \"\n                if ((customButtonProps_1 = calendarCustomButtons[buttonName])) {\n                    buttonClick = function (ev) {\n                        if (customButtonProps_1.click) {\n                            customButtonProps_1.click.call(ev.target, ev, ev.target);\n                        }\n                    };\n                    (buttonIcon = theme.getCustomButtonIconClass(customButtonProps_1)) ||\n                        (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                        (buttonText = customButtonProps_1.text);\n                }\n                else if ((viewSpec = viewSpecs[buttonName])) {\n                    viewsWithButtons.push(buttonName);\n                    buttonClick = function () {\n                        calendarApi.changeView(buttonName);\n                    };\n                    (buttonText = viewSpec.buttonTextOverride) ||\n                        (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                        (buttonText = viewSpec.buttonTextDefault);\n                }\n                else if (calendarApi[buttonName]) { // a calendarApi method\n                    buttonClick = function () {\n                        calendarApi[buttonName]();\n                    };\n                    (buttonText = calendarButtonTextOverrides[buttonName]) ||\n                        (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                        (buttonText = calendarButtonText[buttonName]);\n                    //            ^ everything else is considered default\n                }\n                return { buttonName: buttonName, buttonClick: buttonClick, buttonIcon: buttonIcon, buttonText: buttonText };\n            }\n        });\n    });\n}\n\nvar eventSourceDef = {\n    ignoreRange: true,\n    parseMeta: function (refined) {\n        if (Array.isArray(refined.events)) {\n            return refined.events;\n        }\n        return null;\n    },\n    fetch: function (arg, success) {\n        success({\n            rawEvents: arg.eventSource.meta\n        });\n    }\n};\nvar arrayEventSourcePlugin = createPlugin({\n    eventSourceDefs: [eventSourceDef]\n});\n\nvar eventSourceDef$1 = {\n    parseMeta: function (refined) {\n        if (typeof refined.events === 'function') {\n            return refined.events;\n        }\n        return null;\n    },\n    fetch: function (arg, success, failure) {\n        var dateEnv = arg.context.dateEnv;\n        var func = arg.eventSource.meta;\n        unpromisify(func.bind(null, buildRangeApiWithTimeZone(arg.range, dateEnv)), function (rawEvents) {\n            success({ rawEvents: rawEvents }); // needs an object response\n        }, failure // send errorObj directly to failure callback\n        );\n    }\n};\nvar funcEventSourcePlugin = createPlugin({\n    eventSourceDefs: [eventSourceDef$1]\n});\n\nfunction requestJson(method, url, params, successCallback, failureCallback) {\n    method = method.toUpperCase();\n    var body = null;\n    if (method === 'GET') {\n        url = injectQueryStringParams(url, params);\n    }\n    else {\n        body = encodeParams(params);\n    }\n    var xhr = new XMLHttpRequest();\n    xhr.open(method, url, true);\n    if (method !== 'GET') {\n        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n    xhr.onload = function () {\n        if (xhr.status >= 200 && xhr.status < 400) {\n            var parsed = false;\n            var res = void 0;\n            try {\n                res = JSON.parse(xhr.responseText);\n                parsed = true;\n            }\n            catch (err) {\n                // will handle parsed=false\n            }\n            if (parsed) {\n                successCallback(res, xhr);\n            }\n            else {\n                failureCallback('Failure parsing JSON', xhr);\n            }\n        }\n        else {\n            failureCallback('Request failed', xhr);\n        }\n    };\n    xhr.onerror = function () {\n        failureCallback('Request failed', xhr);\n    };\n    xhr.send(body);\n}\nfunction injectQueryStringParams(url, params) {\n    return url +\n        (url.indexOf('?') === -1 ? '?' : '&') +\n        encodeParams(params);\n}\nfunction encodeParams(params) {\n    var parts = [];\n    for (var key in params) {\n        parts.push(encodeURIComponent(key) + '=' + encodeURIComponent(params[key]));\n    }\n    return parts.join('&');\n}\n\nvar JSON_FEED_EVENT_SOURCE_REFINERS = {\n    method: String,\n    extraParams: identity,\n    startParam: String,\n    endParam: String,\n    timeZoneParam: String\n};\n\nvar eventSourceDef$2 = {\n    parseMeta: function (refined) {\n        if (refined.url) {\n            return {\n                url: refined.url,\n                method: (refined.method || 'GET').toUpperCase(),\n                extraParams: refined.extraParams,\n                startParam: refined.startParam,\n                endParam: refined.endParam,\n                timeZoneParam: refined.timeZoneParam\n            };\n        }\n        return null;\n    },\n    fetch: function (arg, success, failure) {\n        var meta = arg.eventSource.meta;\n        var requestParams = buildRequestParams(meta, arg.range, arg.context);\n        requestJson(meta.method, meta.url, requestParams, function (rawEvents, xhr) {\n            success({ rawEvents: rawEvents, xhr: xhr });\n        }, function (errorMessage, xhr) {\n            failure({ message: errorMessage, xhr: xhr });\n        });\n    }\n};\nvar jsonFeedEventSourcePlugin = createPlugin({\n    eventSourceRefiners: JSON_FEED_EVENT_SOURCE_REFINERS,\n    eventSourceDefs: [eventSourceDef$2]\n});\nfunction buildRequestParams(meta, range, context) {\n    var dateEnv = context.dateEnv, options = context.options;\n    var startParam;\n    var endParam;\n    var timeZoneParam;\n    var customRequestParams;\n    var params = {};\n    startParam = meta.startParam;\n    if (startParam == null) {\n        startParam = options.startParam;\n    }\n    endParam = meta.endParam;\n    if (endParam == null) {\n        endParam = options.endParam;\n    }\n    timeZoneParam = meta.timeZoneParam;\n    if (timeZoneParam == null) {\n        timeZoneParam = options.timeZoneParam;\n    }\n    // retrieve any outbound GET/POST data from the options\n    if (typeof meta.extraParams === 'function') {\n        // supplied as a function that returns a key/value object\n        customRequestParams = meta.extraParams();\n    }\n    else {\n        // probably supplied as a straight key/value object\n        customRequestParams = meta.extraParams || {};\n    }\n    __assign(params, customRequestParams);\n    params[startParam] = dateEnv.formatIso(range.start);\n    params[endParam] = dateEnv.formatIso(range.end);\n    if (dateEnv.timeZone !== 'local') {\n        params[timeZoneParam] = dateEnv.timeZone;\n    }\n    return params;\n}\n\nvar SIMPLE_RECURRING_REFINERS = {\n    daysOfWeek: identity,\n    startTime: createDuration,\n    endTime: createDuration,\n    duration: createDuration,\n    startRecur: identity,\n    endRecur: identity\n};\n\nvar recurring = {\n    parse: function (refined, dateEnv) {\n        if (refined.daysOfWeek || refined.startTime || refined.endTime || refined.startRecur || refined.endRecur) {\n            var recurringData = {\n                daysOfWeek: refined.daysOfWeek || null,\n                startTime: refined.startTime || null,\n                endTime: refined.endTime || null,\n                startRecur: refined.startRecur ? dateEnv.createMarker(refined.startRecur) : null,\n                endRecur: refined.endRecur ? dateEnv.createMarker(refined.endRecur) : null\n            };\n            var duration = void 0;\n            if (refined.duration) {\n                duration = refined.duration;\n            }\n            if (!duration && refined.startTime && refined.endTime) {\n                duration = subtractDurations(refined.endTime, refined.startTime);\n            }\n            return {\n                allDayGuess: Boolean(!refined.startTime && !refined.endTime),\n                duration: duration,\n                typeData: recurringData // doesn't need endTime anymore but oh well\n            };\n        }\n        return null;\n    },\n    expand: function (typeData, framingRange, dateEnv) {\n        var clippedFramingRange = intersectRanges(framingRange, { start: typeData.startRecur, end: typeData.endRecur });\n        if (clippedFramingRange) {\n            return expandRanges(typeData.daysOfWeek, typeData.startTime, clippedFramingRange, dateEnv);\n        }\n        else {\n            return [];\n        }\n    }\n};\nvar simpleRecurringEventsPlugin = createPlugin({\n    recurringTypes: [recurring],\n    eventRefiners: SIMPLE_RECURRING_REFINERS\n});\nfunction expandRanges(daysOfWeek, startTime, framingRange, dateEnv) {\n    var dowHash = daysOfWeek ? arrayToHash(daysOfWeek) : null;\n    var dayMarker = startOfDay(framingRange.start);\n    var endMarker = framingRange.end;\n    var instanceStarts = [];\n    while (dayMarker < endMarker) {\n        var instanceStart \n        // if everyday, or this particular day-of-week\n        = void 0;\n        // if everyday, or this particular day-of-week\n        if (!dowHash || dowHash[dayMarker.getUTCDay()]) {\n            if (startTime) {\n                instanceStart = dateEnv.add(dayMarker, startTime);\n            }\n            else {\n                instanceStart = dayMarker;\n            }\n            instanceStarts.push(instanceStart);\n        }\n        dayMarker = addDays(dayMarker, 1);\n    }\n    return instanceStarts;\n}\n\nvar changeHandlerPlugin = createPlugin({\n    optionChangeHandlers: {\n        events: function (events, context) {\n            handleEventSources([events], context);\n        },\n        eventSources: handleEventSources\n    }\n});\n/*\nBUG: if `event` was supplied, all previously-given `eventSources` will be wiped out\n*/\nfunction handleEventSources(inputs, context) {\n    var unfoundSources = hashValuesToArray(context.getCurrentData().eventSources);\n    var newInputs = [];\n    for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {\n        var input = inputs_1[_i];\n        var inputFound = false;\n        for (var i = 0; i < unfoundSources.length; i++) {\n            if (unfoundSources[i]._raw === input) {\n                unfoundSources.splice(i, 1); // delete\n                inputFound = true;\n                break;\n            }\n        }\n        if (!inputFound) {\n            newInputs.push(input);\n        }\n    }\n    for (var _a = 0, unfoundSources_1 = unfoundSources; _a < unfoundSources_1.length; _a++) {\n        var unfoundSource = unfoundSources_1[_a];\n        context.dispatch({\n            type: 'REMOVE_EVENT_SOURCE',\n            sourceId: unfoundSource.sourceId\n        });\n    }\n    for (var _b = 0, newInputs_1 = newInputs; _b < newInputs_1.length; _b++) {\n        var newInput = newInputs_1[_b];\n        context.calendarApi.addEventSource(newInput);\n    }\n}\n\nfunction handleDateProfile(dateProfile, context) {\n    context.emitter.trigger('datesSet', __assign(__assign({}, buildRangeApiWithTimeZone(dateProfile.activeRange, context.dateEnv)), { view: context.viewApi }));\n}\n\nfunction handleEventStore(eventStore, context) {\n    var emitter = context.emitter;\n    if (emitter.hasHandlers('eventsSet')) {\n        emitter.trigger('eventsSet', buildEventApis(eventStore, context));\n    }\n}\n\n/*\nthis array is exposed on the root namespace so that UMD plugins can add to it.\nsee the rollup-bundles script.\n*/\nvar globalPlugins = [\n    arrayEventSourcePlugin,\n    funcEventSourcePlugin,\n    jsonFeedEventSourcePlugin,\n    simpleRecurringEventsPlugin,\n    changeHandlerPlugin,\n    createPlugin({\n        contentTypeHandlers: {\n            html: function () { return injectHtml; },\n            domNodes: function () { return injectDomNodes; }\n        },\n        propSetHandlers: {\n            dateProfile: handleDateProfile,\n            eventStore: handleEventStore\n        }\n    })\n];\nfunction injectHtml(el, html) {\n    el.innerHTML = html;\n}\nfunction injectDomNodes(el, domNodes) {\n    var oldNodes = Array.prototype.slice.call(el.childNodes); // TODO: use array util\n    var newNodes = Array.prototype.slice.call(domNodes); // TODO: use array util\n    if (!isArraysEqual(oldNodes, newNodes)) {\n        for (var _i = 0, newNodes_1 = newNodes; _i < newNodes_1.length; _i++) {\n            var newNode = newNodes_1[_i];\n            el.appendChild(newNode);\n        }\n        oldNodes.forEach(removeElement);\n    }\n}\n\nvar DelayedRunner = /** @class */ (function () {\n    function DelayedRunner(drainedOption) {\n        this.drainedOption = drainedOption;\n        this.isRunning = false;\n        this.isDirty = false;\n        this.pauseDepths = {};\n        this.timeoutId = 0;\n    }\n    DelayedRunner.prototype.request = function (delay) {\n        this.isDirty = true;\n        if (!this.isPaused()) {\n            this.clearTimeout();\n            if (delay == null) {\n                this.tryDrain();\n            }\n            else {\n                this.timeoutId = setTimeout(// NOT OPTIMAL! TODO: look at debounce\n                this.tryDrain.bind(this), delay);\n            }\n        }\n    };\n    DelayedRunner.prototype.pause = function (scope) {\n        if (scope === void 0) { scope = ''; }\n        var pauseDepths = this.pauseDepths;\n        pauseDepths[scope] = (pauseDepths[scope] || 0) + 1;\n        this.clearTimeout();\n    };\n    DelayedRunner.prototype.resume = function (scope, force) {\n        if (scope === void 0) { scope = ''; }\n        var pauseDepths = this.pauseDepths;\n        if (scope in pauseDepths) {\n            if (force) {\n                delete pauseDepths[scope];\n            }\n            else {\n                var depth = --pauseDepths[scope];\n                if (depth <= 0) {\n                    delete pauseDepths[scope];\n                }\n            }\n            this.tryDrain();\n        }\n    };\n    DelayedRunner.prototype.isPaused = function () {\n        return Object.keys(this.pauseDepths).length;\n    };\n    DelayedRunner.prototype.tryDrain = function () {\n        if (!this.isRunning && !this.isPaused()) {\n            this.isRunning = true;\n            while (this.isDirty) {\n                this.isDirty = false;\n                this.drained(); // might set isDirty to true again\n            }\n            this.isRunning = false;\n        }\n    };\n    DelayedRunner.prototype.clear = function () {\n        this.clearTimeout();\n        this.isDirty = false;\n        this.pauseDepths = {};\n    };\n    DelayedRunner.prototype.clearTimeout = function () {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n            this.timeoutId = 0;\n        }\n    };\n    DelayedRunner.prototype.drained = function () {\n        if (this.drainedOption) {\n            this.drainedOption();\n        }\n    };\n    return DelayedRunner;\n}());\nvar TaskRunner = /** @class */ (function () {\n    function TaskRunner(runTaskOption, drainedOption) {\n        this.runTaskOption = runTaskOption;\n        this.drainedOption = drainedOption;\n        this.queue = [];\n        this.delayedRunner = new DelayedRunner(this.drain.bind(this));\n    }\n    TaskRunner.prototype.request = function (task, delay) {\n        this.queue.push(task);\n        this.delayedRunner.request(delay);\n    };\n    TaskRunner.prototype.pause = function (scope) {\n        this.delayedRunner.pause(scope);\n    };\n    TaskRunner.prototype.resume = function (scope, force) {\n        this.delayedRunner.resume(scope, force);\n    };\n    TaskRunner.prototype.drain = function () {\n        var queue = this.queue;\n        while (queue.length) {\n            var completedTasks = [];\n            var task = void 0;\n            while ((task = queue.shift())) {\n                this.runTask(task);\n                completedTasks.push(task);\n            }\n            this.drained(completedTasks);\n        } // keep going, in case new tasks were added in the drained handler\n    };\n    TaskRunner.prototype.runTask = function (task) {\n        if (this.runTaskOption) {\n            this.runTaskOption(task);\n        }\n    };\n    TaskRunner.prototype.drained = function (completedTasks) {\n        if (this.drainedOption) {\n            this.drainedOption(completedTasks);\n        }\n    };\n    return TaskRunner;\n}());\n\n// Computes what the title at the top of the calendarApi should be for this view\nfunction buildTitle(dateProfile, viewOptions, dateEnv) {\n    var range;\n    // for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n    if (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n        range = dateProfile.currentRange;\n    }\n    else { // for day units or smaller, use the actual day range\n        range = dateProfile.activeRange;\n    }\n    return dateEnv.formatRange(range.start, range.end, createFormatter(viewOptions.titleFormat || buildTitleFormat(dateProfile)), {\n        isEndExclusive: dateProfile.isRangeAllDay,\n        defaultSeparator: viewOptions.titleRangeSeparator\n    });\n}\n// Generates the format string that should be used to generate the title for the current date range.\n// Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\nfunction buildTitleFormat(dateProfile) {\n    var currentRangeUnit = dateProfile.currentRangeUnit;\n    if (currentRangeUnit === 'year') {\n        return { year: 'numeric' };\n    }\n    else if (currentRangeUnit === 'month') {\n        return { year: 'numeric', month: 'long' }; // like \"September 2014\"\n    }\n    else {\n        var days = diffWholeDays(dateProfile.currentRange.start, dateProfile.currentRange.end);\n        if (days !== null && days > 1) {\n            // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n            return { year: 'numeric', month: 'short', day: 'numeric' };\n        }\n        else {\n            // one day. longer, like \"September 9 2014\"\n            return { year: 'numeric', month: 'long', day: 'numeric' };\n        }\n    }\n}\n\n// in future refactor, do the redux-style function(state=initial) for initial-state\n// also, whatever is happening in constructor, have it happen in action queue too\nvar CalendarDataManager = /** @class */ (function () {\n    function CalendarDataManager(props) {\n        var _this = this;\n        this.computeOptionsData = memoize(this._computeOptionsData);\n        this.computeCurrentViewData = memoize(this._computeCurrentViewData);\n        this.organizeRawLocales = memoize(organizeRawLocales);\n        this.buildLocale = memoize(buildLocale);\n        this.buildPluginHooks = buildBuildPluginHooks();\n        this.buildDateEnv = memoize(buildDateEnv$1);\n        this.buildTheme = memoize(buildTheme);\n        this.parseToolbars = memoize(parseToolbars);\n        this.buildViewSpecs = memoize(buildViewSpecs);\n        this.buildDateProfileGenerator = memoizeObjArg(buildDateProfileGenerator);\n        this.buildViewApi = memoize(buildViewApi);\n        this.buildViewUiProps = memoizeObjArg(buildViewUiProps);\n        this.buildEventUiBySource = memoize(buildEventUiBySource, isPropsEqual);\n        this.buildEventUiBases = memoize(buildEventUiBases);\n        this.parseContextBusinessHours = memoizeObjArg(parseContextBusinessHours);\n        this.buildTitle = memoize(buildTitle);\n        this.emitter = new Emitter();\n        this.actionRunner = new TaskRunner(this._handleAction.bind(this), this.updateData.bind(this));\n        this.currentCalendarOptionsInput = {};\n        this.currentCalendarOptionsRefined = {};\n        this.currentViewOptionsInput = {};\n        this.currentViewOptionsRefined = {};\n        this.currentCalendarOptionsRefiners = {};\n        this.getCurrentData = function () {\n            return _this.data;\n        };\n        this.dispatch = function (action) {\n            _this.actionRunner.request(action); // protects against recursive calls to _handleAction\n        };\n        this.props = props;\n        this.actionRunner.pause();\n        var dynamicOptionOverrides = {};\n        var optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n        var currentViewType = optionsData.calendarOptions.initialView || optionsData.pluginHooks.initialView;\n        var currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides);\n        // wire things up\n        // TODO: not DRY\n        props.calendarApi.currentDataManager = this;\n        this.emitter.setThisContext(props.calendarApi);\n        this.emitter.setOptions(currentViewData.options);\n        var currentDate = getInitialDate(optionsData.calendarOptions, optionsData.dateEnv);\n        var dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n        if (!rangeContainsMarker(dateProfile.activeRange, currentDate)) {\n            currentDate = dateProfile.currentRange.start;\n        }\n        var calendarContext = {\n            dateEnv: optionsData.dateEnv,\n            options: optionsData.calendarOptions,\n            pluginHooks: optionsData.pluginHooks,\n            calendarApi: props.calendarApi,\n            dispatch: this.dispatch,\n            emitter: this.emitter,\n            getCurrentData: this.getCurrentData\n        };\n        // needs to be after setThisContext\n        for (var _i = 0, _a = optionsData.pluginHooks.contextInit; _i < _a.length; _i++) {\n            var callback = _a[_i];\n            callback(calendarContext);\n        }\n        // NOT DRY\n        var eventSources = initEventSources(optionsData.calendarOptions, dateProfile, calendarContext);\n        var initialState = {\n            dynamicOptionOverrides: dynamicOptionOverrides,\n            currentViewType: currentViewType,\n            currentDate: currentDate,\n            dateProfile: dateProfile,\n            businessHours: this.parseContextBusinessHours(calendarContext),\n            eventSources: eventSources,\n            eventUiBases: {},\n            loadingLevel: computeEventSourceLoadingLevel(eventSources),\n            eventStore: createEmptyEventStore(),\n            renderableEventStore: createEmptyEventStore(),\n            dateSelection: null,\n            eventSelection: '',\n            eventDrag: null,\n            eventResize: null,\n            selectionConfig: this.buildViewUiProps(calendarContext).selectionConfig\n        };\n        var contextAndState = __assign(__assign({}, calendarContext), initialState);\n        for (var _b = 0, _c = optionsData.pluginHooks.reducers; _b < _c.length; _b++) {\n            var reducer = _c[_b];\n            __assign(initialState, reducer(null, null, contextAndState));\n        }\n        if (initialState.loadingLevel) {\n            this.emitter.trigger('loading', true); // NOT DRY\n        }\n        this.state = initialState;\n        this.updateData();\n        this.actionRunner.resume();\n    }\n    CalendarDataManager.prototype.resetOptions = function (optionOverrides, append) {\n        var props = this.props;\n        props.optionOverrides = append\n            ? __assign(__assign({}, props.optionOverrides), optionOverrides) : optionOverrides;\n        this.actionRunner.request({\n            type: 'NOTHING'\n        });\n    };\n    CalendarDataManager.prototype._handleAction = function (action) {\n        var _a = this, props = _a.props, state = _a.state, emitter = _a.emitter;\n        var dynamicOptionOverrides = reduceDynamicOptionOverrides(state.dynamicOptionOverrides, action);\n        var optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n        var currentViewType = reduceViewType(state.currentViewType, action);\n        var currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides);\n        // wire things up\n        // TODO: not DRY\n        props.calendarApi.currentDataManager = this;\n        emitter.setThisContext(props.calendarApi);\n        emitter.setOptions(currentViewData.options);\n        var calendarContext = {\n            dateEnv: optionsData.dateEnv,\n            options: optionsData.calendarOptions,\n            pluginHooks: optionsData.pluginHooks,\n            calendarApi: props.calendarApi,\n            dispatch: this.dispatch,\n            emitter: emitter,\n            getCurrentData: this.getCurrentData\n        };\n        var currentDate = state.currentDate;\n        var dateProfile = state.dateProfile;\n        if (this.data && this.data.dateProfileGenerator !== currentViewData.dateProfileGenerator) { // hack\n            dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n        }\n        currentDate = reduceCurrentDate(currentDate, action);\n        dateProfile = reduceDateProfile(dateProfile, action, currentDate, currentViewData.dateProfileGenerator);\n        if (!rangeContainsMarker(dateProfile.currentRange, currentDate)) {\n            currentDate = dateProfile.currentRange.start;\n        }\n        var eventSources = reduceEventSources(state.eventSources, action, dateProfile, calendarContext);\n        var eventSourceLoadingLevel = computeEventSourceLoadingLevel(eventSources);\n        var eventStore = reduceEventStore(state.eventStore, action, eventSources, dateProfile, calendarContext);\n        var renderableEventStore = (eventSourceLoadingLevel && !currentViewData.options.progressiveEventRendering) ?\n            (state.renderableEventStore || eventStore) : // try from previous state\n            eventStore;\n        var _b = this.buildViewUiProps(calendarContext), eventUiSingleBase = _b.eventUiSingleBase, selectionConfig = _b.selectionConfig; // will memoize obj\n        var eventUiBySource = this.buildEventUiBySource(eventSources);\n        var eventUiBases = this.buildEventUiBases(renderableEventStore.defs, eventUiSingleBase, eventUiBySource);\n        var prevLoadingLevel = state.loadingLevel || 0;\n        var loadingLevel = eventSourceLoadingLevel;\n        var newState = {\n            dynamicOptionOverrides: dynamicOptionOverrides,\n            currentViewType: currentViewType,\n            currentDate: currentDate,\n            dateProfile: dateProfile,\n            eventSources: eventSources,\n            eventStore: eventStore,\n            renderableEventStore: renderableEventStore,\n            selectionConfig: selectionConfig,\n            eventUiBases: eventUiBases,\n            loadingLevel: loadingLevel,\n            businessHours: this.parseContextBusinessHours(calendarContext),\n            dateSelection: reduceDateSelection(state.dateSelection, action),\n            eventSelection: reduceSelectedEvent(state.eventSelection, action),\n            eventDrag: reduceEventDrag(state.eventDrag, action),\n            eventResize: reduceEventResize(state.eventResize, action)\n        };\n        var contextAndState = __assign(__assign({}, calendarContext), newState);\n        for (var _i = 0, _c = optionsData.pluginHooks.reducers; _i < _c.length; _i++) {\n            var reducer = _c[_i];\n            __assign(newState, reducer(state, action, contextAndState)); // give the OLD state, for old value\n        }\n        // TODO: use propSetHandlers in plugin system\n        if (!prevLoadingLevel && loadingLevel) {\n            emitter.trigger('loading', true);\n        }\n        else if (prevLoadingLevel && !loadingLevel) {\n            emitter.trigger('loading', false);\n        }\n        this.state = newState;\n        if (props.onAction) {\n            props.onAction(action);\n        }\n    };\n    CalendarDataManager.prototype.updateData = function () {\n        var _a = this, props = _a.props, state = _a.state;\n        var oldData = this.data;\n        var optionsData = this.computeOptionsData(props.optionOverrides, state.dynamicOptionOverrides, props.calendarApi);\n        var currentViewData = this.computeCurrentViewData(state.currentViewType, optionsData, props.optionOverrides, state.dynamicOptionOverrides);\n        var data = this.data = __assign(__assign(__assign({ viewTitle: this.buildTitle(state.dateProfile, currentViewData.options, optionsData.dateEnv), calendarApi: props.calendarApi, dispatch: this.dispatch, emitter: this.emitter, getCurrentData: this.getCurrentData }, optionsData), currentViewData), state);\n        var changeHandlers = optionsData.pluginHooks.optionChangeHandlers;\n        var oldCalendarOptions = oldData && oldData.calendarOptions;\n        var newCalendarOptions = optionsData.calendarOptions;\n        if (oldCalendarOptions && oldCalendarOptions !== newCalendarOptions) {\n            if (oldCalendarOptions.timeZone !== newCalendarOptions.timeZone) {\n                // hack\n                state.eventSources = data.eventSources = reduceEventSourcesNewTimeZone(data.eventSources, state.dateProfile, data);\n                state.eventStore = data.eventStore = rezoneEventStoreDates(data.eventStore, oldData.dateEnv, data.dateEnv);\n            }\n            for (var optionName in changeHandlers) {\n                if (oldCalendarOptions[optionName] !== newCalendarOptions[optionName]) {\n                    changeHandlers[optionName](newCalendarOptions[optionName], data);\n                }\n            }\n        }\n        if (props.onData) {\n            props.onData(data);\n        }\n    };\n    CalendarDataManager.prototype._computeOptionsData = function (optionOverrides, dynamicOptionOverrides, calendarApi) {\n        // TODO: blacklist options that are handled by optionChangeHandlers\n        var _a = this.processRawCalendarOptions(optionOverrides, dynamicOptionOverrides), refinedOptions = _a.refinedOptions, pluginHooks = _a.pluginHooks, localeDefaults = _a.localeDefaults, availableLocaleData = _a.availableLocaleData, extra = _a.extra;\n        warnUnknownOptions(extra);\n        var dateEnv = this.buildDateEnv(refinedOptions.timeZone, refinedOptions.locale, refinedOptions.weekNumberCalculation, refinedOptions.firstDay, refinedOptions.weekText, pluginHooks, availableLocaleData, refinedOptions.defaultRangeSeparator);\n        var viewSpecs = this.buildViewSpecs(pluginHooks.views, optionOverrides, dynamicOptionOverrides, localeDefaults);\n        var theme = this.buildTheme(refinedOptions, pluginHooks);\n        var toolbarConfig = this.parseToolbars(refinedOptions, optionOverrides, theme, viewSpecs, calendarApi);\n        return {\n            calendarOptions: refinedOptions,\n            pluginHooks: pluginHooks,\n            dateEnv: dateEnv,\n            viewSpecs: viewSpecs,\n            theme: theme,\n            toolbarConfig: toolbarConfig,\n            localeDefaults: localeDefaults,\n            availableRawLocales: availableLocaleData.map\n        };\n    };\n    // always called from behind a memoizer\n    CalendarDataManager.prototype.processRawCalendarOptions = function (optionOverrides, dynamicOptionOverrides) {\n        var _a = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            optionOverrides,\n            dynamicOptionOverrides\n        ]), locales = _a.locales, locale = _a.locale;\n        var availableLocaleData = this.organizeRawLocales(locales);\n        var availableRawLocales = availableLocaleData.map;\n        var localeDefaults = this.buildLocale(locale || availableLocaleData.defaultCode, availableRawLocales).options;\n        var pluginHooks = this.buildPluginHooks(optionOverrides.plugins || [], globalPlugins);\n        var refiners = this.currentCalendarOptionsRefiners = __assign(__assign(__assign(__assign(__assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n        var extra = {};\n        var raw = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            localeDefaults,\n            optionOverrides,\n            dynamicOptionOverrides\n        ]);\n        var refined = {};\n        var currentRaw = this.currentCalendarOptionsInput;\n        var currentRefined = this.currentCalendarOptionsRefined;\n        var anyChanges = false;\n        for (var optionName in raw) {\n            if (optionName !== 'plugins') { // because plugins is special-cased\n                if (raw[optionName] === currentRaw[optionName] ||\n                    (COMPLEX_OPTION_COMPARATORS[optionName] && (optionName in currentRaw) && COMPLEX_OPTION_COMPARATORS[optionName](currentRaw[optionName], raw[optionName]))) {\n                    refined[optionName] = currentRefined[optionName];\n                }\n                else if (refiners[optionName]) {\n                    refined[optionName] = refiners[optionName](raw[optionName]);\n                    anyChanges = true;\n                }\n                else {\n                    extra[optionName] = currentRaw[optionName];\n                }\n            }\n        }\n        if (anyChanges) {\n            this.currentCalendarOptionsInput = raw;\n            this.currentCalendarOptionsRefined = refined;\n        }\n        return {\n            rawOptions: this.currentCalendarOptionsInput,\n            refinedOptions: this.currentCalendarOptionsRefined,\n            pluginHooks: pluginHooks,\n            availableLocaleData: availableLocaleData,\n            localeDefaults: localeDefaults,\n            extra: extra\n        };\n    };\n    CalendarDataManager.prototype._computeCurrentViewData = function (viewType, optionsData, optionOverrides, dynamicOptionOverrides) {\n        var viewSpec = optionsData.viewSpecs[viewType];\n        if (!viewSpec) {\n            throw new Error(\"viewType \\\"\" + viewType + \"\\\" is not available. Please make sure you've loaded all neccessary plugins\");\n        }\n        var _a = this.processRawViewOptions(viewSpec, optionsData.pluginHooks, optionsData.localeDefaults, optionOverrides, dynamicOptionOverrides), refinedOptions = _a.refinedOptions, extra = _a.extra;\n        warnUnknownOptions(extra);\n        var dateProfileGenerator = this.buildDateProfileGenerator({\n            dateProfileGeneratorClass: viewSpec.optionDefaults.dateProfileGeneratorClass,\n            duration: viewSpec.duration,\n            durationUnit: viewSpec.durationUnit,\n            usesMinMaxTime: viewSpec.optionDefaults.usesMinMaxTime,\n            dateEnv: optionsData.dateEnv,\n            calendarApi: this.props.calendarApi,\n            slotMinTime: refinedOptions.slotMinTime,\n            slotMaxTime: refinedOptions.slotMaxTime,\n            showNonCurrentDates: refinedOptions.showNonCurrentDates,\n            dayCount: refinedOptions.dayCount,\n            dateAlignment: refinedOptions.dateAlignment,\n            dateIncrement: refinedOptions.dateIncrement,\n            hiddenDays: refinedOptions.hiddenDays,\n            weekends: refinedOptions.weekends,\n            nowInput: refinedOptions.now,\n            validRangeInput: refinedOptions.validRange,\n            visibleRangeInput: refinedOptions.visibleRange,\n            monthMode: refinedOptions.monthMode,\n            fixedWeekCount: refinedOptions.fixedWeekCount\n        });\n        var viewApi = this.buildViewApi(viewType, this.getCurrentData, optionsData.dateEnv);\n        return { viewSpec: viewSpec, options: refinedOptions, dateProfileGenerator: dateProfileGenerator, viewApi: viewApi };\n    };\n    CalendarDataManager.prototype.processRawViewOptions = function (viewSpec, pluginHooks, localeDefaults, optionOverrides, dynamicOptionOverrides) {\n        var raw = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            viewSpec.optionDefaults,\n            localeDefaults,\n            optionOverrides,\n            viewSpec.optionOverrides,\n            dynamicOptionOverrides\n        ]);\n        var refiners = __assign(__assign(__assign(__assign(__assign(__assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), VIEW_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n        var refined = {};\n        var currentRaw = this.currentViewOptionsInput;\n        var currentRefined = this.currentViewOptionsRefined;\n        var anyChanges = false;\n        var extra = {};\n        for (var optionName in raw) {\n            if (raw[optionName] === currentRaw[optionName]) {\n                refined[optionName] = currentRefined[optionName];\n            }\n            else {\n                if (raw[optionName] === this.currentCalendarOptionsInput[optionName]) {\n                    if (optionName in this.currentCalendarOptionsRefined) { // might be an \"extra\" prop\n                        refined[optionName] = this.currentCalendarOptionsRefined[optionName];\n                    }\n                }\n                else if (refiners[optionName]) {\n                    refined[optionName] = refiners[optionName](raw[optionName]);\n                }\n                else {\n                    extra[optionName] = raw[optionName];\n                }\n                anyChanges = true;\n            }\n        }\n        if (anyChanges) {\n            this.currentViewOptionsInput = raw;\n            this.currentViewOptionsRefined = refined;\n        }\n        return {\n            rawOptions: this.currentViewOptionsInput,\n            refinedOptions: this.currentViewOptionsRefined,\n            extra: extra\n        };\n    };\n    return CalendarDataManager;\n}());\nfunction buildDateEnv$1(timeZone, explicitLocale, weekNumberCalculation, firstDay, weekText, pluginHooks, availableLocaleData, defaultSeparator) {\n    var locale = buildLocale(explicitLocale || availableLocaleData.defaultCode, availableLocaleData.map);\n    return new DateEnv({\n        calendarSystem: 'gregory',\n        timeZone: timeZone,\n        namedTimeZoneImpl: pluginHooks.namedTimeZonedImpl,\n        locale: locale,\n        weekNumberCalculation: weekNumberCalculation,\n        firstDay: firstDay,\n        weekText: weekText,\n        cmdFormatter: pluginHooks.cmdFormatter,\n        defaultSeparator: defaultSeparator\n    });\n}\nfunction buildTheme(options, pluginHooks) {\n    var ThemeClass = pluginHooks.themeClasses[options.themeSystem] || StandardTheme;\n    return new ThemeClass(options);\n}\nfunction buildDateProfileGenerator(props) {\n    var DateProfileGeneratorClass = props.dateProfileGeneratorClass || DateProfileGenerator;\n    return new DateProfileGeneratorClass(props);\n}\nfunction buildViewApi(type, getCurrentData, dateEnv) {\n    return new ViewApi(type, getCurrentData, dateEnv);\n}\nfunction buildEventUiBySource(eventSources) {\n    return mapHash(eventSources, function (eventSource) {\n        return eventSource.ui;\n    });\n}\nfunction buildEventUiBases(eventDefs, eventUiSingleBase, eventUiBySource) {\n    var eventUiBases = { '': eventUiSingleBase };\n    for (var defId in eventDefs) {\n        var def = eventDefs[defId];\n        if (def.sourceId && eventUiBySource[def.sourceId]) {\n            eventUiBases[defId] = eventUiBySource[def.sourceId];\n        }\n    }\n    return eventUiBases;\n}\nfunction buildViewUiProps(calendarContext) {\n    var options = calendarContext.options;\n    return {\n        eventUiSingleBase: createEventUi({\n            display: options.eventDisplay,\n            editable: options.editable,\n            startEditable: options.eventStartEditable,\n            durationEditable: options.eventDurationEditable,\n            constraint: options.eventConstraint,\n            overlap: typeof options.eventOverlap === 'boolean' ? options.eventOverlap : undefined,\n            allow: options.eventAllow,\n            backgroundColor: options.eventBackgroundColor,\n            borderColor: options.eventBorderColor,\n            textColor: options.eventTextColor,\n            color: options.eventColor\n            // classNames: options.eventClassNames // render hook will handle this\n        }, calendarContext),\n        selectionConfig: createEventUi({\n            constraint: options.selectConstraint,\n            overlap: typeof options.selectOverlap === 'boolean' ? options.selectOverlap : undefined,\n            allow: options.selectAllow\n        }, calendarContext)\n    };\n}\nfunction parseContextBusinessHours(calendarContext) {\n    return parseBusinessHours(calendarContext.options.businessHours, calendarContext);\n}\nfunction warnUnknownOptions(options, viewName) {\n    for (var optionName in options) {\n        console.warn(\"Unknown option '\" + optionName + \"'\" +\n            (viewName ? \" for view '\" + viewName + \"'\" : ''));\n    }\n}\n\n// TODO: move this to react plugin?\nvar CalendarDataProvider = /** @class */ (function (_super) {\n    __extends(CalendarDataProvider, _super);\n    function CalendarDataProvider(props) {\n        var _this = _super.call(this, props) || this;\n        _this.handleData = function (data) {\n            if (!_this.dataManager) { // still within initial run, before assignment in constructor\n                // eslint-disable-next-line react/no-direct-mutation-state\n                _this.state = data; // can't use setState yet\n            }\n            else {\n                _this.setState(data);\n            }\n        };\n        _this.dataManager = new CalendarDataManager({\n            optionOverrides: props.optionOverrides,\n            calendarApi: props.calendarApi,\n            onData: _this.handleData\n        });\n        return _this;\n    }\n    CalendarDataProvider.prototype.render = function () {\n        return this.props.children(this.state);\n    };\n    CalendarDataProvider.prototype.componentDidUpdate = function (prevProps) {\n        var newOptionOverrides = this.props.optionOverrides;\n        if (newOptionOverrides !== prevProps.optionOverrides) { // prevent recursive handleData\n            this.dataManager.resetOptions(newOptionOverrides);\n        }\n    };\n    return CalendarDataProvider;\n}(Component));\n\n// HELPERS\n/*\nif nextDayThreshold is specified, slicing is done in an all-day fashion.\nyou can get nextDayThreshold from context.nextDayThreshold\n*/\nfunction sliceEvents(props, allDay) {\n    return sliceEventStore(props.eventStore, props.eventUiBases, props.dateProfile.activeRange, allDay ? props.nextDayThreshold : null).fg;\n}\n\nvar NamedTimeZoneImpl = /** @class */ (function () {\n    function NamedTimeZoneImpl(timeZoneName) {\n        this.timeZoneName = timeZoneName;\n    }\n    return NamedTimeZoneImpl;\n}());\n\nvar Interaction = /** @class */ (function () {\n    function Interaction(settings) {\n        this.component = settings.component;\n    }\n    Interaction.prototype.destroy = function () {\n    };\n    return Interaction;\n}());\nfunction parseInteractionSettings(component, input) {\n    return {\n        component: component,\n        el: input.el,\n        useEventCenter: input.useEventCenter != null ? input.useEventCenter : true\n    };\n}\nfunction interactionSettingsToStore(settings) {\n    var _a;\n    return _a = {},\n        _a[settings.component.uid] = settings,\n        _a;\n}\n// global state\nvar interactionSettingsStore = {};\n\n/*\nAn abstraction for a dragging interaction originating on an event.\nDoes higher-level things than PointerDragger, such as possibly:\n- a \"mirror\" that moves with the pointer\n- a minimum number of pixels or other criteria for a true drag to begin\n\nsubclasses must emit:\n- pointerdown\n- dragstart\n- dragmove\n- pointerup\n- dragend\n*/\nvar ElementDragging = /** @class */ (function () {\n    function ElementDragging(el, selector) {\n        this.emitter = new Emitter();\n    }\n    ElementDragging.prototype.destroy = function () {\n    };\n    ElementDragging.prototype.setMirrorIsVisible = function (bool) {\n        // optional if subclass doesn't want to support a mirror\n    };\n    ElementDragging.prototype.setMirrorNeedsRevert = function (bool) {\n        // optional if subclass doesn't want to support a mirror\n    };\n    ElementDragging.prototype.setAutoScrollEnabled = function (bool) {\n        // optional\n    };\n    return ElementDragging;\n}());\n\n// TODO: get rid of this in favor of options system,\n// tho it's really easy to access this globally rather than pass thru options.\nvar config = {};\n\n/*\nInformation about what will happen when an external element is dragged-and-dropped\nonto a calendar. Contains information for creating an event.\n*/\nvar DRAG_META_REFINERS = {\n    startTime: createDuration,\n    duration: createDuration,\n    create: Boolean,\n    sourceId: String\n};\nfunction parseDragMeta(raw) {\n    var _a = refineProps(raw, DRAG_META_REFINERS), refined = _a.refined, extra = _a.extra;\n    return {\n        startTime: refined.startTime || null,\n        duration: refined.duration || null,\n        create: refined.create != null ? refined.create : true,\n        sourceId: refined.sourceId,\n        leftoverProps: extra\n    };\n}\n\nvar Toolbar = /** @class */ (function (_super) {\n    __extends(Toolbar, _super);\n    function Toolbar() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Toolbar.prototype.render = function () {\n        var _a = this.props, model = _a.model, extraClassName = _a.extraClassName;\n        var forceLtr = false;\n        var startContent, endContent;\n        var centerContent = model.center;\n        if (model.left) {\n            forceLtr = true;\n            startContent = model.left;\n        }\n        else {\n            startContent = model.start;\n        }\n        if (model.right) {\n            forceLtr = true;\n            endContent = model.right;\n        }\n        else {\n            endContent = model.end;\n        }\n        var classNames = [\n            extraClassName || '',\n            'fc-toolbar',\n            forceLtr ? 'fc-toolbar-ltr' : ''\n        ];\n        return (createElement(\"div\", { className: classNames.join(' ') },\n            this.renderSection('start', startContent || []),\n            this.renderSection('center', centerContent || []),\n            this.renderSection('end', endContent || [])));\n    };\n    Toolbar.prototype.renderSection = function (key, widgetGroups) {\n        var props = this.props;\n        return (createElement(ToolbarSection, { key: key, widgetGroups: widgetGroups, title: props.title, activeButton: props.activeButton, isTodayEnabled: props.isTodayEnabled, isPrevEnabled: props.isPrevEnabled, isNextEnabled: props.isNextEnabled }));\n    };\n    return Toolbar;\n}(BaseComponent));\nvar ToolbarSection = /** @class */ (function (_super) {\n    __extends(ToolbarSection, _super);\n    function ToolbarSection() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ToolbarSection.prototype.render = function () {\n        var _this = this;\n        var children = this.props.widgetGroups.map(function (widgetGroup) { return _this.renderWidgetGroup(widgetGroup); });\n        return createElement.apply(void 0, __spreadArrays(['div', { className: 'fc-toolbar-chunk' }], children));\n    };\n    ToolbarSection.prototype.renderWidgetGroup = function (widgetGroup) {\n        var props = this.props;\n        var theme = this.context.theme;\n        var children = [];\n        var isOnlyButtons = true;\n        for (var _i = 0, widgetGroup_1 = widgetGroup; _i < widgetGroup_1.length; _i++) {\n            var widget = widgetGroup_1[_i];\n            var buttonName = widget.buttonName, buttonClick = widget.buttonClick, buttonText = widget.buttonText, buttonIcon = widget.buttonIcon;\n            if (buttonName === 'title') {\n                isOnlyButtons = false;\n                children.push(createElement(\"h2\", { className: 'fc-toolbar-title' }, props.title));\n            }\n            else {\n                var ariaAttrs = buttonIcon ? { 'aria-label': buttonName } : {};\n                var buttonClasses = ['fc-' + buttonName + '-button', theme.getClass('button')];\n                if (buttonName === props.activeButton) {\n                    buttonClasses.push(theme.getClass('buttonActive'));\n                }\n                var isDisabled = (!props.isTodayEnabled && buttonName === 'today') ||\n                    (!props.isPrevEnabled && buttonName === 'prev') ||\n                    (!props.isNextEnabled && buttonName === 'next');\n                children.push(createElement(\"button\", __assign({ disabled: isDisabled, className: buttonClasses.join(' '), onClick: buttonClick, type: 'button' }, ariaAttrs), buttonText || (buttonIcon ? createElement(\"span\", { className: buttonIcon }) : '')));\n            }\n        }\n        if (children.length > 1) {\n            var groupClassName = (isOnlyButtons && theme.getClass('buttonGroup')) || '';\n            return createElement.apply(void 0, __spreadArrays(['div', { className: groupClassName }], children));\n        }\n        else {\n            return children[0];\n        }\n    };\n    return ToolbarSection;\n}(BaseComponent));\n\n// TODO: do function component?\nvar ViewContainer = /** @class */ (function (_super) {\n    __extends(ViewContainer, _super);\n    function ViewContainer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            availableWidth: null\n        };\n        _this.handleEl = function (el) {\n            _this.el = el;\n            setRef(_this.props.elRef, el);\n            _this.updateAvailableWidth();\n        };\n        _this.handleResize = function () {\n            _this.updateAvailableWidth();\n        };\n        return _this;\n    }\n    ViewContainer.prototype.render = function () {\n        var _a = this, props = _a.props, state = _a.state;\n        var aspectRatio = props.aspectRatio;\n        var classNames = [\n            'fc-view-harness',\n            (aspectRatio || props.liquid || props.height)\n                ? 'fc-view-harness-active' // harness controls the height\n                : 'fc-view-harness-passive' // let the view do the height\n        ];\n        var height = '';\n        var paddingBottom = '';\n        if (aspectRatio) {\n            if (state.availableWidth !== null) {\n                height = state.availableWidth / aspectRatio;\n            }\n            else {\n                // while waiting to know availableWidth, we can't set height to *zero*\n                // because will cause lots of unnecessary scrollbars within scrollgrid.\n                // BETTER: don't start rendering ANYTHING yet until we know container width\n                // NOTE: why not always use paddingBottom? Causes height oscillation (issue 5606)\n                paddingBottom = (1 / aspectRatio) * 100 + '%';\n            }\n        }\n        else {\n            height = props.height || '';\n        }\n        return (createElement(\"div\", { ref: this.handleEl, onClick: props.onClick, className: classNames.join(' '), style: { height: height, paddingBottom: paddingBottom } }, props.children));\n    };\n    ViewContainer.prototype.componentDidMount = function () {\n        this.context.addResizeHandler(this.handleResize);\n    };\n    ViewContainer.prototype.componentWillUnmount = function () {\n        this.context.removeResizeHandler(this.handleResize);\n    };\n    ViewContainer.prototype.updateAvailableWidth = function () {\n        if (this.el && // needed. but why?\n            this.props.aspectRatio // aspectRatio is the only height setting that needs availableWidth\n        ) {\n            this.setState({ availableWidth: this.el.offsetWidth });\n        }\n    };\n    return ViewContainer;\n}(BaseComponent));\n\n/*\nDetects when the user clicks on an event within a DateComponent\n*/\nvar EventClicking = /** @class */ (function (_super) {\n    __extends(EventClicking, _super);\n    function EventClicking(settings) {\n        var _this = _super.call(this, settings) || this;\n        _this.handleSegClick = function (ev, segEl) {\n            var component = _this.component;\n            var context = component.context;\n            var seg = getElSeg(segEl);\n            if (seg && // might be the <div> surrounding the more link\n                component.isValidSegDownEl(ev.target)) {\n                // our way to simulate a link click for elements that can't be <a> tags\n                // grab before trigger fired in case trigger trashes DOM thru rerendering\n                var hasUrlContainer = elementClosest(ev.target, '.fc-event-forced-url');\n                var url = hasUrlContainer ? hasUrlContainer.querySelector('a[href]').href : '';\n                context.emitter.trigger('eventClick', {\n                    el: segEl,\n                    event: new EventApi(component.context, seg.eventRange.def, seg.eventRange.instance),\n                    jsEvent: ev,\n                    view: context.viewApi\n                });\n                if (url && !ev.defaultPrevented) {\n                    window.location.href = url;\n                }\n            }\n        };\n        _this.destroy = listenBySelector(settings.el, 'click', '.fc-event', // on both fg and bg events\n        _this.handleSegClick);\n        return _this;\n    }\n    return EventClicking;\n}(Interaction));\n\n/*\nTriggers events and adds/removes core classNames when the user's pointer\nenters/leaves event-elements of a component.\n*/\nvar EventHovering = /** @class */ (function (_super) {\n    __extends(EventHovering, _super);\n    function EventHovering(settings) {\n        var _this = _super.call(this, settings) || this;\n        // for simulating an eventMouseLeave when the event el is destroyed while mouse is over it\n        _this.handleEventElRemove = function (el) {\n            if (el === _this.currentSegEl) {\n                _this.handleSegLeave(null, _this.currentSegEl);\n            }\n        };\n        _this.handleSegEnter = function (ev, segEl) {\n            if (getElSeg(segEl)) { // TODO: better way to make sure not hovering over more+ link or its wrapper\n                _this.currentSegEl = segEl;\n                _this.triggerEvent('eventMouseEnter', ev, segEl);\n            }\n        };\n        _this.handleSegLeave = function (ev, segEl) {\n            if (_this.currentSegEl) {\n                _this.currentSegEl = null;\n                _this.triggerEvent('eventMouseLeave', ev, segEl);\n            }\n        };\n        _this.removeHoverListeners = listenToHoverBySelector(settings.el, '.fc-event', // on both fg and bg events\n        _this.handleSegEnter, _this.handleSegLeave);\n        return _this;\n    }\n    EventHovering.prototype.destroy = function () {\n        this.removeHoverListeners();\n    };\n    EventHovering.prototype.triggerEvent = function (publicEvName, ev, segEl) {\n        var component = this.component;\n        var context = component.context;\n        var seg = getElSeg(segEl);\n        if (!ev || component.isValidSegDownEl(ev.target)) {\n            context.emitter.trigger(publicEvName, {\n                el: segEl,\n                event: new EventApi(context, seg.eventRange.def, seg.eventRange.instance),\n                jsEvent: ev,\n                view: context.viewApi\n            });\n        }\n    };\n    return EventHovering;\n}(Interaction));\n\nvar CalendarContent = /** @class */ (function (_super) {\n    __extends(CalendarContent, _super);\n    function CalendarContent() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.buildViewContext = memoize(buildViewContext);\n        _this.buildViewPropTransformers = memoize(buildViewPropTransformers);\n        _this.buildToolbarProps = memoize(buildToolbarProps);\n        _this.handleNavLinkClick = buildDelegationHandler('a[data-navlink]', _this._handleNavLinkClick.bind(_this));\n        _this.headerRef = createRef();\n        _this.footerRef = createRef();\n        _this.interactionsStore = {};\n        // Component Registration\n        // -----------------------------------------------------------------------------------------------------------------\n        _this.registerInteractiveComponent = function (component, settingsInput) {\n            var settings = parseInteractionSettings(component, settingsInput);\n            var DEFAULT_INTERACTIONS = [\n                EventClicking,\n                EventHovering\n            ];\n            var interactionClasses = DEFAULT_INTERACTIONS.concat(_this.props.pluginHooks.componentInteractions);\n            var interactions = interactionClasses.map(function (interactionClass) {\n                return new interactionClass(settings);\n            });\n            _this.interactionsStore[component.uid] = interactions;\n            interactionSettingsStore[component.uid] = settings;\n        };\n        _this.unregisterInteractiveComponent = function (component) {\n            for (var _i = 0, _a = _this.interactionsStore[component.uid]; _i < _a.length; _i++) {\n                var listener = _a[_i];\n                listener.destroy();\n            }\n            delete _this.interactionsStore[component.uid];\n            delete interactionSettingsStore[component.uid];\n        };\n        // Resizing\n        // -----------------------------------------------------------------------------------------------------------------\n        _this.resizeRunner = new DelayedRunner(function () {\n            _this.props.emitter.trigger('_resize', true); // should window resizes be considered \"forced\" ?\n            _this.props.emitter.trigger('windowResize', { view: _this.props.viewApi });\n        });\n        _this.handleWindowResize = function (ev) {\n            var options = _this.props.options;\n            if (options.handleWindowResize &&\n                ev.target === window // avoid jqui events\n            ) {\n                _this.resizeRunner.request(options.windowResizeDelay);\n            }\n        };\n        return _this;\n    }\n    /*\n    renders INSIDE of an outer div\n    */\n    CalendarContent.prototype.render = function () {\n        var props = this.props;\n        var toolbarConfig = props.toolbarConfig, options = props.options;\n        var toolbarProps = this.buildToolbarProps(props.viewSpec, props.dateProfile, props.dateProfileGenerator, props.currentDate, getNow(props.options.now, props.dateEnv), // TODO: use NowTimer????\n        props.viewTitle);\n        var viewVGrow = false;\n        var viewHeight = '';\n        var viewAspectRatio;\n        if (props.isHeightAuto || props.forPrint) {\n            viewHeight = '';\n        }\n        else if (options.height != null) {\n            viewVGrow = true;\n        }\n        else if (options.contentHeight != null) {\n            viewHeight = options.contentHeight;\n        }\n        else {\n            viewAspectRatio = Math.max(options.aspectRatio, 0.5); // prevent from getting too tall\n        }\n        var viewContext = this.buildViewContext(props.viewSpec, props.viewApi, props.options, props.dateProfileGenerator, props.dateEnv, props.theme, props.pluginHooks, props.dispatch, props.getCurrentData, props.emitter, props.calendarApi, this.registerInteractiveComponent, this.unregisterInteractiveComponent);\n        return (createElement(ViewContextType.Provider, { value: viewContext },\n            toolbarConfig.headerToolbar &&\n                createElement(Toolbar, __assign({ ref: this.headerRef, extraClassName: 'fc-header-toolbar', model: toolbarConfig.headerToolbar }, toolbarProps)),\n            createElement(ViewContainer, { liquid: viewVGrow, height: viewHeight, aspectRatio: viewAspectRatio, onClick: this.handleNavLinkClick },\n                this.renderView(props),\n                this.buildAppendContent()),\n            toolbarConfig.footerToolbar &&\n                createElement(Toolbar, __assign({ ref: this.footerRef, extraClassName: 'fc-footer-toolbar', model: toolbarConfig.footerToolbar }, toolbarProps))));\n    };\n    CalendarContent.prototype.componentDidMount = function () {\n        var props = this.props;\n        this.calendarInteractions = props.pluginHooks.calendarInteractions\n            .map(function (calendarInteractionClass) {\n            return new calendarInteractionClass(props);\n        });\n        window.addEventListener('resize', this.handleWindowResize);\n        var propSetHandlers = props.pluginHooks.propSetHandlers;\n        for (var propName in propSetHandlers) {\n            propSetHandlers[propName](props[propName], props);\n        }\n    };\n    CalendarContent.prototype.componentDidUpdate = function (prevProps) {\n        var props = this.props;\n        var propSetHandlers = props.pluginHooks.propSetHandlers;\n        for (var propName in propSetHandlers) {\n            if (props[propName] !== prevProps[propName]) {\n                propSetHandlers[propName](props[propName], props);\n            }\n        }\n    };\n    CalendarContent.prototype.componentWillUnmount = function () {\n        window.removeEventListener('resize', this.handleWindowResize);\n        this.resizeRunner.clear();\n        for (var _i = 0, _a = this.calendarInteractions; _i < _a.length; _i++) {\n            var interaction = _a[_i];\n            interaction.destroy();\n        }\n        this.props.emitter.trigger('_unmount');\n    };\n    CalendarContent.prototype._handleNavLinkClick = function (ev, anchorEl) {\n        var _a = this.props, dateEnv = _a.dateEnv, options = _a.options, calendarApi = _a.calendarApi;\n        var navLinkOptions = anchorEl.getAttribute('data-navlink');\n        navLinkOptions = navLinkOptions ? JSON.parse(navLinkOptions) : {};\n        var dateMarker = dateEnv.createMarker(navLinkOptions.date);\n        var viewType = navLinkOptions.type;\n        var customAction = viewType === 'day' ? options.navLinkDayClick :\n            viewType === 'week' ? options.navLinkWeekClick : null;\n        if (typeof customAction === 'function') {\n            customAction.call(calendarApi, dateEnv.toDate(dateMarker), ev);\n        }\n        else {\n            if (typeof customAction === 'string') {\n                viewType = customAction;\n            }\n            calendarApi.zoomTo(dateMarker, viewType);\n        }\n    };\n    CalendarContent.prototype.buildAppendContent = function () {\n        var props = this.props;\n        var children = props.pluginHooks.viewContainerAppends.map(function (buildAppendContent) { return buildAppendContent(props); });\n        return createElement.apply(void 0, __spreadArrays([Fragment, {}], children));\n    };\n    CalendarContent.prototype.renderView = function (props) {\n        var pluginHooks = props.pluginHooks;\n        var viewSpec = props.viewSpec;\n        var viewProps = {\n            dateProfile: props.dateProfile,\n            businessHours: props.businessHours,\n            eventStore: props.renderableEventStore,\n            eventUiBases: props.eventUiBases,\n            dateSelection: props.dateSelection,\n            eventSelection: props.eventSelection,\n            eventDrag: props.eventDrag,\n            eventResize: props.eventResize,\n            isHeightAuto: props.isHeightAuto,\n            forPrint: props.forPrint\n        };\n        var transformers = this.buildViewPropTransformers(pluginHooks.viewPropsTransformers);\n        for (var _i = 0, transformers_1 = transformers; _i < transformers_1.length; _i++) {\n            var transformer = transformers_1[_i];\n            __assign(viewProps, transformer.transform(viewProps, props));\n        }\n        var ViewComponent = viewSpec.component;\n        return (createElement(ViewComponent, __assign({}, viewProps)));\n    };\n    return CalendarContent;\n}(PureComponent));\nfunction buildToolbarProps(viewSpec, dateProfile, dateProfileGenerator, currentDate, now, title) {\n    // don't force any date-profiles to valid date profiles (the `false`) so that we can tell if it's invalid\n    var todayInfo = dateProfileGenerator.build(now, undefined, false); // TODO: need `undefined` or else INFINITE LOOP for some reason\n    var prevInfo = dateProfileGenerator.buildPrev(dateProfile, currentDate, false);\n    var nextInfo = dateProfileGenerator.buildNext(dateProfile, currentDate, false);\n    return {\n        title: title,\n        activeButton: viewSpec.type,\n        isTodayEnabled: todayInfo.isValid && !rangeContainsMarker(dateProfile.currentRange, now),\n        isPrevEnabled: prevInfo.isValid,\n        isNextEnabled: nextInfo.isValid\n    };\n}\n// Plugin\n// -----------------------------------------------------------------------------------------------------------------\nfunction buildViewPropTransformers(theClasses) {\n    return theClasses.map(function (theClass) {\n        return new theClass();\n    });\n}\n\nvar CalendarRoot = /** @class */ (function (_super) {\n    __extends(CalendarRoot, _super);\n    function CalendarRoot() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            forPrint: false\n        };\n        _this.handleBeforePrint = function () {\n            _this.setState({ forPrint: true });\n        };\n        _this.handleAfterPrint = function () {\n            _this.setState({ forPrint: false });\n        };\n        return _this;\n    }\n    CalendarRoot.prototype.render = function () {\n        var props = this.props;\n        var options = props.options;\n        var forPrint = this.state.forPrint;\n        var isHeightAuto = forPrint || options.height === 'auto' || options.contentHeight === 'auto';\n        var height = (!isHeightAuto && options.height != null) ? options.height : '';\n        var classNames = [\n            'fc',\n            forPrint ? 'fc-media-print' : 'fc-media-screen',\n            'fc-direction-' + options.direction,\n            props.theme.getClass('root')\n        ];\n        if (!getCanVGrowWithinCell()) {\n            classNames.push('fc-liquid-hack');\n        }\n        return props.children(classNames, height, isHeightAuto, forPrint);\n    };\n    CalendarRoot.prototype.componentDidMount = function () {\n        var emitter = this.props.emitter;\n        emitter.on('_beforeprint', this.handleBeforePrint);\n        emitter.on('_afterprint', this.handleAfterPrint);\n    };\n    CalendarRoot.prototype.componentWillUnmount = function () {\n        var emitter = this.props.emitter;\n        emitter.off('_beforeprint', this.handleBeforePrint);\n        emitter.off('_afterprint', this.handleAfterPrint);\n    };\n    return CalendarRoot;\n}(BaseComponent));\n\n// Computes a default column header formatting string if `colFormat` is not explicitly defined\nfunction computeFallbackHeaderFormat(datesRepDistinctDays, dayCnt) {\n    // if more than one week row, or if there are a lot of columns with not much space,\n    // put just the day numbers will be in each cell\n    if (!datesRepDistinctDays || dayCnt > 10) {\n        return createFormatter({ weekday: 'short' }); // \"Sat\"\n    }\n    else if (dayCnt > 1) {\n        return createFormatter({ weekday: 'short', month: 'numeric', day: 'numeric', omitCommas: true }); // \"Sat 11/12\"\n    }\n    else {\n        return createFormatter({ weekday: 'long' }); // \"Saturday\"\n    }\n}\n\nvar CLASS_NAME = 'fc-col-header-cell'; // do the cushion too? no\nvar TableDateCell = /** @class */ (function (_super) {\n    __extends(TableDateCell, _super);\n    function TableDateCell() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TableDateCell.prototype.render = function () {\n        var _a = this.context, dateEnv = _a.dateEnv, options = _a.options, theme = _a.theme, viewApi = _a.viewApi;\n        var props = this.props;\n        var date = props.date, dateProfile = props.dateProfile;\n        var dayMeta = getDateMeta(date, props.todayRange, null, dateProfile);\n        var classNames = [CLASS_NAME].concat(getDayClassNames(dayMeta, theme));\n        var text = dateEnv.format(date, props.dayHeaderFormat);\n        // if colCnt is 1, we are already in a day-view and don't need a navlink\n        var navLinkAttrs = (options.navLinks && !dayMeta.isDisabled && props.colCnt > 1)\n            ? { 'data-navlink': buildNavLinkData(date), tabIndex: 0 }\n            : {};\n        var hookProps = __assign(__assign(__assign({ date: dateEnv.toDate(date), view: viewApi }, props.extraHookProps), { text: text }), dayMeta);\n        return (createElement(RenderHook, { hookProps: hookProps, classNames: options.dayHeaderClassNames, content: options.dayHeaderContent, defaultContent: renderInner, didMount: options.dayHeaderDidMount, willUnmount: options.dayHeaderWillUnmount }, function (rootElRef, customClassNames, innerElRef, innerContent) { return (createElement(\"th\", __assign({ ref: rootElRef, className: classNames.concat(customClassNames).join(' '), \"data-date\": !dayMeta.isDisabled ? formatDayString(date) : undefined, colSpan: props.colSpan }, props.extraDataAttrs),\n            createElement(\"div\", { className: 'fc-scrollgrid-sync-inner' }, !dayMeta.isDisabled &&\n                createElement(\"a\", __assign({ ref: innerElRef, className: [\n                        'fc-col-header-cell-cushion',\n                        props.isSticky ? 'fc-sticky' : ''\n                    ].join(' ') }, navLinkAttrs), innerContent)))); }));\n    };\n    return TableDateCell;\n}(BaseComponent));\nvar TableDowCell = /** @class */ (function (_super) {\n    __extends(TableDowCell, _super);\n    function TableDowCell() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TableDowCell.prototype.render = function () {\n        var props = this.props;\n        var _a = this.context, dateEnv = _a.dateEnv, theme = _a.theme, viewApi = _a.viewApi, options = _a.options;\n        var date = addDays(new Date(259200000), props.dow); // start with Sun, 04 Jan 1970 00:00:00 GMT\n        var dateMeta = {\n            dow: props.dow,\n            isDisabled: false,\n            isFuture: false,\n            isPast: false,\n            isToday: false,\n            isOther: false\n        };\n        var classNames = [CLASS_NAME].concat(getDayClassNames(dateMeta, theme), props.extraClassNames || []);\n        var text = dateEnv.format(date, props.dayHeaderFormat);\n        var hookProps = __assign(__assign(__assign(__assign({ // TODO: make this public?\n            date: date }, dateMeta), { view: viewApi }), props.extraHookProps), { text: text });\n        return (createElement(RenderHook, { hookProps: hookProps, classNames: options.dayHeaderClassNames, content: options.dayHeaderContent, defaultContent: renderInner, didMount: options.dayHeaderDidMount, willUnmount: options.dayHeaderWillUnmount }, function (rootElRef, customClassNames, innerElRef, innerContent) { return (createElement(\"th\", __assign({ ref: rootElRef, className: classNames.concat(customClassNames).join(' '), colSpan: props.colSpan }, props.extraDataAttrs),\n            createElement(\"div\", { className: 'fc-scrollgrid-sync-inner' },\n                createElement(\"a\", { className: [\n                        'fc-col-header-cell-cushion',\n                        props.isSticky ? 'fc-sticky' : ''\n                    ].join(' '), ref: innerElRef }, innerContent)))); }));\n    };\n    return TableDowCell;\n}(BaseComponent));\nfunction renderInner(hookProps) {\n    return hookProps.text;\n}\n\nvar NowTimer = /** @class */ (function (_super) {\n    __extends(NowTimer, _super);\n    function NowTimer(props, context) {\n        var _this = _super.call(this, props, context) || this;\n        _this.initialNowDate = getNow(context.options.now, context.dateEnv);\n        _this.initialNowQueriedMs = new Date().valueOf();\n        _this.state = _this.computeTiming().currentState;\n        return _this;\n    }\n    NowTimer.prototype.render = function () {\n        var _a = this, props = _a.props, state = _a.state;\n        return props.children(state.nowDate, state.todayRange);\n    };\n    NowTimer.prototype.componentDidMount = function () {\n        this.setTimeout();\n    };\n    NowTimer.prototype.componentDidUpdate = function (prevProps) {\n        if (prevProps.unit !== this.props.unit) {\n            this.clearTimeout();\n            this.setTimeout();\n        }\n    };\n    NowTimer.prototype.componentWillUnmount = function () {\n        this.clearTimeout();\n    };\n    NowTimer.prototype.computeTiming = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var unroundedNow = addMs(this.initialNowDate, new Date().valueOf() - this.initialNowQueriedMs);\n        var currentUnitStart = context.dateEnv.startOf(unroundedNow, props.unit);\n        var nextUnitStart = context.dateEnv.add(currentUnitStart, createDuration(1, props.unit));\n        var waitMs = nextUnitStart.valueOf() - unroundedNow.valueOf();\n        return {\n            currentState: { nowDate: currentUnitStart, todayRange: buildDayRange(currentUnitStart) },\n            nextState: { nowDate: nextUnitStart, todayRange: buildDayRange(nextUnitStart) },\n            waitMs: waitMs\n        };\n    };\n    NowTimer.prototype.setTimeout = function () {\n        var _this = this;\n        var _a = this.computeTiming(), nextState = _a.nextState, waitMs = _a.waitMs;\n        this.timeoutId = setTimeout(function () {\n            _this.setState(nextState, function () {\n                _this.setTimeout();\n            });\n        }, waitMs);\n    };\n    NowTimer.prototype.clearTimeout = function () {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n    };\n    NowTimer.contextType = ViewContextType;\n    return NowTimer;\n}(Component));\nfunction buildDayRange(date) {\n    var start = startOfDay(date);\n    var end = addDays(start, 1);\n    return { start: start, end: end };\n}\n\nvar DayHeader = /** @class */ (function (_super) {\n    __extends(DayHeader, _super);\n    function DayHeader() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.createDayHeaderFormatter = memoize(createDayHeaderFormatter);\n        return _this;\n    }\n    DayHeader.prototype.render = function () {\n        var context = this.context;\n        var _a = this.props, dates = _a.dates, dateProfile = _a.dateProfile, datesRepDistinctDays = _a.datesRepDistinctDays, renderIntro = _a.renderIntro;\n        var dayHeaderFormat = this.createDayHeaderFormatter(context.options.dayHeaderFormat, datesRepDistinctDays, dates.length);\n        return (createElement(NowTimer, { unit: 'day' }, function (nowDate, todayRange) { return (createElement(\"tr\", null,\n            renderIntro && renderIntro(),\n            dates.map(function (date) { return (datesRepDistinctDays ?\n                createElement(TableDateCell, { key: date.toISOString(), date: date, dateProfile: dateProfile, todayRange: todayRange, colCnt: dates.length, dayHeaderFormat: dayHeaderFormat }) :\n                createElement(TableDowCell, { key: date.getUTCDay(), dow: date.getUTCDay(), dayHeaderFormat: dayHeaderFormat })); }))); }));\n    };\n    return DayHeader;\n}(BaseComponent));\nfunction createDayHeaderFormatter(explicitFormat, datesRepDistinctDays, dateCnt) {\n    return explicitFormat || computeFallbackHeaderFormat(datesRepDistinctDays, dateCnt);\n}\n\nvar DaySeriesModel = /** @class */ (function () {\n    function DaySeriesModel(range, dateProfileGenerator) {\n        var date = range.start;\n        var end = range.end;\n        var indices = [];\n        var dates = [];\n        var dayIndex = -1;\n        while (date < end) { // loop each day from start to end\n            if (dateProfileGenerator.isHiddenDay(date)) {\n                indices.push(dayIndex + 0.5); // mark that it's between indices\n            }\n            else {\n                dayIndex++;\n                indices.push(dayIndex);\n                dates.push(date);\n            }\n            date = addDays(date, 1);\n        }\n        this.dates = dates;\n        this.indices = indices;\n        this.cnt = dates.length;\n    }\n    DaySeriesModel.prototype.sliceRange = function (range) {\n        var firstIndex = this.getDateDayIndex(range.start); // inclusive first index\n        var lastIndex = this.getDateDayIndex(addDays(range.end, -1)); // inclusive last index\n        var clippedFirstIndex = Math.max(0, firstIndex);\n        var clippedLastIndex = Math.min(this.cnt - 1, lastIndex);\n        // deal with in-between indices\n        clippedFirstIndex = Math.ceil(clippedFirstIndex); // in-between starts round to next cell\n        clippedLastIndex = Math.floor(clippedLastIndex); // in-between ends round to prev cell\n        if (clippedFirstIndex <= clippedLastIndex) {\n            return {\n                firstIndex: clippedFirstIndex,\n                lastIndex: clippedLastIndex,\n                isStart: firstIndex === clippedFirstIndex,\n                isEnd: lastIndex === clippedLastIndex\n            };\n        }\n        else {\n            return null;\n        }\n    };\n    // Given a date, returns its chronolocial cell-index from the first cell of the grid.\n    // If the date lies between cells (because of hiddenDays), returns a floating-point value between offsets.\n    // If before the first offset, returns a negative number.\n    // If after the last offset, returns an offset past the last cell offset.\n    // Only works for *start* dates of cells. Will not work for exclusive end dates for cells.\n    DaySeriesModel.prototype.getDateDayIndex = function (date) {\n        var indices = this.indices;\n        var dayOffset = Math.floor(diffDays(this.dates[0], date));\n        if (dayOffset < 0) {\n            return indices[0] - 1;\n        }\n        else if (dayOffset >= indices.length) {\n            return indices[indices.length - 1] + 1;\n        }\n        else {\n            return indices[dayOffset];\n        }\n    };\n    return DaySeriesModel;\n}());\n\nvar DayTableModel = /** @class */ (function () {\n    function DayTableModel(daySeries, breakOnWeeks) {\n        var dates = daySeries.dates;\n        var daysPerRow;\n        var firstDay;\n        var rowCnt;\n        if (breakOnWeeks) {\n            // count columns until the day-of-week repeats\n            firstDay = dates[0].getUTCDay();\n            for (daysPerRow = 1; daysPerRow < dates.length; daysPerRow++) {\n                if (dates[daysPerRow].getUTCDay() === firstDay) {\n                    break;\n                }\n            }\n            rowCnt = Math.ceil(dates.length / daysPerRow);\n        }\n        else {\n            rowCnt = 1;\n            daysPerRow = dates.length;\n        }\n        this.rowCnt = rowCnt;\n        this.colCnt = daysPerRow;\n        this.daySeries = daySeries;\n        this.cells = this.buildCells();\n        this.headerDates = this.buildHeaderDates();\n    }\n    DayTableModel.prototype.buildCells = function () {\n        var rows = [];\n        for (var row = 0; row < this.rowCnt; row++) {\n            var cells = [];\n            for (var col = 0; col < this.colCnt; col++) {\n                cells.push(this.buildCell(row, col));\n            }\n            rows.push(cells);\n        }\n        return rows;\n    };\n    DayTableModel.prototype.buildCell = function (row, col) {\n        var date = this.daySeries.dates[row * this.colCnt + col];\n        return {\n            key: date.toISOString(),\n            date: date\n        };\n    };\n    DayTableModel.prototype.buildHeaderDates = function () {\n        var dates = [];\n        for (var col = 0; col < this.colCnt; col++) {\n            dates.push(this.cells[0][col].date);\n        }\n        return dates;\n    };\n    DayTableModel.prototype.sliceRange = function (range) {\n        var colCnt = this.colCnt;\n        var seriesSeg = this.daySeries.sliceRange(range);\n        var segs = [];\n        if (seriesSeg) {\n            var firstIndex = seriesSeg.firstIndex, lastIndex = seriesSeg.lastIndex;\n            var index = firstIndex;\n            while (index <= lastIndex) {\n                var row = Math.floor(index / colCnt);\n                var nextIndex = Math.min((row + 1) * colCnt, lastIndex + 1);\n                segs.push({\n                    row: row,\n                    firstCol: index % colCnt,\n                    lastCol: (nextIndex - 1) % colCnt,\n                    isStart: seriesSeg.isStart && index === firstIndex,\n                    isEnd: seriesSeg.isEnd && (nextIndex - 1) === lastIndex\n                });\n                index = nextIndex;\n            }\n        }\n        return segs;\n    };\n    return DayTableModel;\n}());\n\nvar Slicer = /** @class */ (function () {\n    function Slicer() {\n        this.sliceBusinessHours = memoize(this._sliceBusinessHours);\n        this.sliceDateSelection = memoize(this._sliceDateSpan);\n        this.sliceEventStore = memoize(this._sliceEventStore);\n        this.sliceEventDrag = memoize(this._sliceInteraction);\n        this.sliceEventResize = memoize(this._sliceInteraction);\n        this.forceDayIfListItem = false; // hack\n    }\n    Slicer.prototype.sliceProps = function (props, dateProfile, nextDayThreshold, context) {\n        var extraArgs = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            extraArgs[_i - 4] = arguments[_i];\n        }\n        var eventUiBases = props.eventUiBases;\n        var eventSegs = this.sliceEventStore.apply(this, __spreadArrays([props.eventStore, eventUiBases, dateProfile, nextDayThreshold], extraArgs));\n        return {\n            dateSelectionSegs: this.sliceDateSelection.apply(this, __spreadArrays([props.dateSelection, eventUiBases, context], extraArgs)),\n            businessHourSegs: this.sliceBusinessHours.apply(this, __spreadArrays([props.businessHours, dateProfile, nextDayThreshold, context], extraArgs)),\n            fgEventSegs: eventSegs.fg,\n            bgEventSegs: eventSegs.bg,\n            eventDrag: this.sliceEventDrag.apply(this, __spreadArrays([props.eventDrag, eventUiBases, dateProfile, nextDayThreshold], extraArgs)),\n            eventResize: this.sliceEventResize.apply(this, __spreadArrays([props.eventResize, eventUiBases, dateProfile, nextDayThreshold], extraArgs)),\n            eventSelection: props.eventSelection\n        }; // TODO: give interactionSegs?\n    };\n    Slicer.prototype.sliceNowDate = function (// does not memoize\n    date, context) {\n        var extraArgs = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            extraArgs[_i - 2] = arguments[_i];\n        }\n        return this._sliceDateSpan.apply(this, __spreadArrays([{ range: { start: date, end: addMs(date, 1) }, allDay: false },\n            {},\n            context], extraArgs));\n    };\n    Slicer.prototype._sliceBusinessHours = function (businessHours, dateProfile, nextDayThreshold, context) {\n        var extraArgs = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            extraArgs[_i - 4] = arguments[_i];\n        }\n        if (!businessHours) {\n            return [];\n        }\n        return this._sliceEventStore.apply(this, __spreadArrays([expandRecurring(businessHours, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), context),\n            {},\n            dateProfile,\n            nextDayThreshold], extraArgs)).bg;\n    };\n    Slicer.prototype._sliceEventStore = function (eventStore, eventUiBases, dateProfile, nextDayThreshold) {\n        var extraArgs = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            extraArgs[_i - 4] = arguments[_i];\n        }\n        if (eventStore) {\n            var rangeRes = sliceEventStore(eventStore, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n            return {\n                bg: this.sliceEventRanges(rangeRes.bg, extraArgs),\n                fg: this.sliceEventRanges(rangeRes.fg, extraArgs)\n            };\n        }\n        else {\n            return { bg: [], fg: [] };\n        }\n    };\n    Slicer.prototype._sliceInteraction = function (interaction, eventUiBases, dateProfile, nextDayThreshold) {\n        var extraArgs = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            extraArgs[_i - 4] = arguments[_i];\n        }\n        if (!interaction) {\n            return null;\n        }\n        var rangeRes = sliceEventStore(interaction.mutatedEvents, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n        return {\n            segs: this.sliceEventRanges(rangeRes.fg, extraArgs),\n            affectedInstances: interaction.affectedEvents.instances,\n            isEvent: interaction.isEvent\n        };\n    };\n    Slicer.prototype._sliceDateSpan = function (dateSpan, eventUiBases, context) {\n        var extraArgs = [];\n        for (var _i = 3; _i < arguments.length; _i++) {\n            extraArgs[_i - 3] = arguments[_i];\n        }\n        if (!dateSpan) {\n            return [];\n        }\n        var eventRange = fabricateEventRange(dateSpan, eventUiBases, context);\n        var segs = this.sliceRange.apply(this, __spreadArrays([dateSpan.range], extraArgs));\n        for (var _a = 0, segs_1 = segs; _a < segs_1.length; _a++) {\n            var seg = segs_1[_a];\n            seg.eventRange = eventRange;\n        }\n        return segs;\n    };\n    /*\n    \"complete\" seg means it has component and eventRange\n    */\n    Slicer.prototype.sliceEventRanges = function (eventRanges, extraArgs) {\n        var segs = [];\n        for (var _i = 0, eventRanges_1 = eventRanges; _i < eventRanges_1.length; _i++) {\n            var eventRange = eventRanges_1[_i];\n            segs.push.apply(segs, this.sliceEventRange(eventRange, extraArgs));\n        }\n        return segs;\n    };\n    /*\n    \"complete\" seg means it has component and eventRange\n    */\n    Slicer.prototype.sliceEventRange = function (eventRange, extraArgs) {\n        var dateRange = eventRange.range;\n        // hack to make multi-day events that are being force-displayed as list-items to take up only one day\n        if (this.forceDayIfListItem && eventRange.ui.display === 'list-item') {\n            dateRange = {\n                start: dateRange.start,\n                end: addDays(dateRange.start, 1)\n            };\n        }\n        var segs = this.sliceRange.apply(this, __spreadArrays([dateRange], extraArgs));\n        for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n            var seg = segs_2[_i];\n            seg.eventRange = eventRange;\n            seg.isStart = eventRange.isStart && seg.isStart;\n            seg.isEnd = eventRange.isEnd && seg.isEnd;\n        }\n        return segs;\n    };\n    return Slicer;\n}());\n/*\nfor incorporating slotMinTime/slotMaxTime if appropriate\nTODO: should be part of DateProfile!\nTimelineDateProfile already does this btw\n*/\nfunction computeActiveRange(dateProfile, isComponentAllDay) {\n    var range = dateProfile.activeRange;\n    if (isComponentAllDay) {\n        return range;\n    }\n    return {\n        start: addMs(range.start, dateProfile.slotMinTime.milliseconds),\n        end: addMs(range.end, dateProfile.slotMaxTime.milliseconds - 864e5) // 864e5 = ms in a day\n    };\n}\n\nvar VISIBLE_HIDDEN_RE = /^(visible|hidden)$/;\nvar Scroller = /** @class */ (function (_super) {\n    __extends(Scroller, _super);\n    function Scroller() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.handleEl = function (el) {\n            _this.el = el;\n            setRef(_this.props.elRef, el);\n        };\n        return _this;\n    }\n    Scroller.prototype.render = function () {\n        var props = this.props;\n        var liquid = props.liquid, liquidIsAbsolute = props.liquidIsAbsolute;\n        var isAbsolute = liquid && liquidIsAbsolute;\n        var className = ['fc-scroller'];\n        if (liquid) {\n            if (liquidIsAbsolute) {\n                className.push('fc-scroller-liquid-absolute');\n            }\n            else {\n                className.push('fc-scroller-liquid');\n            }\n        }\n        return (createElement(\"div\", { ref: this.handleEl, className: className.join(' '), style: {\n                overflowX: props.overflowX,\n                overflowY: props.overflowY,\n                left: (isAbsolute && -(props.overcomeLeft || 0)) || '',\n                right: (isAbsolute && -(props.overcomeRight || 0)) || '',\n                bottom: (isAbsolute && -(props.overcomeBottom || 0)) || '',\n                marginLeft: (!isAbsolute && -(props.overcomeLeft || 0)) || '',\n                marginRight: (!isAbsolute && -(props.overcomeRight || 0)) || '',\n                marginBottom: (!isAbsolute && -(props.overcomeBottom || 0)) || '',\n                maxHeight: props.maxHeight || ''\n            } }, props.children));\n    };\n    Scroller.prototype.needsXScrolling = function () {\n        if (VISIBLE_HIDDEN_RE.test(this.props.overflowX)) {\n            return false;\n        }\n        // testing scrollWidth>clientWidth is unreliable cross-browser when pixel heights aren't integers.\n        // much more reliable to see if children are taller than the scroller, even tho doesn't account for\n        // inner-child margins and absolute positioning\n        var el = this.el;\n        var realClientWidth = this.el.getBoundingClientRect().width - this.getYScrollbarWidth();\n        var children = el.children;\n        for (var i = 0; i < children.length; i++) {\n            var childEl = children[i];\n            if (childEl.getBoundingClientRect().width > realClientWidth) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Scroller.prototype.needsYScrolling = function () {\n        if (VISIBLE_HIDDEN_RE.test(this.props.overflowY)) {\n            return false;\n        }\n        // testing scrollHeight>clientHeight is unreliable cross-browser when pixel heights aren't integers.\n        // much more reliable to see if children are taller than the scroller, even tho doesn't account for\n        // inner-child margins and absolute positioning\n        var el = this.el;\n        var realClientHeight = this.el.getBoundingClientRect().height - this.getXScrollbarWidth();\n        var children = el.children;\n        for (var i = 0; i < children.length; i++) {\n            var childEl = children[i];\n            if (childEl.getBoundingClientRect().height > realClientHeight) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Scroller.prototype.getXScrollbarWidth = function () {\n        if (VISIBLE_HIDDEN_RE.test(this.props.overflowX)) {\n            return 0;\n        }\n        else {\n            return this.el.offsetHeight - this.el.clientHeight; // only works because we guarantee no borders. TODO: add to CSS with important?\n        }\n    };\n    Scroller.prototype.getYScrollbarWidth = function () {\n        if (VISIBLE_HIDDEN_RE.test(this.props.overflowY)) {\n            return 0;\n        }\n        else {\n            return this.el.offsetWidth - this.el.clientWidth; // only works because we guarantee no borders. TODO: add to CSS with important?\n        }\n    };\n    return Scroller;\n}(BaseComponent));\n\n/*\nTODO: somehow infer OtherArgs from masterCallback?\nTODO: infer RefType from masterCallback if provided\n*/\nvar RefMap = /** @class */ (function () {\n    function RefMap(masterCallback) {\n        var _this = this;\n        this.masterCallback = masterCallback;\n        this.currentMap = {};\n        this.depths = {};\n        this.callbackMap = {};\n        this.handleValue = function (val, key) {\n            var _a = _this, depths = _a.depths, currentMap = _a.currentMap;\n            var removed = false;\n            var added = false;\n            if (val !== null) {\n                removed = (key in currentMap); // for bug... ACTUALLY: can probably do away with this now that callers don't share numeric indices anymore\n                currentMap[key] = val;\n                depths[key] = (depths[key] || 0) + 1;\n                added = true;\n            }\n            else if (--depths[key] === 0) {\n                delete currentMap[key];\n                delete _this.callbackMap[key];\n                removed = true;\n            }\n            if (_this.masterCallback) {\n                if (removed) {\n                    _this.masterCallback(null, String(key));\n                }\n                if (added) {\n                    _this.masterCallback(val, String(key));\n                }\n            }\n        };\n    }\n    RefMap.prototype.createRef = function (key) {\n        var _this = this;\n        var refCallback = this.callbackMap[key];\n        if (!refCallback) {\n            refCallback = this.callbackMap[key] = function (val) {\n                _this.handleValue(val, String(key));\n            };\n        }\n        return refCallback;\n    };\n    // TODO: check callers that don't care about order. should use getAll instead\n    // NOTE: this method has become less valuable now that we are encouraged to map order by some other index\n    // TODO: provide ONE array-export function, buildArray, which fails on non-numeric indexes. caller can manipulate and \"collect\"\n    RefMap.prototype.collect = function (startIndex, endIndex, step) {\n        return collectFromHash(this.currentMap, startIndex, endIndex, step);\n    };\n    RefMap.prototype.getAll = function () {\n        return hashValuesToArray(this.currentMap);\n    };\n    return RefMap;\n}());\n\nfunction computeShrinkWidth(chunkEls) {\n    var shrinkCells = findElements(chunkEls, '.fc-scrollgrid-shrink');\n    var largestWidth = 0;\n    for (var _i = 0, shrinkCells_1 = shrinkCells; _i < shrinkCells_1.length; _i++) {\n        var shrinkCell = shrinkCells_1[_i];\n        largestWidth = Math.max(largestWidth, computeSmallestCellWidth(shrinkCell));\n    }\n    return Math.ceil(largestWidth); // <table> elements work best with integers. round up to ensure contents fits\n}\nfunction getSectionHasLiquidHeight(props, sectionConfig) {\n    return props.liquid && sectionConfig.liquid; // does the section do liquid-height? (need to have whole scrollgrid liquid-height as well)\n}\nfunction getAllowYScrolling(props, sectionConfig) {\n    return sectionConfig.maxHeight != null || // if its possible for the height to max out, we might need scrollbars\n        getSectionHasLiquidHeight(props, sectionConfig); // if the section is liquid height, it might condense enough to require scrollbars\n}\n// TODO: ONLY use `arg`. force out internal function to use same API\nfunction renderChunkContent(sectionConfig, chunkConfig, arg) {\n    var expandRows = arg.expandRows;\n    var content = typeof chunkConfig.content === 'function' ?\n        chunkConfig.content(arg) :\n        createElement('table', {\n            className: [\n                chunkConfig.tableClassName,\n                sectionConfig.syncRowHeights ? 'fc-scrollgrid-sync-table' : ''\n            ].join(' '),\n            style: {\n                minWidth: arg.tableMinWidth,\n                width: arg.clientWidth,\n                height: expandRows ? arg.clientHeight : '' // css `height` on a <table> serves as a min-height\n            }\n        }, arg.tableColGroupNode, createElement('tbody', {}, typeof chunkConfig.rowContent === 'function' ? chunkConfig.rowContent(arg) : chunkConfig.rowContent));\n    return content;\n}\nfunction isColPropsEqual(cols0, cols1) {\n    return isArraysEqual(cols0, cols1, isPropsEqual);\n}\nfunction renderMicroColGroup(cols, shrinkWidth) {\n    var colNodes = [];\n    /*\n    for ColProps with spans, it would have been great to make a single <col span=\"\">\n    HOWEVER, Chrome was getting messing up distributing the width to <td>/<th> elements with colspans.\n    SOLUTION: making individual <col> elements makes Chrome behave.\n    */\n    for (var _i = 0, cols_1 = cols; _i < cols_1.length; _i++) {\n        var colProps = cols_1[_i];\n        var span = colProps.span || 1;\n        for (var i = 0; i < span; i++) {\n            colNodes.push(createElement(\"col\", { style: {\n                    width: colProps.width === 'shrink' ? sanitizeShrinkWidth(shrinkWidth) : (colProps.width || ''),\n                    minWidth: colProps.minWidth || ''\n                } }));\n        }\n    }\n    return createElement.apply(void 0, __spreadArrays(['colgroup', {}], colNodes));\n}\nfunction sanitizeShrinkWidth(shrinkWidth) {\n    /* why 4? if we do 0, it will kill any border, which are needed for computeSmallestCellWidth\n    4 accounts for 2 2-pixel borders. TODO: better solution? */\n    return shrinkWidth == null ? 4 : shrinkWidth;\n}\nfunction hasShrinkWidth(cols) {\n    for (var _i = 0, cols_2 = cols; _i < cols_2.length; _i++) {\n        var col = cols_2[_i];\n        if (col.width === 'shrink') {\n            return true;\n        }\n    }\n    return false;\n}\nfunction getScrollGridClassNames(liquid, context) {\n    var classNames = [\n        'fc-scrollgrid',\n        context.theme.getClass('table')\n    ];\n    if (liquid) {\n        classNames.push('fc-scrollgrid-liquid');\n    }\n    return classNames;\n}\nfunction getSectionClassNames(sectionConfig, wholeTableVGrow) {\n    var classNames = [\n        'fc-scrollgrid-section',\n        'fc-scrollgrid-section-' + sectionConfig.type,\n        sectionConfig.className // used?\n    ];\n    if (wholeTableVGrow && sectionConfig.liquid && sectionConfig.maxHeight == null) {\n        classNames.push('fc-scrollgrid-section-liquid');\n    }\n    if (sectionConfig.isSticky) {\n        classNames.push('fc-scrollgrid-section-sticky');\n    }\n    return classNames;\n}\nfunction renderScrollShim(arg) {\n    return (createElement(\"div\", { className: 'fc-scrollgrid-sticky-shim', style: {\n            width: arg.clientWidth,\n            minWidth: arg.tableMinWidth\n        } }));\n}\nfunction getStickyHeaderDates(options) {\n    var stickyHeaderDates = options.stickyHeaderDates;\n    if (stickyHeaderDates == null || stickyHeaderDates === 'auto') {\n        stickyHeaderDates = options.height === 'auto' || options.viewHeight === 'auto';\n    }\n    return stickyHeaderDates;\n}\nfunction getStickyFooterScrollbar(options) {\n    var stickyFooterScrollbar = options.stickyFooterScrollbar;\n    if (stickyFooterScrollbar == null || stickyFooterScrollbar === 'auto') {\n        stickyFooterScrollbar = options.height === 'auto' || options.viewHeight === 'auto';\n    }\n    return stickyFooterScrollbar;\n}\n\nvar SimpleScrollGrid = /** @class */ (function (_super) {\n    __extends(SimpleScrollGrid, _super);\n    function SimpleScrollGrid() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.processCols = memoize(function (a) { return a; }, isColPropsEqual); // so we get same `cols` props every time\n        _this.renderMicroColGroup = memoize(renderMicroColGroup); // yucky to memoize VNodes, but much more efficient for consumers\n        _this.scrollerRefs = new RefMap();\n        _this.scrollerElRefs = new RefMap(_this._handleScrollerEl.bind(_this));\n        _this.state = {\n            shrinkWidth: null,\n            forceYScrollbars: false,\n            scrollerClientWidths: {},\n            scrollerClientHeights: {}\n        };\n        // TODO: can do a really simple print-view. dont need to join rows\n        _this.handleSizing = function () {\n            _this.setState(__assign({ shrinkWidth: _this.computeShrinkWidth() }, _this.computeScrollerDims()));\n        };\n        return _this;\n    }\n    SimpleScrollGrid.prototype.render = function () {\n        var _a = this, props = _a.props, state = _a.state, context = _a.context;\n        var sectionConfigs = props.sections || [];\n        var cols = this.processCols(props.cols);\n        var microColGroupNode = this.renderMicroColGroup(cols, state.shrinkWidth);\n        var classNames = getScrollGridClassNames(props.liquid, context);\n        // TODO: make DRY\n        var configCnt = sectionConfigs.length;\n        var configI = 0;\n        var currentConfig;\n        var headSectionNodes = [];\n        var bodySectionNodes = [];\n        var footSectionNodes = [];\n        while (configI < configCnt && (currentConfig = sectionConfigs[configI]).type === 'header') {\n            headSectionNodes.push(this.renderSection(currentConfig, configI, microColGroupNode));\n            configI++;\n        }\n        while (configI < configCnt && (currentConfig = sectionConfigs[configI]).type === 'body') {\n            bodySectionNodes.push(this.renderSection(currentConfig, configI, microColGroupNode));\n            configI++;\n        }\n        while (configI < configCnt && (currentConfig = sectionConfigs[configI]).type === 'footer') {\n            footSectionNodes.push(this.renderSection(currentConfig, configI, microColGroupNode));\n            configI++;\n        }\n        // firefox bug: when setting height on table and there is a thead or tfoot,\n        // the necessary height:100% on the liquid-height body section forces the *whole* table to be taller. (bug #5524)\n        // use getCanVGrowWithinCell as a way to detect table-stupid firefox.\n        // if so, use a simpler dom structure, jam everything into a lone tbody.\n        var isBuggy = !getCanVGrowWithinCell();\n        return createElement('table', {\n            className: classNames.join(' '),\n            style: { height: props.height }\n        }, Boolean(!isBuggy && headSectionNodes.length) && createElement.apply(void 0, __spreadArrays(['thead', {}], headSectionNodes)), Boolean(!isBuggy && bodySectionNodes.length) && createElement.apply(void 0, __spreadArrays(['tbody', {}], bodySectionNodes)), Boolean(!isBuggy && footSectionNodes.length) && createElement.apply(void 0, __spreadArrays(['tfoot', {}], footSectionNodes)), isBuggy && createElement.apply(void 0, __spreadArrays(['tbody', {}], headSectionNodes, bodySectionNodes, footSectionNodes)));\n    };\n    SimpleScrollGrid.prototype.renderSection = function (sectionConfig, sectionI, microColGroupNode) {\n        if ('outerContent' in sectionConfig) {\n            return (createElement(Fragment, { key: sectionConfig.key }, sectionConfig.outerContent));\n        }\n        return (createElement(\"tr\", { key: sectionConfig.key, className: getSectionClassNames(sectionConfig, this.props.liquid).join(' ') }, this.renderChunkTd(sectionConfig, sectionI, microColGroupNode, sectionConfig.chunk)));\n    };\n    SimpleScrollGrid.prototype.renderChunkTd = function (sectionConfig, sectionI, microColGroupNode, chunkConfig) {\n        if ('outerContent' in chunkConfig) {\n            return chunkConfig.outerContent;\n        }\n        var props = this.props;\n        var _a = this.state, forceYScrollbars = _a.forceYScrollbars, scrollerClientWidths = _a.scrollerClientWidths, scrollerClientHeights = _a.scrollerClientHeights;\n        var needsYScrolling = getAllowYScrolling(props, sectionConfig); // TODO: do lazily. do in section config?\n        var isLiquid = getSectionHasLiquidHeight(props, sectionConfig);\n        // for `!props.liquid` - is WHOLE scrollgrid natural height?\n        // TODO: do same thing in advanced scrollgrid? prolly not b/c always has horizontal scrollbars\n        var overflowY = !props.liquid ? 'visible' :\n            forceYScrollbars ? 'scroll' :\n                !needsYScrolling ? 'hidden' :\n                    'auto';\n        var content = renderChunkContent(sectionConfig, chunkConfig, {\n            tableColGroupNode: microColGroupNode,\n            tableMinWidth: '',\n            clientWidth: scrollerClientWidths[sectionI] !== undefined ? scrollerClientWidths[sectionI] : null,\n            clientHeight: scrollerClientHeights[sectionI] !== undefined ? scrollerClientHeights[sectionI] : null,\n            expandRows: sectionConfig.expandRows,\n            syncRowHeights: false,\n            rowSyncHeights: [],\n            reportRowHeightChange: function () { }\n        });\n        return (createElement(\"td\", { ref: chunkConfig.elRef },\n            createElement(\"div\", { className: 'fc-scroller-harness' + (isLiquid ? ' fc-scroller-harness-liquid' : '') },\n                createElement(Scroller, { ref: this.scrollerRefs.createRef(sectionI), elRef: this.scrollerElRefs.createRef(sectionI), overflowY: overflowY, overflowX: !props.liquid ? 'visible' : 'hidden' /* natural height? */, maxHeight: sectionConfig.maxHeight, liquid: isLiquid, liquidIsAbsolute: true /* because its within a harness */ }, content))));\n    };\n    SimpleScrollGrid.prototype._handleScrollerEl = function (scrollerEl, key) {\n        var sectionI = parseInt(key, 10);\n        var chunkConfig = this.props.sections[sectionI].chunk;\n        setRef(chunkConfig.scrollerElRef, scrollerEl);\n    };\n    SimpleScrollGrid.prototype.componentDidMount = function () {\n        this.handleSizing();\n        this.context.addResizeHandler(this.handleSizing);\n    };\n    SimpleScrollGrid.prototype.componentDidUpdate = function () {\n        // TODO: need better solution when state contains non-sizing things\n        this.handleSizing();\n    };\n    SimpleScrollGrid.prototype.componentWillUnmount = function () {\n        this.context.removeResizeHandler(this.handleSizing);\n    };\n    SimpleScrollGrid.prototype.computeShrinkWidth = function () {\n        return hasShrinkWidth(this.props.cols)\n            ? computeShrinkWidth(this.scrollerElRefs.getAll())\n            : 0;\n    };\n    SimpleScrollGrid.prototype.computeScrollerDims = function () {\n        var scrollbarWidth = getScrollbarWidths();\n        var sectionCnt = this.props.sections.length;\n        var _a = this, scrollerRefs = _a.scrollerRefs, scrollerElRefs = _a.scrollerElRefs;\n        var forceYScrollbars = false;\n        var scrollerClientWidths = {};\n        var scrollerClientHeights = {};\n        for (var sectionI = 0; sectionI < sectionCnt; sectionI++) { // along edge\n            var scroller = scrollerRefs.currentMap[sectionI];\n            if (scroller && scroller.needsYScrolling()) {\n                forceYScrollbars = true;\n                break;\n            }\n        }\n        for (var sectionI = 0; sectionI < sectionCnt; sectionI++) { // along edge\n            var scrollerEl = scrollerElRefs.currentMap[sectionI];\n            if (scrollerEl) {\n                var harnessEl = scrollerEl.parentNode; // TODO: weird way to get this. need harness b/c doesn't include table borders\n                scrollerClientWidths[sectionI] = Math.floor(harnessEl.getBoundingClientRect().width - (forceYScrollbars\n                    ? scrollbarWidth.y // use global because scroller might not have scrollbars yet but will need them in future\n                    : 0));\n                scrollerClientHeights[sectionI] = Math.floor(harnessEl.getBoundingClientRect().height // never has horizontal scrollbars\n                );\n            }\n        }\n        return { forceYScrollbars: forceYScrollbars, scrollerClientWidths: scrollerClientWidths, scrollerClientHeights: scrollerClientHeights };\n    };\n    return SimpleScrollGrid;\n}(BaseComponent));\nSimpleScrollGrid.addStateEquality({\n    scrollerClientWidths: isPropsEqual,\n    scrollerClientHeights: isPropsEqual\n});\n\nvar EventRoot = /** @class */ (function (_super) {\n    __extends(EventRoot, _super);\n    function EventRoot() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.elRef = createRef();\n        return _this;\n    }\n    EventRoot.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var options = context.options;\n        var seg = props.seg;\n        var eventRange = seg.eventRange;\n        var ui = eventRange.ui;\n        var hookProps = {\n            event: new EventApi(context, eventRange.def, eventRange.instance),\n            view: context.viewApi,\n            timeText: props.timeText,\n            textColor: ui.textColor,\n            backgroundColor: ui.backgroundColor,\n            borderColor: ui.borderColor,\n            isDraggable: !props.disableDragging && computeSegDraggable(seg, context),\n            isStartResizable: !props.disableResizing && computeSegStartResizable(seg, context),\n            isEndResizable: !props.disableResizing && computeSegEndResizable(seg),\n            isMirror: Boolean(props.isDragging || props.isResizing || props.isDateSelecting),\n            isStart: Boolean(seg.isStart),\n            isEnd: Boolean(seg.isEnd),\n            isPast: Boolean(props.isPast),\n            isFuture: Boolean(props.isFuture),\n            isToday: Boolean(props.isToday),\n            isSelected: Boolean(props.isSelected),\n            isDragging: Boolean(props.isDragging),\n            isResizing: Boolean(props.isResizing)\n        };\n        var standardClassNames = getEventClassNames(hookProps).concat(ui.classNames);\n        return (createElement(RenderHook, { hookProps: hookProps, classNames: options.eventClassNames, content: options.eventContent, defaultContent: props.defaultContent, didMount: options.eventDidMount, willUnmount: options.eventWillUnmount, elRef: this.elRef }, function (rootElRef, customClassNames, innerElRef, innerContent) { return props.children(rootElRef, standardClassNames.concat(customClassNames), innerElRef, innerContent, hookProps); }));\n    };\n    EventRoot.prototype.componentDidMount = function () {\n        setElSeg(this.elRef.current, this.props.seg);\n    };\n    /*\n    need to re-assign seg to the element if seg changes, even if the element is the same\n    */\n    EventRoot.prototype.componentDidUpdate = function (prevProps) {\n        var seg = this.props.seg;\n        if (seg !== prevProps.seg) {\n            setElSeg(this.elRef.current, seg);\n        }\n    };\n    return EventRoot;\n}(BaseComponent));\n\n// should not be a purecomponent\nvar StandardEvent = /** @class */ (function (_super) {\n    __extends(StandardEvent, _super);\n    function StandardEvent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    StandardEvent.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var seg = props.seg;\n        var timeFormat = context.options.eventTimeFormat || props.defaultTimeFormat;\n        var timeText = buildSegTimeText(seg, timeFormat, context, props.defaultDisplayEventTime, props.defaultDisplayEventEnd);\n        return (createElement(EventRoot, { seg: seg, timeText: timeText, disableDragging: props.disableDragging, disableResizing: props.disableResizing, defaultContent: props.defaultContent || renderInnerContent, isDragging: props.isDragging, isResizing: props.isResizing, isDateSelecting: props.isDateSelecting, isSelected: props.isSelected, isPast: props.isPast, isFuture: props.isFuture, isToday: props.isToday }, function (rootElRef, classNames, innerElRef, innerContent, hookProps) { return (createElement(\"a\", __assign({ className: props.extraClassNames.concat(classNames).join(' '), style: {\n                borderColor: hookProps.borderColor,\n                backgroundColor: hookProps.backgroundColor\n            }, ref: rootElRef }, getSegAnchorAttrs(seg)),\n            createElement(\"div\", { className: 'fc-event-main', ref: innerElRef, style: { color: hookProps.textColor } }, innerContent),\n            hookProps.isStartResizable &&\n                createElement(\"div\", { className: 'fc-event-resizer fc-event-resizer-start' }),\n            hookProps.isEndResizable &&\n                createElement(\"div\", { className: 'fc-event-resizer fc-event-resizer-end' }))); }));\n    };\n    return StandardEvent;\n}(BaseComponent));\nfunction renderInnerContent(innerProps) {\n    return (createElement(\"div\", { className: 'fc-event-main-frame' },\n        innerProps.timeText &&\n            createElement(\"div\", { className: 'fc-event-time' }, innerProps.timeText),\n        createElement(\"div\", { className: 'fc-event-title-container' },\n            createElement(\"div\", { className: 'fc-event-title fc-sticky' }, innerProps.event.title || createElement(Fragment, null, \"\\u00A0\")))));\n}\nfunction getSegAnchorAttrs(seg) {\n    var url = seg.eventRange.def.url;\n    return url ? { href: url } : {};\n}\n\nvar NowIndicatorRoot = function (props) { return (createElement(ViewContextType.Consumer, null, function (context) {\n    var options = context.options;\n    var hookProps = {\n        isAxis: props.isAxis,\n        date: context.dateEnv.toDate(props.date),\n        view: context.viewApi\n    };\n    return (createElement(RenderHook, { hookProps: hookProps, classNames: options.nowIndicatorClassNames, content: options.nowIndicatorContent, didMount: options.nowIndicatorDidMount, willUnmount: options.nowIndicatorWillUnmount }, props.children));\n})); };\n\nvar DAY_NUM_FORMAT = createFormatter({ day: 'numeric' });\nvar DayCellRoot = /** @class */ (function (_super) {\n    __extends(DayCellRoot, _super);\n    function DayCellRoot() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.refineHookProps = memoizeObjArg(refineHookProps);\n        _this.normalizeClassNames = buildClassNameNormalizer();\n        return _this;\n    }\n    DayCellRoot.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var options = context.options;\n        var hookProps = this.refineHookProps({\n            date: props.date,\n            dateProfile: props.dateProfile,\n            todayRange: props.todayRange,\n            showDayNumber: props.showDayNumber,\n            extraProps: props.extraHookProps,\n            viewApi: context.viewApi,\n            dateEnv: context.dateEnv\n        });\n        var classNames = getDayClassNames(hookProps, context.theme).concat(hookProps.isDisabled\n            ? [] // don't use custom classNames if disabled\n            : this.normalizeClassNames(options.dayCellClassNames, hookProps));\n        var dataAttrs = hookProps.isDisabled ? {} : {\n            'data-date': formatDayString(props.date)\n        };\n        return (createElement(MountHook, { hookProps: hookProps, didMount: options.dayCellDidMount, willUnmount: options.dayCellWillUnmount, elRef: props.elRef }, function (rootElRef) { return props.children(rootElRef, classNames, dataAttrs, hookProps.isDisabled); }));\n    };\n    return DayCellRoot;\n}(BaseComponent));\nvar DayCellContent = /** @class */ (function (_super) {\n    __extends(DayCellContent, _super);\n    function DayCellContent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DayCellContent.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var options = context.options;\n        var hookProps = refineHookProps({\n            date: props.date,\n            dateProfile: props.dateProfile,\n            todayRange: props.todayRange,\n            showDayNumber: props.showDayNumber,\n            extraProps: props.extraHookProps,\n            viewApi: context.viewApi,\n            dateEnv: context.dateEnv\n        });\n        return (createElement(ContentHook, { hookProps: hookProps, content: options.dayCellContent, defaultContent: props.defaultContent }, props.children));\n    };\n    return DayCellContent;\n}(BaseComponent));\nfunction refineHookProps(raw) {\n    var date = raw.date, dateEnv = raw.dateEnv;\n    var dayMeta = getDateMeta(date, raw.todayRange, null, raw.dateProfile);\n    return __assign(__assign(__assign({ date: dateEnv.toDate(date), view: raw.viewApi }, dayMeta), { dayNumberText: raw.showDayNumber ? dateEnv.format(date, DAY_NUM_FORMAT) : '' }), raw.extraProps);\n}\n\nfunction renderFill(fillType) {\n    return (createElement(\"div\", { className: \"fc-\" + fillType }));\n}\nvar BgEvent = function (props) { return (createElement(EventRoot, { defaultContent: renderInnerContent$1, seg: props.seg /* uselesss i think */, timeText: '' /* weird */, disableDragging: true, disableResizing: true, isDragging: false, isResizing: false, isDateSelecting: false, isSelected: false, isPast: props.isPast, isFuture: props.isFuture, isToday: props.isToday }, function (rootElRef, classNames, innerElRef, innerContent, hookProps) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-bg-event'].concat(classNames).join(' '), style: {\n        backgroundColor: hookProps.backgroundColor\n    } }, innerContent)); })); };\nfunction renderInnerContent$1(props) {\n    var title = props.event.title;\n    return title && (createElement(\"div\", { className: 'fc-event-title' }, props.event.title));\n}\n\nvar WeekNumberRoot = function (props) { return (createElement(ViewContextType.Consumer, null, function (context) {\n    var dateEnv = context.dateEnv, options = context.options;\n    var date = props.date;\n    var format = options.weekNumberFormat || props.defaultFormat;\n    var num = dateEnv.computeWeekNumber(date); // TODO: somehow use for formatting as well?\n    var text = dateEnv.format(date, format);\n    var hookProps = { num: num, text: text, date: date };\n    return (createElement(RenderHook, { hookProps: hookProps, classNames: options.weekNumberClassNames, content: options.weekNumberContent, defaultContent: renderInner$1, didMount: options.weekNumberDidMount, willUnmount: options.weekNumberWillUnmount }, props.children));\n})); };\nfunction renderInner$1(innerProps) {\n    return innerProps.text;\n}\n\n// exports\n// --------------------------------------------------------------------------------------------------\nvar version = '5.3.1'; // important to type it, so .d.ts has generic string\n\nexport { BASE_OPTION_DEFAULTS, BASE_OPTION_REFINERS, BaseComponent, BgEvent, CalendarApi, CalendarContent, CalendarDataManager, CalendarDataProvider, CalendarRoot, ContentHook, CustomContentRenderContext, DateComponent, DateEnv, DateProfileGenerator, DayCellContent, DayCellRoot, DayHeader, DaySeriesModel, DayTableModel, DelayedRunner, ElementDragging, ElementScrollController, Emitter, EventApi, EventRoot, EventSourceApi, Interaction, MountHook, NamedTimeZoneImpl, NowIndicatorRoot, NowTimer, PositionCache, RefMap, RenderHook, ScrollController, ScrollResponder, Scroller, SimpleScrollGrid, Slicer, Splitter, StandardEvent, TableDateCell, TableDowCell, Theme, ViewApi, ViewContextType, ViewRoot, WeekNumberRoot, WindowScrollController, addDays, addDurations, addMs, addWeeks, allowContextMenu, allowSelection, applyMutationToEventStore, applyStyle, applyStyleProp, asCleanDays, asRoughMinutes, asRoughMs, asRoughSeconds, buildClassNameNormalizer, buildEventApis, buildEventRangeKey, buildHashFromArray, buildNavLinkData, buildSegCompareObj, buildSegTimeText, collectFromHash, combineEventUis, compareByFieldSpec, compareByFieldSpecs, compareNumbers, compareObjs, computeEdges, computeFallbackHeaderFormat, computeHeightAndMargins, computeInnerRect, computeRect, computeSegDraggable, computeSegEndResizable, computeSegStartResizable, computeShrinkWidth, computeSmallestCellWidth, computeVisibleDayRange, config, constrainPoint, createDuration, createEmptyEventStore, createEventInstance, createEventUi, createFormatter, createPlugin, diffDates, diffDayAndTime, diffDays, diffPoints, diffWeeks, diffWholeDays, diffWholeWeeks, disableCursor, elementClosest, elementMatches, enableCursor, eventTupleToStore, filterEventStoreDefs, filterHash, findDirectChildren, findElements, flexibleCompare, formatDate, formatDayString, formatIsoTimeString, formatRange, getAllowYScrolling, getCanVGrowWithinCell, getClippingParents, getDateMeta, getDayClassNames, getDefaultEventEnd, getElSeg, getEventClassNames, getIsRtlScrollbarOnLeft, getRectCenter, getRelevantEvents, getScrollGridClassNames, getScrollbarWidths, getSectionClassNames, getSectionHasLiquidHeight, getSegMeta, getSlotClassNames, getStickyFooterScrollbar, getStickyHeaderDates, getUnequalProps, globalLocales, globalPlugins, greatestDurationDenominator, guid, hasBgRendering, hasShrinkWidth, identity, interactionSettingsStore, interactionSettingsToStore, intersectRanges, intersectRects, isArraysEqual, isColPropsEqual, isDateSpansEqual, isInt, isInteractionValid, isMultiDayRange, isPropsEqual, isPropsValid, isValidDate, listenBySelector, mapHash, memoize, memoizeArraylike, memoizeHashlike, memoizeObjArg, mergeEventStores, multiplyDuration, padStart, parseBusinessHours, parseClassNames, parseDragMeta, parseEventDef, parseFieldSpecs, parse as parseMarker, pointInsideRect, preventContextMenu, preventDefault, preventSelection, rangeContainsMarker, rangeContainsRange, rangesEqual, rangesIntersect, refineEventDef, refineProps, removeElement, removeExact, renderChunkContent, renderFill, renderMicroColGroup, renderScrollShim, requestJson, sanitizeShrinkWidth, setElSeg, setRef, sliceEventStore, sliceEvents, sortEventSegs, startOfDay, translateRect, triggerDateSelect, unpromisify, version, whenTransitionDone, wholeDivideDurations };\n//# sourceMappingURL=main.js.map\n","/*!\nFullCalendar v5.3.1\nDocs & License: https://fullcalendar.io/\n(c) 2020 Adam Shaw\n*/\nimport './vdom';\nimport { __extends, __assign } from 'tslib';\nimport { render, createElement, CalendarRoot, CustomContentRenderContext, CalendarContent, flushToDom, DelayedRunner, CalendarDataManager, isArraysEqual, applyStyleProp, CalendarApi } from '@fullcalendar/common';\nexport * from '@fullcalendar/common';\n\nvar Calendar = /** @class */ (function (_super) {\n    __extends(Calendar, _super);\n    function Calendar(el, optionOverrides) {\n        if (optionOverrides === void 0) { optionOverrides = {}; }\n        var _this = _super.call(this) || this;\n        _this.isRendering = false;\n        _this.isRendered = false;\n        _this.currentClassNames = [];\n        _this.customContentRenderId = 0; // will affect custom generated classNames?\n        _this.handleAction = function (action) {\n            // actions we know we want to render immediately\n            switch (action.type) {\n                case 'SET_EVENT_DRAG':\n                case 'SET_EVENT_RESIZE':\n                    _this.renderRunner.tryDrain();\n            }\n        };\n        _this.handleData = function (data) {\n            _this.currentData = data;\n            _this.renderRunner.request(data.calendarOptions.rerenderDelay);\n        };\n        _this.handleRenderRequest = function () {\n            if (_this.isRendering) {\n                _this.isRendered = true;\n                var currentData_1 = _this.currentData;\n                render(createElement(CalendarRoot, { options: currentData_1.calendarOptions, theme: currentData_1.theme, emitter: currentData_1.emitter }, function (classNames, height, isHeightAuto, forPrint) {\n                    _this.setClassNames(classNames);\n                    _this.setHeight(height);\n                    return (createElement(CustomContentRenderContext.Provider, { value: _this.customContentRenderId },\n                        createElement(CalendarContent, __assign({ isHeightAuto: isHeightAuto, forPrint: forPrint }, currentData_1))));\n                }), _this.el);\n            }\n            else if (_this.isRendered) {\n                _this.isRendered = false;\n                render(null, _this.el);\n                _this.setClassNames([]);\n                _this.setHeight('');\n            }\n            flushToDom();\n        };\n        _this.el = el;\n        _this.renderRunner = new DelayedRunner(_this.handleRenderRequest);\n        new CalendarDataManager({\n            optionOverrides: optionOverrides,\n            calendarApi: _this,\n            onAction: _this.handleAction,\n            onData: _this.handleData\n        });\n        return _this;\n    }\n    Object.defineProperty(Calendar.prototype, \"view\", {\n        get: function () { return this.currentData.viewApi; } // for public API\n        ,\n        enumerable: false,\n        configurable: true\n    });\n    Calendar.prototype.render = function () {\n        var wasRendering = this.isRendering;\n        if (!wasRendering) {\n            this.isRendering = true;\n        }\n        else {\n            this.customContentRenderId++;\n        }\n        this.renderRunner.request();\n        if (wasRendering) {\n            this.updateSize();\n        }\n    };\n    Calendar.prototype.destroy = function () {\n        if (this.isRendering) {\n            this.isRendering = false;\n            this.renderRunner.request();\n        }\n    };\n    Calendar.prototype.updateSize = function () {\n        _super.prototype.updateSize.call(this);\n        flushToDom();\n    };\n    Calendar.prototype.batchRendering = function (func) {\n        this.renderRunner.pause('batchRendering');\n        func();\n        this.renderRunner.resume('batchRendering');\n    };\n    Calendar.prototype.pauseRendering = function () {\n        this.renderRunner.pause('pauseRendering');\n    };\n    Calendar.prototype.resumeRendering = function () {\n        this.renderRunner.resume('pauseRendering', true);\n    };\n    Calendar.prototype.resetOptions = function (optionOverrides, append) {\n        this.currentDataManager.resetOptions(optionOverrides, append);\n    };\n    Calendar.prototype.setClassNames = function (classNames) {\n        if (!isArraysEqual(classNames, this.currentClassNames)) {\n            var classList = this.el.classList;\n            for (var _i = 0, _a = this.currentClassNames; _i < _a.length; _i++) {\n                var className = _a[_i];\n                classList.remove(className);\n            }\n            for (var _b = 0, classNames_1 = classNames; _b < classNames_1.length; _b++) {\n                var className = classNames_1[_b];\n                classList.add(className);\n            }\n            this.currentClassNames = classNames;\n        }\n    };\n    Calendar.prototype.setHeight = function (height) {\n        applyStyleProp(this.el, 'height', height);\n    };\n    return Calendar;\n}(CalendarApi));\n\nexport { Calendar };\n//# sourceMappingURL=main.js.map\n","/*!\nFullCalendar v5.3.2\nDocs & License: https://fullcalendar.io/\n(c) 2020 Adam Shaw\n*/\nimport './main.css';\n\nimport { createRef, getStickyHeaderDates, createElement, ViewRoot, SimpleScrollGrid, getStickyFooterScrollbar, DateComponent, renderScrollShim, createFormatter, setRef, buildNavLinkData, DayCellRoot, WeekNumberRoot, RenderHook, DayCellContent, Fragment, BaseComponent, buildSegTimeText, EventRoot, StandardEvent, sortEventSegs, addDays, intersectRanges, RefMap, isPropsEqual, getSegMeta, buildEventRangeKey, BgEvent, renderFill, PositionCache, mapHash, DelayedRunner, applyStyle, memoize, NowTimer, EventApi, Slicer, DayHeader, DaySeriesModel, DayTableModel, addWeeks, diffWeeks, DateProfileGenerator, identity, createPlugin } from '@fullcalendar/common';\nimport { __extends, __assign, __spreadArrays } from 'tslib';\n\n/* An abstract class for the daygrid views, as well as month view. Renders one or more rows of day cells.\n----------------------------------------------------------------------------------------------------------------------*/\n// It is a manager for a Table subcomponent, which does most of the heavy lifting.\n// It is responsible for managing width/height.\nvar TableView = /** @class */ (function (_super) {\n    __extends(TableView, _super);\n    function TableView() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.headerElRef = createRef();\n        return _this;\n    }\n    TableView.prototype.renderSimpleLayout = function (headerRowContent, bodyContent) {\n        var _a = this, props = _a.props, context = _a.context;\n        var sections = [];\n        var stickyHeaderDates = getStickyHeaderDates(context.options);\n        if (headerRowContent) {\n            sections.push({\n                type: 'header',\n                key: 'header',\n                isSticky: stickyHeaderDates,\n                chunk: {\n                    elRef: this.headerElRef,\n                    tableClassName: 'fc-col-header',\n                    rowContent: headerRowContent\n                }\n            });\n        }\n        sections.push({\n            type: 'body',\n            key: 'body',\n            liquid: true,\n            chunk: { content: bodyContent }\n        });\n        return (createElement(ViewRoot, { viewSpec: context.viewSpec }, function (rootElRef, classNames) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-daygrid'].concat(classNames).join(' ') },\n            createElement(SimpleScrollGrid, { liquid: !props.isHeightAuto && !props.forPrint, cols: [] /* TODO: make optional? */, sections: sections }))); }));\n    };\n    TableView.prototype.renderHScrollLayout = function (headerRowContent, bodyContent, colCnt, dayMinWidth) {\n        var ScrollGrid = this.context.pluginHooks.scrollGridImpl;\n        if (!ScrollGrid) {\n            throw new Error('No ScrollGrid implementation');\n        }\n        var _a = this, props = _a.props, context = _a.context;\n        var stickyHeaderDates = !props.forPrint && getStickyHeaderDates(context.options);\n        var stickyFooterScrollbar = !props.forPrint && getStickyFooterScrollbar(context.options);\n        var sections = [];\n        if (headerRowContent) {\n            sections.push({\n                type: 'header',\n                key: 'header',\n                isSticky: stickyHeaderDates,\n                chunks: [{\n                        key: 'main',\n                        elRef: this.headerElRef,\n                        tableClassName: 'fc-col-header',\n                        rowContent: headerRowContent\n                    }]\n            });\n        }\n        sections.push({\n            type: 'body',\n            key: 'body',\n            liquid: true,\n            chunks: [{\n                    key: 'main',\n                    content: bodyContent\n                }]\n        });\n        if (stickyFooterScrollbar) {\n            sections.push({\n                type: 'footer',\n                key: 'footer',\n                isSticky: true,\n                chunks: [{\n                        key: 'main',\n                        content: renderScrollShim\n                    }]\n            });\n        }\n        return (createElement(ViewRoot, { viewSpec: context.viewSpec }, function (rootElRef, classNames) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-daygrid'].concat(classNames).join(' ') },\n            createElement(ScrollGrid, { liquid: !props.isHeightAuto && !props.forPrint, colGroups: [{ cols: [{ span: colCnt, minWidth: dayMinWidth }] }], sections: sections }))); }));\n    };\n    return TableView;\n}(DateComponent));\n\nfunction splitSegsByRow(segs, rowCnt) {\n    var byRow = [];\n    for (var i = 0; i < rowCnt; i++) {\n        byRow[i] = [];\n    }\n    for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n        var seg = segs_1[_i];\n        byRow[seg.row].push(seg);\n    }\n    return byRow;\n}\nfunction splitSegsByFirstCol(segs, colCnt) {\n    var byCol = [];\n    for (var i = 0; i < colCnt; i++) {\n        byCol[i] = [];\n    }\n    for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n        var seg = segs_2[_i];\n        byCol[seg.firstCol].push(seg);\n    }\n    return byCol;\n}\nfunction splitInteractionByRow(ui, rowCnt) {\n    var byRow = [];\n    if (!ui) {\n        for (var i = 0; i < rowCnt; i++) {\n            byRow[i] = null;\n        }\n    }\n    else {\n        for (var i = 0; i < rowCnt; i++) {\n            byRow[i] = {\n                affectedInstances: ui.affectedInstances,\n                isEvent: ui.isEvent,\n                segs: []\n            };\n        }\n        for (var _i = 0, _a = ui.segs; _i < _a.length; _i++) {\n            var seg = _a[_i];\n            byRow[seg.row].segs.push(seg);\n        }\n    }\n    return byRow;\n}\n\nvar DEFAULT_WEEK_NUM_FORMAT = createFormatter({ week: 'narrow' });\nvar TableCell = /** @class */ (function (_super) {\n    __extends(TableCell, _super);\n    function TableCell() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.handleRootEl = function (el) {\n            _this.rootEl = el;\n            setRef(_this.props.elRef, el);\n        };\n        _this.handleMoreLinkClick = function (ev) {\n            var props = _this.props;\n            if (props.onMoreClick) {\n                var allSegs = props.segsByEachCol;\n                var hiddenSegs = allSegs.filter(function (seg) { return props.segIsHidden[seg.eventRange.instance.instanceId]; });\n                props.onMoreClick({\n                    date: props.date,\n                    allSegs: allSegs,\n                    hiddenSegs: hiddenSegs,\n                    moreCnt: props.moreCnt,\n                    dayEl: _this.rootEl,\n                    ev: ev\n                });\n            }\n        };\n        return _this;\n    }\n    TableCell.prototype.render = function () {\n        var _this = this;\n        var _a = this.context, options = _a.options, viewApi = _a.viewApi;\n        var props = this.props;\n        var date = props.date, dateProfile = props.dateProfile;\n        var hookProps = {\n            num: props.moreCnt,\n            text: props.buildMoreLinkText(props.moreCnt),\n            view: viewApi\n        };\n        var navLinkAttrs = options.navLinks\n            ? { 'data-navlink': buildNavLinkData(date, 'week'), tabIndex: 0 }\n            : {};\n        return (createElement(DayCellRoot, { date: date, dateProfile: dateProfile, todayRange: props.todayRange, showDayNumber: props.showDayNumber, extraHookProps: props.extraHookProps, elRef: this.handleRootEl }, function (rootElRef, classNames, rootDataAttrs, isDisabled) { return (createElement(\"td\", __assign({ ref: rootElRef, className: ['fc-daygrid-day'].concat(classNames, props.extraClassNames || []).join(' ') }, rootDataAttrs, props.extraDataAttrs),\n            createElement(\"div\", { className: 'fc-daygrid-day-frame fc-scrollgrid-sync-inner', ref: props.innerElRef /* different from hook system! RENAME */ },\n                props.showWeekNumber &&\n                    createElement(WeekNumberRoot, { date: date, defaultFormat: DEFAULT_WEEK_NUM_FORMAT }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"a\", __assign({ ref: rootElRef, className: ['fc-daygrid-week-number'].concat(classNames).join(' ') }, navLinkAttrs), innerContent)); }),\n                !isDisabled &&\n                    createElement(TableCellTop, { date: date, dateProfile: dateProfile, showDayNumber: props.showDayNumber, forceDayTop: props.forceDayTop, todayRange: props.todayRange, extraHookProps: props.extraHookProps }),\n                createElement(\"div\", { className: 'fc-daygrid-day-events', ref: props.fgContentElRef, style: { paddingBottom: props.fgPaddingBottom } },\n                    props.fgContent,\n                    Boolean(props.moreCnt) &&\n                        createElement(\"div\", { className: 'fc-daygrid-day-bottom', style: { marginTop: props.moreMarginTop } },\n                            createElement(RenderHook, { hookProps: hookProps, classNames: options.moreLinkClassNames, content: options.moreLinkContent, defaultContent: renderMoreLinkInner, didMount: options.moreLinkDidMount, willUnmount: options.moreLinkWillUnmount }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"a\", { onClick: _this.handleMoreLinkClick, ref: rootElRef, className: ['fc-daygrid-more-link'].concat(classNames).join(' ') }, innerContent)); }))),\n                createElement(\"div\", { className: 'fc-daygrid-day-bg' }, props.bgContent)))); }));\n    };\n    return TableCell;\n}(DateComponent));\nfunction renderTopInner(props) {\n    return props.dayNumberText;\n}\nfunction renderMoreLinkInner(props) {\n    return props.text;\n}\nvar TableCellTop = /** @class */ (function (_super) {\n    __extends(TableCellTop, _super);\n    function TableCellTop() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TableCellTop.prototype.render = function () {\n        var props = this.props;\n        var navLinkAttrs = this.context.options.navLinks\n            ? { 'data-navlink': buildNavLinkData(props.date), tabIndex: 0 }\n            : {};\n        return (createElement(DayCellContent, { date: props.date, dateProfile: props.dateProfile, todayRange: props.todayRange, showDayNumber: props.showDayNumber, extraHookProps: props.extraHookProps, defaultContent: renderTopInner }, function (innerElRef, innerContent) { return ((innerContent || props.forceDayTop) &&\n            createElement(\"div\", { className: 'fc-daygrid-day-top', ref: innerElRef },\n                createElement(\"a\", __assign({ className: 'fc-daygrid-day-number' }, navLinkAttrs), innerContent || createElement(Fragment, null, \"\\u00A0\")))); }));\n    };\n    return TableCellTop;\n}(BaseComponent));\n\nvar DEFAULT_TABLE_EVENT_TIME_FORMAT = createFormatter({\n    hour: 'numeric',\n    minute: '2-digit',\n    omitZeroMinute: true,\n    meridiem: 'narrow'\n});\nfunction hasListItemDisplay(seg) {\n    var display = seg.eventRange.ui.display;\n    return display === 'list-item' || (display === 'auto' &&\n        !seg.eventRange.def.allDay &&\n        seg.firstCol === seg.lastCol && // can't be multi-day\n        seg.isStart && // \"\n        seg.isEnd // \"\n    );\n}\n\nvar TableListItemEvent = /** @class */ (function (_super) {\n    __extends(TableListItemEvent, _super);\n    function TableListItemEvent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TableListItemEvent.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var timeFormat = context.options.eventTimeFormat || DEFAULT_TABLE_EVENT_TIME_FORMAT;\n        var timeText = buildSegTimeText(props.seg, timeFormat, context, true, props.defaultDisplayEventEnd);\n        return (createElement(EventRoot, { seg: props.seg, timeText: timeText, defaultContent: renderInnerContent, isDragging: props.isDragging, isResizing: false, isDateSelecting: false, isSelected: props.isSelected, isPast: props.isPast, isFuture: props.isFuture, isToday: props.isToday }, function (rootElRef, classNames, innerElRef, innerContent) { return ( // we don't use styles!\n        createElement(\"a\", __assign({ className: ['fc-daygrid-event', 'fc-daygrid-dot-event'].concat(classNames).join(' '), ref: rootElRef }, getSegAnchorAttrs(props.seg)), innerContent)); }));\n    };\n    return TableListItemEvent;\n}(BaseComponent));\nfunction renderInnerContent(innerProps) {\n    return (createElement(Fragment, null,\n        createElement(\"div\", { className: 'fc-daygrid-event-dot', style: { borderColor: innerProps.borderColor || innerProps.backgroundColor } }),\n        innerProps.timeText &&\n            createElement(\"div\", { className: 'fc-event-time' }, innerProps.timeText),\n        createElement(\"div\", { className: 'fc-event-title' }, innerProps.event.title || createElement(Fragment, null, \"\\u00A0\"))));\n}\nfunction getSegAnchorAttrs(seg) {\n    var url = seg.eventRange.def.url;\n    return url ? { href: url } : {};\n}\n\nvar TableBlockEvent = /** @class */ (function (_super) {\n    __extends(TableBlockEvent, _super);\n    function TableBlockEvent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TableBlockEvent.prototype.render = function () {\n        var props = this.props;\n        return (createElement(StandardEvent, __assign({}, props, { extraClassNames: ['fc-daygrid-event', 'fc-daygrid-block-event', 'fc-h-event'], defaultTimeFormat: DEFAULT_TABLE_EVENT_TIME_FORMAT, defaultDisplayEventEnd: props.defaultDisplayEventEnd, disableResizing: !props.seg.eventRange.def.allDay })));\n    };\n    return TableBlockEvent;\n}(BaseComponent));\n\nfunction computeFgSegPlacement(// for one row. TODO: print mode?\ncellModels, segs, dayMaxEvents, dayMaxEventRows, eventHeights, maxContentHeight, colCnt, eventOrderSpecs) {\n    var colPlacements = []; // if event spans multiple cols, its present in each col\n    var moreCnts = []; // by-col\n    var segIsHidden = {};\n    var segTops = {}; // always populated for each seg\n    var segMarginTops = {}; // simetimes populated for each seg\n    var moreTops = {};\n    var paddingBottoms = {}; // for each cell's inner-wrapper div\n    for (var i = 0; i < colCnt; i++) {\n        colPlacements.push([]);\n        moreCnts.push(0);\n    }\n    segs = sortEventSegs(segs, eventOrderSpecs);\n    for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n        var seg = segs_1[_i];\n        var instanceId = seg.eventRange.instance.instanceId;\n        var eventHeight = eventHeights[instanceId + ':' + seg.firstCol];\n        placeSeg(seg, eventHeight || 0); // will keep colPlacements sorted by top\n    }\n    if (dayMaxEvents === true || dayMaxEventRows === true) {\n        limitByMaxHeight(moreCnts, segIsHidden, colPlacements, maxContentHeight); // populates moreCnts/segIsHidden\n    }\n    else if (typeof dayMaxEvents === 'number') {\n        limitByMaxEvents(moreCnts, segIsHidden, colPlacements, dayMaxEvents); // populates moreCnts/segIsHidden\n    }\n    else if (typeof dayMaxEventRows === 'number') {\n        limitByMaxRows(moreCnts, segIsHidden, colPlacements, dayMaxEventRows); // populates moreCnts/segIsHidden\n    }\n    // computes segTops/segMarginTops/moreTops/paddingBottoms\n    for (var col = 0; col < colCnt; col++) {\n        var placements = colPlacements[col];\n        var currentNonAbsBottom = 0;\n        var currentAbsHeight = 0;\n        for (var _a = 0, placements_1 = placements; _a < placements_1.length; _a++) {\n            var placement = placements_1[_a];\n            var seg = placement.seg;\n            if (!segIsHidden[seg.eventRange.instance.instanceId]) {\n                segTops[seg.eventRange.instance.instanceId] = placement.top; // from top of container\n                if (seg.firstCol === seg.lastCol && seg.isStart && seg.isEnd) { // TODO: simpler way? NOT DRY\n                    segMarginTops[seg.eventRange.instance.instanceId] =\n                        placement.top - currentNonAbsBottom; // from previous seg bottom\n                    currentAbsHeight = 0;\n                    currentNonAbsBottom = placement.bottom;\n                }\n                else { // multi-col event, abs positioned\n                    currentAbsHeight = placement.bottom - currentNonAbsBottom;\n                }\n            }\n        }\n        if (currentAbsHeight) {\n            if (moreCnts[col]) {\n                moreTops[col] = currentAbsHeight;\n            }\n            else {\n                paddingBottoms[col] = currentAbsHeight;\n            }\n        }\n    }\n    function placeSeg(seg, segHeight) {\n        if (!tryPlaceSegAt(seg, segHeight, 0)) {\n            for (var col = seg.firstCol; col <= seg.lastCol; col++) {\n                for (var _i = 0, _a = colPlacements[col]; _i < _a.length; _i++) { // will repeat multi-day segs!!!!!!! bad!!!!!!\n                    var placement = _a[_i];\n                    if (tryPlaceSegAt(seg, segHeight, placement.bottom)) {\n                        return;\n                    }\n                }\n            }\n        }\n    }\n    function tryPlaceSegAt(seg, segHeight, top) {\n        if (canPlaceSegAt(seg, segHeight, top)) {\n            for (var col = seg.firstCol; col <= seg.lastCol; col++) {\n                var placements = colPlacements[col];\n                var insertionIndex = 0;\n                while (insertionIndex < placements.length &&\n                    top >= placements[insertionIndex].top) {\n                    insertionIndex++;\n                }\n                placements.splice(insertionIndex, 0, {\n                    seg: seg,\n                    top: top,\n                    bottom: top + segHeight\n                });\n            }\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    function canPlaceSegAt(seg, segHeight, top) {\n        for (var col = seg.firstCol; col <= seg.lastCol; col++) {\n            for (var _i = 0, _a = colPlacements[col]; _i < _a.length; _i++) {\n                var placement = _a[_i];\n                if (top < placement.bottom && top + segHeight > placement.top) { // collide?\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    // what does this do!?\n    for (var instanceIdAndFirstCol in eventHeights) {\n        if (!eventHeights[instanceIdAndFirstCol]) {\n            segIsHidden[instanceIdAndFirstCol.split(':')[0]] = true;\n        }\n    }\n    var segsByFirstCol = colPlacements.map(extractFirstColSegs); // operates on the sorted cols\n    var segsByEachCol = colPlacements.map(function (placements, col) {\n        var segs = extractAllColSegs(placements);\n        segs = resliceDaySegs(segs, cellModels[col].date, col);\n        return segs;\n    });\n    return {\n        segsByFirstCol: segsByFirstCol,\n        segsByEachCol: segsByEachCol,\n        segIsHidden: segIsHidden,\n        segTops: segTops,\n        segMarginTops: segMarginTops,\n        moreCnts: moreCnts,\n        moreTops: moreTops,\n        paddingBottoms: paddingBottoms\n    };\n}\nfunction extractFirstColSegs(oneColPlacements, col) {\n    var segs = [];\n    for (var _i = 0, oneColPlacements_1 = oneColPlacements; _i < oneColPlacements_1.length; _i++) {\n        var placement = oneColPlacements_1[_i];\n        if (placement.seg.firstCol === col) {\n            segs.push(placement.seg);\n        }\n    }\n    return segs;\n}\nfunction extractAllColSegs(oneColPlacements) {\n    var segs = [];\n    for (var _i = 0, oneColPlacements_2 = oneColPlacements; _i < oneColPlacements_2.length; _i++) {\n        var placement = oneColPlacements_2[_i];\n        segs.push(placement.seg);\n    }\n    return segs;\n}\nfunction limitByMaxHeight(hiddenCnts, segIsHidden, colPlacements, maxContentHeight) {\n    limitEvents(hiddenCnts, segIsHidden, colPlacements, true, function (placement) {\n        return placement.bottom <= maxContentHeight;\n    });\n}\nfunction limitByMaxEvents(hiddenCnts, segIsHidden, colPlacements, dayMaxEvents) {\n    limitEvents(hiddenCnts, segIsHidden, colPlacements, false, function (placement, levelIndex) {\n        return levelIndex < dayMaxEvents;\n    });\n}\nfunction limitByMaxRows(hiddenCnts, segIsHidden, colPlacements, dayMaxEventRows) {\n    limitEvents(hiddenCnts, segIsHidden, colPlacements, true, function (placement, levelIndex) {\n        return levelIndex < dayMaxEventRows;\n    });\n}\n/*\npopulates the given hiddenCnts/segIsHidden, which are supplied empty.\nTODO: return them instead\n*/\nfunction limitEvents(hiddenCnts, segIsHidden, colPlacements, _moreLinkConsumesLevel, isPlacementInBounds) {\n    var colCnt = hiddenCnts.length;\n    var segIsVisible = {}; // TODO: instead, use segIsHidden with true/false?\n    var visibleColPlacements = []; // will mirror colPlacements\n    for (var col = 0; col < colCnt; col++) {\n        visibleColPlacements.push([]);\n    }\n    for (var col = 0; col < colCnt; col++) {\n        var placements = colPlacements[col];\n        var level = 0;\n        for (var _i = 0, placements_2 = placements; _i < placements_2.length; _i++) {\n            var placement = placements_2[_i];\n            if (isPlacementInBounds(placement, level)) {\n                recordVisible(placement);\n            }\n            else {\n                recordHidden(placement, level, _moreLinkConsumesLevel);\n            }\n            // only considered a level if the seg had height\n            if (placement.top !== placement.bottom) {\n                level++;\n            }\n        }\n    }\n    function recordVisible(placement) {\n        var seg = placement.seg;\n        var instanceId = seg.eventRange.instance.instanceId;\n        if (!segIsVisible[instanceId]) {\n            segIsVisible[instanceId] = true;\n            for (var col = seg.firstCol; col <= seg.lastCol; col++) {\n                visibleColPlacements[col].push(placement);\n            }\n        }\n    }\n    function recordHidden(placement, currentLevel, moreLinkConsumesLevel) {\n        var seg = placement.seg;\n        var instanceId = seg.eventRange.instance.instanceId;\n        if (!segIsHidden[instanceId]) {\n            segIsHidden[instanceId] = true;\n            for (var col = seg.firstCol; col <= seg.lastCol; col++) {\n                var hiddenCnt = ++hiddenCnts[col];\n                if (moreLinkConsumesLevel && hiddenCnt === 1) {\n                    var doomedLevel = currentLevel - 1;\n                    while (visibleColPlacements[col].length > doomedLevel) {\n                        recordHidden(visibleColPlacements[col].pop(), // removes\n                        visibleColPlacements[col].length, // will execute after the pop. will be the index of the removed placement\n                        false);\n                    }\n                }\n            }\n        }\n    }\n}\n// Given the events within an array of segment objects, reslice them to be in a single day\nfunction resliceDaySegs(segs, dayDate, colIndex) {\n    var dayStart = dayDate;\n    var dayEnd = addDays(dayStart, 1);\n    var dayRange = { start: dayStart, end: dayEnd };\n    var newSegs = [];\n    for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n        var seg = segs_2[_i];\n        var eventRange = seg.eventRange;\n        var origRange = eventRange.range;\n        var slicedRange = intersectRanges(origRange, dayRange);\n        if (slicedRange) {\n            newSegs.push(__assign(__assign({}, seg), { firstCol: colIndex, lastCol: colIndex, eventRange: {\n                    def: eventRange.def,\n                    ui: __assign(__assign({}, eventRange.ui), { durationEditable: false }),\n                    instance: eventRange.instance,\n                    range: slicedRange\n                }, isStart: seg.isStart && slicedRange.start.valueOf() === origRange.start.valueOf(), isEnd: seg.isEnd && slicedRange.end.valueOf() === origRange.end.valueOf() }));\n        }\n    }\n    return newSegs;\n}\n\nvar TableRow = /** @class */ (function (_super) {\n    __extends(TableRow, _super);\n    function TableRow() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.cellElRefs = new RefMap(); // the <td>\n        _this.frameElRefs = new RefMap(); // the fc-daygrid-day-frame\n        _this.fgElRefs = new RefMap(); // the fc-daygrid-day-events\n        _this.segHarnessRefs = new RefMap(); // indexed by \"instanceId:firstCol\"\n        _this.rootElRef = createRef();\n        _this.state = {\n            framePositions: null,\n            maxContentHeight: null,\n            segHeights: {}\n        };\n        return _this;\n    }\n    TableRow.prototype.render = function () {\n        var _this = this;\n        var _a = this, props = _a.props, state = _a.state, context = _a.context;\n        var colCnt = props.cells.length;\n        var businessHoursByCol = splitSegsByFirstCol(props.businessHourSegs, colCnt);\n        var bgEventSegsByCol = splitSegsByFirstCol(props.bgEventSegs, colCnt);\n        var highlightSegsByCol = splitSegsByFirstCol(this.getHighlightSegs(), colCnt);\n        var mirrorSegsByCol = splitSegsByFirstCol(this.getMirrorSegs(), colCnt);\n        var _b = computeFgSegPlacement(props.cells, props.fgEventSegs, props.dayMaxEvents, props.dayMaxEventRows, state.segHeights, state.maxContentHeight, colCnt, context.options.eventOrder), paddingBottoms = _b.paddingBottoms, segsByFirstCol = _b.segsByFirstCol, segsByEachCol = _b.segsByEachCol, segIsHidden = _b.segIsHidden, segTops = _b.segTops, segMarginTops = _b.segMarginTops, moreCnts = _b.moreCnts, moreTops = _b.moreTops;\n        var selectedInstanceHash = // TODO: messy way to compute this\n         (props.eventDrag && props.eventDrag.affectedInstances) ||\n            (props.eventResize && props.eventResize.affectedInstances) ||\n            {};\n        return (createElement(\"tr\", { ref: this.rootElRef },\n            props.renderIntro && props.renderIntro(),\n            props.cells.map(function (cell, col) {\n                var normalFgNodes = _this.renderFgSegs(segsByFirstCol[col], segIsHidden, segTops, segMarginTops, selectedInstanceHash, props.todayRange);\n                var mirrorFgNodes = _this.renderFgSegs(mirrorSegsByCol[col], {}, segTops, // use same tops as real rendering\n                {}, {}, props.todayRange, Boolean(props.eventDrag), Boolean(props.eventResize), false // date-selecting (because mirror is never drawn for date selection)\n                );\n                return (createElement(TableCell, { key: cell.key, elRef: _this.cellElRefs.createRef(cell.key), innerElRef: _this.frameElRefs.createRef(cell.key) /* FF <td> problem, but okay to use for left/right. TODO: rename prop */, dateProfile: props.dateProfile, date: cell.date, showDayNumber: props.showDayNumbers, showWeekNumber: props.showWeekNumbers && col === 0, forceDayTop: props.showWeekNumbers /* even displaying weeknum for row, not necessarily day */, todayRange: props.todayRange, extraHookProps: cell.extraHookProps, extraDataAttrs: cell.extraDataAttrs, extraClassNames: cell.extraClassNames, moreCnt: moreCnts[col], buildMoreLinkText: props.buildMoreLinkText, onMoreClick: props.onMoreClick, segIsHidden: segIsHidden, moreMarginTop: moreTops[col] /* rename */, segsByEachCol: segsByEachCol[col], fgPaddingBottom: paddingBottoms[col], fgContentElRef: _this.fgElRefs.createRef(cell.key), fgContent: ( // Fragment scopes the keys\n                    createElement(Fragment, null,\n                        createElement(Fragment, null, normalFgNodes),\n                        createElement(Fragment, null, mirrorFgNodes))), bgContent: ( // Fragment scopes the keys\n                    createElement(Fragment, null,\n                        _this.renderFillSegs(highlightSegsByCol[col], 'highlight'),\n                        _this.renderFillSegs(businessHoursByCol[col], 'non-business'),\n                        _this.renderFillSegs(bgEventSegsByCol[col], 'bg-event'))) }));\n            })));\n    };\n    TableRow.prototype.componentDidMount = function () {\n        this.updateSizing(true);\n    };\n    TableRow.prototype.componentDidUpdate = function (prevProps, prevState) {\n        var currentProps = this.props;\n        this.updateSizing(!isPropsEqual(prevProps, currentProps));\n    };\n    TableRow.prototype.getHighlightSegs = function () {\n        var props = this.props;\n        if (props.eventDrag && props.eventDrag.segs.length) { // messy check\n            return props.eventDrag.segs;\n        }\n        else if (props.eventResize && props.eventResize.segs.length) { // messy check\n            return props.eventResize.segs;\n        }\n        else {\n            return props.dateSelectionSegs;\n        }\n    };\n    TableRow.prototype.getMirrorSegs = function () {\n        var props = this.props;\n        if (props.eventResize && props.eventResize.segs.length) { // messy check\n            return props.eventResize.segs;\n        }\n        else {\n            return [];\n        }\n    };\n    TableRow.prototype.renderFgSegs = function (segs, segIsHidden, // does NOT mean display:hidden\n    segTops, segMarginTops, selectedInstanceHash, todayRange, isDragging, isResizing, isDateSelecting) {\n        var context = this.context;\n        var eventSelection = this.props.eventSelection;\n        var framePositions = this.state.framePositions;\n        var defaultDisplayEventEnd = this.props.cells.length === 1; // colCnt === 1\n        var nodes = [];\n        if (framePositions) {\n            for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n                var seg = segs_1[_i];\n                var instanceId = seg.eventRange.instance.instanceId;\n                var isMirror = isDragging || isResizing || isDateSelecting;\n                var isSelected = selectedInstanceHash[instanceId];\n                var isInvisible = segIsHidden[instanceId] || isSelected;\n                var isAbsolute = segIsHidden[instanceId] || isMirror || seg.firstCol !== seg.lastCol || !seg.isStart || !seg.isEnd; // TODO: simpler way? NOT DRY\n                var marginTop = void 0;\n                var top_1 = void 0;\n                var left = void 0;\n                var right = void 0;\n                if (isAbsolute) {\n                    top_1 = segTops[instanceId];\n                    if (context.isRtl) {\n                        right = 0;\n                        left = framePositions.lefts[seg.lastCol] - framePositions.lefts[seg.firstCol];\n                    }\n                    else {\n                        left = 0;\n                        right = framePositions.rights[seg.firstCol] - framePositions.rights[seg.lastCol];\n                    }\n                }\n                else {\n                    marginTop = segMarginTops[instanceId];\n                }\n                /*\n                known bug: events that are force to be list-item but span multiple days still take up space in later columns\n                */\n                nodes.push(createElement(\"div\", { className: 'fc-daygrid-event-harness' + (isAbsolute ? ' fc-daygrid-event-harness-abs' : ''), key: instanceId, ref: isMirror ? null : this.segHarnessRefs.createRef(instanceId + ':' + seg.firstCol) /* in print mode when in mult cols, could collide */, style: {\n                        visibility: isInvisible ? 'hidden' : '',\n                        marginTop: marginTop || '',\n                        top: top_1 || '',\n                        left: left || '',\n                        right: right || ''\n                    } }, hasListItemDisplay(seg) ?\n                    createElement(TableListItemEvent, __assign({ seg: seg, isDragging: isDragging, isSelected: instanceId === eventSelection, defaultDisplayEventEnd: defaultDisplayEventEnd }, getSegMeta(seg, todayRange))) :\n                    createElement(TableBlockEvent, __assign({ seg: seg, isDragging: isDragging, isResizing: isResizing, isDateSelecting: isDateSelecting, isSelected: instanceId === eventSelection, defaultDisplayEventEnd: defaultDisplayEventEnd }, getSegMeta(seg, todayRange)))));\n            }\n        }\n        return nodes;\n    };\n    TableRow.prototype.renderFillSegs = function (segs, fillType) {\n        var isRtl = this.context.isRtl;\n        var todayRange = this.props.todayRange;\n        var framePositions = this.state.framePositions;\n        var nodes = [];\n        if (framePositions) {\n            for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n                var seg = segs_2[_i];\n                var leftRightCss = isRtl ? {\n                    right: 0,\n                    left: framePositions.lefts[seg.lastCol] - framePositions.lefts[seg.firstCol]\n                } : {\n                    left: 0,\n                    right: framePositions.rights[seg.firstCol] - framePositions.rights[seg.lastCol],\n                };\n                nodes.push(createElement(\"div\", { key: buildEventRangeKey(seg.eventRange), className: 'fc-daygrid-bg-harness', style: leftRightCss }, fillType === 'bg-event' ?\n                    createElement(BgEvent, __assign({ seg: seg }, getSegMeta(seg, todayRange))) :\n                    renderFill(fillType)));\n            }\n        }\n        return createElement.apply(void 0, __spreadArrays([Fragment, {}], nodes));\n    };\n    TableRow.prototype.updateSizing = function (isExternalSizingChange) {\n        var _a = this, props = _a.props, frameElRefs = _a.frameElRefs;\n        if (props.clientWidth !== null) { // positioning ready?\n            if (isExternalSizingChange) {\n                var frameEls = props.cells.map(function (cell) { return frameElRefs.currentMap[cell.key]; });\n                if (frameEls.length) {\n                    var originEl = this.rootElRef.current;\n                    this.setState({\n                        framePositions: new PositionCache(originEl, frameEls, true, // isHorizontal\n                        false)\n                    });\n                }\n            }\n            var limitByContentHeight = props.dayMaxEvents === true || props.dayMaxEventRows === true;\n            this.setState({\n                segHeights: this.computeSegHeights(),\n                maxContentHeight: limitByContentHeight ? this.computeMaxContentHeight() : null\n            });\n        }\n    };\n    TableRow.prototype.computeSegHeights = function () {\n        return mapHash(this.segHarnessRefs.currentMap, function (eventHarnessEl) { return (eventHarnessEl.getBoundingClientRect().height); });\n    };\n    TableRow.prototype.computeMaxContentHeight = function () {\n        var firstKey = this.props.cells[0].key;\n        var cellEl = this.cellElRefs.currentMap[firstKey];\n        var fcContainerEl = this.fgElRefs.currentMap[firstKey];\n        return cellEl.getBoundingClientRect().bottom - fcContainerEl.getBoundingClientRect().top;\n    };\n    TableRow.prototype.getCellEls = function () {\n        var elMap = this.cellElRefs.currentMap;\n        return this.props.cells.map(function (cell) { return elMap[cell.key]; });\n    };\n    return TableRow;\n}(DateComponent));\nTableRow.addStateEquality({\n    segHeights: isPropsEqual\n});\n\nvar PADDING_FROM_VIEWPORT = 10;\nvar SCROLL_DEBOUNCE = 10;\nvar Popover = /** @class */ (function (_super) {\n    __extends(Popover, _super);\n    function Popover() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.repositioner = new DelayedRunner(_this.updateSize.bind(_this));\n        _this.handleRootEl = function (el) {\n            _this.rootEl = el;\n            if (_this.props.elRef) {\n                setRef(_this.props.elRef, el);\n            }\n        };\n        // Triggered when the user clicks *anywhere* in the document, for the autoHide feature\n        _this.handleDocumentMousedown = function (ev) {\n            var onClose = _this.props.onClose;\n            // only hide the popover if the click happened outside the popover\n            if (onClose && !_this.rootEl.contains(ev.target)) {\n                onClose();\n            }\n        };\n        _this.handleDocumentScroll = function () {\n            _this.repositioner.request(SCROLL_DEBOUNCE);\n        };\n        _this.handleCloseClick = function () {\n            var onClose = _this.props.onClose;\n            if (onClose) {\n                onClose();\n            }\n        };\n        return _this;\n    }\n    Popover.prototype.render = function () {\n        var theme = this.context.theme;\n        var props = this.props;\n        var classNames = [\n            'fc-popover',\n            theme.getClass('popover')\n        ].concat(props.extraClassNames || []);\n        return (createElement(\"div\", __assign({ className: classNames.join(' ') }, props.extraAttrs, { ref: this.handleRootEl }),\n            createElement(\"div\", { className: 'fc-popover-header ' + theme.getClass('popoverHeader') },\n                createElement(\"span\", { className: 'fc-popover-title' }, props.title),\n                createElement(\"span\", { className: 'fc-popover-close ' + theme.getIconClass('close'), onClick: this.handleCloseClick })),\n            createElement(\"div\", { className: 'fc-popover-body ' + theme.getClass('popoverContent') }, props.children)));\n    };\n    Popover.prototype.componentDidMount = function () {\n        document.addEventListener('mousedown', this.handleDocumentMousedown);\n        document.addEventListener('scroll', this.handleDocumentScroll);\n        this.updateSize();\n    };\n    Popover.prototype.componentWillUnmount = function () {\n        document.removeEventListener('mousedown', this.handleDocumentMousedown);\n        document.removeEventListener('scroll', this.handleDocumentScroll);\n    };\n    // TODO: adjust on window resize\n    /*\n    NOTE: the popover is position:fixed, so coordinates are relative to the viewport\n    NOTE: the PARENT calls this as well, on window resize. we would have wanted to use the repositioner,\n          but need to ensure that all other components have updated size first (for alignmentEl)\n    */\n    Popover.prototype.updateSize = function () {\n        var _a = this.props, alignmentEl = _a.alignmentEl, topAlignmentEl = _a.topAlignmentEl;\n        var rootEl = this.rootEl;\n        if (!rootEl) {\n            return; // not sure why this was null, but we shouldn't let external components call updateSize() anyway\n        }\n        var dims = rootEl.getBoundingClientRect(); // only used for width,height\n        var alignment = alignmentEl.getBoundingClientRect();\n        var top = topAlignmentEl ? topAlignmentEl.getBoundingClientRect().top : alignment.top;\n        top = Math.min(top, window.innerHeight - dims.height - PADDING_FROM_VIEWPORT);\n        top = Math.max(top, PADDING_FROM_VIEWPORT);\n        var left;\n        if (this.context.isRtl) {\n            left = alignment.right - dims.width;\n        }\n        else {\n            left = alignment.left;\n        }\n        left = Math.min(left, window.innerWidth - dims.width - PADDING_FROM_VIEWPORT);\n        left = Math.max(left, PADDING_FROM_VIEWPORT);\n        applyStyle(rootEl, { top: top, left: left });\n    };\n    return Popover;\n}(BaseComponent));\n\nvar MorePopover = /** @class */ (function (_super) {\n    __extends(MorePopover, _super);\n    function MorePopover() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.handlePopoverEl = function (popoverEl) {\n            _this.popoverEl = popoverEl;\n            if (popoverEl) {\n                _this.context.registerInteractiveComponent(_this, {\n                    el: popoverEl,\n                    useEventCenter: false\n                });\n            }\n            else {\n                _this.context.unregisterInteractiveComponent(_this);\n            }\n        };\n        return _this;\n    }\n    MorePopover.prototype.render = function () {\n        var _a = this.context, options = _a.options, dateEnv = _a.dateEnv;\n        var props = this.props;\n        var date = props.date, hiddenInstances = props.hiddenInstances, todayRange = props.todayRange, dateProfile = props.dateProfile, selectedInstanceId = props.selectedInstanceId;\n        var title = dateEnv.format(date, options.dayPopoverFormat);\n        return (createElement(DayCellRoot, { date: date, dateProfile: dateProfile, todayRange: todayRange, elRef: this.handlePopoverEl }, function (rootElRef, dayClassNames, dataAttrs) { return (createElement(Popover, { elRef: rootElRef, title: title, extraClassNames: ['fc-more-popover'].concat(dayClassNames), extraAttrs: dataAttrs, onClose: props.onCloseClick, alignmentEl: props.alignmentEl, topAlignmentEl: props.topAlignmentEl },\n            createElement(DayCellContent, { date: date, dateProfile: dateProfile, todayRange: todayRange }, function (innerElRef, innerContent) { return (innerContent &&\n                createElement(\"div\", { className: 'fc-more-popover-misc', ref: innerElRef }, innerContent)); }),\n            props.segs.map(function (seg) {\n                var instanceId = seg.eventRange.instance.instanceId;\n                return (createElement(\"div\", { className: 'fc-daygrid-event-harness', key: instanceId, style: {\n                        visibility: hiddenInstances[instanceId] ? 'hidden' : ''\n                    } }, hasListItemDisplay(seg) ?\n                    createElement(TableListItemEvent, __assign({ seg: seg, isDragging: false, isSelected: instanceId === selectedInstanceId, defaultDisplayEventEnd: false }, getSegMeta(seg, todayRange))) :\n                    createElement(TableBlockEvent, __assign({ seg: seg, isDragging: false, isResizing: false, isDateSelecting: false, isSelected: instanceId === selectedInstanceId, defaultDisplayEventEnd: false }, getSegMeta(seg, todayRange)))));\n            }))); }));\n    };\n    MorePopover.prototype.queryHit = function (positionLeft, positionTop, elWidth, elHeight) {\n        var date = this.props.date;\n        if (positionLeft < elWidth && positionTop < elHeight) {\n            return {\n                component: this,\n                dateSpan: {\n                    allDay: true,\n                    range: { start: date, end: addDays(date, 1) }\n                },\n                dayEl: this.popoverEl,\n                rect: {\n                    left: 0,\n                    top: 0,\n                    right: elWidth,\n                    bottom: elHeight\n                },\n                layer: 1\n            };\n        }\n    };\n    MorePopover.prototype.isPopover = function () {\n        return true; // gross\n    };\n    return MorePopover;\n}(DateComponent));\n\nvar Table = /** @class */ (function (_super) {\n    __extends(Table, _super);\n    function Table() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.splitBusinessHourSegs = memoize(splitSegsByRow);\n        _this.splitBgEventSegs = memoize(splitSegsByRow);\n        _this.splitFgEventSegs = memoize(splitSegsByRow);\n        _this.splitDateSelectionSegs = memoize(splitSegsByRow);\n        _this.splitEventDrag = memoize(splitInteractionByRow);\n        _this.splitEventResize = memoize(splitInteractionByRow);\n        _this.buildBuildMoreLinkText = memoize(buildBuildMoreLinkText);\n        _this.rowRefs = new RefMap();\n        _this.state = {\n            morePopoverState: null\n        };\n        _this.handleRootEl = function (rootEl) {\n            _this.rootEl = rootEl;\n            setRef(_this.props.elRef, rootEl);\n        };\n        _this.handleMoreLinkClick = function (arg) {\n            var context = _this.context;\n            var dateEnv = context.dateEnv;\n            var clickOption = context.options.moreLinkClick;\n            function segForPublic(seg) {\n                var _a = seg.eventRange, def = _a.def, instance = _a.instance, range = _a.range;\n                return {\n                    event: new EventApi(context, def, instance),\n                    start: dateEnv.toDate(range.start),\n                    end: dateEnv.toDate(range.end),\n                    isStart: seg.isStart,\n                    isEnd: seg.isEnd\n                };\n            }\n            if (typeof clickOption === 'function') {\n                clickOption = clickOption({\n                    date: dateEnv.toDate(arg.date),\n                    allDay: true,\n                    allSegs: arg.allSegs.map(segForPublic),\n                    hiddenSegs: arg.hiddenSegs.map(segForPublic),\n                    jsEvent: arg.ev,\n                    view: context.viewApi\n                }); // hack to handle void\n            }\n            if (!clickOption || clickOption === 'popover') {\n                _this.setState({\n                    morePopoverState: __assign(__assign({}, arg), { currentFgEventSegs: _this.props.fgEventSegs })\n                });\n            }\n            else if (typeof clickOption === 'string') { // a view name\n                context.calendarApi.zoomTo(arg.date, clickOption);\n            }\n        };\n        _this.handleMorePopoverClose = function () {\n            _this.setState({\n                morePopoverState: null\n            });\n        };\n        return _this;\n    }\n    Table.prototype.render = function () {\n        var _this = this;\n        var props = this.props;\n        var dateProfile = props.dateProfile, dayMaxEventRows = props.dayMaxEventRows, dayMaxEvents = props.dayMaxEvents, expandRows = props.expandRows;\n        var morePopoverState = this.state.morePopoverState;\n        var rowCnt = props.cells.length;\n        var businessHourSegsByRow = this.splitBusinessHourSegs(props.businessHourSegs, rowCnt);\n        var bgEventSegsByRow = this.splitBgEventSegs(props.bgEventSegs, rowCnt);\n        var fgEventSegsByRow = this.splitFgEventSegs(props.fgEventSegs, rowCnt);\n        var dateSelectionSegsByRow = this.splitDateSelectionSegs(props.dateSelectionSegs, rowCnt);\n        var eventDragByRow = this.splitEventDrag(props.eventDrag, rowCnt);\n        var eventResizeByRow = this.splitEventResize(props.eventResize, rowCnt);\n        var buildMoreLinkText = this.buildBuildMoreLinkText(this.context.options.moreLinkText);\n        var limitViaBalanced = dayMaxEvents === true || dayMaxEventRows === true;\n        // if rows can't expand to fill fixed height, can't do balanced-height event limit\n        // TODO: best place to normalize these options?\n        if (limitViaBalanced && !expandRows) {\n            limitViaBalanced = false;\n            dayMaxEventRows = null;\n            dayMaxEvents = null;\n        }\n        var classNames = [\n            'fc-daygrid-body',\n            limitViaBalanced ? 'fc-daygrid-body-balanced' : 'fc-daygrid-body-unbalanced',\n            expandRows ? '' : 'fc-daygrid-body-natural' // will height of one row depend on the others?\n        ];\n        return (createElement(\"div\", { className: classNames.join(' '), ref: this.handleRootEl, style: {\n                // these props are important to give this wrapper correct dimensions for interactions\n                // TODO: if we set it here, can we avoid giving to inner tables?\n                width: props.clientWidth,\n                minWidth: props.tableMinWidth\n            } },\n            createElement(NowTimer, { unit: 'day' }, function (nowDate, todayRange) { return (createElement(Fragment, null,\n                createElement(\"table\", { className: 'fc-scrollgrid-sync-table', style: {\n                        width: props.clientWidth,\n                        minWidth: props.tableMinWidth,\n                        height: expandRows ? props.clientHeight : ''\n                    } },\n                    props.colGroupNode,\n                    createElement(\"tbody\", null, props.cells.map(function (cells, row) { return (createElement(TableRow, { ref: _this.rowRefs.createRef(row), key: cells.length\n                            ? cells[0].date.toISOString() /* best? or put key on cell? or use diff formatter? */\n                            : row // in case there are no cells (like when resource view is loading)\n                        , showDayNumbers: rowCnt > 1, showWeekNumbers: props.showWeekNumbers, todayRange: todayRange, dateProfile: dateProfile, cells: cells, renderIntro: props.renderRowIntro, businessHourSegs: businessHourSegsByRow[row], eventSelection: props.eventSelection, bgEventSegs: bgEventSegsByRow[row].filter(isSegAllDay) /* hack */, fgEventSegs: fgEventSegsByRow[row], dateSelectionSegs: dateSelectionSegsByRow[row], eventDrag: eventDragByRow[row], eventResize: eventResizeByRow[row], dayMaxEvents: dayMaxEvents, dayMaxEventRows: dayMaxEventRows, clientWidth: props.clientWidth, clientHeight: props.clientHeight, buildMoreLinkText: buildMoreLinkText, onMoreClick: _this.handleMoreLinkClick })); }))),\n                (!props.forPrint && morePopoverState && morePopoverState.currentFgEventSegs === props.fgEventSegs) && // clear popover on event mod\n                    createElement(MorePopover, { date: morePopoverState.date, dateProfile: dateProfile, segs: morePopoverState.allSegs, alignmentEl: morePopoverState.dayEl, topAlignmentEl: rowCnt === 1 ? props.headerAlignElRef.current : null, onCloseClick: _this.handleMorePopoverClose, selectedInstanceId: props.eventSelection, hiddenInstances: // yuck\n                        (props.eventDrag ? props.eventDrag.affectedInstances : null) ||\n                            (props.eventResize ? props.eventResize.affectedInstances : null) ||\n                            {}, todayRange: todayRange }))); })));\n    };\n    // Hit System\n    // ----------------------------------------------------------------------------------------------------\n    Table.prototype.prepareHits = function () {\n        this.rowPositions = new PositionCache(this.rootEl, this.rowRefs.collect().map(function (rowObj) { return rowObj.getCellEls()[0]; }), // first cell el in each row. TODO: not optimal\n        false, true // vertical\n        );\n        this.colPositions = new PositionCache(this.rootEl, this.rowRefs.currentMap[0].getCellEls(), // cell els in first row\n        true, // horizontal\n        false);\n    };\n    Table.prototype.positionToHit = function (leftPosition, topPosition) {\n        var _a = this, colPositions = _a.colPositions, rowPositions = _a.rowPositions;\n        var col = colPositions.leftToIndex(leftPosition);\n        var row = rowPositions.topToIndex(topPosition);\n        if (row != null && col != null) {\n            return {\n                row: row,\n                col: col,\n                dateSpan: {\n                    range: this.getCellRange(row, col),\n                    allDay: true\n                },\n                dayEl: this.getCellEl(row, col),\n                relativeRect: {\n                    left: colPositions.lefts[col],\n                    right: colPositions.rights[col],\n                    top: rowPositions.tops[row],\n                    bottom: rowPositions.bottoms[row]\n                }\n            };\n        }\n    };\n    Table.prototype.getCellEl = function (row, col) {\n        return this.rowRefs.currentMap[row].getCellEls()[col]; // TODO: not optimal\n    };\n    Table.prototype.getCellRange = function (row, col) {\n        var start = this.props.cells[row][col].date;\n        var end = addDays(start, 1);\n        return { start: start, end: end };\n    };\n    return Table;\n}(DateComponent));\nfunction buildBuildMoreLinkText(moreLinkTextInput) {\n    if (typeof moreLinkTextInput === 'function') {\n        return moreLinkTextInput;\n    }\n    else {\n        return function (num) {\n            return \"+\" + num + \" \" + moreLinkTextInput;\n        };\n    }\n}\nfunction isSegAllDay(seg) {\n    return seg.eventRange.def.allDay;\n}\n\nvar DayTable = /** @class */ (function (_super) {\n    __extends(DayTable, _super);\n    function DayTable() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.slicer = new DayTableSlicer();\n        _this.tableRef = createRef();\n        _this.handleRootEl = function (rootEl) {\n            if (rootEl) {\n                _this.context.registerInteractiveComponent(_this, { el: rootEl });\n            }\n            else {\n                _this.context.unregisterInteractiveComponent(_this);\n            }\n        };\n        return _this;\n    }\n    DayTable.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        return (createElement(Table, __assign({ ref: this.tableRef, elRef: this.handleRootEl }, this.slicer.sliceProps(props, props.dateProfile, props.nextDayThreshold, context, props.dayTableModel), { dateProfile: props.dateProfile, cells: props.dayTableModel.cells, colGroupNode: props.colGroupNode, tableMinWidth: props.tableMinWidth, renderRowIntro: props.renderRowIntro, dayMaxEvents: props.dayMaxEvents, dayMaxEventRows: props.dayMaxEventRows, showWeekNumbers: props.showWeekNumbers, expandRows: props.expandRows, headerAlignElRef: props.headerAlignElRef, clientWidth: props.clientWidth, clientHeight: props.clientHeight, forPrint: props.forPrint })));\n    };\n    DayTable.prototype.prepareHits = function () {\n        this.tableRef.current.prepareHits();\n    };\n    DayTable.prototype.queryHit = function (positionLeft, positionTop) {\n        var rawHit = this.tableRef.current.positionToHit(positionLeft, positionTop);\n        if (rawHit) {\n            return {\n                component: this,\n                dateSpan: rawHit.dateSpan,\n                dayEl: rawHit.dayEl,\n                rect: {\n                    left: rawHit.relativeRect.left,\n                    right: rawHit.relativeRect.right,\n                    top: rawHit.relativeRect.top,\n                    bottom: rawHit.relativeRect.bottom\n                },\n                layer: 0\n            };\n        }\n    };\n    return DayTable;\n}(DateComponent));\nvar DayTableSlicer = /** @class */ (function (_super) {\n    __extends(DayTableSlicer, _super);\n    function DayTableSlicer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.forceDayIfListItem = true;\n        return _this;\n    }\n    DayTableSlicer.prototype.sliceRange = function (dateRange, dayTableModel) {\n        return dayTableModel.sliceRange(dateRange);\n    };\n    return DayTableSlicer;\n}(Slicer));\n\nvar DayTableView = /** @class */ (function (_super) {\n    __extends(DayTableView, _super);\n    function DayTableView() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.buildDayTableModel = memoize(buildDayTableModel);\n        _this.headerRef = createRef();\n        _this.tableRef = createRef();\n        return _this;\n    }\n    DayTableView.prototype.render = function () {\n        var _this = this;\n        var _a = this.context, options = _a.options, dateProfileGenerator = _a.dateProfileGenerator;\n        var props = this.props;\n        var dayTableModel = this.buildDayTableModel(props.dateProfile, dateProfileGenerator);\n        var headerContent = options.dayHeaders &&\n            createElement(DayHeader, { ref: this.headerRef, dateProfile: props.dateProfile, dates: dayTableModel.headerDates, datesRepDistinctDays: dayTableModel.rowCnt === 1 });\n        var bodyContent = function (contentArg) { return (createElement(DayTable, { ref: _this.tableRef, dateProfile: props.dateProfile, dayTableModel: dayTableModel, businessHours: props.businessHours, dateSelection: props.dateSelection, eventStore: props.eventStore, eventUiBases: props.eventUiBases, eventSelection: props.eventSelection, eventDrag: props.eventDrag, eventResize: props.eventResize, nextDayThreshold: options.nextDayThreshold, colGroupNode: contentArg.tableColGroupNode, tableMinWidth: contentArg.tableMinWidth, dayMaxEvents: options.dayMaxEvents, dayMaxEventRows: options.dayMaxEventRows, showWeekNumbers: options.weekNumbers, expandRows: !props.isHeightAuto, headerAlignElRef: _this.headerElRef, clientWidth: contentArg.clientWidth, clientHeight: contentArg.clientHeight, forPrint: props.forPrint })); };\n        return options.dayMinWidth\n            ? this.renderHScrollLayout(headerContent, bodyContent, dayTableModel.colCnt, options.dayMinWidth)\n            : this.renderSimpleLayout(headerContent, bodyContent);\n    };\n    return DayTableView;\n}(TableView));\nfunction buildDayTableModel(dateProfile, dateProfileGenerator) {\n    var daySeries = new DaySeriesModel(dateProfile.renderRange, dateProfileGenerator);\n    return new DayTableModel(daySeries, /year|month|week/.test(dateProfile.currentRangeUnit));\n}\n\nvar TableDateProfileGenerator = /** @class */ (function (_super) {\n    __extends(TableDateProfileGenerator, _super);\n    function TableDateProfileGenerator() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    // Computes the date range that will be rendered.\n    TableDateProfileGenerator.prototype.buildRenderRange = function (currentRange, currentRangeUnit, isRangeAllDay) {\n        var dateEnv = this.props.dateEnv;\n        var renderRange = _super.prototype.buildRenderRange.call(this, currentRange, currentRangeUnit, isRangeAllDay);\n        var start = renderRange.start;\n        var end = renderRange.end;\n        var endOfWeek;\n        // year and month views should be aligned with weeks. this is already done for week\n        if (/^(year|month)$/.test(currentRangeUnit)) {\n            start = dateEnv.startOfWeek(start);\n            // make end-of-week if not already\n            endOfWeek = dateEnv.startOfWeek(end);\n            if (endOfWeek.valueOf() !== end.valueOf()) {\n                end = addWeeks(endOfWeek, 1);\n            }\n        }\n        // ensure 6 weeks\n        if (this.props.monthMode &&\n            this.props.fixedWeekCount) {\n            var rowCnt = Math.ceil(// could be partial weeks due to hiddenDays\n            diffWeeks(start, end));\n            end = addWeeks(end, 6 - rowCnt);\n        }\n        return { start: start, end: end };\n    };\n    return TableDateProfileGenerator;\n}(DateProfileGenerator));\n\nvar OPTION_REFINERS = {\n    moreLinkClick: identity,\n    moreLinkClassNames: identity,\n    moreLinkContent: identity,\n    moreLinkDidMount: identity,\n    moreLinkWillUnmount: identity,\n};\n\nvar main = createPlugin({\n    initialView: 'dayGridMonth',\n    optionRefiners: OPTION_REFINERS,\n    views: {\n        dayGrid: {\n            component: DayTableView,\n            dateProfileGeneratorClass: TableDateProfileGenerator\n        },\n        dayGridDay: {\n            type: 'dayGrid',\n            duration: { days: 1 }\n        },\n        dayGridWeek: {\n            type: 'dayGrid',\n            duration: { weeks: 1 }\n        },\n        dayGridMonth: {\n            type: 'dayGrid',\n            duration: { months: 1 },\n            monthMode: true,\n            fixedWeekCount: true\n        }\n    }\n});\n\nexport default main;\nexport { DayTableView as DayGridView, DayTable, DayTableSlicer, Table, TableView, buildDayTableModel };\n//# sourceMappingURL=main.js.map\n","/*!\nFullCalendar v5.3.1\nDocs & License: https://fullcalendar.io/\n(c) 2020 Adam Shaw\n*/\nimport './main.css';\n\nimport { hasBgRendering, Splitter, rangeContainsMarker, startOfDay, asRoughMs, createDuration, createRef, RefMap, createElement, PositionCache, BaseComponent, RenderHook, createFormatter, ViewContextType, wholeDivideDurations, formatIsoTimeString, addDurations, diffDays, buildNavLinkData, WeekNumberRoot, getStickyHeaderDates, ViewRoot, SimpleScrollGrid, getStickyFooterScrollbar, NowTimer, NowIndicatorRoot, DateComponent, renderScrollShim, sortEventSegs, compareByFieldSpecs, buildSegCompareObj, StandardEvent, config, DayCellRoot, getSegMeta, buildEventRangeKey, BgEvent, renderFill, Fragment, DayCellContent, memoize, multiplyDuration, intersectRanges, Slicer, DayHeader, DaySeriesModel, DayTableModel, createPlugin } from '@fullcalendar/common';\nimport { __extends, __assign } from 'tslib';\nimport { DayTable } from '@fullcalendar/daygrid';\n\nvar AllDaySplitter = /** @class */ (function (_super) {\n    __extends(AllDaySplitter, _super);\n    function AllDaySplitter() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AllDaySplitter.prototype.getKeyInfo = function () {\n        return {\n            allDay: {},\n            timed: {}\n        };\n    };\n    AllDaySplitter.prototype.getKeysForDateSpan = function (dateSpan) {\n        if (dateSpan.allDay) {\n            return ['allDay'];\n        }\n        else {\n            return ['timed'];\n        }\n    };\n    AllDaySplitter.prototype.getKeysForEventDef = function (eventDef) {\n        if (!eventDef.allDay) {\n            return ['timed'];\n        }\n        else if (hasBgRendering(eventDef)) {\n            return ['timed', 'allDay'];\n        }\n        else {\n            return ['allDay'];\n        }\n    };\n    return AllDaySplitter;\n}(Splitter));\n\nvar TimeColsSlatsCoords = /** @class */ (function () {\n    function TimeColsSlatsCoords(positions, dateProfile, slatMetas) {\n        this.positions = positions;\n        this.dateProfile = dateProfile;\n        this.slatMetas = slatMetas;\n    }\n    TimeColsSlatsCoords.prototype.safeComputeTop = function (date) {\n        var dateProfile = this.dateProfile;\n        if (rangeContainsMarker(dateProfile.currentRange, date)) {\n            var startOfDayDate = startOfDay(date);\n            var timeMs = date.valueOf() - startOfDayDate.valueOf();\n            if (timeMs >= asRoughMs(dateProfile.slotMinTime) &&\n                timeMs < asRoughMs(dateProfile.slotMaxTime)) {\n                return this.computeTimeTop(createDuration(timeMs));\n            }\n        }\n    };\n    // Computes the top coordinate, relative to the bounds of the grid, of the given date.\n    // A `startOfDayDate` must be given for avoiding ambiguity over how to treat midnight.\n    TimeColsSlatsCoords.prototype.computeDateTop = function (when, startOfDayDate) {\n        if (!startOfDayDate) {\n            startOfDayDate = startOfDay(when);\n        }\n        return this.computeTimeTop(createDuration(when.valueOf() - startOfDayDate.valueOf()));\n    };\n    // Computes the top coordinate, relative to the bounds of the grid, of the given time (a Duration).\n    // This is a makeshify way to compute the time-top. Assumes all slatMetas dates are uniform.\n    // Eventually allow computation with arbirary slat dates.\n    TimeColsSlatsCoords.prototype.computeTimeTop = function (duration) {\n        var _a = this, positions = _a.positions, dateProfile = _a.dateProfile, slatMetas = _a.slatMetas;\n        var len = positions.els.length;\n        var slotDurationMs = slatMetas[1].date.valueOf() - slatMetas[0].date.valueOf(); // we assume dates are uniform\n        var slatCoverage = (duration.milliseconds - asRoughMs(dateProfile.slotMinTime)) / slotDurationMs; // floating-point value of # of slots covered\n        var slatIndex;\n        var slatRemainder;\n        // compute a floating-point number for how many slats should be progressed through.\n        // from 0 to number of slats (inclusive)\n        // constrained because slotMinTime/slotMaxTime might be customized.\n        slatCoverage = Math.max(0, slatCoverage);\n        slatCoverage = Math.min(len, slatCoverage);\n        // an integer index of the furthest whole slat\n        // from 0 to number slats (*exclusive*, so len-1)\n        slatIndex = Math.floor(slatCoverage);\n        slatIndex = Math.min(slatIndex, len - 1);\n        // how much further through the slatIndex slat (from 0.0-1.0) must be covered in addition.\n        // could be 1.0 if slatCoverage is covering *all* the slots\n        slatRemainder = slatCoverage - slatIndex;\n        return positions.tops[slatIndex] +\n            positions.getHeight(slatIndex) * slatRemainder;\n    };\n    return TimeColsSlatsCoords;\n}());\n\n// potential nice values for the slot-duration and interval-duration\n// from largest to smallest\nvar STOCK_SUB_DURATIONS = [\n    { hours: 1 },\n    { minutes: 30 },\n    { minutes: 15 },\n    { seconds: 30 },\n    { seconds: 15 }\n];\n/*\nfor the horizontal \"slats\" that run width-wise. Has a time axis on a side. Depends on RTL.\n*/\nvar TimeColsSlats = /** @class */ (function (_super) {\n    __extends(TimeColsSlats, _super);\n    function TimeColsSlats() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.rootElRef = createRef();\n        _this.slatElRefs = new RefMap();\n        return _this;\n    }\n    TimeColsSlats.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        return (createElement(\"div\", { className: 'fc-timegrid-slots', ref: this.rootElRef },\n            createElement(\"table\", { className: context.theme.getClass('table'), style: {\n                    minWidth: props.tableMinWidth,\n                    width: props.clientWidth,\n                    height: props.minHeight\n                } },\n                props.tableColGroupNode /* relies on there only being a single <col> for the axis */,\n                createElement(TimeColsSlatsBody, { slatElRefs: this.slatElRefs, axis: props.axis, slatMetas: props.slatMetas }))));\n    };\n    TimeColsSlats.prototype.componentDidMount = function () {\n        this.updateSizing();\n    };\n    TimeColsSlats.prototype.componentDidUpdate = function () {\n        this.updateSizing();\n    };\n    TimeColsSlats.prototype.componentWillUnmount = function () {\n        if (this.props.onCoords) {\n            this.props.onCoords(null);\n        }\n    };\n    TimeColsSlats.prototype.updateSizing = function () {\n        var props = this.props;\n        if (props.onCoords &&\n            props.clientWidth !== null // means sizing has stabilized\n        ) {\n            var rootEl = this.rootElRef.current;\n            if (rootEl.offsetHeight) { // not hidden by css\n                props.onCoords(new TimeColsSlatsCoords(new PositionCache(this.rootElRef.current, collectSlatEls(this.slatElRefs.currentMap, props.slatMetas), false, true // vertical\n                ), this.props.dateProfile, props.slatMetas));\n            }\n        }\n    };\n    return TimeColsSlats;\n}(BaseComponent));\nfunction collectSlatEls(elMap, slatMetas) {\n    return slatMetas.map(function (slatMeta) { return elMap[slatMeta.key]; });\n}\nvar TimeColsSlatsBody = /** @class */ (function (_super) {\n    __extends(TimeColsSlatsBody, _super);\n    function TimeColsSlatsBody() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimeColsSlatsBody.prototype.render = function () {\n        var _a = this, props = _a.props, context = _a.context;\n        var options = context.options;\n        var slatElRefs = props.slatElRefs;\n        return (createElement(\"tbody\", null, props.slatMetas.map(function (slatMeta, i) {\n            var hookProps = {\n                time: slatMeta.time,\n                date: context.dateEnv.toDate(slatMeta.date),\n                view: context.viewApi\n            };\n            var classNames = [\n                'fc-timegrid-slot',\n                'fc-timegrid-slot-lane',\n                slatMeta.isLabeled ? '' : 'fc-timegrid-slot-minor'\n            ];\n            return (createElement(\"tr\", { key: slatMeta.key, ref: slatElRefs.createRef(slatMeta.key) },\n                props.axis &&\n                    createElement(TimeColsAxisCell, __assign({}, slatMeta)),\n                createElement(RenderHook, { hookProps: hookProps, classNames: options.slotLaneClassNames, content: options.slotLaneContent, didMount: options.slotLaneDidMount, willUnmount: options.slotLaneWillUnmount }, function (rootElRef, customClassNames, innerElRef, innerContent) { return (createElement(\"td\", { ref: rootElRef, className: classNames.concat(customClassNames).join(' '), \"data-time\": slatMeta.isoTimeStr }, innerContent)); })));\n        })));\n    };\n    return TimeColsSlatsBody;\n}(BaseComponent));\nvar DEFAULT_SLAT_LABEL_FORMAT = createFormatter({\n    hour: 'numeric',\n    minute: '2-digit',\n    omitZeroMinute: true,\n    meridiem: 'short'\n});\nfunction TimeColsAxisCell(props) {\n    var classNames = [\n        'fc-timegrid-slot',\n        'fc-timegrid-slot-label',\n        props.isLabeled ? 'fc-scrollgrid-shrink' : 'fc-timegrid-slot-minor'\n    ];\n    return (createElement(ViewContextType.Consumer, null, function (context) {\n        if (!props.isLabeled) {\n            return (createElement(\"td\", { className: classNames.join(' '), \"data-time\": props.isoTimeStr }));\n        }\n        else {\n            var dateEnv = context.dateEnv, options = context.options, viewApi = context.viewApi;\n            var labelFormat = // TODO: fully pre-parse\n             options.slotLabelFormat == null ? DEFAULT_SLAT_LABEL_FORMAT :\n                Array.isArray(options.slotLabelFormat) ? createFormatter(options.slotLabelFormat[0]) :\n                    createFormatter(options.slotLabelFormat);\n            var hookProps = {\n                level: 0,\n                time: props.time,\n                date: dateEnv.toDate(props.date),\n                view: viewApi,\n                text: dateEnv.format(props.date, labelFormat)\n            };\n            return (createElement(RenderHook, { hookProps: hookProps, classNames: options.slotLabelClassNames, content: options.slotLabelContent, defaultContent: renderInnerContent, didMount: options.slotLabelDidMount, willUnmount: options.slotLabelWillUnmount }, function (rootElRef, customClassNames, innerElRef, innerContent) { return (createElement(\"td\", { ref: rootElRef, className: classNames.concat(customClassNames).join(' '), \"data-time\": props.isoTimeStr },\n                createElement(\"div\", { className: 'fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame' },\n                    createElement(\"div\", { className: 'fc-timegrid-slot-label-cushion fc-scrollgrid-shrink-cushion', ref: innerElRef }, innerContent)))); }));\n        }\n    }));\n}\nfunction renderInnerContent(props) {\n    return props.text;\n}\nfunction buildSlatMetas(slotMinTime, slotMaxTime, explicitLabelInterval, slotDuration, dateEnv) {\n    var dayStart = new Date(0);\n    var slatTime = slotMinTime;\n    var slatIterator = createDuration(0);\n    var labelInterval = explicitLabelInterval || computeLabelInterval(slotDuration);\n    var metas = [];\n    while (asRoughMs(slatTime) < asRoughMs(slotMaxTime)) {\n        var date = dateEnv.add(dayStart, slatTime);\n        var isLabeled = wholeDivideDurations(slatIterator, labelInterval) !== null;\n        metas.push({\n            date: date,\n            time: slatTime,\n            key: date.toISOString(),\n            isoTimeStr: formatIsoTimeString(date),\n            isLabeled: isLabeled\n        });\n        slatTime = addDurations(slatTime, slotDuration);\n        slatIterator = addDurations(slatIterator, slotDuration);\n    }\n    return metas;\n}\n// Computes an automatic value for slotLabelInterval\nfunction computeLabelInterval(slotDuration) {\n    var i;\n    var labelInterval;\n    var slotsPerLabel;\n    // find the smallest stock label interval that results in more than one slots-per-label\n    for (i = STOCK_SUB_DURATIONS.length - 1; i >= 0; i--) {\n        labelInterval = createDuration(STOCK_SUB_DURATIONS[i]);\n        slotsPerLabel = wholeDivideDurations(labelInterval, slotDuration);\n        if (slotsPerLabel !== null && slotsPerLabel > 1) {\n            return labelInterval;\n        }\n    }\n    return slotDuration; // fall back\n}\n\nvar DEFAULT_WEEK_NUM_FORMAT = createFormatter({ week: 'short' });\nvar AUTO_ALL_DAY_MAX_EVENT_ROWS = 5;\nvar TimeColsView = /** @class */ (function (_super) {\n    __extends(TimeColsView, _super);\n    function TimeColsView() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.allDaySplitter = new AllDaySplitter(); // for use by subclasses\n        _this.headerElRef = createRef();\n        _this.rootElRef = createRef();\n        _this.scrollerElRef = createRef();\n        _this.state = {\n            slatCoords: null\n        };\n        _this.handleScrollTopRequest = function (scrollTop) {\n            var scrollerEl = _this.scrollerElRef.current;\n            if (scrollerEl) { // TODO: not sure how this could ever be null. weirdness with the reducer\n                scrollerEl.scrollTop = scrollTop;\n            }\n        };\n        /* Header Render Methods\n        ------------------------------------------------------------------------------------------------------------------*/\n        _this.renderHeadAxis = function (frameHeight) {\n            if (frameHeight === void 0) { frameHeight = ''; }\n            var options = _this.context.options;\n            var dateProfile = _this.props.dateProfile;\n            var range = dateProfile.renderRange;\n            var dayCnt = diffDays(range.start, range.end);\n            var navLinkAttrs = (options.navLinks && dayCnt === 1) // only do in day views (to avoid doing in week views that dont need it)\n                ? { 'data-navlink': buildNavLinkData(range.start, 'week'), tabIndex: 0 }\n                : {};\n            if (options.weekNumbers) {\n                return (createElement(WeekNumberRoot, { date: range.start, defaultFormat: DEFAULT_WEEK_NUM_FORMAT }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"th\", { ref: rootElRef, className: [\n                        'fc-timegrid-axis',\n                        'fc-scrollgrid-shrink'\n                    ].concat(classNames).join(' ') },\n                    createElement(\"div\", { className: 'fc-timegrid-axis-frame fc-scrollgrid-shrink-frame fc-timegrid-axis-frame-liquid', style: { height: frameHeight } },\n                        createElement(\"a\", __assign({ ref: innerElRef, className: 'fc-timegrid-axis-cushion fc-scrollgrid-shrink-cushion fc-scrollgrid-sync-inner' }, navLinkAttrs), innerContent)))); }));\n            }\n            return (createElement(\"th\", { className: 'fc-timegrid-axis' },\n                createElement(\"div\", { className: 'fc-timegrid-axis-frame', style: { height: frameHeight } })));\n        };\n        /* Table Component Render Methods\n        ------------------------------------------------------------------------------------------------------------------*/\n        // only a one-way height sync. we don't send the axis inner-content height to the DayGrid,\n        // but DayGrid still needs to have classNames on inner elements in order to measure.\n        _this.renderTableRowAxis = function (rowHeight) {\n            var _a = _this.context, options = _a.options, viewApi = _a.viewApi;\n            var hookProps = {\n                text: options.allDayText,\n                view: viewApi\n            };\n            return (\n            // TODO: make reusable hook. used in list view too\n            createElement(RenderHook, { hookProps: hookProps, classNames: options.allDayClassNames, content: options.allDayContent, defaultContent: renderAllDayInner, didMount: options.allDayDidMount, willUnmount: options.allDayWillUnmount }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"td\", { ref: rootElRef, className: [\n                    'fc-timegrid-axis',\n                    'fc-scrollgrid-shrink'\n                ].concat(classNames).join(' ') },\n                createElement(\"div\", { className: 'fc-timegrid-axis-frame fc-scrollgrid-shrink-frame' + (rowHeight == null ? ' fc-timegrid-axis-frame-liquid' : ''), style: { height: rowHeight } },\n                    createElement(\"span\", { className: 'fc-timegrid-axis-cushion fc-scrollgrid-shrink-cushion fc-scrollgrid-sync-inner', ref: innerElRef }, innerContent)))); }));\n        };\n        _this.handleSlatCoords = function (slatCoords) {\n            _this.setState({ slatCoords: slatCoords });\n        };\n        return _this;\n    }\n    // rendering\n    // ----------------------------------------------------------------------------------------------------\n    TimeColsView.prototype.renderSimpleLayout = function (headerRowContent, allDayContent, timeContent) {\n        var _a = this, context = _a.context, props = _a.props;\n        var sections = [];\n        var stickyHeaderDates = getStickyHeaderDates(context.options);\n        if (headerRowContent) {\n            sections.push({\n                type: 'header',\n                key: 'header',\n                isSticky: stickyHeaderDates,\n                chunk: {\n                    elRef: this.headerElRef,\n                    tableClassName: 'fc-col-header',\n                    rowContent: headerRowContent\n                }\n            });\n        }\n        if (allDayContent) {\n            sections.push({\n                type: 'body',\n                key: 'all-day',\n                chunk: { content: allDayContent }\n            });\n            sections.push({\n                type: 'body',\n                key: 'all-day-divider',\n                outerContent: ( // TODO: rename to cellContent so don't need to define <tr>?\n                createElement(\"tr\", { className: 'fc-scrollgrid-section' },\n                    createElement(\"td\", { className: 'fc-timegrid-divider ' + context.theme.getClass('tableCellShaded') })))\n            });\n        }\n        sections.push({\n            type: 'body',\n            key: 'body',\n            liquid: true,\n            expandRows: Boolean(context.options.expandRows),\n            chunk: {\n                scrollerElRef: this.scrollerElRef,\n                content: timeContent\n            }\n        });\n        return (createElement(ViewRoot, { viewSpec: context.viewSpec, elRef: this.rootElRef }, function (rootElRef, classNames) { return (createElement(\"div\", { className: ['fc-timegrid'].concat(classNames).join(' '), ref: rootElRef },\n            createElement(SimpleScrollGrid, { liquid: !props.isHeightAuto && !props.forPrint, cols: [{ width: 'shrink' }], sections: sections }))); }));\n    };\n    TimeColsView.prototype.renderHScrollLayout = function (headerRowContent, allDayContent, timeContent, colCnt, dayMinWidth, slatMetas, slatCoords // yuck\n    ) {\n        var _this = this;\n        var ScrollGrid = this.context.pluginHooks.scrollGridImpl;\n        if (!ScrollGrid) {\n            throw new Error('No ScrollGrid implementation');\n        }\n        var _a = this, context = _a.context, props = _a.props;\n        var stickyHeaderDates = !props.forPrint && getStickyHeaderDates(context.options);\n        var stickyFooterScrollbar = !props.forPrint && getStickyFooterScrollbar(context.options);\n        var sections = [];\n        if (headerRowContent) {\n            sections.push({\n                type: 'header',\n                key: 'header',\n                isSticky: stickyHeaderDates,\n                syncRowHeights: true,\n                chunks: [\n                    {\n                        key: 'axis',\n                        rowContent: function (arg) { return (createElement(\"tr\", null, _this.renderHeadAxis(arg.rowSyncHeights[0]))); }\n                    },\n                    {\n                        key: 'cols',\n                        elRef: this.headerElRef,\n                        tableClassName: 'fc-col-header',\n                        rowContent: headerRowContent\n                    }\n                ]\n            });\n        }\n        if (allDayContent) {\n            sections.push({\n                type: 'body',\n                key: 'all-day',\n                syncRowHeights: true,\n                chunks: [\n                    {\n                        key: 'axis',\n                        rowContent: function (contentArg) { return (createElement(\"tr\", null, _this.renderTableRowAxis(contentArg.rowSyncHeights[0]))); },\n                    },\n                    {\n                        key: 'cols',\n                        content: allDayContent\n                    }\n                ]\n            });\n            sections.push({\n                key: 'all-day-divider',\n                type: 'body',\n                outerContent: ( // TODO: rename to cellContent so don't need to define <tr>?\n                createElement(\"tr\", { className: 'fc-scrollgrid-section' },\n                    createElement(\"td\", { colSpan: 2, className: 'fc-timegrid-divider ' + context.theme.getClass('tableCellShaded') })))\n            });\n        }\n        var isNowIndicator = context.options.nowIndicator;\n        sections.push({\n            type: 'body',\n            key: 'body',\n            liquid: true,\n            expandRows: Boolean(context.options.expandRows),\n            chunks: [\n                {\n                    key: 'axis',\n                    content: function (arg) {\n                        // TODO: make this now-indicator arrow more DRY with TimeColsContent\n                        return (createElement(\"div\", { className: 'fc-timegrid-axis-chunk' },\n                            createElement(\"table\", { style: { height: arg.expandRows ? arg.clientHeight : '' } },\n                                arg.tableColGroupNode,\n                                createElement(\"tbody\", null,\n                                    createElement(TimeBodyAxis, { slatMetas: slatMetas }))),\n                            createElement(\"div\", { className: 'fc-timegrid-now-indicator-container' },\n                                createElement(NowTimer, { unit: isNowIndicator ? 'minute' : 'day' /* hacky */ }, function (nowDate) {\n                                    var nowIndicatorTop = isNowIndicator &&\n                                        slatCoords &&\n                                        slatCoords.safeComputeTop(nowDate); // might return void\n                                    if (typeof nowIndicatorTop === 'number') {\n                                        return (createElement(NowIndicatorRoot, { isAxis: true, date: nowDate }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-timegrid-now-indicator-arrow'].concat(classNames).join(' '), style: { top: nowIndicatorTop } }, innerContent)); }));\n                                    }\n                                    return null;\n                                }))));\n                    }\n                },\n                {\n                    key: 'cols',\n                    scrollerElRef: this.scrollerElRef,\n                    content: timeContent\n                }\n            ]\n        });\n        if (stickyFooterScrollbar) {\n            sections.push({\n                key: 'footer',\n                type: 'footer',\n                isSticky: true,\n                chunks: [\n                    {\n                        key: 'axis',\n                        content: renderScrollShim\n                    },\n                    {\n                        key: 'cols',\n                        content: renderScrollShim\n                    }\n                ]\n            });\n        }\n        return (createElement(ViewRoot, { viewSpec: context.viewSpec, elRef: this.rootElRef }, function (rootElRef, classNames) { return (createElement(\"div\", { className: ['fc-timegrid'].concat(classNames).join(' '), ref: rootElRef },\n            createElement(ScrollGrid, { liquid: !props.isHeightAuto && !props.forPrint, colGroups: [\n                    { width: 'shrink', cols: [{ width: 'shrink' }] },\n                    { cols: [{ span: colCnt, minWidth: dayMinWidth }] }\n                ], sections: sections }))); }));\n    };\n    /* Dimensions\n    ------------------------------------------------------------------------------------------------------------------*/\n    TimeColsView.prototype.getAllDayMaxEventProps = function () {\n        var _a = this.context.options, dayMaxEvents = _a.dayMaxEvents, dayMaxEventRows = _a.dayMaxEventRows;\n        if (dayMaxEvents === true || dayMaxEventRows === true) { // is auto?\n            dayMaxEvents = undefined;\n            dayMaxEventRows = AUTO_ALL_DAY_MAX_EVENT_ROWS; // make sure \"auto\" goes to a real number\n        }\n        return { dayMaxEvents: dayMaxEvents, dayMaxEventRows: dayMaxEventRows };\n    };\n    return TimeColsView;\n}(DateComponent));\nfunction renderAllDayInner(hookProps) {\n    return hookProps.text;\n}\nvar TimeBodyAxis = /** @class */ (function (_super) {\n    __extends(TimeBodyAxis, _super);\n    function TimeBodyAxis() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimeBodyAxis.prototype.render = function () {\n        return this.props.slatMetas.map(function (slatMeta) { return (createElement(\"tr\", { key: slatMeta.key },\n            createElement(TimeColsAxisCell, __assign({}, slatMeta)))); });\n    };\n    return TimeBodyAxis;\n}(BaseComponent));\n\nfunction splitSegsByCol(segs, colCnt) {\n    var segsByCol = [];\n    var i;\n    for (i = 0; i < colCnt; i++) {\n        segsByCol.push([]);\n    }\n    if (segs) {\n        for (i = 0; i < segs.length; i++) {\n            segsByCol[segs[i].col].push(segs[i]);\n        }\n    }\n    return segsByCol;\n}\nfunction splitInteractionByCol(ui, colCnt) {\n    var byRow = [];\n    if (!ui) {\n        for (var i = 0; i < colCnt; i++) {\n            byRow[i] = null;\n        }\n    }\n    else {\n        for (var i = 0; i < colCnt; i++) {\n            byRow[i] = {\n                affectedInstances: ui.affectedInstances,\n                isEvent: ui.isEvent,\n                segs: []\n            };\n        }\n        for (var _i = 0, _a = ui.segs; _i < _a.length; _i++) {\n            var seg = _a[_i];\n            byRow[seg.col].segs.push(seg);\n        }\n    }\n    return byRow;\n}\n\n// UNFORTUNATELY, assigns results to the top/bottom/level/forwardCoord/backwardCoord props of the actual segs.\n// TODO: return hash (by instanceId) of results\nfunction computeSegCoords(segs, dayDate, slatCoords, eventMinHeight, eventOrderSpecs) {\n    computeSegVerticals(segs, dayDate, slatCoords, eventMinHeight);\n    return computeSegHorizontals(segs, eventOrderSpecs); // requires top/bottom from computeSegVerticals\n}\n// For each segment in an array, computes and assigns its top and bottom properties\nfunction computeSegVerticals(segs, dayDate, slatCoords, eventMinHeight) {\n    for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n        var seg = segs_1[_i];\n        seg.top = slatCoords.computeDateTop(seg.start, dayDate);\n        seg.bottom = Math.max(seg.top + (eventMinHeight || 0), // yuck\n        slatCoords.computeDateTop(seg.end, dayDate));\n    }\n}\n// Given an array of segments that are all in the same column, sets the backwardCoord and forwardCoord on each.\n// Assumed the segs are already ordered.\n// NOTE: Also reorders the given array by date!\nfunction computeSegHorizontals(segs, eventOrderSpecs) {\n    // IMPORTANT TO CLEAR OLD RESULTS :(\n    for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n        var seg = segs_2[_i];\n        seg.level = null;\n        seg.forwardCoord = null;\n        seg.backwardCoord = null;\n        seg.forwardPressure = null;\n    }\n    segs = sortEventSegs(segs, eventOrderSpecs);\n    var level0;\n    var levels = buildSlotSegLevels(segs);\n    computeForwardSlotSegs(levels);\n    if ((level0 = levels[0])) {\n        for (var _a = 0, level0_1 = level0; _a < level0_1.length; _a++) {\n            var seg = level0_1[_a];\n            computeSlotSegPressures(seg);\n        }\n        for (var _b = 0, level0_2 = level0; _b < level0_2.length; _b++) {\n            var seg = level0_2[_b];\n            computeSegForwardBack(seg, 0, 0, eventOrderSpecs);\n        }\n    }\n    return segs;\n}\n// Builds an array of segments \"levels\". The first level will be the leftmost tier of segments if the calendar is\n// left-to-right, or the rightmost if the calendar is right-to-left. Assumes the segments are already ordered by date.\nfunction buildSlotSegLevels(segs) {\n    var levels = [];\n    var i;\n    var seg;\n    var j;\n    for (i = 0; i < segs.length; i++) {\n        seg = segs[i];\n        // go through all the levels and stop on the first level where there are no collisions\n        for (j = 0; j < levels.length; j++) {\n            if (!computeSlotSegCollisions(seg, levels[j]).length) {\n                break;\n            }\n        }\n        seg.level = j;\n        (levels[j] || (levels[j] = [])).push(seg);\n    }\n    return levels;\n}\n// Find all the segments in `otherSegs` that vertically collide with `seg`.\n// Append into an optionally-supplied `results` array and return.\nfunction computeSlotSegCollisions(seg, otherSegs, results) {\n    if (results === void 0) { results = []; }\n    for (var i = 0; i < otherSegs.length; i++) {\n        if (isSlotSegCollision(seg, otherSegs[i])) {\n            results.push(otherSegs[i]);\n        }\n    }\n    return results;\n}\n// Do these segments occupy the same vertical space?\nfunction isSlotSegCollision(seg1, seg2) {\n    return seg1.bottom > seg2.top && seg1.top < seg2.bottom;\n}\n// For every segment, figure out the other segments that are in subsequent\n// levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\nfunction computeForwardSlotSegs(levels) {\n    var i;\n    var level;\n    var j;\n    var seg;\n    var k;\n    for (i = 0; i < levels.length; i++) {\n        level = levels[i];\n        for (j = 0; j < level.length; j++) {\n            seg = level[j];\n            seg.forwardSegs = [];\n            for (k = i + 1; k < levels.length; k++) {\n                computeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n            }\n        }\n    }\n}\n// Figure out which path forward (via seg.forwardSegs) results in the longest path until\n// the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\nfunction computeSlotSegPressures(seg) {\n    var forwardSegs = seg.forwardSegs;\n    var forwardPressure = 0;\n    var i;\n    var forwardSeg;\n    if (seg.forwardPressure == null) { // not already computed\n        for (i = 0; i < forwardSegs.length; i++) {\n            forwardSeg = forwardSegs[i];\n            // figure out the child's maximum forward path\n            computeSlotSegPressures(forwardSeg);\n            // either use the existing maximum, or use the child's forward pressure\n            // plus one (for the forwardSeg itself)\n            forwardPressure = Math.max(forwardPressure, 1 + forwardSeg.forwardPressure);\n        }\n        seg.forwardPressure = forwardPressure;\n    }\n}\n// Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n// from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n// seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n//\n// The segment might be part of a \"series\", which means consecutive segments with the same pressure\n// who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n// segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n// coordinate of the first segment in the series.\nfunction computeSegForwardBack(seg, seriesBackwardPressure, seriesBackwardCoord, eventOrderSpecs) {\n    var forwardSegs = seg.forwardSegs;\n    var i;\n    if (seg.forwardCoord == null) { // not already computed\n        if (!forwardSegs.length) {\n            // if there are no forward segments, this segment should butt up against the edge\n            seg.forwardCoord = 1;\n        }\n        else {\n            // sort highest pressure first\n            sortForwardSegs(forwardSegs, eventOrderSpecs);\n            // this segment's forwardCoord will be calculated from the backwardCoord of the\n            // highest-pressure forward segment.\n            computeSegForwardBack(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord, eventOrderSpecs);\n            seg.forwardCoord = forwardSegs[0].backwardCoord;\n        }\n        // calculate the backwardCoord from the forwardCoord. consider the series\n        seg.backwardCoord = seg.forwardCoord -\n            (seg.forwardCoord - seriesBackwardCoord) / // available width for series\n                (seriesBackwardPressure + 1); // # of segments in the series\n        // use this segment's coordinates to computed the coordinates of the less-pressurized\n        // forward segments\n        for (i = 0; i < forwardSegs.length; i++) {\n            computeSegForwardBack(forwardSegs[i], 0, seg.forwardCoord, eventOrderSpecs);\n        }\n    }\n}\nfunction sortForwardSegs(forwardSegs, eventOrderSpecs) {\n    var objs = forwardSegs.map(buildTimeGridSegCompareObj);\n    var specs = [\n        // put higher-pressure first\n        { field: 'forwardPressure', order: -1 },\n        // put segments that are closer to initial edge first (and favor ones with no coords yet)\n        { field: 'backwardCoord', order: 1 }\n    ].concat(eventOrderSpecs);\n    objs.sort(function (obj0, obj1) {\n        return compareByFieldSpecs(obj0, obj1, specs);\n    });\n    return objs.map(function (c) {\n        return c._seg;\n    });\n}\nfunction buildTimeGridSegCompareObj(seg) {\n    var obj = buildSegCompareObj(seg);\n    obj.forwardPressure = seg.forwardPressure;\n    obj.backwardCoord = seg.backwardCoord;\n    return obj;\n}\n\nvar DEFAULT_TIME_FORMAT = createFormatter({\n    hour: 'numeric',\n    minute: '2-digit',\n    meridiem: false\n});\nvar TimeColEvent = /** @class */ (function (_super) {\n    __extends(TimeColEvent, _super);\n    function TimeColEvent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimeColEvent.prototype.render = function () {\n        var classNames = [\n            'fc-timegrid-event',\n            'fc-v-event'\n        ];\n        if (this.props.isCondensed) {\n            classNames.push('fc-timegrid-event-condensed');\n        }\n        return (createElement(StandardEvent, __assign({}, this.props, { defaultTimeFormat: DEFAULT_TIME_FORMAT, extraClassNames: classNames })));\n    };\n    return TimeColEvent;\n}(BaseComponent));\n\nconfig.timeGridEventCondensedHeight = 30;\nvar TimeCol = /** @class */ (function (_super) {\n    __extends(TimeCol, _super);\n    function TimeCol() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimeCol.prototype.render = function () {\n        var _this = this;\n        var _a = this, props = _a.props, context = _a.context;\n        var isSelectMirror = context.options.selectMirror;\n        var mirrorSegs = (props.eventDrag && props.eventDrag.segs) ||\n            (props.eventResize && props.eventResize.segs) ||\n            (isSelectMirror && props.dateSelectionSegs) ||\n            [];\n        var interactionAffectedInstances = // TODO: messy way to compute this\n         (props.eventDrag && props.eventDrag.affectedInstances) ||\n            (props.eventResize && props.eventResize.affectedInstances) ||\n            {};\n        return (createElement(DayCellRoot, { elRef: props.elRef, date: props.date, dateProfile: props.dateProfile, todayRange: props.todayRange, extraHookProps: props.extraHookProps }, function (rootElRef, classNames, dataAttrs) { return (createElement(\"td\", __assign({ ref: rootElRef, className: ['fc-timegrid-col'].concat(classNames, props.extraClassNames || []).join(' ') }, dataAttrs, props.extraDataAttrs),\n            createElement(\"div\", { className: 'fc-timegrid-col-frame' },\n                createElement(\"div\", { className: 'fc-timegrid-col-bg' },\n                    _this.renderFillSegs(props.businessHourSegs, 'non-business'),\n                    _this.renderFillSegs(props.bgEventSegs, 'bg-event'),\n                    _this.renderFillSegs(props.dateSelectionSegs, 'highlight')),\n                createElement(\"div\", { className: 'fc-timegrid-col-events' }, _this.renderFgSegs(props.fgEventSegs, interactionAffectedInstances)),\n                createElement(\"div\", { className: 'fc-timegrid-col-events' }, _this.renderFgSegs(mirrorSegs, {}, Boolean(props.eventDrag), Boolean(props.eventResize), Boolean(isSelectMirror)\n                // TODO: pass in left/right instead of using only computeSegTopBottomCss\n                )),\n                createElement(\"div\", { className: 'fc-timegrid-now-indicator-container' }, _this.renderNowIndicator(props.nowIndicatorSegs)),\n                createElement(TimeColMisc, { date: props.date, dateProfile: props.dateProfile, todayRange: props.todayRange, extraHookProps: props.extraHookProps })))); }));\n    };\n    TimeCol.prototype.renderFgSegs = function (segs, segIsInvisible, isDragging, isResizing, isDateSelecting) {\n        var props = this.props;\n        if (props.forPrint) {\n            return this.renderPrintFgSegs(segs);\n        }\n        else if (props.slatCoords) {\n            return this.renderPositionedFgSegs(segs, segIsInvisible, isDragging, isResizing, isDateSelecting);\n        }\n    };\n    TimeCol.prototype.renderPrintFgSegs = function (segs) {\n        var _a = this, props = _a.props, context = _a.context;\n        // not DRY\n        segs = sortEventSegs(segs, context.options.eventOrder);\n        return segs.map(function (seg) { return (createElement(\"div\", { className: 'fc-timegrid-event-harness', key: seg.eventRange.instance.instanceId },\n            createElement(TimeColEvent, __assign({ seg: seg, isDragging: false, isResizing: false, isDateSelecting: false, isSelected: false, isCondensed: false }, getSegMeta(seg, props.todayRange, props.nowDate))))); });\n    };\n    TimeCol.prototype.renderPositionedFgSegs = function (segs, segIsInvisible, isDragging, isResizing, isDateSelecting) {\n        var _this = this;\n        var _a = this, context = _a.context, props = _a.props;\n        // assigns TO THE SEGS THEMSELVES\n        // also, receives resorted array\n        segs = computeSegCoords(segs, props.date, props.slatCoords, context.options.eventMinHeight, context.options.eventOrder);\n        return segs.map(function (seg) {\n            var instanceId = seg.eventRange.instance.instanceId;\n            var isMirror = isDragging || isResizing || isDateSelecting;\n            var positionCss = isMirror ? __assign({ left: 0, right: 0 }, _this.computeSegTopBottomCss(seg)) :\n                _this.computeFgSegPositionCss(seg);\n            return (createElement(\"div\", { className: 'fc-timegrid-event-harness' + (seg.level > 0 ? ' fc-timegrid-event-harness-inset' : ''), key: instanceId, style: __assign({ visibility: segIsInvisible[instanceId] ? 'hidden' : '' }, positionCss) },\n                createElement(TimeColEvent, __assign({ seg: seg, isDragging: isDragging, isResizing: isResizing, isDateSelecting: isDateSelecting, isSelected: instanceId === props.eventSelection, isCondensed: (seg.bottom - seg.top) < config.timeGridEventCondensedHeight }, getSegMeta(seg, props.todayRange, props.nowDate)))));\n        });\n    };\n    TimeCol.prototype.renderFillSegs = function (segs, fillType) {\n        var _this = this;\n        var _a = this, context = _a.context, props = _a.props;\n        if (!props.slatCoords) {\n            return;\n        }\n        // BAD: assigns TO THE SEGS THEMSELVES\n        computeSegVerticals(segs, props.date, props.slatCoords, context.options.eventMinHeight);\n        var children = segs.map(function (seg) { return (createElement(\"div\", { key: buildEventRangeKey(seg.eventRange), className: 'fc-timegrid-bg-harness', style: _this.computeSegTopBottomCss(seg) }, fillType === 'bg-event' ?\n            createElement(BgEvent, __assign({ seg: seg }, getSegMeta(seg, props.todayRange, props.nowDate))) :\n            renderFill(fillType))); });\n        return createElement(Fragment, null, children);\n    };\n    TimeCol.prototype.renderNowIndicator = function (segs) {\n        var _a = this.props, slatCoords = _a.slatCoords, date = _a.date;\n        if (!slatCoords) {\n            return;\n        }\n        return segs.map(function (seg, i) { return (createElement(NowIndicatorRoot, { isAxis: false, date: date, key: i /* key doesn't matter. will only ever be one */ }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-timegrid-now-indicator-line'].concat(classNames).join(' '), style: { top: slatCoords.computeDateTop(seg.start, date) } }, innerContent)); })); });\n    };\n    TimeCol.prototype.computeFgSegPositionCss = function (seg) {\n        var _a = this.context, isRtl = _a.isRtl, options = _a.options;\n        var shouldOverlap = options.slotEventOverlap;\n        var backwardCoord = seg.backwardCoord; // the left side if LTR. the right side if RTL. floating-point\n        var forwardCoord = seg.forwardCoord; // the right side if LTR. the left side if RTL. floating-point\n        var left; // amount of space from left edge, a fraction of the total width\n        var right; // amount of space from right edge, a fraction of the total width\n        if (shouldOverlap) {\n            // double the width, but don't go beyond the maximum forward coordinate (1.0)\n            forwardCoord = Math.min(1, backwardCoord + (forwardCoord - backwardCoord) * 2);\n        }\n        if (isRtl) {\n            left = 1 - forwardCoord;\n            right = backwardCoord;\n        }\n        else {\n            left = backwardCoord;\n            right = 1 - forwardCoord;\n        }\n        var props = {\n            zIndex: seg.level + 1,\n            left: left * 100 + '%',\n            right: right * 100 + '%'\n        };\n        if (shouldOverlap && seg.forwardPressure) {\n            // add padding to the edge so that forward stacked events don't cover the resizer's icon\n            props[isRtl ? 'marginLeft' : 'marginRight'] = 10 * 2; // 10 is a guesstimate of the icon's width\n        }\n        return __assign(__assign({}, props), this.computeSegTopBottomCss(seg));\n    };\n    TimeCol.prototype.computeSegTopBottomCss = function (seg) {\n        return {\n            top: seg.top,\n            bottom: -seg.bottom\n        };\n    };\n    return TimeCol;\n}(BaseComponent));\nvar TimeColMisc = /** @class */ (function (_super) {\n    __extends(TimeColMisc, _super);\n    function TimeColMisc() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimeColMisc.prototype.render = function () {\n        var props = this.props;\n        return (createElement(DayCellContent, { date: props.date, dateProfile: props.dateProfile, todayRange: props.todayRange, extraHookProps: props.extraHookProps }, function (innerElRef, innerContent) { return (innerContent &&\n            createElement(\"div\", { className: 'fc-timegrid-col-misc', ref: innerElRef }, innerContent)); }));\n    };\n    return TimeColMisc;\n}(BaseComponent));\n\nvar TimeColsContent = /** @class */ (function (_super) {\n    __extends(TimeColsContent, _super);\n    function TimeColsContent() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.splitFgEventSegs = memoize(splitSegsByCol);\n        _this.splitBgEventSegs = memoize(splitSegsByCol);\n        _this.splitBusinessHourSegs = memoize(splitSegsByCol);\n        _this.splitNowIndicatorSegs = memoize(splitSegsByCol);\n        _this.splitDateSelectionSegs = memoize(splitSegsByCol);\n        _this.splitEventDrag = memoize(splitInteractionByCol);\n        _this.splitEventResize = memoize(splitInteractionByCol);\n        _this.rootElRef = createRef();\n        _this.cellElRefs = new RefMap();\n        return _this;\n    }\n    TimeColsContent.prototype.render = function () {\n        var _this = this;\n        var _a = this, props = _a.props, context = _a.context;\n        var nowIndicatorTop = context.options.nowIndicator &&\n            props.slatCoords &&\n            props.slatCoords.safeComputeTop(props.nowDate); // might return void\n        var colCnt = props.cells.length;\n        var fgEventSegsByRow = this.splitFgEventSegs(props.fgEventSegs, colCnt);\n        var bgEventSegsByRow = this.splitBgEventSegs(props.bgEventSegs, colCnt);\n        var businessHourSegsByRow = this.splitBusinessHourSegs(props.businessHourSegs, colCnt);\n        var nowIndicatorSegsByRow = this.splitNowIndicatorSegs(props.nowIndicatorSegs, colCnt);\n        var dateSelectionSegsByRow = this.splitDateSelectionSegs(props.dateSelectionSegs, colCnt);\n        var eventDragByRow = this.splitEventDrag(props.eventDrag, colCnt);\n        var eventResizeByRow = this.splitEventResize(props.eventResize, colCnt);\n        return (createElement(\"div\", { className: 'fc-timegrid-cols', ref: this.rootElRef },\n            createElement(\"table\", { style: {\n                    minWidth: props.tableMinWidth,\n                    width: props.clientWidth\n                } },\n                props.tableColGroupNode,\n                createElement(\"tbody\", null,\n                    createElement(\"tr\", null,\n                        props.axis &&\n                            createElement(\"td\", { className: 'fc-timegrid-col fc-timegrid-axis' },\n                                createElement(\"div\", { className: 'fc-timegrid-col-frame' },\n                                    createElement(\"div\", { className: 'fc-timegrid-now-indicator-container' }, typeof nowIndicatorTop === 'number' &&\n                                        createElement(NowIndicatorRoot, { isAxis: true, date: props.nowDate }, function (rootElRef, classNames, innerElRef, innerContent) { return (createElement(\"div\", { ref: rootElRef, className: ['fc-timegrid-now-indicator-arrow'].concat(classNames).join(' '), style: { top: nowIndicatorTop } }, innerContent)); })))),\n                        props.cells.map(function (cell, i) { return (createElement(TimeCol, { key: cell.key, elRef: _this.cellElRefs.createRef(cell.key), dateProfile: props.dateProfile, date: cell.date, nowDate: props.nowDate, todayRange: props.todayRange, extraHookProps: cell.extraHookProps, extraDataAttrs: cell.extraDataAttrs, extraClassNames: cell.extraClassNames, fgEventSegs: fgEventSegsByRow[i], bgEventSegs: bgEventSegsByRow[i], businessHourSegs: businessHourSegsByRow[i], nowIndicatorSegs: nowIndicatorSegsByRow[i], dateSelectionSegs: dateSelectionSegsByRow[i], eventDrag: eventDragByRow[i], eventResize: eventResizeByRow[i], slatCoords: props.slatCoords, eventSelection: props.eventSelection, forPrint: props.forPrint })); }))))));\n    };\n    TimeColsContent.prototype.componentDidMount = function () {\n        this.updateCoords();\n    };\n    TimeColsContent.prototype.componentDidUpdate = function () {\n        this.updateCoords();\n    };\n    TimeColsContent.prototype.updateCoords = function () {\n        var props = this.props;\n        if (props.onColCoords &&\n            props.clientWidth !== null // means sizing has stabilized\n        ) {\n            props.onColCoords(new PositionCache(this.rootElRef.current, collectCellEls(this.cellElRefs.currentMap, props.cells), true, // horizontal\n            false));\n        }\n    };\n    return TimeColsContent;\n}(BaseComponent));\nfunction collectCellEls(elMap, cells) {\n    return cells.map(function (cell) { return elMap[cell.key]; });\n}\n\n/* A component that renders one or more columns of vertical time slots\n----------------------------------------------------------------------------------------------------------------------*/\nvar TimeCols = /** @class */ (function (_super) {\n    __extends(TimeCols, _super);\n    function TimeCols() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.processSlotOptions = memoize(processSlotOptions);\n        _this.state = {\n            slatCoords: null\n        };\n        _this.handleScrollRequest = function (request) {\n            var onScrollTopRequest = _this.props.onScrollTopRequest;\n            var slatCoords = _this.state.slatCoords;\n            if (onScrollTopRequest && slatCoords) {\n                if (request.time) {\n                    var top_1 = slatCoords.computeTimeTop(request.time);\n                    top_1 = Math.ceil(top_1); // zoom can give weird floating-point values. rather scroll a little bit further\n                    if (top_1) {\n                        top_1++;\n                    } // to overcome top border that slots beyond the first have. looks better\n                    onScrollTopRequest(top_1);\n                }\n                return true;\n            }\n        };\n        _this.handleColCoords = function (colCoords) {\n            _this.colCoords = colCoords;\n        };\n        _this.handleSlatCoords = function (slatCoords) {\n            _this.setState({ slatCoords: slatCoords });\n            if (_this.props.onSlatCoords) {\n                _this.props.onSlatCoords(slatCoords);\n            }\n        };\n        return _this;\n    }\n    TimeCols.prototype.render = function () {\n        var _a = this, props = _a.props, state = _a.state;\n        return (createElement(\"div\", { className: 'fc-timegrid-body', ref: props.rootElRef, style: {\n                // these props are important to give this wrapper correct dimensions for interactions\n                // TODO: if we set it here, can we avoid giving to inner tables?\n                width: props.clientWidth,\n                minWidth: props.tableMinWidth\n            } },\n            createElement(TimeColsSlats, { axis: props.axis, dateProfile: props.dateProfile, slatMetas: props.slatMetas, clientWidth: props.clientWidth, minHeight: props.expandRows ? props.clientHeight : '', tableMinWidth: props.tableMinWidth, tableColGroupNode: props.axis ? props.tableColGroupNode : null /* axis depends on the colgroup's shrinking */, onCoords: this.handleSlatCoords }),\n            createElement(TimeColsContent, { cells: props.cells, axis: props.axis, dateProfile: props.dateProfile, businessHourSegs: props.businessHourSegs, bgEventSegs: props.bgEventSegs, fgEventSegs: props.fgEventSegs, dateSelectionSegs: props.dateSelectionSegs, eventSelection: props.eventSelection, eventDrag: props.eventDrag, eventResize: props.eventResize, todayRange: props.todayRange, nowDate: props.nowDate, nowIndicatorSegs: props.nowIndicatorSegs, clientWidth: props.clientWidth, tableMinWidth: props.tableMinWidth, tableColGroupNode: props.tableColGroupNode, slatCoords: state.slatCoords, onColCoords: this.handleColCoords, forPrint: props.forPrint })));\n    };\n    TimeCols.prototype.componentDidMount = function () {\n        this.scrollResponder = this.context.createScrollResponder(this.handleScrollRequest);\n    };\n    TimeCols.prototype.componentDidUpdate = function (prevProps) {\n        this.scrollResponder.update(prevProps.dateProfile !== this.props.dateProfile);\n    };\n    TimeCols.prototype.componentWillUnmount = function () {\n        this.scrollResponder.detach();\n    };\n    TimeCols.prototype.positionToHit = function (positionLeft, positionTop) {\n        var _a = this.context, dateEnv = _a.dateEnv, options = _a.options;\n        var colCoords = this.colCoords;\n        var dateProfile = this.props.dateProfile;\n        var slatCoords = this.state.slatCoords;\n        var _b = this.processSlotOptions(this.props.slotDuration, options.snapDuration), snapDuration = _b.snapDuration, snapsPerSlot = _b.snapsPerSlot;\n        var colIndex = colCoords.leftToIndex(positionLeft);\n        var slatIndex = slatCoords.positions.topToIndex(positionTop);\n        if (colIndex != null && slatIndex != null) {\n            var slatTop = slatCoords.positions.tops[slatIndex];\n            var slatHeight = slatCoords.positions.getHeight(slatIndex);\n            var partial = (positionTop - slatTop) / slatHeight; // floating point number between 0 and 1\n            var localSnapIndex = Math.floor(partial * snapsPerSlot); // the snap # relative to start of slat\n            var snapIndex = slatIndex * snapsPerSlot + localSnapIndex;\n            var dayDate = this.props.cells[colIndex].date;\n            var time = addDurations(dateProfile.slotMinTime, multiplyDuration(snapDuration, snapIndex));\n            var start = dateEnv.add(dayDate, time);\n            var end = dateEnv.add(start, snapDuration);\n            return {\n                col: colIndex,\n                dateSpan: {\n                    range: { start: start, end: end },\n                    allDay: false\n                },\n                dayEl: colCoords.els[colIndex],\n                relativeRect: {\n                    left: colCoords.lefts[colIndex],\n                    right: colCoords.rights[colIndex],\n                    top: slatTop,\n                    bottom: slatTop + slatHeight\n                }\n            };\n        }\n    };\n    return TimeCols;\n}(BaseComponent));\nfunction processSlotOptions(slotDuration, snapDurationOverride) {\n    var snapDuration = snapDurationOverride || slotDuration;\n    var snapsPerSlot = wholeDivideDurations(slotDuration, snapDuration);\n    if (snapsPerSlot === null) {\n        snapDuration = slotDuration;\n        snapsPerSlot = 1;\n        // TODO: say warning?\n    }\n    return { snapDuration: snapDuration, snapsPerSlot: snapsPerSlot };\n}\n\nvar DayTimeCols = /** @class */ (function (_super) {\n    __extends(DayTimeCols, _super);\n    function DayTimeCols() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.buildDayRanges = memoize(buildDayRanges);\n        _this.slicer = new DayTimeColsSlicer();\n        _this.timeColsRef = createRef();\n        _this.handleRootEl = function (rootEl) {\n            if (rootEl) {\n                _this.context.registerInteractiveComponent(_this, { el: rootEl });\n            }\n            else {\n                _this.context.unregisterInteractiveComponent(_this);\n            }\n        };\n        return _this;\n    }\n    DayTimeCols.prototype.render = function () {\n        var _this = this;\n        var _a = this, props = _a.props, context = _a.context;\n        var dateProfile = props.dateProfile, dayTableModel = props.dayTableModel;\n        var isNowIndicator = context.options.nowIndicator;\n        var dayRanges = this.buildDayRanges(dayTableModel, dateProfile, context.dateEnv);\n        // give it the first row of cells\n        // TODO: would move this further down hierarchy, but sliceNowDate needs it\n        return (createElement(NowTimer, { unit: isNowIndicator ? 'minute' : 'day' }, function (nowDate, todayRange) { return (createElement(TimeCols, __assign({ ref: _this.timeColsRef, rootElRef: _this.handleRootEl }, _this.slicer.sliceProps(props, dateProfile, null, context, dayRanges), { forPrint: props.forPrint, axis: props.axis, dateProfile: dateProfile, slatMetas: props.slatMetas, slotDuration: props.slotDuration, cells: dayTableModel.cells[0], tableColGroupNode: props.tableColGroupNode, tableMinWidth: props.tableMinWidth, clientWidth: props.clientWidth, clientHeight: props.clientHeight, expandRows: props.expandRows, nowDate: nowDate, nowIndicatorSegs: isNowIndicator && _this.slicer.sliceNowDate(nowDate, context, dayRanges), todayRange: todayRange, onScrollTopRequest: props.onScrollTopRequest, onSlatCoords: props.onSlatCoords }))); }));\n    };\n    DayTimeCols.prototype.queryHit = function (positionLeft, positionTop) {\n        var rawHit = this.timeColsRef.current.positionToHit(positionLeft, positionTop);\n        if (rawHit) {\n            return {\n                component: this,\n                dateSpan: rawHit.dateSpan,\n                dayEl: rawHit.dayEl,\n                rect: {\n                    left: rawHit.relativeRect.left,\n                    right: rawHit.relativeRect.right,\n                    top: rawHit.relativeRect.top,\n                    bottom: rawHit.relativeRect.bottom\n                },\n                layer: 0\n            };\n        }\n    };\n    return DayTimeCols;\n}(DateComponent));\nfunction buildDayRanges(dayTableModel, dateProfile, dateEnv) {\n    var ranges = [];\n    for (var _i = 0, _a = dayTableModel.headerDates; _i < _a.length; _i++) {\n        var date = _a[_i];\n        ranges.push({\n            start: dateEnv.add(date, dateProfile.slotMinTime),\n            end: dateEnv.add(date, dateProfile.slotMaxTime)\n        });\n    }\n    return ranges;\n}\nvar DayTimeColsSlicer = /** @class */ (function (_super) {\n    __extends(DayTimeColsSlicer, _super);\n    function DayTimeColsSlicer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DayTimeColsSlicer.prototype.sliceRange = function (range, dayRanges) {\n        var segs = [];\n        for (var col = 0; col < dayRanges.length; col++) {\n            var segRange = intersectRanges(range, dayRanges[col]);\n            if (segRange) {\n                segs.push({\n                    start: segRange.start,\n                    end: segRange.end,\n                    isStart: segRange.start.valueOf() === range.start.valueOf(),\n                    isEnd: segRange.end.valueOf() === range.end.valueOf(),\n                    col: col\n                });\n            }\n        }\n        return segs;\n    };\n    return DayTimeColsSlicer;\n}(Slicer));\n\nvar DayTimeColsView = /** @class */ (function (_super) {\n    __extends(DayTimeColsView, _super);\n    function DayTimeColsView() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.buildTimeColsModel = memoize(buildTimeColsModel);\n        _this.buildSlatMetas = memoize(buildSlatMetas);\n        return _this;\n    }\n    DayTimeColsView.prototype.render = function () {\n        var _this = this;\n        var _a = this.context, options = _a.options, dateEnv = _a.dateEnv, dateProfileGenerator = _a.dateProfileGenerator;\n        var props = this.props;\n        var dateProfile = props.dateProfile;\n        var dayTableModel = this.buildTimeColsModel(dateProfile, dateProfileGenerator);\n        var splitProps = this.allDaySplitter.splitProps(props);\n        var slatMetas = this.buildSlatMetas(dateProfile.slotMinTime, dateProfile.slotMaxTime, options.slotLabelInterval, options.slotDuration, dateEnv);\n        var dayMinWidth = options.dayMinWidth;\n        var hasAttachedAxis = !dayMinWidth;\n        var hasDetachedAxis = dayMinWidth;\n        var headerContent = options.dayHeaders &&\n            createElement(DayHeader, { dates: dayTableModel.headerDates, dateProfile: dateProfile, datesRepDistinctDays: true, renderIntro: hasAttachedAxis ? this.renderHeadAxis : null });\n        var allDayContent = (options.allDaySlot !== false) && (function (contentArg) { return (createElement(DayTable, __assign({}, splitProps['allDay'], { dateProfile: dateProfile, dayTableModel: dayTableModel, nextDayThreshold: options.nextDayThreshold, tableMinWidth: contentArg.tableMinWidth, colGroupNode: contentArg.tableColGroupNode, renderRowIntro: hasAttachedAxis ? _this.renderTableRowAxis : null, showWeekNumbers: false, expandRows: false, headerAlignElRef: _this.headerElRef, clientWidth: contentArg.clientWidth, clientHeight: contentArg.clientHeight, forPrint: props.forPrint }, _this.getAllDayMaxEventProps()))); });\n        var timeGridContent = function (contentArg) { return (createElement(DayTimeCols, __assign({}, splitProps['timed'], { dayTableModel: dayTableModel, dateProfile: dateProfile, axis: hasAttachedAxis, slotDuration: options.slotDuration, slatMetas: slatMetas, forPrint: props.forPrint, tableColGroupNode: contentArg.tableColGroupNode, tableMinWidth: contentArg.tableMinWidth, clientWidth: contentArg.clientWidth, clientHeight: contentArg.clientHeight, onSlatCoords: _this.handleSlatCoords, expandRows: contentArg.expandRows, onScrollTopRequest: _this.handleScrollTopRequest }))); };\n        return hasDetachedAxis\n            ? this.renderHScrollLayout(headerContent, allDayContent, timeGridContent, dayTableModel.colCnt, dayMinWidth, slatMetas, this.state.slatCoords)\n            : this.renderSimpleLayout(headerContent, allDayContent, timeGridContent);\n    };\n    return DayTimeColsView;\n}(TimeColsView));\nfunction buildTimeColsModel(dateProfile, dateProfileGenerator) {\n    var daySeries = new DaySeriesModel(dateProfile.renderRange, dateProfileGenerator);\n    return new DayTableModel(daySeries, false);\n}\n\nvar OPTION_REFINERS = {\n    allDaySlot: Boolean\n};\n\nvar main = createPlugin({\n    initialView: 'timeGridWeek',\n    optionRefiners: OPTION_REFINERS,\n    views: {\n        timeGrid: {\n            component: DayTimeColsView,\n            usesMinMaxTime: true,\n            allDaySlot: true,\n            slotDuration: '00:30:00',\n            slotEventOverlap: true // a bad name. confused with overlap/constraint system\n        },\n        timeGridDay: {\n            type: 'timeGrid',\n            duration: { days: 1 }\n        },\n        timeGridWeek: {\n            type: 'timeGrid',\n            duration: { weeks: 1 }\n        }\n    }\n});\n\nexport default main;\nexport { DayTimeCols, DayTimeColsSlicer, DayTimeColsView, TimeCols, TimeColsSlatsCoords, TimeColsView, buildDayRanges, buildSlatMetas, buildTimeColsModel };\n//# sourceMappingURL=main.js.map\n","/*!\nFullCalendar v5.3.1\nDocs & License: https://fullcalendar.io/\n(c) 2020 Adam Shaw\n*/\nimport { config, elementClosest, Emitter, applyStyle, whenTransitionDone, removeElement, ScrollController, ElementScrollController, computeInnerRect, WindowScrollController, preventSelection, preventContextMenu, allowSelection, allowContextMenu, ElementDragging, computeRect, getClippingParents, pointInsideRect, isDateSpansEqual, constrainPoint, intersectRects, getRectCenter, diffPoints, mapHash, rangeContainsRange, interactionSettingsToStore, Interaction, enableCursor, disableCursor, triggerDateSelect, compareNumbers, getElSeg, getRelevantEvents, EventApi, createEmptyEventStore, applyMutationToEventStore, buildEventApis, interactionSettingsStore, startOfDay, diffDates, createDuration, identity, eventTupleToStore, isInteractionValid, parseDragMeta, elementMatches, refineEventDef, parseEventDef, getDefaultEventEnd, createEventInstance, BASE_OPTION_DEFAULTS, createPlugin } from '@fullcalendar/common';\nimport { __extends, __assign } from 'tslib';\n\nconfig.touchMouseIgnoreWait = 500;\nvar ignoreMouseDepth = 0;\nvar listenerCnt = 0;\nvar isWindowTouchMoveCancelled = false;\n/*\nUses a \"pointer\" abstraction, which monitors UI events for both mouse and touch.\nTracks when the pointer \"drags\" on a certain element, meaning down+move+up.\n\nAlso, tracks if there was touch-scrolling.\nAlso, can prevent touch-scrolling from happening.\nAlso, can fire pointermove events when scrolling happens underneath, even when no real pointer movement.\n\nemits:\n- pointerdown\n- pointermove\n- pointerup\n*/\nvar PointerDragging = /** @class */ (function () {\n    function PointerDragging(containerEl) {\n        var _this = this;\n        this.subjectEl = null;\n        // options that can be directly assigned by caller\n        this.selector = ''; // will cause subjectEl in all emitted events to be this element\n        this.handleSelector = '';\n        this.shouldIgnoreMove = false;\n        this.shouldWatchScroll = true; // for simulating pointermove on scroll\n        // internal states\n        this.isDragging = false;\n        this.isTouchDragging = false;\n        this.wasTouchScroll = false;\n        // Mouse\n        // ----------------------------------------------------------------------------------------------------\n        this.handleMouseDown = function (ev) {\n            if (!_this.shouldIgnoreMouse() &&\n                isPrimaryMouseButton(ev) &&\n                _this.tryStart(ev)) {\n                var pev = _this.createEventFromMouse(ev, true);\n                _this.emitter.trigger('pointerdown', pev);\n                _this.initScrollWatch(pev);\n                if (!_this.shouldIgnoreMove) {\n                    document.addEventListener('mousemove', _this.handleMouseMove);\n                }\n                document.addEventListener('mouseup', _this.handleMouseUp);\n            }\n        };\n        this.handleMouseMove = function (ev) {\n            var pev = _this.createEventFromMouse(ev);\n            _this.recordCoords(pev);\n            _this.emitter.trigger('pointermove', pev);\n        };\n        this.handleMouseUp = function (ev) {\n            document.removeEventListener('mousemove', _this.handleMouseMove);\n            document.removeEventListener('mouseup', _this.handleMouseUp);\n            _this.emitter.trigger('pointerup', _this.createEventFromMouse(ev));\n            _this.cleanup(); // call last so that pointerup has access to props\n        };\n        // Touch\n        // ----------------------------------------------------------------------------------------------------\n        this.handleTouchStart = function (ev) {\n            if (_this.tryStart(ev)) {\n                _this.isTouchDragging = true;\n                var pev = _this.createEventFromTouch(ev, true);\n                _this.emitter.trigger('pointerdown', pev);\n                _this.initScrollWatch(pev);\n                // unlike mouse, need to attach to target, not document\n                // https://stackoverflow.com/a/45760014\n                var targetEl = ev.target;\n                if (!_this.shouldIgnoreMove) {\n                    targetEl.addEventListener('touchmove', _this.handleTouchMove);\n                }\n                targetEl.addEventListener('touchend', _this.handleTouchEnd);\n                targetEl.addEventListener('touchcancel', _this.handleTouchEnd); // treat it as a touch end\n                // attach a handler to get called when ANY scroll action happens on the page.\n                // this was impossible to do with normal on/off because 'scroll' doesn't bubble.\n                // http://stackoverflow.com/a/32954565/96342\n                window.addEventListener('scroll', _this.handleTouchScroll, true // useCapture\n                );\n            }\n        };\n        this.handleTouchMove = function (ev) {\n            var pev = _this.createEventFromTouch(ev);\n            _this.recordCoords(pev);\n            _this.emitter.trigger('pointermove', pev);\n        };\n        this.handleTouchEnd = function (ev) {\n            if (_this.isDragging) { // done to guard against touchend followed by touchcancel\n                var targetEl = ev.target;\n                targetEl.removeEventListener('touchmove', _this.handleTouchMove);\n                targetEl.removeEventListener('touchend', _this.handleTouchEnd);\n                targetEl.removeEventListener('touchcancel', _this.handleTouchEnd);\n                window.removeEventListener('scroll', _this.handleTouchScroll, true); // useCaptured=true\n                _this.emitter.trigger('pointerup', _this.createEventFromTouch(ev));\n                _this.cleanup(); // call last so that pointerup has access to props\n                _this.isTouchDragging = false;\n                startIgnoringMouse();\n            }\n        };\n        this.handleTouchScroll = function () {\n            _this.wasTouchScroll = true;\n        };\n        this.handleScroll = function (ev) {\n            if (!_this.shouldIgnoreMove) {\n                var pageX = (window.pageXOffset - _this.prevScrollX) + _this.prevPageX;\n                var pageY = (window.pageYOffset - _this.prevScrollY) + _this.prevPageY;\n                _this.emitter.trigger('pointermove', {\n                    origEvent: ev,\n                    isTouch: _this.isTouchDragging,\n                    subjectEl: _this.subjectEl,\n                    pageX: pageX,\n                    pageY: pageY,\n                    deltaX: pageX - _this.origPageX,\n                    deltaY: pageY - _this.origPageY\n                });\n            }\n        };\n        this.containerEl = containerEl;\n        this.emitter = new Emitter();\n        containerEl.addEventListener('mousedown', this.handleMouseDown);\n        containerEl.addEventListener('touchstart', this.handleTouchStart, { passive: true });\n        listenerCreated();\n    }\n    PointerDragging.prototype.destroy = function () {\n        this.containerEl.removeEventListener('mousedown', this.handleMouseDown);\n        this.containerEl.removeEventListener('touchstart', this.handleTouchStart, { passive: true });\n        listenerDestroyed();\n    };\n    PointerDragging.prototype.tryStart = function (ev) {\n        var subjectEl = this.querySubjectEl(ev);\n        var downEl = ev.target;\n        if (subjectEl &&\n            (!this.handleSelector || elementClosest(downEl, this.handleSelector))) {\n            this.subjectEl = subjectEl;\n            this.isDragging = true; // do this first so cancelTouchScroll will work\n            this.wasTouchScroll = false;\n            return true;\n        }\n        return false;\n    };\n    PointerDragging.prototype.cleanup = function () {\n        isWindowTouchMoveCancelled = false;\n        this.isDragging = false;\n        this.subjectEl = null;\n        // keep wasTouchScroll around for later access\n        this.destroyScrollWatch();\n    };\n    PointerDragging.prototype.querySubjectEl = function (ev) {\n        if (this.selector) {\n            return elementClosest(ev.target, this.selector);\n        }\n        else {\n            return this.containerEl;\n        }\n    };\n    PointerDragging.prototype.shouldIgnoreMouse = function () {\n        return ignoreMouseDepth || this.isTouchDragging;\n    };\n    // can be called by user of this class, to cancel touch-based scrolling for the current drag\n    PointerDragging.prototype.cancelTouchScroll = function () {\n        if (this.isDragging) {\n            isWindowTouchMoveCancelled = true;\n        }\n    };\n    // Scrolling that simulates pointermoves\n    // ----------------------------------------------------------------------------------------------------\n    PointerDragging.prototype.initScrollWatch = function (ev) {\n        if (this.shouldWatchScroll) {\n            this.recordCoords(ev);\n            window.addEventListener('scroll', this.handleScroll, true); // useCapture=true\n        }\n    };\n    PointerDragging.prototype.recordCoords = function (ev) {\n        if (this.shouldWatchScroll) {\n            this.prevPageX = ev.pageX;\n            this.prevPageY = ev.pageY;\n            this.prevScrollX = window.pageXOffset;\n            this.prevScrollY = window.pageYOffset;\n        }\n    };\n    PointerDragging.prototype.destroyScrollWatch = function () {\n        if (this.shouldWatchScroll) {\n            window.removeEventListener('scroll', this.handleScroll, true); // useCaptured=true\n        }\n    };\n    // Event Normalization\n    // ----------------------------------------------------------------------------------------------------\n    PointerDragging.prototype.createEventFromMouse = function (ev, isFirst) {\n        var deltaX = 0;\n        var deltaY = 0;\n        // TODO: repeat code\n        if (isFirst) {\n            this.origPageX = ev.pageX;\n            this.origPageY = ev.pageY;\n        }\n        else {\n            deltaX = ev.pageX - this.origPageX;\n            deltaY = ev.pageY - this.origPageY;\n        }\n        return {\n            origEvent: ev,\n            isTouch: false,\n            subjectEl: this.subjectEl,\n            pageX: ev.pageX,\n            pageY: ev.pageY,\n            deltaX: deltaX,\n            deltaY: deltaY\n        };\n    };\n    PointerDragging.prototype.createEventFromTouch = function (ev, isFirst) {\n        var touches = ev.touches;\n        var pageX;\n        var pageY;\n        var deltaX = 0;\n        var deltaY = 0;\n        // if touch coords available, prefer,\n        // because FF would give bad ev.pageX ev.pageY\n        if (touches && touches.length) {\n            pageX = touches[0].pageX;\n            pageY = touches[0].pageY;\n        }\n        else {\n            pageX = ev.pageX;\n            pageY = ev.pageY;\n        }\n        // TODO: repeat code\n        if (isFirst) {\n            this.origPageX = pageX;\n            this.origPageY = pageY;\n        }\n        else {\n            deltaX = pageX - this.origPageX;\n            deltaY = pageY - this.origPageY;\n        }\n        return {\n            origEvent: ev,\n            isTouch: true,\n            subjectEl: this.subjectEl,\n            pageX: pageX,\n            pageY: pageY,\n            deltaX: deltaX,\n            deltaY: deltaY\n        };\n    };\n    return PointerDragging;\n}());\n// Returns a boolean whether this was a left mouse click and no ctrl key (which means right click on Mac)\nfunction isPrimaryMouseButton(ev) {\n    return ev.button === 0 && !ev.ctrlKey;\n}\n// Ignoring fake mouse events generated by touch\n// ----------------------------------------------------------------------------------------------------\nfunction startIgnoringMouse() {\n    ignoreMouseDepth++;\n    setTimeout(function () {\n        ignoreMouseDepth--;\n    }, config.touchMouseIgnoreWait);\n}\n// We want to attach touchmove as early as possible for Safari\n// ----------------------------------------------------------------------------------------------------\nfunction listenerCreated() {\n    if (!(listenerCnt++)) {\n        window.addEventListener('touchmove', onWindowTouchMove, { passive: false });\n    }\n}\nfunction listenerDestroyed() {\n    if (!(--listenerCnt)) {\n        window.removeEventListener('touchmove', onWindowTouchMove, { passive: false });\n    }\n}\nfunction onWindowTouchMove(ev) {\n    if (isWindowTouchMoveCancelled) {\n        ev.preventDefault();\n    }\n}\n\n/*\nAn effect in which an element follows the movement of a pointer across the screen.\nThe moving element is a clone of some other element.\nMust call start + handleMove + stop.\n*/\nvar ElementMirror = /** @class */ (function () {\n    function ElementMirror() {\n        this.isVisible = false; // must be explicitly enabled\n        this.sourceEl = null;\n        this.mirrorEl = null;\n        this.sourceElRect = null; // screen coords relative to viewport\n        // options that can be set directly by caller\n        this.parentNode = document.body;\n        this.zIndex = 9999;\n        this.revertDuration = 0;\n    }\n    ElementMirror.prototype.start = function (sourceEl, pageX, pageY) {\n        this.sourceEl = sourceEl;\n        this.sourceElRect = this.sourceEl.getBoundingClientRect();\n        this.origScreenX = pageX - window.pageXOffset;\n        this.origScreenY = pageY - window.pageYOffset;\n        this.deltaX = 0;\n        this.deltaY = 0;\n        this.updateElPosition();\n    };\n    ElementMirror.prototype.handleMove = function (pageX, pageY) {\n        this.deltaX = (pageX - window.pageXOffset) - this.origScreenX;\n        this.deltaY = (pageY - window.pageYOffset) - this.origScreenY;\n        this.updateElPosition();\n    };\n    // can be called before start\n    ElementMirror.prototype.setIsVisible = function (bool) {\n        if (bool) {\n            if (!this.isVisible) {\n                if (this.mirrorEl) {\n                    this.mirrorEl.style.display = '';\n                }\n                this.isVisible = bool; // needs to happen before updateElPosition\n                this.updateElPosition(); // because was not updating the position while invisible\n            }\n        }\n        else {\n            if (this.isVisible) {\n                if (this.mirrorEl) {\n                    this.mirrorEl.style.display = 'none';\n                }\n                this.isVisible = bool;\n            }\n        }\n    };\n    // always async\n    ElementMirror.prototype.stop = function (needsRevertAnimation, callback) {\n        var _this = this;\n        var done = function () {\n            _this.cleanup();\n            callback();\n        };\n        if (needsRevertAnimation &&\n            this.mirrorEl &&\n            this.isVisible &&\n            this.revertDuration && // if 0, transition won't work\n            (this.deltaX || this.deltaY) // if same coords, transition won't work\n        ) {\n            this.doRevertAnimation(done, this.revertDuration);\n        }\n        else {\n            setTimeout(done, 0);\n        }\n    };\n    ElementMirror.prototype.doRevertAnimation = function (callback, revertDuration) {\n        var mirrorEl = this.mirrorEl;\n        var finalSourceElRect = this.sourceEl.getBoundingClientRect(); // because autoscrolling might have happened\n        mirrorEl.style.transition =\n            'top ' + revertDuration + 'ms,' +\n                'left ' + revertDuration + 'ms';\n        applyStyle(mirrorEl, {\n            left: finalSourceElRect.left,\n            top: finalSourceElRect.top\n        });\n        whenTransitionDone(mirrorEl, function () {\n            mirrorEl.style.transition = '';\n            callback();\n        });\n    };\n    ElementMirror.prototype.cleanup = function () {\n        if (this.mirrorEl) {\n            removeElement(this.mirrorEl);\n            this.mirrorEl = null;\n        }\n        this.sourceEl = null;\n    };\n    ElementMirror.prototype.updateElPosition = function () {\n        if (this.sourceEl && this.isVisible) {\n            applyStyle(this.getMirrorEl(), {\n                left: this.sourceElRect.left + this.deltaX,\n                top: this.sourceElRect.top + this.deltaY\n            });\n        }\n    };\n    ElementMirror.prototype.getMirrorEl = function () {\n        var sourceElRect = this.sourceElRect;\n        var mirrorEl = this.mirrorEl;\n        if (!mirrorEl) {\n            mirrorEl = this.mirrorEl = this.sourceEl.cloneNode(true); // cloneChildren=true\n            // we don't want long taps or any mouse interaction causing selection/menus.\n            // would use preventSelection(), but that prevents selectstart, causing problems.\n            mirrorEl.classList.add('fc-unselectable');\n            mirrorEl.classList.add('fc-event-dragging');\n            applyStyle(mirrorEl, {\n                position: 'fixed',\n                zIndex: this.zIndex,\n                visibility: '',\n                boxSizing: 'border-box',\n                width: sourceElRect.right - sourceElRect.left,\n                height: sourceElRect.bottom - sourceElRect.top,\n                right: 'auto',\n                bottom: 'auto',\n                margin: 0\n            });\n            this.parentNode.appendChild(mirrorEl);\n        }\n        return mirrorEl;\n    };\n    return ElementMirror;\n}());\n\n/*\nIs a cache for a given element's scroll information (all the info that ScrollController stores)\nin addition the \"client rectangle\" of the element.. the area within the scrollbars.\n\nThe cache can be in one of two modes:\n- doesListening:false - ignores when the container is scrolled by someone else\n- doesListening:true - watch for scrolling and update the cache\n*/\nvar ScrollGeomCache = /** @class */ (function (_super) {\n    __extends(ScrollGeomCache, _super);\n    function ScrollGeomCache(scrollController, doesListening) {\n        var _this = _super.call(this) || this;\n        _this.handleScroll = function () {\n            _this.scrollTop = _this.scrollController.getScrollTop();\n            _this.scrollLeft = _this.scrollController.getScrollLeft();\n            _this.handleScrollChange();\n        };\n        _this.scrollController = scrollController;\n        _this.doesListening = doesListening;\n        _this.scrollTop = _this.origScrollTop = scrollController.getScrollTop();\n        _this.scrollLeft = _this.origScrollLeft = scrollController.getScrollLeft();\n        _this.scrollWidth = scrollController.getScrollWidth();\n        _this.scrollHeight = scrollController.getScrollHeight();\n        _this.clientWidth = scrollController.getClientWidth();\n        _this.clientHeight = scrollController.getClientHeight();\n        _this.clientRect = _this.computeClientRect(); // do last in case it needs cached values\n        if (_this.doesListening) {\n            _this.getEventTarget().addEventListener('scroll', _this.handleScroll);\n        }\n        return _this;\n    }\n    ScrollGeomCache.prototype.destroy = function () {\n        if (this.doesListening) {\n            this.getEventTarget().removeEventListener('scroll', this.handleScroll);\n        }\n    };\n    ScrollGeomCache.prototype.getScrollTop = function () {\n        return this.scrollTop;\n    };\n    ScrollGeomCache.prototype.getScrollLeft = function () {\n        return this.scrollLeft;\n    };\n    ScrollGeomCache.prototype.setScrollTop = function (top) {\n        this.scrollController.setScrollTop(top);\n        if (!this.doesListening) {\n            // we are not relying on the element to normalize out-of-bounds scroll values\n            // so we need to sanitize ourselves\n            this.scrollTop = Math.max(Math.min(top, this.getMaxScrollTop()), 0);\n            this.handleScrollChange();\n        }\n    };\n    ScrollGeomCache.prototype.setScrollLeft = function (top) {\n        this.scrollController.setScrollLeft(top);\n        if (!this.doesListening) {\n            // we are not relying on the element to normalize out-of-bounds scroll values\n            // so we need to sanitize ourselves\n            this.scrollLeft = Math.max(Math.min(top, this.getMaxScrollLeft()), 0);\n            this.handleScrollChange();\n        }\n    };\n    ScrollGeomCache.prototype.getClientWidth = function () {\n        return this.clientWidth;\n    };\n    ScrollGeomCache.prototype.getClientHeight = function () {\n        return this.clientHeight;\n    };\n    ScrollGeomCache.prototype.getScrollWidth = function () {\n        return this.scrollWidth;\n    };\n    ScrollGeomCache.prototype.getScrollHeight = function () {\n        return this.scrollHeight;\n    };\n    ScrollGeomCache.prototype.handleScrollChange = function () {\n    };\n    return ScrollGeomCache;\n}(ScrollController));\nvar ElementScrollGeomCache = /** @class */ (function (_super) {\n    __extends(ElementScrollGeomCache, _super);\n    function ElementScrollGeomCache(el, doesListening) {\n        return _super.call(this, new ElementScrollController(el), doesListening) || this;\n    }\n    ElementScrollGeomCache.prototype.getEventTarget = function () {\n        return this.scrollController.el;\n    };\n    ElementScrollGeomCache.prototype.computeClientRect = function () {\n        return computeInnerRect(this.scrollController.el);\n    };\n    return ElementScrollGeomCache;\n}(ScrollGeomCache));\nvar WindowScrollGeomCache = /** @class */ (function (_super) {\n    __extends(WindowScrollGeomCache, _super);\n    function WindowScrollGeomCache(doesListening) {\n        return _super.call(this, new WindowScrollController(), doesListening) || this;\n    }\n    WindowScrollGeomCache.prototype.getEventTarget = function () {\n        return window;\n    };\n    WindowScrollGeomCache.prototype.computeClientRect = function () {\n        return {\n            left: this.scrollLeft,\n            right: this.scrollLeft + this.clientWidth,\n            top: this.scrollTop,\n            bottom: this.scrollTop + this.clientHeight\n        };\n    };\n    // the window is the only scroll object that changes it's rectangle relative\n    // to the document's topleft as it scrolls\n    WindowScrollGeomCache.prototype.handleScrollChange = function () {\n        this.clientRect = this.computeClientRect();\n    };\n    return WindowScrollGeomCache;\n}(ScrollGeomCache));\n\n// If available we are using native \"performance\" API instead of \"Date\"\n// Read more about it on MDN:\n// https://developer.mozilla.org/en-US/docs/Web/API/Performance\nvar getTime = typeof performance === 'function' ? performance.now : Date.now;\n/*\nFor a pointer interaction, automatically scrolls certain scroll containers when the pointer\napproaches the edge.\n\nThe caller must call start + handleMove + stop.\n*/\nvar AutoScroller = /** @class */ (function () {\n    function AutoScroller() {\n        var _this = this;\n        // options that can be set by caller\n        this.isEnabled = true;\n        this.scrollQuery = [window, '.fc-scroller'];\n        this.edgeThreshold = 50; // pixels\n        this.maxVelocity = 300; // pixels per second\n        // internal state\n        this.pointerScreenX = null;\n        this.pointerScreenY = null;\n        this.isAnimating = false;\n        this.scrollCaches = null;\n        // protect against the initial pointerdown being too close to an edge and starting the scroll\n        this.everMovedUp = false;\n        this.everMovedDown = false;\n        this.everMovedLeft = false;\n        this.everMovedRight = false;\n        this.animate = function () {\n            if (_this.isAnimating) { // wasn't cancelled between animation calls\n                var edge = _this.computeBestEdge(_this.pointerScreenX + window.pageXOffset, _this.pointerScreenY + window.pageYOffset);\n                if (edge) {\n                    var now = getTime();\n                    _this.handleSide(edge, (now - _this.msSinceRequest) / 1000);\n                    _this.requestAnimation(now);\n                }\n                else {\n                    _this.isAnimating = false; // will stop animation\n                }\n            }\n        };\n    }\n    AutoScroller.prototype.start = function (pageX, pageY) {\n        if (this.isEnabled) {\n            this.scrollCaches = this.buildCaches();\n            this.pointerScreenX = null;\n            this.pointerScreenY = null;\n            this.everMovedUp = false;\n            this.everMovedDown = false;\n            this.everMovedLeft = false;\n            this.everMovedRight = false;\n            this.handleMove(pageX, pageY);\n        }\n    };\n    AutoScroller.prototype.handleMove = function (pageX, pageY) {\n        if (this.isEnabled) {\n            var pointerScreenX = pageX - window.pageXOffset;\n            var pointerScreenY = pageY - window.pageYOffset;\n            var yDelta = this.pointerScreenY === null ? 0 : pointerScreenY - this.pointerScreenY;\n            var xDelta = this.pointerScreenX === null ? 0 : pointerScreenX - this.pointerScreenX;\n            if (yDelta < 0) {\n                this.everMovedUp = true;\n            }\n            else if (yDelta > 0) {\n                this.everMovedDown = true;\n            }\n            if (xDelta < 0) {\n                this.everMovedLeft = true;\n            }\n            else if (xDelta > 0) {\n                this.everMovedRight = true;\n            }\n            this.pointerScreenX = pointerScreenX;\n            this.pointerScreenY = pointerScreenY;\n            if (!this.isAnimating) {\n                this.isAnimating = true;\n                this.requestAnimation(getTime());\n            }\n        }\n    };\n    AutoScroller.prototype.stop = function () {\n        if (this.isEnabled) {\n            this.isAnimating = false; // will stop animation\n            for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n                var scrollCache = _a[_i];\n                scrollCache.destroy();\n            }\n            this.scrollCaches = null;\n        }\n    };\n    AutoScroller.prototype.requestAnimation = function (now) {\n        this.msSinceRequest = now;\n        requestAnimationFrame(this.animate);\n    };\n    AutoScroller.prototype.handleSide = function (edge, seconds) {\n        var scrollCache = edge.scrollCache;\n        var edgeThreshold = this.edgeThreshold;\n        var invDistance = edgeThreshold - edge.distance;\n        var velocity = // the closer to the edge, the faster we scroll\n         (invDistance * invDistance) / (edgeThreshold * edgeThreshold) * // quadratic\n            this.maxVelocity * seconds;\n        var sign = 1;\n        switch (edge.name) {\n            case 'left':\n                sign = -1;\n            // falls through\n            case 'right':\n                scrollCache.setScrollLeft(scrollCache.getScrollLeft() + velocity * sign);\n                break;\n            case 'top':\n                sign = -1;\n            // falls through\n            case 'bottom':\n                scrollCache.setScrollTop(scrollCache.getScrollTop() + velocity * sign);\n                break;\n        }\n    };\n    // left/top are relative to document topleft\n    AutoScroller.prototype.computeBestEdge = function (left, top) {\n        var edgeThreshold = this.edgeThreshold;\n        var bestSide = null;\n        for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n            var scrollCache = _a[_i];\n            var rect = scrollCache.clientRect;\n            var leftDist = left - rect.left;\n            var rightDist = rect.right - left;\n            var topDist = top - rect.top;\n            var bottomDist = rect.bottom - top;\n            // completely within the rect?\n            if (leftDist >= 0 && rightDist >= 0 && topDist >= 0 && bottomDist >= 0) {\n                if (topDist <= edgeThreshold && this.everMovedUp && scrollCache.canScrollUp() &&\n                    (!bestSide || bestSide.distance > topDist)) {\n                    bestSide = { scrollCache: scrollCache, name: 'top', distance: topDist };\n                }\n                if (bottomDist <= edgeThreshold && this.everMovedDown && scrollCache.canScrollDown() &&\n                    (!bestSide || bestSide.distance > bottomDist)) {\n                    bestSide = { scrollCache: scrollCache, name: 'bottom', distance: bottomDist };\n                }\n                if (leftDist <= edgeThreshold && this.everMovedLeft && scrollCache.canScrollLeft() &&\n                    (!bestSide || bestSide.distance > leftDist)) {\n                    bestSide = { scrollCache: scrollCache, name: 'left', distance: leftDist };\n                }\n                if (rightDist <= edgeThreshold && this.everMovedRight && scrollCache.canScrollRight() &&\n                    (!bestSide || bestSide.distance > rightDist)) {\n                    bestSide = { scrollCache: scrollCache, name: 'right', distance: rightDist };\n                }\n            }\n        }\n        return bestSide;\n    };\n    AutoScroller.prototype.buildCaches = function () {\n        return this.queryScrollEls().map(function (el) {\n            if (el === window) {\n                return new WindowScrollGeomCache(false); // false = don't listen to user-generated scrolls\n            }\n            else {\n                return new ElementScrollGeomCache(el, false); // false = don't listen to user-generated scrolls\n            }\n        });\n    };\n    AutoScroller.prototype.queryScrollEls = function () {\n        var els = [];\n        for (var _i = 0, _a = this.scrollQuery; _i < _a.length; _i++) {\n            var query = _a[_i];\n            if (typeof query === 'object') {\n                els.push(query);\n            }\n            else {\n                els.push.apply(els, Array.prototype.slice.call(document.querySelectorAll(query)));\n            }\n        }\n        return els;\n    };\n    return AutoScroller;\n}());\n\n/*\nMonitors dragging on an element. Has a number of high-level features:\n- minimum distance required before dragging\n- minimum wait time (\"delay\") before dragging\n- a mirror element that follows the pointer\n*/\nvar FeaturefulElementDragging = /** @class */ (function (_super) {\n    __extends(FeaturefulElementDragging, _super);\n    function FeaturefulElementDragging(containerEl, selector) {\n        var _this = _super.call(this, containerEl) || this;\n        // options that can be directly set by caller\n        // the caller can also set the PointerDragging's options as well\n        _this.delay = null;\n        _this.minDistance = 0;\n        _this.touchScrollAllowed = true; // prevents drag from starting and blocks scrolling during drag\n        _this.mirrorNeedsRevert = false;\n        _this.isInteracting = false; // is the user validly moving the pointer? lasts until pointerup\n        _this.isDragging = false; // is it INTENTFULLY dragging? lasts until after revert animation\n        _this.isDelayEnded = false;\n        _this.isDistanceSurpassed = false;\n        _this.delayTimeoutId = null;\n        _this.onPointerDown = function (ev) {\n            if (!_this.isDragging) { // so new drag doesn't happen while revert animation is going\n                _this.isInteracting = true;\n                _this.isDelayEnded = false;\n                _this.isDistanceSurpassed = false;\n                preventSelection(document.body);\n                preventContextMenu(document.body);\n                // prevent links from being visited if there's an eventual drag.\n                // also prevents selection in older browsers (maybe?).\n                // not necessary for touch, besides, browser would complain about passiveness.\n                if (!ev.isTouch) {\n                    ev.origEvent.preventDefault();\n                }\n                _this.emitter.trigger('pointerdown', ev);\n                if (_this.isInteracting && // not destroyed via pointerdown handler\n                    !_this.pointer.shouldIgnoreMove) {\n                    // actions related to initiating dragstart+dragmove+dragend...\n                    _this.mirror.setIsVisible(false); // reset. caller must set-visible\n                    _this.mirror.start(ev.subjectEl, ev.pageX, ev.pageY); // must happen on first pointer down\n                    _this.startDelay(ev);\n                    if (!_this.minDistance) {\n                        _this.handleDistanceSurpassed(ev);\n                    }\n                }\n            }\n        };\n        _this.onPointerMove = function (ev) {\n            if (_this.isInteracting) {\n                _this.emitter.trigger('pointermove', ev);\n                if (!_this.isDistanceSurpassed) {\n                    var minDistance = _this.minDistance;\n                    var distanceSq = void 0; // current distance from the origin, squared\n                    var deltaX = ev.deltaX, deltaY = ev.deltaY;\n                    distanceSq = deltaX * deltaX + deltaY * deltaY;\n                    if (distanceSq >= minDistance * minDistance) { // use pythagorean theorem\n                        _this.handleDistanceSurpassed(ev);\n                    }\n                }\n                if (_this.isDragging) {\n                    // a real pointer move? (not one simulated by scrolling)\n                    if (ev.origEvent.type !== 'scroll') {\n                        _this.mirror.handleMove(ev.pageX, ev.pageY);\n                        _this.autoScroller.handleMove(ev.pageX, ev.pageY);\n                    }\n                    _this.emitter.trigger('dragmove', ev);\n                }\n            }\n        };\n        _this.onPointerUp = function (ev) {\n            if (_this.isInteracting) {\n                _this.isInteracting = false;\n                allowSelection(document.body);\n                allowContextMenu(document.body);\n                _this.emitter.trigger('pointerup', ev); // can potentially set mirrorNeedsRevert\n                if (_this.isDragging) {\n                    _this.autoScroller.stop();\n                    _this.tryStopDrag(ev); // which will stop the mirror\n                }\n                if (_this.delayTimeoutId) {\n                    clearTimeout(_this.delayTimeoutId);\n                    _this.delayTimeoutId = null;\n                }\n            }\n        };\n        var pointer = _this.pointer = new PointerDragging(containerEl);\n        pointer.emitter.on('pointerdown', _this.onPointerDown);\n        pointer.emitter.on('pointermove', _this.onPointerMove);\n        pointer.emitter.on('pointerup', _this.onPointerUp);\n        if (selector) {\n            pointer.selector = selector;\n        }\n        _this.mirror = new ElementMirror();\n        _this.autoScroller = new AutoScroller();\n        return _this;\n    }\n    FeaturefulElementDragging.prototype.destroy = function () {\n        this.pointer.destroy();\n        // HACK: simulate a pointer-up to end the current drag\n        // TODO: fire 'dragend' directly and stop interaction. discourage use of pointerup event (b/c might not fire)\n        this.onPointerUp({});\n    };\n    FeaturefulElementDragging.prototype.startDelay = function (ev) {\n        var _this = this;\n        if (typeof this.delay === 'number') {\n            this.delayTimeoutId = setTimeout(function () {\n                _this.delayTimeoutId = null;\n                _this.handleDelayEnd(ev);\n            }, this.delay); // not assignable to number!\n        }\n        else {\n            this.handleDelayEnd(ev);\n        }\n    };\n    FeaturefulElementDragging.prototype.handleDelayEnd = function (ev) {\n        this.isDelayEnded = true;\n        this.tryStartDrag(ev);\n    };\n    FeaturefulElementDragging.prototype.handleDistanceSurpassed = function (ev) {\n        this.isDistanceSurpassed = true;\n        this.tryStartDrag(ev);\n    };\n    FeaturefulElementDragging.prototype.tryStartDrag = function (ev) {\n        if (this.isDelayEnded && this.isDistanceSurpassed) {\n            if (!this.pointer.wasTouchScroll || this.touchScrollAllowed) {\n                this.isDragging = true;\n                this.mirrorNeedsRevert = false;\n                this.autoScroller.start(ev.pageX, ev.pageY);\n                this.emitter.trigger('dragstart', ev);\n                if (this.touchScrollAllowed === false) {\n                    this.pointer.cancelTouchScroll();\n                }\n            }\n        }\n    };\n    FeaturefulElementDragging.prototype.tryStopDrag = function (ev) {\n        // .stop() is ALWAYS asynchronous, which we NEED because we want all pointerup events\n        // that come from the document to fire beforehand. much more convenient this way.\n        this.mirror.stop(this.mirrorNeedsRevert, this.stopDrag.bind(this, ev) // bound with args\n        );\n    };\n    FeaturefulElementDragging.prototype.stopDrag = function (ev) {\n        this.isDragging = false;\n        this.emitter.trigger('dragend', ev);\n    };\n    // fill in the implementations...\n    FeaturefulElementDragging.prototype.setIgnoreMove = function (bool) {\n        this.pointer.shouldIgnoreMove = bool;\n    };\n    FeaturefulElementDragging.prototype.setMirrorIsVisible = function (bool) {\n        this.mirror.setIsVisible(bool);\n    };\n    FeaturefulElementDragging.prototype.setMirrorNeedsRevert = function (bool) {\n        this.mirrorNeedsRevert = bool;\n    };\n    FeaturefulElementDragging.prototype.setAutoScrollEnabled = function (bool) {\n        this.autoScroller.isEnabled = bool;\n    };\n    return FeaturefulElementDragging;\n}(ElementDragging));\n\n/*\nWhen this class is instantiated, it records the offset of an element (relative to the document topleft),\nand continues to monitor scrolling, updating the cached coordinates if it needs to.\nDoes not access the DOM after instantiation, so highly performant.\n\nAlso keeps track of all scrolling/overflow:hidden containers that are parents of the given element\nand an determine if a given point is inside the combined clipping rectangle.\n*/\nvar OffsetTracker = /** @class */ (function () {\n    function OffsetTracker(el) {\n        this.origRect = computeRect(el);\n        // will work fine for divs that have overflow:hidden\n        this.scrollCaches = getClippingParents(el).map(function (el) {\n            return new ElementScrollGeomCache(el, true); // listen=true\n        });\n    }\n    OffsetTracker.prototype.destroy = function () {\n        for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n            var scrollCache = _a[_i];\n            scrollCache.destroy();\n        }\n    };\n    OffsetTracker.prototype.computeLeft = function () {\n        var left = this.origRect.left;\n        for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n            var scrollCache = _a[_i];\n            left += scrollCache.origScrollLeft - scrollCache.getScrollLeft();\n        }\n        return left;\n    };\n    OffsetTracker.prototype.computeTop = function () {\n        var top = this.origRect.top;\n        for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n            var scrollCache = _a[_i];\n            top += scrollCache.origScrollTop - scrollCache.getScrollTop();\n        }\n        return top;\n    };\n    OffsetTracker.prototype.isWithinClipping = function (pageX, pageY) {\n        var point = { left: pageX, top: pageY };\n        for (var _i = 0, _a = this.scrollCaches; _i < _a.length; _i++) {\n            var scrollCache = _a[_i];\n            if (!isIgnoredClipping(scrollCache.getEventTarget()) &&\n                !pointInsideRect(point, scrollCache.clientRect)) {\n                return false;\n            }\n        }\n        return true;\n    };\n    return OffsetTracker;\n}());\n// certain clipping containers should never constrain interactions, like <html> and <body>\n// https://github.com/fullcalendar/fullcalendar/issues/3615\nfunction isIgnoredClipping(node) {\n    var tagName = node.tagName;\n    return tagName === 'HTML' || tagName === 'BODY';\n}\n\n/*\nTracks movement over multiple droppable areas (aka \"hits\")\nthat exist in one or more DateComponents.\nRelies on an existing draggable.\n\nemits:\n- pointerdown\n- dragstart\n- hitchange - fires initially, even if not over a hit\n- pointerup\n- (hitchange - again, to null, if ended over a hit)\n- dragend\n*/\nvar HitDragging = /** @class */ (function () {\n    function HitDragging(dragging, droppableStore) {\n        var _this = this;\n        // options that can be set by caller\n        this.useSubjectCenter = false;\n        this.requireInitial = true; // if doesn't start out on a hit, won't emit any events\n        this.initialHit = null;\n        this.movingHit = null;\n        this.finalHit = null; // won't ever be populated if shouldIgnoreMove\n        this.handlePointerDown = function (ev) {\n            var dragging = _this.dragging;\n            _this.initialHit = null;\n            _this.movingHit = null;\n            _this.finalHit = null;\n            _this.prepareHits();\n            _this.processFirstCoord(ev);\n            if (_this.initialHit || !_this.requireInitial) {\n                dragging.setIgnoreMove(false);\n                _this.emitter.trigger('pointerdown', ev); // TODO: fire this before computing processFirstCoord, so listeners can cancel. this gets fired by almost every handler :(\n            }\n            else {\n                dragging.setIgnoreMove(true);\n            }\n        };\n        this.handleDragStart = function (ev) {\n            _this.emitter.trigger('dragstart', ev);\n            _this.handleMove(ev, true); // force = fire even if initially null\n        };\n        this.handleDragMove = function (ev) {\n            _this.emitter.trigger('dragmove', ev);\n            _this.handleMove(ev);\n        };\n        this.handlePointerUp = function (ev) {\n            _this.releaseHits();\n            _this.emitter.trigger('pointerup', ev);\n        };\n        this.handleDragEnd = function (ev) {\n            if (_this.movingHit) {\n                _this.emitter.trigger('hitupdate', null, true, ev);\n            }\n            _this.finalHit = _this.movingHit;\n            _this.movingHit = null;\n            _this.emitter.trigger('dragend', ev);\n        };\n        this.droppableStore = droppableStore;\n        dragging.emitter.on('pointerdown', this.handlePointerDown);\n        dragging.emitter.on('dragstart', this.handleDragStart);\n        dragging.emitter.on('dragmove', this.handleDragMove);\n        dragging.emitter.on('pointerup', this.handlePointerUp);\n        dragging.emitter.on('dragend', this.handleDragEnd);\n        this.dragging = dragging;\n        this.emitter = new Emitter();\n    }\n    // sets initialHit\n    // sets coordAdjust\n    HitDragging.prototype.processFirstCoord = function (ev) {\n        var origPoint = { left: ev.pageX, top: ev.pageY };\n        var adjustedPoint = origPoint;\n        var subjectEl = ev.subjectEl;\n        var subjectRect;\n        if (subjectEl !== document) {\n            subjectRect = computeRect(subjectEl);\n            adjustedPoint = constrainPoint(adjustedPoint, subjectRect);\n        }\n        var initialHit = this.initialHit = this.queryHitForOffset(adjustedPoint.left, adjustedPoint.top);\n        if (initialHit) {\n            if (this.useSubjectCenter && subjectRect) {\n                var slicedSubjectRect = intersectRects(subjectRect, initialHit.rect);\n                if (slicedSubjectRect) {\n                    adjustedPoint = getRectCenter(slicedSubjectRect);\n                }\n            }\n            this.coordAdjust = diffPoints(adjustedPoint, origPoint);\n        }\n        else {\n            this.coordAdjust = { left: 0, top: 0 };\n        }\n    };\n    HitDragging.prototype.handleMove = function (ev, forceHandle) {\n        var hit = this.queryHitForOffset(ev.pageX + this.coordAdjust.left, ev.pageY + this.coordAdjust.top);\n        if (forceHandle || !isHitsEqual(this.movingHit, hit)) {\n            this.movingHit = hit;\n            this.emitter.trigger('hitupdate', hit, false, ev);\n        }\n    };\n    HitDragging.prototype.prepareHits = function () {\n        this.offsetTrackers = mapHash(this.droppableStore, function (interactionSettings) {\n            interactionSettings.component.prepareHits();\n            return new OffsetTracker(interactionSettings.el);\n        });\n    };\n    HitDragging.prototype.releaseHits = function () {\n        var offsetTrackers = this.offsetTrackers;\n        for (var id in offsetTrackers) {\n            offsetTrackers[id].destroy();\n        }\n        this.offsetTrackers = {};\n    };\n    HitDragging.prototype.queryHitForOffset = function (offsetLeft, offsetTop) {\n        var _a = this, droppableStore = _a.droppableStore, offsetTrackers = _a.offsetTrackers;\n        var bestHit = null;\n        for (var id in droppableStore) {\n            var component = droppableStore[id].component;\n            var offsetTracker = offsetTrackers[id];\n            if (offsetTracker && // wasn't destroyed mid-drag\n                offsetTracker.isWithinClipping(offsetLeft, offsetTop)) {\n                var originLeft = offsetTracker.computeLeft();\n                var originTop = offsetTracker.computeTop();\n                var positionLeft = offsetLeft - originLeft;\n                var positionTop = offsetTop - originTop;\n                var origRect = offsetTracker.origRect;\n                var width = origRect.right - origRect.left;\n                var height = origRect.bottom - origRect.top;\n                if (\n                // must be within the element's bounds\n                positionLeft >= 0 && positionLeft < width &&\n                    positionTop >= 0 && positionTop < height) {\n                    var hit = component.queryHit(positionLeft, positionTop, width, height);\n                    var dateProfile = component.context.getCurrentData().dateProfile;\n                    if (hit &&\n                        (\n                        // make sure the hit is within activeRange, meaning it's not a deal cell\n                        rangeContainsRange(dateProfile.activeRange, hit.dateSpan.range)) &&\n                        (!bestHit || hit.layer > bestHit.layer)) {\n                        // TODO: better way to re-orient rectangle\n                        hit.rect.left += originLeft;\n                        hit.rect.right += originLeft;\n                        hit.rect.top += originTop;\n                        hit.rect.bottom += originTop;\n                        bestHit = hit;\n                    }\n                }\n            }\n        }\n        return bestHit;\n    };\n    return HitDragging;\n}());\nfunction isHitsEqual(hit0, hit1) {\n    if (!hit0 && !hit1) {\n        return true;\n    }\n    if (Boolean(hit0) !== Boolean(hit1)) {\n        return false;\n    }\n    return isDateSpansEqual(hit0.dateSpan, hit1.dateSpan);\n}\n\nfunction buildDatePointApiWithContext(dateSpan, context) {\n    var props = {};\n    for (var _i = 0, _a = context.pluginHooks.datePointTransforms; _i < _a.length; _i++) {\n        var transform = _a[_i];\n        __assign(props, transform(dateSpan, context));\n    }\n    __assign(props, buildDatePointApi(dateSpan, context.dateEnv));\n    return props;\n}\nfunction buildDatePointApi(span, dateEnv) {\n    return {\n        date: dateEnv.toDate(span.range.start),\n        dateStr: dateEnv.formatIso(span.range.start, { omitTime: span.allDay }),\n        allDay: span.allDay\n    };\n}\n\n/*\nMonitors when the user clicks on a specific date/time of a component.\nA pointerdown+pointerup on the same \"hit\" constitutes a click.\n*/\nvar DateClicking = /** @class */ (function (_super) {\n    __extends(DateClicking, _super);\n    function DateClicking(settings) {\n        var _this = _super.call(this, settings) || this;\n        _this.handlePointerDown = function (pev) {\n            var dragging = _this.dragging;\n            var downEl = pev.origEvent.target;\n            // do this in pointerdown (not dragend) because DOM might be mutated by the time dragend is fired\n            dragging.setIgnoreMove(!_this.component.isValidDateDownEl(downEl));\n        };\n        // won't even fire if moving was ignored\n        _this.handleDragEnd = function (ev) {\n            var component = _this.component;\n            var pointer = _this.dragging.pointer;\n            if (!pointer.wasTouchScroll) {\n                var _a = _this.hitDragging, initialHit = _a.initialHit, finalHit = _a.finalHit;\n                if (initialHit && finalHit && isHitsEqual(initialHit, finalHit)) {\n                    var context = component.context;\n                    var arg = __assign(__assign({}, buildDatePointApiWithContext(initialHit.dateSpan, context)), { dayEl: initialHit.dayEl, jsEvent: ev.origEvent, view: context.viewApi || context.calendarApi.view });\n                    context.emitter.trigger('dateClick', arg);\n                }\n            }\n        };\n        // we DO want to watch pointer moves because otherwise finalHit won't get populated\n        _this.dragging = new FeaturefulElementDragging(settings.el);\n        _this.dragging.autoScroller.isEnabled = false;\n        var hitDragging = _this.hitDragging = new HitDragging(_this.dragging, interactionSettingsToStore(settings));\n        hitDragging.emitter.on('pointerdown', _this.handlePointerDown);\n        hitDragging.emitter.on('dragend', _this.handleDragEnd);\n        return _this;\n    }\n    DateClicking.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    return DateClicking;\n}(Interaction));\n\n/*\nTracks when the user selects a portion of time of a component,\nconstituted by a drag over date cells, with a possible delay at the beginning of the drag.\n*/\nvar DateSelecting = /** @class */ (function (_super) {\n    __extends(DateSelecting, _super);\n    function DateSelecting(settings) {\n        var _this = _super.call(this, settings) || this;\n        _this.dragSelection = null;\n        _this.handlePointerDown = function (ev) {\n            var _a = _this, component = _a.component, dragging = _a.dragging;\n            var options = component.context.options;\n            var canSelect = options.selectable &&\n                component.isValidDateDownEl(ev.origEvent.target);\n            // don't bother to watch expensive moves if component won't do selection\n            dragging.setIgnoreMove(!canSelect);\n            // if touch, require user to hold down\n            dragging.delay = ev.isTouch ? getComponentTouchDelay(component) : null;\n        };\n        _this.handleDragStart = function (ev) {\n            _this.component.context.calendarApi.unselect(ev); // unselect previous selections\n        };\n        _this.handleHitUpdate = function (hit, isFinal) {\n            var context = _this.component.context;\n            var dragSelection = null;\n            var isInvalid = false;\n            if (hit) {\n                dragSelection = joinHitsIntoSelection(_this.hitDragging.initialHit, hit, context.pluginHooks.dateSelectionTransformers);\n                if (!dragSelection || !_this.component.isDateSelectionValid(dragSelection)) {\n                    isInvalid = true;\n                    dragSelection = null;\n                }\n            }\n            if (dragSelection) {\n                context.dispatch({ type: 'SELECT_DATES', selection: dragSelection });\n            }\n            else if (!isFinal) { // only unselect if moved away while dragging\n                context.dispatch({ type: 'UNSELECT_DATES' });\n            }\n            if (!isInvalid) {\n                enableCursor();\n            }\n            else {\n                disableCursor();\n            }\n            if (!isFinal) {\n                _this.dragSelection = dragSelection; // only clear if moved away from all hits while dragging\n            }\n        };\n        _this.handlePointerUp = function (pev) {\n            if (_this.dragSelection) {\n                // selection is already rendered, so just need to report selection\n                triggerDateSelect(_this.dragSelection, pev, _this.component.context);\n                _this.dragSelection = null;\n            }\n        };\n        var component = settings.component;\n        var options = component.context.options;\n        var dragging = _this.dragging = new FeaturefulElementDragging(settings.el);\n        dragging.touchScrollAllowed = false;\n        dragging.minDistance = options.selectMinDistance || 0;\n        dragging.autoScroller.isEnabled = options.dragScroll;\n        var hitDragging = _this.hitDragging = new HitDragging(_this.dragging, interactionSettingsToStore(settings));\n        hitDragging.emitter.on('pointerdown', _this.handlePointerDown);\n        hitDragging.emitter.on('dragstart', _this.handleDragStart);\n        hitDragging.emitter.on('hitupdate', _this.handleHitUpdate);\n        hitDragging.emitter.on('pointerup', _this.handlePointerUp);\n        return _this;\n    }\n    DateSelecting.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    return DateSelecting;\n}(Interaction));\nfunction getComponentTouchDelay(component) {\n    var options = component.context.options;\n    var delay = options.selectLongPressDelay;\n    if (delay == null) {\n        delay = options.longPressDelay;\n    }\n    return delay;\n}\nfunction joinHitsIntoSelection(hit0, hit1, dateSelectionTransformers) {\n    var dateSpan0 = hit0.dateSpan;\n    var dateSpan1 = hit1.dateSpan;\n    var ms = [\n        dateSpan0.range.start,\n        dateSpan0.range.end,\n        dateSpan1.range.start,\n        dateSpan1.range.end\n    ];\n    ms.sort(compareNumbers);\n    var props = {};\n    for (var _i = 0, dateSelectionTransformers_1 = dateSelectionTransformers; _i < dateSelectionTransformers_1.length; _i++) {\n        var transformer = dateSelectionTransformers_1[_i];\n        var res = transformer(hit0, hit1);\n        if (res === false) {\n            return null;\n        }\n        else if (res) {\n            __assign(props, res);\n        }\n    }\n    props.range = { start: ms[0], end: ms[3] };\n    props.allDay = dateSpan0.allDay;\n    return props;\n}\n\nvar EventDragging = /** @class */ (function (_super) {\n    __extends(EventDragging, _super);\n    function EventDragging(settings) {\n        var _this = _super.call(this, settings) || this;\n        // internal state\n        _this.subjectEl = null;\n        _this.subjectSeg = null; // the seg being selected/dragged\n        _this.isDragging = false;\n        _this.eventRange = null;\n        _this.relevantEvents = null; // the events being dragged\n        _this.receivingContext = null;\n        _this.validMutation = null;\n        _this.mutatedRelevantEvents = null;\n        _this.handlePointerDown = function (ev) {\n            var origTarget = ev.origEvent.target;\n            var _a = _this, component = _a.component, dragging = _a.dragging;\n            var mirror = dragging.mirror;\n            var options = component.context.options;\n            var initialContext = component.context;\n            _this.subjectEl = ev.subjectEl;\n            var subjectSeg = _this.subjectSeg = getElSeg(ev.subjectEl);\n            var eventRange = _this.eventRange = subjectSeg.eventRange;\n            var eventInstanceId = eventRange.instance.instanceId;\n            _this.relevantEvents = getRelevantEvents(initialContext.getCurrentData().eventStore, eventInstanceId);\n            dragging.minDistance = ev.isTouch ? 0 : options.eventDragMinDistance;\n            dragging.delay =\n                // only do a touch delay if touch and this event hasn't been selected yet\n                (ev.isTouch && eventInstanceId !== component.props.eventSelection) ?\n                    getComponentTouchDelay$1(component) :\n                    null;\n            mirror.parentNode = elementClosest(origTarget, '.fc');\n            mirror.revertDuration = options.dragRevertDuration;\n            var isValid = component.isValidSegDownEl(origTarget) &&\n                !elementClosest(origTarget, '.fc-event-resizer'); // NOT on a resizer\n            dragging.setIgnoreMove(!isValid);\n            // disable dragging for elements that are resizable (ie, selectable)\n            // but are not draggable\n            _this.isDragging = isValid &&\n                ev.subjectEl.classList.contains('fc-event-draggable');\n        };\n        _this.handleDragStart = function (ev) {\n            var initialContext = _this.component.context;\n            var eventRange = _this.eventRange;\n            var eventInstanceId = eventRange.instance.instanceId;\n            if (ev.isTouch) {\n                // need to select a different event?\n                if (eventInstanceId !== _this.component.props.eventSelection) {\n                    initialContext.dispatch({ type: 'SELECT_EVENT', eventInstanceId: eventInstanceId });\n                }\n            }\n            else {\n                // if now using mouse, but was previous touch interaction, clear selected event\n                initialContext.dispatch({ type: 'UNSELECT_EVENT' });\n            }\n            if (_this.isDragging) {\n                initialContext.calendarApi.unselect(ev); // unselect *date* selection\n                initialContext.emitter.trigger('eventDragStart', {\n                    el: _this.subjectEl,\n                    event: new EventApi(initialContext, eventRange.def, eventRange.instance),\n                    jsEvent: ev.origEvent,\n                    view: initialContext.viewApi\n                });\n            }\n        };\n        _this.handleHitUpdate = function (hit, isFinal) {\n            if (!_this.isDragging) {\n                return;\n            }\n            var relevantEvents = _this.relevantEvents;\n            var initialHit = _this.hitDragging.initialHit;\n            var initialContext = _this.component.context;\n            // states based on new hit\n            var receivingContext = null;\n            var mutation = null;\n            var mutatedRelevantEvents = null;\n            var isInvalid = false;\n            var interaction = {\n                affectedEvents: relevantEvents,\n                mutatedEvents: createEmptyEventStore(),\n                isEvent: true\n            };\n            if (hit) {\n                var receivingComponent = hit.component;\n                receivingContext = receivingComponent.context;\n                var receivingOptions = receivingContext.options;\n                if (initialContext === receivingContext ||\n                    receivingOptions.editable && receivingOptions.droppable) {\n                    mutation = computeEventMutation(initialHit, hit, receivingContext.getCurrentData().pluginHooks.eventDragMutationMassagers);\n                    if (mutation) {\n                        mutatedRelevantEvents = applyMutationToEventStore(relevantEvents, receivingContext.getCurrentData().eventUiBases, mutation, receivingContext);\n                        interaction.mutatedEvents = mutatedRelevantEvents;\n                        if (!receivingComponent.isInteractionValid(interaction)) {\n                            isInvalid = true;\n                            mutation = null;\n                            mutatedRelevantEvents = null;\n                            interaction.mutatedEvents = createEmptyEventStore();\n                        }\n                    }\n                }\n                else {\n                    receivingContext = null;\n                }\n            }\n            _this.displayDrag(receivingContext, interaction);\n            if (!isInvalid) {\n                enableCursor();\n            }\n            else {\n                disableCursor();\n            }\n            if (!isFinal) {\n                if (initialContext === receivingContext && // TODO: write test for this\n                    isHitsEqual(initialHit, hit)) {\n                    mutation = null;\n                }\n                _this.dragging.setMirrorNeedsRevert(!mutation);\n                // render the mirror if no already-rendered mirror\n                // TODO: wish we could somehow wait for dispatch to guarantee render\n                _this.dragging.setMirrorIsVisible(!hit || !document.querySelector('.fc-event-mirror'));\n                // assign states based on new hit\n                _this.receivingContext = receivingContext;\n                _this.validMutation = mutation;\n                _this.mutatedRelevantEvents = mutatedRelevantEvents;\n            }\n        };\n        _this.handlePointerUp = function () {\n            if (!_this.isDragging) {\n                _this.cleanup(); // because handleDragEnd won't fire\n            }\n        };\n        _this.handleDragEnd = function (ev) {\n            if (_this.isDragging) {\n                var initialContext_1 = _this.component.context;\n                var initialView = initialContext_1.viewApi;\n                var _a = _this, receivingContext_1 = _a.receivingContext, validMutation = _a.validMutation;\n                var eventDef = _this.eventRange.def;\n                var eventInstance = _this.eventRange.instance;\n                var eventApi = new EventApi(initialContext_1, eventDef, eventInstance);\n                var relevantEvents_1 = _this.relevantEvents;\n                var mutatedRelevantEvents_1 = _this.mutatedRelevantEvents;\n                var finalHit = _this.hitDragging.finalHit;\n                _this.clearDrag(); // must happen after revert animation\n                initialContext_1.emitter.trigger('eventDragStop', {\n                    el: _this.subjectEl,\n                    event: eventApi,\n                    jsEvent: ev.origEvent,\n                    view: initialView\n                });\n                if (validMutation) {\n                    // dropped within same calendar\n                    if (receivingContext_1 === initialContext_1) {\n                        var updatedEventApi = new EventApi(initialContext_1, mutatedRelevantEvents_1.defs[eventDef.defId], eventInstance ? mutatedRelevantEvents_1.instances[eventInstance.instanceId] : null);\n                        initialContext_1.dispatch({\n                            type: 'MERGE_EVENTS',\n                            eventStore: mutatedRelevantEvents_1\n                        });\n                        var eventChangeArg = {\n                            oldEvent: eventApi,\n                            event: updatedEventApi,\n                            relatedEvents: buildEventApis(mutatedRelevantEvents_1, initialContext_1, eventInstance),\n                            revert: function () {\n                                initialContext_1.dispatch({\n                                    type: 'MERGE_EVENTS',\n                                    eventStore: relevantEvents_1 // the pre-change data\n                                });\n                            }\n                        };\n                        var transformed = {};\n                        for (var _i = 0, _b = initialContext_1.getCurrentData().pluginHooks.eventDropTransformers; _i < _b.length; _i++) {\n                            var transformer = _b[_i];\n                            __assign(transformed, transformer(validMutation, initialContext_1));\n                        }\n                        initialContext_1.emitter.trigger('eventDrop', __assign(__assign(__assign({}, eventChangeArg), transformed), { el: ev.subjectEl, delta: validMutation.datesDelta, jsEvent: ev.origEvent, view: initialView }));\n                        initialContext_1.emitter.trigger('eventChange', eventChangeArg);\n                        // dropped in different calendar\n                    }\n                    else if (receivingContext_1) {\n                        var eventRemoveArg = {\n                            event: eventApi,\n                            relatedEvents: buildEventApis(relevantEvents_1, initialContext_1, eventInstance),\n                            revert: function () {\n                                initialContext_1.dispatch({\n                                    type: 'MERGE_EVENTS',\n                                    eventStore: relevantEvents_1\n                                });\n                            }\n                        };\n                        initialContext_1.emitter.trigger('eventLeave', __assign(__assign({}, eventRemoveArg), { draggedEl: ev.subjectEl, view: initialView }));\n                        initialContext_1.dispatch({\n                            type: 'REMOVE_EVENTS',\n                            eventStore: relevantEvents_1\n                        });\n                        initialContext_1.emitter.trigger('eventRemove', eventRemoveArg);\n                        var addedEventDef = mutatedRelevantEvents_1.defs[eventDef.defId];\n                        var addedEventInstance = mutatedRelevantEvents_1.instances[eventInstance.instanceId];\n                        var addedEventApi = new EventApi(receivingContext_1, addedEventDef, addedEventInstance);\n                        receivingContext_1.dispatch({\n                            type: 'MERGE_EVENTS',\n                            eventStore: mutatedRelevantEvents_1\n                        });\n                        var eventAddArg = {\n                            event: addedEventApi,\n                            relatedEvents: buildEventApis(mutatedRelevantEvents_1, receivingContext_1, addedEventInstance),\n                            revert: function () {\n                                receivingContext_1.dispatch({\n                                    type: 'REMOVE_EVENTS',\n                                    eventStore: mutatedRelevantEvents_1\n                                });\n                            }\n                        };\n                        receivingContext_1.emitter.trigger('eventAdd', eventAddArg);\n                        if (ev.isTouch) {\n                            receivingContext_1.dispatch({\n                                type: 'SELECT_EVENT',\n                                eventInstanceId: eventInstance.instanceId\n                            });\n                        }\n                        receivingContext_1.emitter.trigger('drop', __assign(__assign({}, buildDatePointApiWithContext(finalHit.dateSpan, receivingContext_1)), { draggedEl: ev.subjectEl, jsEvent: ev.origEvent, view: finalHit.component.context.viewApi }));\n                        receivingContext_1.emitter.trigger('eventReceive', __assign(__assign({}, eventAddArg), { draggedEl: ev.subjectEl, view: finalHit.component.context.viewApi }));\n                    }\n                }\n                else {\n                    initialContext_1.emitter.trigger('_noEventDrop');\n                }\n            }\n            _this.cleanup();\n        };\n        var component = _this.component;\n        var options = component.context.options;\n        var dragging = _this.dragging = new FeaturefulElementDragging(settings.el);\n        dragging.pointer.selector = EventDragging.SELECTOR;\n        dragging.touchScrollAllowed = false;\n        dragging.autoScroller.isEnabled = options.dragScroll;\n        var hitDragging = _this.hitDragging = new HitDragging(_this.dragging, interactionSettingsStore);\n        hitDragging.useSubjectCenter = settings.useEventCenter;\n        hitDragging.emitter.on('pointerdown', _this.handlePointerDown);\n        hitDragging.emitter.on('dragstart', _this.handleDragStart);\n        hitDragging.emitter.on('hitupdate', _this.handleHitUpdate);\n        hitDragging.emitter.on('pointerup', _this.handlePointerUp);\n        hitDragging.emitter.on('dragend', _this.handleDragEnd);\n        return _this;\n    }\n    EventDragging.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    // render a drag state on the next receivingCalendar\n    EventDragging.prototype.displayDrag = function (nextContext, state) {\n        var initialContext = this.component.context;\n        var prevContext = this.receivingContext;\n        // does the previous calendar need to be cleared?\n        if (prevContext && prevContext !== nextContext) {\n            // does the initial calendar need to be cleared?\n            // if so, don't clear all the way. we still need to to hide the affectedEvents\n            if (prevContext === initialContext) {\n                prevContext.dispatch({\n                    type: 'SET_EVENT_DRAG',\n                    state: {\n                        affectedEvents: state.affectedEvents,\n                        mutatedEvents: createEmptyEventStore(),\n                        isEvent: true\n                    }\n                });\n                // completely clear the old calendar if it wasn't the initial\n            }\n            else {\n                prevContext.dispatch({ type: 'UNSET_EVENT_DRAG' });\n            }\n        }\n        if (nextContext) {\n            nextContext.dispatch({ type: 'SET_EVENT_DRAG', state: state });\n        }\n    };\n    EventDragging.prototype.clearDrag = function () {\n        var initialCalendar = this.component.context;\n        var receivingContext = this.receivingContext;\n        if (receivingContext) {\n            receivingContext.dispatch({ type: 'UNSET_EVENT_DRAG' });\n        }\n        // the initial calendar might have an dummy drag state from displayDrag\n        if (initialCalendar !== receivingContext) {\n            initialCalendar.dispatch({ type: 'UNSET_EVENT_DRAG' });\n        }\n    };\n    EventDragging.prototype.cleanup = function () {\n        this.subjectSeg = null;\n        this.isDragging = false;\n        this.eventRange = null;\n        this.relevantEvents = null;\n        this.receivingContext = null;\n        this.validMutation = null;\n        this.mutatedRelevantEvents = null;\n    };\n    // TODO: test this in IE11\n    // QUESTION: why do we need it on the resizable???\n    EventDragging.SELECTOR = '.fc-event-draggable, .fc-event-resizable';\n    return EventDragging;\n}(Interaction));\nfunction computeEventMutation(hit0, hit1, massagers) {\n    var dateSpan0 = hit0.dateSpan;\n    var dateSpan1 = hit1.dateSpan;\n    var date0 = dateSpan0.range.start;\n    var date1 = dateSpan1.range.start;\n    var standardProps = {};\n    if (dateSpan0.allDay !== dateSpan1.allDay) {\n        standardProps.allDay = dateSpan1.allDay;\n        standardProps.hasEnd = hit1.component.context.options.allDayMaintainDuration;\n        if (dateSpan1.allDay) {\n            // means date1 is already start-of-day,\n            // but date0 needs to be converted\n            date0 = startOfDay(date0);\n        }\n    }\n    var delta = diffDates(date0, date1, hit0.component.context.dateEnv, hit0.component === hit1.component ?\n        hit0.component.largeUnit :\n        null);\n    if (delta.milliseconds) { // has hours/minutes/seconds\n        standardProps.allDay = false;\n    }\n    var mutation = {\n        datesDelta: delta,\n        standardProps: standardProps\n    };\n    for (var _i = 0, massagers_1 = massagers; _i < massagers_1.length; _i++) {\n        var massager = massagers_1[_i];\n        massager(mutation, hit0, hit1);\n    }\n    return mutation;\n}\nfunction getComponentTouchDelay$1(component) {\n    var options = component.context.options;\n    var delay = options.eventLongPressDelay;\n    if (delay == null) {\n        delay = options.longPressDelay;\n    }\n    return delay;\n}\n\nvar EventResizing = /** @class */ (function (_super) {\n    __extends(EventResizing, _super);\n    function EventResizing(settings) {\n        var _this = _super.call(this, settings) || this;\n        // internal state\n        _this.draggingSegEl = null;\n        _this.draggingSeg = null; // TODO: rename to resizingSeg? subjectSeg?\n        _this.eventRange = null;\n        _this.relevantEvents = null;\n        _this.validMutation = null;\n        _this.mutatedRelevantEvents = null;\n        _this.handlePointerDown = function (ev) {\n            var component = _this.component;\n            var segEl = _this.querySegEl(ev);\n            var seg = getElSeg(segEl);\n            var eventRange = _this.eventRange = seg.eventRange;\n            _this.dragging.minDistance = component.context.options.eventDragMinDistance;\n            // if touch, need to be working with a selected event\n            _this.dragging.setIgnoreMove(!_this.component.isValidSegDownEl(ev.origEvent.target) ||\n                (ev.isTouch && _this.component.props.eventSelection !== eventRange.instance.instanceId));\n        };\n        _this.handleDragStart = function (ev) {\n            var context = _this.component.context;\n            var eventRange = _this.eventRange;\n            _this.relevantEvents = getRelevantEvents(context.getCurrentData().eventStore, _this.eventRange.instance.instanceId);\n            var segEl = _this.querySegEl(ev);\n            _this.draggingSegEl = segEl;\n            _this.draggingSeg = getElSeg(segEl);\n            context.calendarApi.unselect();\n            context.emitter.trigger('eventResizeStart', {\n                el: segEl,\n                event: new EventApi(context, eventRange.def, eventRange.instance),\n                jsEvent: ev.origEvent,\n                view: context.viewApi\n            });\n        };\n        _this.handleHitUpdate = function (hit, isFinal, ev) {\n            var context = _this.component.context;\n            var relevantEvents = _this.relevantEvents;\n            var initialHit = _this.hitDragging.initialHit;\n            var eventInstance = _this.eventRange.instance;\n            var mutation = null;\n            var mutatedRelevantEvents = null;\n            var isInvalid = false;\n            var interaction = {\n                affectedEvents: relevantEvents,\n                mutatedEvents: createEmptyEventStore(),\n                isEvent: true\n            };\n            if (hit) {\n                mutation = computeMutation(initialHit, hit, ev.subjectEl.classList.contains('fc-event-resizer-start'), eventInstance.range, context.pluginHooks.eventResizeJoinTransforms);\n            }\n            if (mutation) {\n                mutatedRelevantEvents = applyMutationToEventStore(relevantEvents, context.getCurrentData().eventUiBases, mutation, context);\n                interaction.mutatedEvents = mutatedRelevantEvents;\n                if (!_this.component.isInteractionValid(interaction)) {\n                    isInvalid = true;\n                    mutation = null;\n                    mutatedRelevantEvents = null;\n                    interaction.mutatedEvents = null;\n                }\n            }\n            if (mutatedRelevantEvents) {\n                context.dispatch({\n                    type: 'SET_EVENT_RESIZE',\n                    state: interaction\n                });\n            }\n            else {\n                context.dispatch({ type: 'UNSET_EVENT_RESIZE' });\n            }\n            if (!isInvalid) {\n                enableCursor();\n            }\n            else {\n                disableCursor();\n            }\n            if (!isFinal) {\n                if (mutation && isHitsEqual(initialHit, hit)) {\n                    mutation = null;\n                }\n                _this.validMutation = mutation;\n                _this.mutatedRelevantEvents = mutatedRelevantEvents;\n            }\n        };\n        _this.handleDragEnd = function (ev) {\n            var context = _this.component.context;\n            var eventDef = _this.eventRange.def;\n            var eventInstance = _this.eventRange.instance;\n            var eventApi = new EventApi(context, eventDef, eventInstance);\n            var relevantEvents = _this.relevantEvents;\n            var mutatedRelevantEvents = _this.mutatedRelevantEvents;\n            context.emitter.trigger('eventResizeStop', {\n                el: _this.draggingSegEl,\n                event: eventApi,\n                jsEvent: ev.origEvent,\n                view: context.viewApi\n            });\n            if (_this.validMutation) {\n                var updatedEventApi = new EventApi(context, mutatedRelevantEvents.defs[eventDef.defId], eventInstance ? mutatedRelevantEvents.instances[eventInstance.instanceId] : null);\n                context.dispatch({\n                    type: 'MERGE_EVENTS',\n                    eventStore: mutatedRelevantEvents\n                });\n                var eventChangeArg = {\n                    oldEvent: eventApi,\n                    event: updatedEventApi,\n                    relatedEvents: buildEventApis(mutatedRelevantEvents, context, eventInstance),\n                    revert: function () {\n                        context.dispatch({\n                            type: 'MERGE_EVENTS',\n                            eventStore: relevantEvents // the pre-change events\n                        });\n                    }\n                };\n                context.emitter.trigger('eventResize', __assign(__assign({}, eventChangeArg), { el: _this.draggingSegEl, startDelta: _this.validMutation.startDelta || createDuration(0), endDelta: _this.validMutation.endDelta || createDuration(0), jsEvent: ev.origEvent, view: context.viewApi }));\n                context.emitter.trigger('eventChange', eventChangeArg);\n            }\n            else {\n                context.emitter.trigger('_noEventResize');\n            }\n            // reset all internal state\n            _this.draggingSeg = null;\n            _this.relevantEvents = null;\n            _this.validMutation = null;\n            // okay to keep eventInstance around. useful to set it in handlePointerDown\n        };\n        var component = settings.component;\n        var dragging = _this.dragging = new FeaturefulElementDragging(settings.el);\n        dragging.pointer.selector = '.fc-event-resizer';\n        dragging.touchScrollAllowed = false;\n        dragging.autoScroller.isEnabled = component.context.options.dragScroll;\n        var hitDragging = _this.hitDragging = new HitDragging(_this.dragging, interactionSettingsToStore(settings));\n        hitDragging.emitter.on('pointerdown', _this.handlePointerDown);\n        hitDragging.emitter.on('dragstart', _this.handleDragStart);\n        hitDragging.emitter.on('hitupdate', _this.handleHitUpdate);\n        hitDragging.emitter.on('dragend', _this.handleDragEnd);\n        return _this;\n    }\n    EventResizing.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    EventResizing.prototype.querySegEl = function (ev) {\n        return elementClosest(ev.subjectEl, '.fc-event');\n    };\n    return EventResizing;\n}(Interaction));\nfunction computeMutation(hit0, hit1, isFromStart, instanceRange, transforms) {\n    var dateEnv = hit0.component.context.dateEnv;\n    var date0 = hit0.dateSpan.range.start;\n    var date1 = hit1.dateSpan.range.start;\n    var delta = diffDates(date0, date1, dateEnv, hit0.component.largeUnit);\n    var props = {};\n    for (var _i = 0, transforms_1 = transforms; _i < transforms_1.length; _i++) {\n        var transform = transforms_1[_i];\n        var res = transform(hit0, hit1);\n        if (res === false) {\n            return null;\n        }\n        else if (res) {\n            __assign(props, res);\n        }\n    }\n    if (isFromStart) {\n        if (dateEnv.add(instanceRange.start, delta) < instanceRange.end) {\n            props.startDelta = delta;\n            return props;\n        }\n    }\n    else {\n        if (dateEnv.add(instanceRange.end, delta) > instanceRange.start) {\n            props.endDelta = delta;\n            return props;\n        }\n    }\n    return null;\n}\n\nvar UnselectAuto = /** @class */ (function () {\n    function UnselectAuto(context) {\n        var _this = this;\n        this.context = context;\n        this.isRecentPointerDateSelect = false; // wish we could use a selector to detect date selection, but uses hit system\n        this.matchesCancel = false;\n        this.matchesEvent = false;\n        this.onSelect = function (selectInfo) {\n            if (selectInfo.jsEvent) {\n                _this.isRecentPointerDateSelect = true;\n            }\n        };\n        this.onDocumentPointerDown = function (pev) {\n            var unselectCancel = _this.context.options.unselectCancel;\n            var downEl = pev.origEvent.target;\n            _this.matchesCancel = !!elementClosest(downEl, unselectCancel);\n            _this.matchesEvent = !!elementClosest(downEl, EventDragging.SELECTOR); // interaction started on an event?\n        };\n        this.onDocumentPointerUp = function (pev) {\n            var context = _this.context;\n            var documentPointer = _this.documentPointer;\n            var calendarState = context.getCurrentData();\n            // touch-scrolling should never unfocus any type of selection\n            if (!documentPointer.wasTouchScroll) {\n                if (calendarState.dateSelection && // an existing date selection?\n                    !_this.isRecentPointerDateSelect // a new pointer-initiated date selection since last onDocumentPointerUp?\n                ) {\n                    var unselectAuto = context.options.unselectAuto;\n                    if (unselectAuto && (!unselectAuto || !_this.matchesCancel)) {\n                        context.calendarApi.unselect(pev);\n                    }\n                }\n                if (calendarState.eventSelection && // an existing event selected?\n                    !_this.matchesEvent // interaction DIDN'T start on an event\n                ) {\n                    context.dispatch({ type: 'UNSELECT_EVENT' });\n                }\n            }\n            _this.isRecentPointerDateSelect = false;\n        };\n        var documentPointer = this.documentPointer = new PointerDragging(document);\n        documentPointer.shouldIgnoreMove = true;\n        documentPointer.shouldWatchScroll = false;\n        documentPointer.emitter.on('pointerdown', this.onDocumentPointerDown);\n        documentPointer.emitter.on('pointerup', this.onDocumentPointerUp);\n        /*\n        TODO: better way to know about whether there was a selection with the pointer\n        */\n        context.emitter.on('select', this.onSelect);\n    }\n    UnselectAuto.prototype.destroy = function () {\n        this.context.emitter.off('select', this.onSelect);\n        this.documentPointer.destroy();\n    };\n    return UnselectAuto;\n}());\n\nvar LISTENER_REFINERS = {\n    dateClick: identity,\n    eventDragStart: identity,\n    eventDragStop: identity,\n    eventDrop: identity,\n    eventResizeStart: identity,\n    eventResizeStop: identity,\n    eventResize: identity,\n    drop: identity,\n    eventReceive: identity,\n    eventLeave: identity\n};\n\n/*\nGiven an already instantiated draggable object for one-or-more elements,\nInterprets any dragging as an attempt to drag an events that lives outside\nof a calendar onto a calendar.\n*/\nvar ExternalElementDragging = /** @class */ (function () {\n    function ExternalElementDragging(dragging, suppliedDragMeta) {\n        var _this = this;\n        this.receivingContext = null;\n        this.droppableEvent = null; // will exist for all drags, even if create:false\n        this.suppliedDragMeta = null;\n        this.dragMeta = null;\n        this.handleDragStart = function (ev) {\n            _this.dragMeta = _this.buildDragMeta(ev.subjectEl);\n        };\n        this.handleHitUpdate = function (hit, isFinal, ev) {\n            var dragging = _this.hitDragging.dragging;\n            var receivingContext = null;\n            var droppableEvent = null;\n            var isInvalid = false;\n            var interaction = {\n                affectedEvents: createEmptyEventStore(),\n                mutatedEvents: createEmptyEventStore(),\n                isEvent: _this.dragMeta.create\n            };\n            if (hit) {\n                receivingContext = hit.component.context;\n                if (_this.canDropElOnCalendar(ev.subjectEl, receivingContext)) {\n                    droppableEvent = computeEventForDateSpan(hit.dateSpan, _this.dragMeta, receivingContext);\n                    interaction.mutatedEvents = eventTupleToStore(droppableEvent);\n                    isInvalid = !isInteractionValid(interaction, receivingContext);\n                    if (isInvalid) {\n                        interaction.mutatedEvents = createEmptyEventStore();\n                        droppableEvent = null;\n                    }\n                }\n            }\n            _this.displayDrag(receivingContext, interaction);\n            // show mirror if no already-rendered mirror element OR if we are shutting down the mirror (?)\n            // TODO: wish we could somehow wait for dispatch to guarantee render\n            dragging.setMirrorIsVisible(isFinal || !droppableEvent || !document.querySelector('.fc-event-mirror'));\n            if (!isInvalid) {\n                enableCursor();\n            }\n            else {\n                disableCursor();\n            }\n            if (!isFinal) {\n                dragging.setMirrorNeedsRevert(!droppableEvent);\n                _this.receivingContext = receivingContext;\n                _this.droppableEvent = droppableEvent;\n            }\n        };\n        this.handleDragEnd = function (pev) {\n            var _a = _this, receivingContext = _a.receivingContext, droppableEvent = _a.droppableEvent;\n            _this.clearDrag();\n            if (receivingContext && droppableEvent) {\n                var finalHit = _this.hitDragging.finalHit;\n                var finalView = finalHit.component.context.viewApi;\n                var dragMeta = _this.dragMeta;\n                receivingContext.emitter.trigger('drop', __assign(__assign({}, buildDatePointApiWithContext(finalHit.dateSpan, receivingContext)), { draggedEl: pev.subjectEl, jsEvent: pev.origEvent, view: finalView }));\n                if (dragMeta.create) {\n                    var addingEvents_1 = eventTupleToStore(droppableEvent);\n                    receivingContext.dispatch({\n                        type: 'MERGE_EVENTS',\n                        eventStore: addingEvents_1\n                    });\n                    if (pev.isTouch) {\n                        receivingContext.dispatch({\n                            type: 'SELECT_EVENT',\n                            eventInstanceId: droppableEvent.instance.instanceId\n                        });\n                    }\n                    // signal that an external event landed\n                    receivingContext.emitter.trigger('eventReceive', {\n                        event: new EventApi(receivingContext, droppableEvent.def, droppableEvent.instance),\n                        relatedEvents: [],\n                        revert: function () {\n                            receivingContext.dispatch({\n                                type: 'REMOVE_EVENTS',\n                                eventStore: addingEvents_1\n                            });\n                        },\n                        draggedEl: pev.subjectEl,\n                        view: finalView\n                    });\n                }\n            }\n            _this.receivingContext = null;\n            _this.droppableEvent = null;\n        };\n        var hitDragging = this.hitDragging = new HitDragging(dragging, interactionSettingsStore);\n        hitDragging.requireInitial = false; // will start outside of a component\n        hitDragging.emitter.on('dragstart', this.handleDragStart);\n        hitDragging.emitter.on('hitupdate', this.handleHitUpdate);\n        hitDragging.emitter.on('dragend', this.handleDragEnd);\n        this.suppliedDragMeta = suppliedDragMeta;\n    }\n    ExternalElementDragging.prototype.buildDragMeta = function (subjectEl) {\n        if (typeof this.suppliedDragMeta === 'object') {\n            return parseDragMeta(this.suppliedDragMeta);\n        }\n        else if (typeof this.suppliedDragMeta === 'function') {\n            return parseDragMeta(this.suppliedDragMeta(subjectEl));\n        }\n        else {\n            return getDragMetaFromEl(subjectEl);\n        }\n    };\n    ExternalElementDragging.prototype.displayDrag = function (nextContext, state) {\n        var prevContext = this.receivingContext;\n        if (prevContext && prevContext !== nextContext) {\n            prevContext.dispatch({ type: 'UNSET_EVENT_DRAG' });\n        }\n        if (nextContext) {\n            nextContext.dispatch({ type: 'SET_EVENT_DRAG', state: state });\n        }\n    };\n    ExternalElementDragging.prototype.clearDrag = function () {\n        if (this.receivingContext) {\n            this.receivingContext.dispatch({ type: 'UNSET_EVENT_DRAG' });\n        }\n    };\n    ExternalElementDragging.prototype.canDropElOnCalendar = function (el, receivingContext) {\n        var dropAccept = receivingContext.options.dropAccept;\n        if (typeof dropAccept === 'function') {\n            return dropAccept.call(receivingContext.calendarApi, el);\n        }\n        else if (typeof dropAccept === 'string' && dropAccept) {\n            return Boolean(elementMatches(el, dropAccept));\n        }\n        return true;\n    };\n    return ExternalElementDragging;\n}());\n// Utils for computing event store from the DragMeta\n// ----------------------------------------------------------------------------------------------------\nfunction computeEventForDateSpan(dateSpan, dragMeta, context) {\n    var defProps = __assign({}, dragMeta.leftoverProps);\n    for (var _i = 0, _a = context.pluginHooks.externalDefTransforms; _i < _a.length; _i++) {\n        var transform = _a[_i];\n        __assign(defProps, transform(dateSpan, dragMeta));\n    }\n    var _b = refineEventDef(defProps, context), refined = _b.refined, extra = _b.extra;\n    var def = parseEventDef(refined, extra, dragMeta.sourceId, dateSpan.allDay, context.options.forceEventDuration || Boolean(dragMeta.duration), // hasEnd\n    context);\n    var start = dateSpan.range.start;\n    // only rely on time info if drop zone is all-day,\n    // otherwise, we already know the time\n    if (dateSpan.allDay && dragMeta.startTime) {\n        start = context.dateEnv.add(start, dragMeta.startTime);\n    }\n    var end = dragMeta.duration ?\n        context.dateEnv.add(start, dragMeta.duration) :\n        getDefaultEventEnd(dateSpan.allDay, start, context);\n    var instance = createEventInstance(def.defId, { start: start, end: end });\n    return { def: def, instance: instance };\n}\n// Utils for extracting data from element\n// ----------------------------------------------------------------------------------------------------\nfunction getDragMetaFromEl(el) {\n    var str = getEmbeddedElData(el, 'event');\n    var obj = str ?\n        JSON.parse(str) :\n        { create: false }; // if no embedded data, assume no event creation\n    return parseDragMeta(obj);\n}\nconfig.dataAttrPrefix = '';\nfunction getEmbeddedElData(el, name) {\n    var prefix = config.dataAttrPrefix;\n    var prefixedName = (prefix ? prefix + '-' : '') + name;\n    return el.getAttribute('data-' + prefixedName) || '';\n}\n\n/*\nMakes an element (that is *external* to any calendar) draggable.\nCan pass in data that determines how an event will be created when dropped onto a calendar.\nLeverages FullCalendar's internal drag-n-drop functionality WITHOUT a third-party drag system.\n*/\nvar ExternalDraggable = /** @class */ (function () {\n    function ExternalDraggable(el, settings) {\n        var _this = this;\n        if (settings === void 0) { settings = {}; }\n        this.handlePointerDown = function (ev) {\n            var dragging = _this.dragging;\n            var _a = _this.settings, minDistance = _a.minDistance, longPressDelay = _a.longPressDelay;\n            dragging.minDistance =\n                minDistance != null ?\n                    minDistance :\n                    (ev.isTouch ? 0 : BASE_OPTION_DEFAULTS.eventDragMinDistance);\n            dragging.delay =\n                ev.isTouch ? // TODO: eventually read eventLongPressDelay instead vvv\n                    (longPressDelay != null ? longPressDelay : BASE_OPTION_DEFAULTS.longPressDelay) :\n                    0;\n        };\n        this.handleDragStart = function (ev) {\n            if (ev.isTouch &&\n                _this.dragging.delay &&\n                ev.subjectEl.classList.contains('fc-event')) {\n                _this.dragging.mirror.getMirrorEl().classList.add('fc-event-selected');\n            }\n        };\n        this.settings = settings;\n        var dragging = this.dragging = new FeaturefulElementDragging(el);\n        dragging.touchScrollAllowed = false;\n        if (settings.itemSelector != null) {\n            dragging.pointer.selector = settings.itemSelector;\n        }\n        if (settings.appendTo != null) {\n            dragging.mirror.parentNode = settings.appendTo; // TODO: write tests\n        }\n        dragging.emitter.on('pointerdown', this.handlePointerDown);\n        dragging.emitter.on('dragstart', this.handleDragStart);\n        new ExternalElementDragging(dragging, settings.eventData);\n    }\n    ExternalDraggable.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    return ExternalDraggable;\n}());\n\n/*\nDetects when a *THIRD-PARTY* drag-n-drop system interacts with elements.\nThe third-party system is responsible for drawing the visuals effects of the drag.\nThis class simply monitors for pointer movements and fires events.\nIt also has the ability to hide the moving element (the \"mirror\") during the drag.\n*/\nvar InferredElementDragging = /** @class */ (function (_super) {\n    __extends(InferredElementDragging, _super);\n    function InferredElementDragging(containerEl) {\n        var _this = _super.call(this, containerEl) || this;\n        _this.shouldIgnoreMove = false;\n        _this.mirrorSelector = '';\n        _this.currentMirrorEl = null;\n        _this.handlePointerDown = function (ev) {\n            _this.emitter.trigger('pointerdown', ev);\n            if (!_this.shouldIgnoreMove) {\n                // fire dragstart right away. does not support delay or min-distance\n                _this.emitter.trigger('dragstart', ev);\n            }\n        };\n        _this.handlePointerMove = function (ev) {\n            if (!_this.shouldIgnoreMove) {\n                _this.emitter.trigger('dragmove', ev);\n            }\n        };\n        _this.handlePointerUp = function (ev) {\n            _this.emitter.trigger('pointerup', ev);\n            if (!_this.shouldIgnoreMove) {\n                // fire dragend right away. does not support a revert animation\n                _this.emitter.trigger('dragend', ev);\n            }\n        };\n        var pointer = _this.pointer = new PointerDragging(containerEl);\n        pointer.emitter.on('pointerdown', _this.handlePointerDown);\n        pointer.emitter.on('pointermove', _this.handlePointerMove);\n        pointer.emitter.on('pointerup', _this.handlePointerUp);\n        return _this;\n    }\n    InferredElementDragging.prototype.destroy = function () {\n        this.pointer.destroy();\n    };\n    InferredElementDragging.prototype.setIgnoreMove = function (bool) {\n        this.shouldIgnoreMove = bool;\n    };\n    InferredElementDragging.prototype.setMirrorIsVisible = function (bool) {\n        if (bool) {\n            // restore a previously hidden element.\n            // use the reference in case the selector class has already been removed.\n            if (this.currentMirrorEl) {\n                this.currentMirrorEl.style.visibility = '';\n                this.currentMirrorEl = null;\n            }\n        }\n        else {\n            var mirrorEl = this.mirrorSelector ?\n                document.querySelector(this.mirrorSelector) :\n                null;\n            if (mirrorEl) {\n                this.currentMirrorEl = mirrorEl;\n                mirrorEl.style.visibility = 'hidden';\n            }\n        }\n    };\n    return InferredElementDragging;\n}(ElementDragging));\n\n/*\nBridges third-party drag-n-drop systems with FullCalendar.\nMust be instantiated and destroyed by caller.\n*/\nvar ThirdPartyDraggable = /** @class */ (function () {\n    function ThirdPartyDraggable(containerOrSettings, settings) {\n        var containerEl = document;\n        if (\n        // wish we could just test instanceof EventTarget, but doesn't work in IE11\n        containerOrSettings === document ||\n            containerOrSettings instanceof Element) {\n            containerEl = containerOrSettings;\n            settings = settings || {};\n        }\n        else {\n            settings = (containerOrSettings || {});\n        }\n        var dragging = this.dragging = new InferredElementDragging(containerEl);\n        if (typeof settings.itemSelector === 'string') {\n            dragging.pointer.selector = settings.itemSelector;\n        }\n        else if (containerEl === document) {\n            dragging.pointer.selector = '[data-event]';\n        }\n        if (typeof settings.mirrorSelector === 'string') {\n            dragging.mirrorSelector = settings.mirrorSelector;\n        }\n        new ExternalElementDragging(dragging, settings.eventData);\n    }\n    ThirdPartyDraggable.prototype.destroy = function () {\n        this.dragging.destroy();\n    };\n    return ThirdPartyDraggable;\n}());\n\nvar main = createPlugin({\n    componentInteractions: [DateClicking, DateSelecting, EventDragging, EventResizing],\n    calendarInteractions: [UnselectAuto],\n    elementDraggingImpl: FeaturefulElementDragging,\n    listenerRefiners: LISTENER_REFINERS\n});\n\nexport default main;\nexport { ExternalDraggable as Draggable, FeaturefulElementDragging, PointerDragging, ThirdPartyDraggable };\n//# sourceMappingURL=main.js.map\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport { Calendar } from '@fullcalendar/core';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport interactionPlugin from '@fullcalendar/interaction';\n\nfrappe.provide(\"frappe.views.calendar\");\nfrappe.provide(\"frappe.views.calendars\");\n\nconst day_map = {\n\t\"Sunday\": 0,\n\t\"Monday\": 1,\n\t\"Tuesday\": 2,\n\t\"Wednesday\": 3,\n\t\"Thursday\": 4,\n\t\"Friday\": 5,\n\t\"Saturday\": 6\n}\n\nfrappe.views.CalendarView = class CalendarView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Calendar'] || {};\n\t\t\troute.push(user_settings.last_calendar || 'default');\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\ttoggle_result_area() { }\n\n\tget view_name() {\n\t\t// __(\"Calendar\")\n\t\treturn 'Calendar';\n\t}\n\n\tsetup_page() {\n\t\tthis.hide_page_form = false;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = __('{0} Calendar', [this.page_title]);\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\tthis.calendar_name = frappe.utils.to_title_case(frappe.get_route()[3] || '');\n\t}\n\n\tbefore_refresh() {\n\t\tsuper.before_refresh();\n\t\tif (this.calendar_settings.filters && this.calendar_settings.filters.length > 0 && Array.isArray(this.calendar_settings.filters[0])) {\n\t\t\tthis.filter_area.add(this.calendar_settings.filters);\n\t\t}\n\t}\n\n\tsetup_view() {\n\t\tthis.sort_selector.wrapper.hide();\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tthis.save_view_user_settings({\n\t\t\tlast_calendar: this.calendar_name\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.calendar) {\n\t\t\tthis.calendar.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.load_lib\n\t\t\t.then(() => this.get_calendar_preferences())\n\t\t\t.then(options => {\n\t\t\t\tthis.calendar = new frappe.views.Calendar(options);\n\t\t\t});\n\t}\n\n\tget_calendar_preferences() {\n\t\tconst options = {\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.$result,\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t};\n\t\tconst calendar_name = this.calendar_name;\n\n\t\treturn new Promise(resolve => {\n\t\t\tif (calendar_name === 'Default') {\n\t\t\t\tObject.assign(options, frappe.views.calendar[this.doctype]);\n\t\t\t\tresolve(options);\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doc('Calendar View', calendar_name, () => {\n\t\t\t\t\tconst doc = frappe.get_doc('Calendar View', calendar_name);\n\t\t\t\t\tObject.assign(options, {\n\t\t\t\t\t\tfield_map: {\n\t\t\t\t\t\t\tid: \"name\",\n\t\t\t\t\t\t\tstart: doc.start_date_field,\n\t\t\t\t\t\t\tend: doc.end_date_field,\n\t\t\t\t\t\t\ttitle: doc.subject_field,\n\t\t\t\t\t\t\tallDay: doc.all_day_field,\n\t\t\t\t\t\t\tstatus: doc.status_field,\n\t\t\t\t\t\t\tcolor: doc.color_field,\n\t\t\t\t\t\t\trrule: doc.recurrence_rule_field,\n\t\t\t\t\t\t\tsecondary_status: doc.secondary_status_field\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary_status_color: doc.secondary_status.reduce((obj, f) =>\n\t\t\t\t\t\t\tObject.assign(obj, {[f.value]: f.color}), {}\n\t\t\t\t\t\t),\n\t\t\t\t\t\tcalendar_defaults: {\n\t\t\t\t\t\t\tslots_start_time: doc.daily_minimum_time,\n\t\t\t\t\t\t\tslots_end_time: doc.daily_maximum_time,\n\t\t\t\t\t\t\tfirst_day: doc.first_day ? day_map[doc.first_day] : null,\n\t\t\t\t\t\t\tdisplay_event_time: doc.display_event_time == 1 ? true : false,\n\t\t\t\t\t\t\tdisplay_event_end: doc.display_event_end == 1 ? true : false\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget required_libs() {\n\t}\n};\n\nfrappe.views.Calendar = class {\n\tconstructor(options) {\n\t\t$.extend(this, options);\n\t\tthis.fullcalendar = null;\n\t\tthis.calendar_defaults = this.calendar_defaults&&Object.keys(this.calendar_defaults) ? this.calendar_defaults : {\n\t\t\tdisplay_event_time: true,\n\t\t\tdisplay_event_end: true\n\t\t};\n\t\tthis.sidebar_menu = this.list_view.list_sidebar.sidebar.find(\".sidebar-menu\")\n\t\tthis.get_default_options();\n\t}\n\n\tget_default_options() {\n\t\treturn new Promise((resolve) => {\n\t\t\tlet initialView = localStorage.getItem('cal_initialView');\n\t\t\tlet weekends = localStorage.getItem('cal_weekends');\n\t\t\tlet defaults = {\n\t\t\t\t'initialView': initialView && [\"timeGridDay\", \"timeGridWeek\", \"dayGridMonth\"].includes(initialView) ? initialView : \"dayGridMonth\",\n\t\t\t\t'weekends': weekends ? weekends : true\n\t\t\t};\n\t\t\tresolve(defaults);\n\t\t}).then(defaults => {\n\t\t\tObject.assign(this.calendar_defaults, defaults)\n\t\t\tthis.make_page();\n\t\t\tthis.setup_options(this.calendar_defaults);\n\t\t\tthis.make();\n\t\t\tthis.setup_view_mode_button(this.calendar_defaults);\n\t\t\tthis.bind();\n\t\t});\n\t}\n\n\tmake_page() {\n\t\tconst me = this;\n\n\t\t// add links to other calendars\n\t\tme.page.clear_user_actions();\n\t\t$.each(frappe.boot.calendars, function (i, doctype) {\n\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\tme.page.add_menu_item(__(doctype), function () {\n\t\t\t\t\tfrappe.set_route(\"List\", doctype, \"Calendar\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$(this.parent).on(\"show\", function () {\n\t\t\tme.fullcalendar.refetchEvents()\n\t\t});\n\t}\n\n\tmake() {\n\t\tconst me = this;\n\t\tthis.$wrapper = this.parent;\n\t\tthis.$cal = $(\"<div>\").appendTo(this.$wrapper);\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.$wrapper,\n\t\t\t__(\"Select or drag across time slots to create a new event.\"));\n\t\tthis.footnote_area.css({ \"border-top\": \"0px\" });\n\n\t\tthis.fullcalendar = new Calendar(this.$cal[0], this.cal_options);\n\t\tthis.fullcalendar.render();\n\n\t\tthis.$wrapper.find('.fc-today-button').prepend(frappe.utils.icon('today'));\n\n\t\tif (this.secondary_status_color) {\n\t\t\tthis.show_secondary_status_legend()\n\t\t}\n\t}\n\n\tsetup_view_mode_button(defaults) {\n\t\tconst me = this;\n\t\t$(me.footnote_area).find('.btn-weekend').detach();\n\t\tconst btnTitle = (defaults.weekends) ? __('Hide Weekends') : __('Show Weekends');\n\t\tconst btn = `<button class=\"btn btn-default btn-xs btn-weekend\">${btnTitle}</button>`;\n\t\tme.footnote_area.append(btn);\n\t}\n\n\tset_localStorage_option(option, value) {\n\t\tlocalStorage.removeItem(option);\n\t\tlocalStorage.setItem(option, value);\n\t}\n\n\tbind() {\n\t\tconst me = this;\n\t\tconst btn_group = me.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.on(\"click\", \".fc-button\", function () {\n\t\t\tconst value = ($(this).hasClass('fc-timeGridWeek-button')) ? 'timeGridWeek' : (($(this).hasClass('fc-timeGridDay-button')) ? 'timeGridDay' : 'dayGridMonth');\n\t\t\tme.set_localStorage_option(\"cal_initialView\", value);\n\t\t});\n\n\t\tme.$wrapper.on(\"click\", \".btn-weekend\", function () {\n\t\t\tme.cal_options.weekends = !me.cal_options.weekends;\n\t\t\tme.fullcalendar.setOption('weekends', me.cal_options.weekends);\n\t\t\tme.set_localStorage_option(\"cal_weekends\", me.cal_options.weekends);\n\t\t\tme.setup_view_mode_button(me.cal_options);\n\t\t});\n\t}\n\n\tfield_map() {\n\t\treturn {\n\t\t\t\"id\": \"name\",\n\t\t\t\"start\": \"start\",\n\t\t\t\"end\": \"end\",\n\t\t\t\"allDay\": \"all_day\",\n\t\t}\n\t}\n\n\tshow_secondary_status_legend() {\n\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\tconst meta = frappe.get_meta(this.doctype);\n\t\t\tconst status_colors = Object.keys(this.secondary_status_color).map(f => {\n\t\t\t\treturn `\n\t\t\t\t\t<div><span class=\"flex align-items-center status-color ${this.secondary_status_color[f]}\">${__(f)}</span></div>\n\t\t\t\t`\n\t\t\t}).join(\"\")\n\t\t\tthis.sidebar_menu.find(\".calendar-status-section\").remove()\n\t\t\tthis.sidebar_menu.append(`\n\t\t\t\t<div class=\"calendar-status-section\">\n\t\t\t\t\t<li class=\"sidebar-label\">${__(meta.fields.filter(f => f.fieldname == this.field_map.secondary_status)[0].label)}</li>\n\t\t\t\t\t<div>${status_colors}</div>\n\t\t\t\t</div>\n\t\t\t`)\n\t\t});\n\t}\n\n\tget_system_datetime(date) {\n\t\tdate._offset = (moment(date).tz(frappe.sys_defaults.time_zone)._offset);\n\t\treturn frappe.datetime.convert_to_system_tz(date);\n\t}\n\n\tsetup_options(defaults) {\n\t\tconst me = this;\n\t\tthis.cal_options = {\n\t\t\tlocale: frappe.boot.lang || \"en\",\n\t\t\tplugins: [interactionPlugin, timeGridPlugin, dayGridPlugin],\n\t\t\theaderToolbar: {\n\t\t\t\tleft: 'dayGridMonth,timeGridWeek,timeGridDay',\n\t\t\t\tcenter: 'prev,title,next',\n\t\t\t\tright: 'today'\n\t\t\t},\n\t\t\theight: \"auto\",\n\t\t\teditable: true,\n\t\t\tselectable: true,\n\t\t\tselectMirror: true,\n\t\t\tforceEventDuration: true,\n\t\t\tdisplayEventTime: defaults.display_event_time,\n\t\t\tdisplayEventEnd: defaults.display_event_end,\n\t\t\tinitialView: defaults.initialView,\n\t\t\tweekends: defaults.weekends,\n\t\t\tnowIndicator: true,\n\t\t\tevents: function (parameters, callback) {\n\t\t\t\treturn frappe.xcall(me.get_events_method || \"frappe.desk.calendar.get_events\",\n\t\t\t\t\tme.get_args(parameters.start, parameters.end)\n\t\t\t\t).then(r => {\n\t\t\t\t\tlet events = r || [];\n\t\t\t\t\tevents = me.prepare_events(events);\n\t\t\t\t\tcallback(events);\n\t\t\t\t});\n\t\t\t},\n\t\t\teventClick: function (info) {\n\t\t\t\t// edit event description or delete\n\t\t\t\tconst doctype = info.event.doctype || info.event.extendedProps.doctype || me.doctype;\n\t\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\t\tfrappe.set_route(\"Form\", doctype, info.event.id);\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function (info) {\n\t\t\t\tme.update_event(info);\n\t\t\t},\n\t\t\teventResize: function (info) {\n\t\t\t\tme.update_event(info);\n\t\t\t},\n\t\t\tselect: function (selectionInfo) {\n\t\t\t\tif (selectionInfo.view.type === \"dayGridMonth\" && (selectionInfo.end - selectionInfo.start) === 86400000) {\n\t\t\t\t\t// detect single day click in month view\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst event = frappe.model.get_new_doc(me.doctype);\n\n\t\t\t\tevent[me.field_map.start] = me.get_system_datetime(selectionInfo.start);\n\n\t\t\t\tif (me.field_map.end) {\n\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(selectionInfo.end);\n\t\t\t\t}\n\n\t\t\t\tif (me.field_map.allDay) {\n\t\t\t\t\tevent[me.field_map.allDay] = selectionInfo.allDay;\n\n\t\t\t\t\tif (selectionInfo.allDay) {\n\t\t\t\t\t\tevent[me.field_map.end] = moment(selectionInfo.end).subtract(1, \"seconds\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfrappe.set_route(\"Form\", me.doctype, event.name);\n\t\t\t},\n\t\t\tdateClick: function (info) {\n\t\t\t\tif (info.view.type === 'dayGridMonth') {\n\t\t\t\t\tme.fullcalendar.changeView('timeGridDay');\n\t\t\t\t\tme.fullcalendar.gotoDate(info.date);\n\n\t\t\t\t\t// update \"active view\" btn\n\t\t\t\t\tme.$wrapper.find('.fc-dayGridMonth-button').removeClass('active');\n\t\t\t\t\tme.$wrapper.find('.fc-timeGridDay-button').addClass('active');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tbuttonText: {\n\t\t\t\ttoday: __(\"Today\"),\n\t\t\t\tmonth: __(\"Month\"),\n\t\t\t\tweek: __(\"Week\"),\n\t\t\t\tday: __(\"Day\")\n\t\t\t},\n\t\t\tallDayContent: function() {\n\t\t\t\treturn __(\"All Day\");\n\t\t\t},\n\t\t\teventDidMount: function(info) {\n\t\t\t\t$(info.el).tooltip({\n\t\t\t\t\ttitle: frappe.utils.html2text(info.event.title),\n\t\t\t\t\tplacement: 'auto'\n\t\t\t\t})\n\t\t\t},\n\t\t\tslotMinTime: defaults.slots_start_time || \"06:00:00\",\n\t\t\tslotMaxTime: defaults.slots_end_time || \"22:00:00\"\n\t\t};\n\n\t\tif (defaults.first_day) {\n\t\t\tObject.assign(this.cal_options, {\n\t\t\t\tfirstDay: defaults.first_day\n\t\t\t})\n\t\t}\n\n\t\tif (this.options) {\n\t\t\t$.extend(this.cal_options, this.options);\n\t\t}\n\t}\n\n\tget_args(start, end) {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tstart: this.get_system_datetime(start),\n\t\t\tend: this.get_system_datetime(end),\n\t\t\tfilters: this.list_view.filter_area.get(),\n\t\t\tfield_map: this.field_map\n\t\t};\n\t}\n\n\trefresh() {\n\t\tthis.fullcalendar.refetchEvents();\n\t}\n\n\tprepare_events(events) {\n\t\tconst me = this;\n\t\treturn (events || []).map(d => {\n\t\t\td.id = d.name;\n\t\t\td.editable = frappe.model.can_write(d.doctype || me.doctype);\n\t\t\td.classNames = []\n\n\t\t\t// do not allow submitted/cancelled events to be moved / extended\n\t\t\tif (d.docstatus && d.docstatus > 0) {\n\t\t\t\td.editable = false;\n\t\t\t}\n\n\t\t\t$.each(me.field_map, function (target, source) {\n\t\t\t\td[target] = d[source];\n\t\t\t});\n\n\t\t\tif (!me.field_map.allDay && !me.no_all_day) {\n\t\t\t\td.allDay = true;\n\t\t\t}\n\n\t\t\t// convert to user tz\n\t\t\td.start = frappe.datetime.convert_to_user_tz(d.start);\n\t\t\td.end = frappe.datetime.convert_to_user_tz(d.end);\n\n\t\t\t// show event on single day if start or end date is invalid\n\t\t\tif (!frappe.datetime.validate(d.start) && d.end) {\n\t\t\t\td.start = frappe.datetime.add_days(d.end, -1);\n\t\t\t}\n\n\t\t\tif (d.start && !frappe.datetime.validate(d.end)) {\n\t\t\t\td.end = frappe.datetime.add_days(d.start, 1);\n\t\t\t}\n\n\t\t\tif ((d.secondary_status || d.status) && me.secondary_status_color) {\n\t\t\t\td.classNames.push(me.secondary_status_color[d.secondary_status || d.status] || \"\");\n\t\t\t}\n\n\t\t\tme.fix_end_date_for_event_render(d);\n\t\t\tme.prepare_colors(d);\n\n\t\t\td.title = frappe.utils.html2text(d.title);\n\n\t\t\treturn d;\n\t\t});\n\t}\n\n\tprepare_colors(d) {\n\t\tlet color;\n\n\t\tcolor = d.color;\n\t\tif (!frappe.ui.color.validate_hex(color) || !color) {\n\t\t\tcolor = frappe.ui.color.get('blue', 'default');\n\t\t}\n\t\td.backgroundColor = color;\n\t\td.borderColor = color;\n\t\td.textColor = frappe.ui.color.get_contrast_color(color);\n\n\t\treturn d;\n\t}\n\n\tupdate_event(info) {\n\t\tvar me = this;\n\t\tfrappe.model.remove_from_locals(me.doctype, info.event.name);\n\t\treturn frappe.call({\n\t\t\tmethod: me.update_event_method || \"frappe.desk.calendar.update_event\",\n\t\t\targs: me.get_update_args(info.event),\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tfrappe.show_alert(__(\"Unable to update event\"));\n\t\t\t\t\tinfo.revert();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function () {\n\t\t\t\tinfo.revert();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_update_args(event) {\n\t\tconst me = this;\n\t\tlet args = {\n\t\t\tname: event.id\n\t\t};\n\n\t\targs[this.field_map.start] = me.get_system_datetime(event.start);\n\n\t\tif (this.field_map.allDay)\n\t\t\targs[this.field_map.allDay] = event.allDay;\n\n\t\tif (this.field_map.end) {\n\t\t\tif (!event.end) {\n\t\t\t\tevent.end = event.start.add(1, \"hour\");\n\t\t\t}\n\n\t\t\targs[this.field_map.end] = me.get_system_datetime(event.end);\n\n\t\t\tif (args[this.field_map.allDay]) {\n\t\t\t\targs[this.field_map.end] = moment(event.end).subtract(1, \"seconds\");\n\t\t\t}\n\t\t}\n\n\t\targs.doctype = event.doctype || this.doctype;\n\n\t\treturn { args: args, field_map: this.field_map };\n\t}\n\n\tfix_end_date_for_event_render(event) {\n\t\tif (event.allDay) {\n\t\t\t// We use inclusive end dates. This workaround fixes the rendering of events\n\t\t\tevent.end = event.end ? this.get_system_datetime(moment(event.end).add(1, \"day\")) : null;\n\t\t}\n\t}\n};","frappe.provide(\"frappe.views\");\n\nfrappe.views.FileView = class FileView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 2) {\n\t\t\tconst view_user_settings = frappe.get_user_settings(\"File\", \"File\");\n\t\t\tfrappe.set_route(\n\t\t\t\t\"List\",\n\t\t\t\t\"File\",\n\t\t\t\tview_user_settings.last_folder || frappe.boot.home_folder\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\t\treturn redirect_to_home_if_invalid_route();\n\t}\n\n\tget view_name() {\n\t\treturn \"File\";\n\t}\n\n\tshow() {\n\t\tif (!redirect_to_home_if_invalid_route()) {\n\t\t\tsuper.show();\n\t\t}\n\t}\n\n\tsetup_view() {\n\t\tthis.render_header();\n\t\tthis.setup_events();\n\t\tthis.$page.find(\".layout-main-section-wrapper\").addClass(\"file-view\");\n\t\tthis.add_file_action_buttons();\n\t\tthis.page.add_button(__(\"Toggle Grid View\"), () => {\n\t\t\tfrappe.views.FileView.grid_view = !frappe.views.FileView.grid_view;\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`<div class=\"no-result\">\n\t\t\t<div class=\"breadcrumbs\">${this.get_breadcrumbs_html()}</div>\n\t\t\t<div class=\"text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t</div>`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tget_args() {\n\t\tlet args = super.get_args();\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tObject.assign(args, {\n\t\t\t\torder_by: `is_folder desc, ${this.sort_by} ${this.sort_order}`\n\t\t\t});\n\t\t}\n\t\treturn args;\n\t}\n\n\tset_breadcrumbs() {\n\t\tconst route = frappe.get_route();\n\t\troute.splice(-1);\n\t\tconst last_folder = route[route.length - 1];\n\t\tif (last_folder === \"File\") return;\n\n\t\tconst home_index = route.indexOf(\"Home\");\n\t\tconst new_route = home_index ? route.slice(home_index + 1) : [];\n\t\tif (last_folder !== 'File' && new_route.length) {\n\t\t\tfrappe.breadcrumbs.add({\n\t\t\t\ttype: 'Custom',\n\t\t\t\tlabel: __(last_folder),\n\t\t\t\troute: `/app/file/view/Home/${new_route.join(\"/\")}`\n\t\t\t});\n\n\t\t} else {\n\t\t\tfrappe.breadcrumbs.add({\n\t\t\t\ttype: \"Custom\",\n\t\t\t\tlabel: __(\"Home\"),\n\t\t\t\troute: \"/app/file/view/Home\"\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults().then(() => {\n\t\t\tthis.page_title = __(\"File Manager\");\n\n\t\t\tconst route = frappe.get_route();\n\t\t\tthis.current_folder = route.slice(2).join(\"/\");\n\t\t\tthis.filters = [[\"File\", \"folder\", \"=\", this.current_folder, true]];\n\t\t\tthis.order_by = this.view_user_settings.order_by || \"file_name asc\";\n\n\t\t\tthis.menu_items = this.menu_items.concat(this.file_menu_items());\n\t\t});\n\t}\n\n\tfile_menu_items() {\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tlabel: __(\"Home\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.set_route(\"List\", \"File\", \"Home\");\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"New Folder\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.prompt(\n\t\t\t\t\t\t__(\"Name\"),\n\t\t\t\t\t\tvalues => {\n\t\t\t\t\t\t\tif (values.value.indexOf(\"/\") > -1) {\n\t\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\"Folder name should not include '/' (slash)\"\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst data = {\n\t\t\t\t\t\t\t\tfile_name: values.value,\n\t\t\t\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\n\t\t\t\t\t\t\t\t\t\"frappe.core.doctype.file.file.create_new_folder\",\n\t\t\t\t\t\t\t\targs: data\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t__(\"Enter folder name\"),\n\t\t\t\t\t\t__(\"Create\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Import Zip\"),\n\t\t\t\taction: () => {\n\t\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\t\tfolder: this.current_folder,\n\t\t\t\t\t\trestrictions: {\n\t\t\t\t\t\t\tallowed_file_types: [\".zip\"]\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton_success: file => {\n\t\t\t\t\t\t\tfrappe.show_alert(__(\"Unzipping files...\"));\n\t\t\t\t\t\t\tfrappe\n\t\t\t\t\t\t\t\t.call(\n\t\t\t\t\t\t\t\t\t\"frappe.core.doctype.file.file.unzip_file\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: file.name\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.then(r => {\n\t\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t\t\t\t__(\"Unzipped {0} files\", [\n\t\t\t\t\t\t\t\t\t\t\t\tr.message\n\t\t\t\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\treturn items;\n\t}\n\n\tadd_file_action_buttons() {\n\t\tthis.$cut_button = this.page\n\t\t\t.add_button(__(\"Cut\"), () => {\n\t\t\t\tfrappe.file_manager.cut(\n\t\t\t\t\tthis.get_checked_items(),\n\t\t\t\t\tthis.current_folder\n\t\t\t\t);\n\t\t\t\tthis.$checks.parents(\".file-wrapper\").addClass(\"cut\");\n\t\t\t})\n\t\t\t.hide();\n\n\t\tthis.$paste_btn = this.page\n\t\t\t.add_button(__(\"Paste\"), () =>\n\t\t\t\tfrappe.file_manager.paste(this.current_folder)\n\t\t\t)\n\t\t\t.hide();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = this.meta.fields\n\t\t\t.filter(\n\t\t\t\tdf => frappe.model.is_value_type(df.fieldtype) && !df.hidden\n\t\t\t)\n\t\t\t.map(df => df.fieldname)\n\t\t\t.concat([\"name\", \"modified\", \"creation\"]);\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\n\t\tthis.data = this.data.map(d => this.prepare_datum(d));\n\n\t\t// Bring folders to the top\n\t\tconst { sort_by } = this.sort_selector;\n\t\tif (sort_by === \"file_name\") {\n\t\t\tthis.data.sort((a, b) => {\n\t\t\t\tif (a.is_folder && !b.is_folder) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!a.is_folder && b.is_folder) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tprepare_datum(d) {\n\t\tlet icon_class = \"\";\n\t\tlet type = \"\";\n\t\tif (d.is_folder) {\n\t\t\ticon_class = \"folder-normal\";\n\t\t\ttype = \"folder\";\n\t\t} else if (frappe.utils.is_image_file(d.file_name)) {\n\t\t\ticon_class = \"image\";\n\t\t\ttype = \"image\";\n\t\t} else {\n\t\t\ticon_class = \"file\";\n\t\t\ttype = \"file\";\n\t\t}\n\n\t\tlet title = d.file_name || d.file_url;\n\t\ttitle = title.slice(0, 60);\n\t\td._title = title;\n\t\td.icon_class = icon_class;\n\t\td._type = type;\n\n\t\td.subject_html = `\n\t\t\t${frappe.utils.icon(icon_class)}\n\t\t\t<span>${title}</span>\n\t\t\t${d.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : \"\"}\n\t\t`;\n\t\treturn d;\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tfrappe.model.user_settings.save(\n\t\t\t\"File\",\n\t\t\t\"grid_view\",\n\t\t\tfrappe.views.FileView.grid_view\n\t\t);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_folder: this.current_folder\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.empty().removeClass(\"file-grid-view\");\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render();\n\t\t\tthis.render_header();\n\t\t}\n\t}\n\n\tafter_render() {}\n\n\trender_list() {\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render_list();\n\t\t}\n\t}\n\n\trender_grid_view() {\n\t\tlet html = this.data\n\t\t\t.map(d => {\n\t\t\t\tconst icon_class = d.icon_class + \"-large\";\n\t\t\t\tlet file_body_html =\n\t\t\t\t\td._type == \"image\"\n\t\t\t\t\t\t? `<div class=\"file-image\"><img src=\"${\n\t\t\t\t\t\t\td.file_url\n\t\t\t\t\t\t}\" alt=\"${d.file_name}\"></div>`\n\t\t\t\t\t\t: frappe.utils.icon(icon_class, {\n\t\t\t\t\t\t\twidth: \"40px\",\n\t\t\t\t\t\t\theight: \"45px\"\n\t\t\t\t\t\t});\n\t\t\t\tconst name = escape(d.name);\n\t\t\t\tconst draggable = d.type == \"Folder\" ? false : true;\n\t\t\t\treturn `\n\t\t\t\t<a href=\"${this.get_route_url(d)}\"\n\t\t\t\t\tdraggable=\"${draggable}\" class=\"file-wrapper ellipsis\" data-name=\"${name}\">\n\t\t\t\t\t<div class=\"file-header\">\n\t\t\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${name}\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"file-body\">\n\t\t\t\t\t\t${file_body_html}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"file-footer\">\n\t\t\t\t\t\t<div class=\"file-title ellipsis\">${d._title}</div>\n\t\t\t\t\t\t<div class=\"file-creation\">${this.get_creation_date(d)}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tthis.$result.addClass(\"file-grid-view\");\n\t\tthis.$result.empty().html(\n\t\t\t`<div class=\"file-grid\">\n\t\t\t\t${html}\n\t\t\t</div>`\n\t\t);\n\t}\n\n\tget_breadcrumbs_html() {\n\t\tconst route = frappe.router.parse();\n\t\tconst folders = route.slice(2);\n\n\t\treturn folders\n\t\t\t.map((folder, i) => {\n\t\t\t\tif (i === folders.length - 1) {\n\t\t\t\t\treturn `<span>${folder}</span>`;\n\t\t\t\t}\n\t\t\t\tconst route = folders.reduce((acc, curr, j) => {\n\t\t\t\t\tif (j <= i) {\n\t\t\t\t\t\tacc += \"/\" + curr;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, \"/app/file/view\");\n\n\t\t\t\treturn `<a href=\"${route}\">${folder}</a>`;\n\t\t\t})\n\t\t\t.join(\"&nbsp;/&nbsp;\");\n\t}\n\n\tget_header_html() {\n\t\tconst breadcrumbs_html = this.get_breadcrumbs_html();\n\n\t\tlet header_selector_html = !frappe.views.FileView.grid_view\n\t\t\t? `<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\n\t\t\t\t\"Select All\"\n\t\t\t)}\">`\n\t\t\t: \"\";\n\n\t\tlet header_columns_html = !frappe.views.FileView.grid_view\n\t\t\t? `<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t\t<span>${__(\"Size\")}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t\t<span>${__(\"Created\")}</span>\n\t\t\t\t</div>`\n\t\t\t: \"\";\n\n\t\tlet subject_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t${header_selector_html}\n\t\t\t\t<span class=\"level-item\">${breadcrumbs_html}</span>\n\t\t\t</div>\n\t\t\t${header_columns_html}\n\t\t`;\n\n\t\treturn this.get_header_html_skeleton(\n\t\t\tsubject_html,\n\t\t\t'<span class=\"list-count\"></span>'\n\t\t);\n\t}\n\n\tget_route_url(file) {\n\t\treturn file.is_folder\n\t\t\t? \"/app/file/view/\" + file.name\n\t\t\t: this.get_form_link(file);\n\t}\n\n\tget_creation_date(file) {\n\t\tconst [date] = file.creation.split(\" \");\n\t\tlet created_on;\n\t\tif (date === frappe.datetime.now_date()) {\n\t\t\tcreated_on = comment_when(file.creation);\n\t\t} else {\n\t\t\tcreated_on = frappe.datetime.str_to_user(date);\n\t\t}\n\t\treturn created_on;\n\t}\n\n\tget_left_html(file) {\n\t\tfile = this.prepare_datum(file);\n\t\tconst file_size = file.file_size\n\t\t\t? frappe.form.formatters.FileSize(file.file_size)\n\t\t\t: \"\";\n\t\tconst route_url = this.get_route_url(file);\n\n\t\treturn `\n\t\t\t<div class=\"list-row-col ellipsis list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\"\n\t\t\t\t\ttype=\"checkbox\" data-name=\"${file.name}\">\n\t\t\t\t<span class=\"level-item ellipsis\" title=\"${file.file_name}\">\n\t\t\t\t\t<a class=\"ellipsis\" href=\"${route_url}\" title=\"${file.file_name}\">\n\t\t\t\t\t\t${file.subject_html}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${file_size}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${this.get_creation_date(file)}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_right_html(file) {\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${comment_when(file.modified)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetup_events() {\n\t\tsuper.setup_events();\n\t\tthis.setup_drag_events();\n\t}\n\n\tsetup_drag_events() {\n\t\tthis.$result.on(\"dragstart\", \".files .file-wrapper\", e => {\n\t\t\te.stopPropagation();\n\t\t\te.originalEvent.dataTransfer.setData(\n\t\t\t\t\"Text\",\n\t\t\t\t$(e.currentTarget).attr(\"data-name\")\n\t\t\t);\n\t\t\te.target.style.opacity = \"0.4\";\n\t\t\tfrappe.file_manager.cut(\n\t\t\t\t[{ name: $(e.currentTarget).attr(\"data-name\") }],\n\t\t\t\tthis.current_folder\n\t\t\t);\n\t\t});\n\n\t\tthis.$result.on(\n\t\t\t\"dragover\",\n\t\t\te => {\n\t\t\t\te.preventDefault();\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\n\t\tthis.$result.on(\"dragend\", \".files .file-wrapper\", e => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.target.style.opacity = \"1\";\n\t\t});\n\n\t\tthis.$result.on(\"drop\", e => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconst $el = $(e.target).parents(\".file-wrapper\");\n\n\t\t\tlet dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!dataTransfer) return;\n\n\t\t\tif (dataTransfer.files && dataTransfer.files.length > 0) {\n\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t});\n\t\t\t} else if (dataTransfer.getData(\"Text\")) {\n\t\t\t\tif ($el.parents(\".folders\").length !== 0) {\n\t\t\t\t\tconst file_name = dataTransfer.getData(\"Text\");\n\t\t\t\t\tconst folder_name = decodeURIComponent(\n\t\t\t\t\t\t$el.attr(\"data-name\")\n\t\t\t\t\t);\n\t\t\t\t\tfrappe.file_manager.paste(folder_name);\n\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t`File ${file_name} moved to ${folder_name}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ton_row_checked() {\n\t\tsuper.on_row_checked();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ttoggle_cut_paste_buttons() {\n\t\tconst hide_paste_btn =\n\t\t\t!frappe.file_manager.can_paste ||\n\t\t\tfrappe.file_manager.old_folder === this.current_folder;\n\t\tconst hide_cut_btn = !(this.$checks && this.$checks.length > 0);\n\n\t\tthis.$paste_btn.toggle(!hide_paste_btn);\n\t\tthis.$cut_button.toggle(!hide_cut_btn);\n\t}\n};\n\nfrappe.views.FileView.grid_view =\n\tfrappe.get_user_settings(\"File\").grid_view || false;\n\nfunction redirect_to_home_if_invalid_route() {\n\tconst route = frappe.get_route();\n\tif (route[2] === \"List\") {\n\t\t// if the user somehow redirects to List/File/List\n\t\t// redirect back to Home\n\t\tfrappe.set_route(\"List\", \"File\", \"Home\");\n\t\treturn true;\n\t}\n\treturn false;\n}","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.provide('frappe.views');\nfrappe.provide(\"frappe.interaction_settings\");\n\nfrappe.views.InteractionComposer = class InteractionComposer {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tfrappe.model.with_doctype(\"Event Participants\", () => {\n\t\t\tthis.make();\n\t\t});\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: (me.title || me.subject || __(\"New Activity\")),\n\t\t\tno_submit_on_enter: true,\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __('Create'),\n\t\t\tprimary_action: function() {\n\t\t\t\tme.create_action();\n\t\t\t}\n\t\t});\n\n\t\t$(document).on(\"upload_complete\", function(event, attachment) {\n\t\t\tif(me.dialog.display) {\n\t\t\t\tlet wrapper = $(me.dialog.fields_dict.select_attachments.wrapper);\n\n\t\t\t\t// find already checked items\n\t\t\t\tlet checked_items = wrapper.find('[data-file-name]:checked').map(function() {\n\t\t\t\t\treturn $(this).attr(\"data-file-name\");\n\t\t\t\t});\n\n\t\t\t\t// reset attachment list\n\t\t\t\tme.render_attach();\n\n\t\t\t\t// check latest added\n\t\t\t\tchecked_items.push(attachment.name);\n\n\t\t\t\t$.each(checked_items, function(i, filename) {\n\t\t\t\t\twrapper.find('[data-file-name=\"'+ filename +'\"]').prop(\"checked\", true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tme.prepare();\n\t\tme.dialog.show();\n\t}\n\n\tget_fields() {\n\t\tlet me = this;\n\t\tlet interaction_docs = Object.keys(get_doc_mappings());\n\n\t\tlet fields = [\n\t\t\t{label:__(\"Reference\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"interaction_type\", options: interaction_docs,\n\t\t\t\treqd: 1,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tlet values = me.get_values();\n\t\t\t\t\tme.get_fields().forEach(field => {\n\t\t\t\t\t\tif (field.fieldname != \"interaction_type\") {\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"reqd\", 0);\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"hidden\", 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.set_reqd_hidden_fields(values);\n\t\t\t\t\tme.get_event_categories();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{label:__(\"Category\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"category\", options: \"\", hidden: 1},\n\t\t\t{label:__(\"Public\"), fieldtype:\"Check\",\n\t\t\t\tfieldname:\"public\", default: \"1\"},\n\t\t\t{fieldtype: \"Column Break\"},\n\t\t\t{label:__(\"Date\"), fieldtype:\"Datetime\",\n\t\t\t\tfieldname:\"due_date\"},\n\t\t\t{label:__(\"Assigned To\"), fieldtype:\"Link\",\n\t\t\t\tfieldname:\"assigned_to\", options:\"User\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Participants\"), fieldtype:\"Table MultiSelect\",\n\t\t\t\tfieldname:\"participants\", options:\"Event Participants\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Summary\"), fieldtype:\"Data\",\n\t\t\t\tfieldname:\"summary\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{fieldtype:\"Text Editor\", fieldname:\"description\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Select Attachments\"), fieldtype:\"HTML\",\n\t\t\t\tfieldname:\"select_attachments\"}\n\t\t];\n\n\t\treturn fields;\n\n\t}\n\n\tget_event_categories() {\n\t\tlet me = this;\n\t\tfrappe.model.with_doctype('Event', () => {\n\t\t\tlet categories = frappe.meta.get_docfield(\"Event\", \"event_category\").options.split(\"\\n\");\n\t\t\tme.dialog.get_input(\"category\").empty().add_options(categories);\n\t\t});\n\t}\n\n\tprepare() {\n\t\tthis.setup_attach();\n\t}\n\n\tset_reqd_hidden_fields(values) {\n\t\tlet me = this;\n\t\tif (values&&\"interaction_type\" in values) {\n\t\t\tlet doc_mapping = get_doc_mappings();\n\t\t\tdoc_mapping[values.interaction_type][\"reqd_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'reqd', 1);\n\t\t\t});\n\n\t\t\tdoc_mapping[values.interaction_type][\"hidden_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'hidden', 1);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_attach() {\n\t\tvar fields = this.dialog.fields_dict;\n\t\tvar attach = $(fields.select_attachments.wrapper);\n\n\t\tif (!this.attachments) {\n\t\t\tthis.attachments = [];\n\t\t}\n\n\t\tlet args = {\n\t\t\tfolder: frappe.boot.attachments_folder,\n\t\t\ton_success: attachment => this.attachments.push(attachment)\n\t\t};\n\n\t\tif (this.frm) {\n\t\t\targs = {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tdocname: this.frm.docname,\n\t\t\t\tfolder: frappe.boot.attachments_folder,\n\t\t\t\ton_success: attachment => {\n\t\t\t\t\tthis.frm.attachments.attachment_uploaded(attachment);\n\t\t\t\t\tthis.render_attach();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t$(\"<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>\"\n\t\t\t+__(\"Select Attachments\")+\"</h6><div class='attach-list'></div>\\\n\t\t\t<p class='add-more-attachments'>\\\n\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> \"\n\t\t\t+__(\"Add Attachment\")+\"</a></p>\").appendTo(attach.empty());\n\t\tattach\n\t\t\t.find(\".add-more-attachments a\")\n\t\t\t.on('click',() => new frappe.ui.FileUploader(args));\n\t\tthis.render_attach();\n\t}\n\n\trender_attach(){\n\t\tlet fields = this.dialog.fields_dict;\n\t\tlet attach = $(fields.select_attachments.wrapper).find(\".attach-list\").empty();\n\n\t\tlet files = [];\n\t\tif (this.attachments && this.attachments.length) {\n\t\t\tfiles = files.concat(this.attachments);\n\t\t}\n\t\tif (cur_frm) {\n\t\t\tfiles = files.concat(cur_frm.get_files());\n\t\t}\n\n\t\tif(files.length) {\n\t\t\t$.each(files, function(i, f) {\n\t\t\t\tif (!f.file_name) return;\n\t\t\t\tf.file_url = frappe.urllib.get_full_url(f.file_url);\n\n\t\t\t\t$(repl('<p class=\"checkbox\">'\n\t\t\t\t\t+\t'<label><span><input type=\"checkbox\" data-file-name=\"%(name)s\"></input></span>'\n\t\t\t\t\t+\t\t'<span class=\"small\">%(file_name)s</span>'\n\t\t\t\t\t+\t' <a href=\"%(file_url)s\" target=\"_blank\" class=\"text-muted small\">'\n\t\t\t\t\t+\t\t'<i class=\"uil uil-file-share-alt\" style=\"vertical-align: middle; margin-left: 3px;\"></i>'\n\t\t\t\t\t+ '</label></p>', f))\n\t\t\t\t\t.appendTo(attach);\n\t\t\t});\n\t\t}\n\t}\n\n\tcreate_action() {\n\t\tlet me = this;\n\t\tlet btn = me.dialog.get_primary_btn();\n\n\t\tlet form_values = this.get_values();\n\t\tif(!form_values) return;\n\n\t\tlet selected_attachments =\n\t\t\t$.map($(me.dialog.wrapper).find(\"[data-file-name]:checked\"), function(element){\n\t\t\t\treturn $(element).attr(\"data-file-name\");\n\t\t\t});\n\n\t\tme.create_interaction(btn, form_values, selected_attachments);\n\t}\n\n\tget_values() {\n\t\tlet me = this;\n\t\tlet values = this.dialog.get_values(true);\n\t\tif (values) {\n\t\t\tvalues[\"reference_doctype\"] = me.frm.doc.doctype;\n\t\t\tvalues[\"reference_document\"] = me.frm.doc.name;\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tcreate_interaction(btn, form_values, selected_attachments) {\n\t\tlet me = this;\n\t\tme.dialog.hide();\n\n\t\tlet field_map = get_doc_mappings();\n\t\tlet interaction_values = {};\n\t\tObject.keys(form_values).forEach(value => {\n\t\t\tinteraction_values[field_map[form_values.interaction_type][\"field_map\"][value]] = form_values[value];\n\t\t});\n\n\t\tif (\"event_type\" in interaction_values){\n\t\t\tinteraction_values[\"event_type\"] = (form_values.public == 1) ? \"Public\" : \"Private\";\n\t\t}\n\t\tif (interaction_values[\"doctype\"] == \"Event\") {\n\t\t\tinteraction_values[\"event_participants\"] = form_values.participants;\n\t\t}\n\t\tif (!(\"owner\" in interaction_values)){\n\t\t\tinteraction_values[\"owner\"] = frappe.session.user;\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod:\"frappe.client.insert\",\n\t\t\targs: { doc: interaction_values},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"{0} created successfully\", [form_values.interaction_type]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tif (\"assigned_to\" in form_values) {\n\t\t\t\t\t\tme.assign_document(r.message, form_values[\"assigned_to\"]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selected_attachments) {\n\t\t\t\t\t\tme.add_attachments(r.message, selected_attachments);\n\t\t\t\t\t}\n\t\t\t\t\tif (cur_frm) {\n\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while creating the document. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tassign_document(doc, assignee) {\n\t\tif (doc.doctype != \"ToDo\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:'frappe.desk.form.assign_to.add',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\tname: doc.name,\n\t\t\t\t\tassign_to: JSON.stringify([assignee])\n\t\t\t\t},\n\t\t\t\tcallback:function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document has been assigned to {0}\", [assignee]),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document could not be correctly assigned\"),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\tadd_attachments(doc, attachments) {\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.utils.file_manager.add_attachments',\n\t\t\targs: {\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tattachments: JSON.stringify(attachments)\n\t\t\t},\n\t\t\tcallback:function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"The attachments could not be correctly linked to the new document\"),\n\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n};\n\nfunction get_doc_mappings() {\n\tconst doc_map = {\n\t\t\"Event\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"summary\": \"subject\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"category\": \"event_category\",\n\t\t\t\t\"due_date\": \"starts_on\",\n\t\t\t\t\"public\": \"event_type\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"summary\", \"due_date\"],\n\t\t\t\"hidden_fields\": []\n\t\t} ,\n\t\t\"ToDo\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"due_date\": \"date\",\n\t\t\t\t\"reference_doctype\": \"reference_type\",\n\t\t\t\t\"reference_document\": \"reference_name\",\n\t\t\t\t\"assigned_to\": \"owner\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"description\"],\n\t\t\t\"hidden_fields\": [\"public\", \"category\"]\n\t\t}\n\t};\n\n\treturn doc_map;\n}","frappe.provide('frappe.views');\n\nfrappe.views.DashboardView = class DashboardView extends frappe.views.ListView {\n\tget view_name() {\n\t\t// __(\"Dashboard\")\n\t\treturn 'Dashboard';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = __('{0} Dashboard', [__(this.doctype)]);\n\t\t\t\tthis.dashboard_settings = frappe.get_user_settings(this.doctype)['dashboard_settings'] || null;\n\t\t\t});\n\t}\n\n\trender() {\n\n\t}\n\n\tsetup_page() {\n\t\tthis.hide_sidebar = true;\n\t\tthis.hide_page_form = true;\n\t\tthis.hide_page_form = true;\n\t\tthis.hide_filters = true;\n\t\tthis.hide_sort_selector = true;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_view() {\n\t\tif (this.chart_group || this.number_card_group) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setup_dashboard_page();\n\t\tthis.setup_dashboard_customization();\n\t\tthis.make_dashboard();\n\n\t\tthis.filter_area && this.filter_area.$filter_list_wrapper.hide();\n\t}\n\n\tsetup_dashboard_customization() {\n\t\tthis.page.add_menu_item(__('Customize Dashboard'), () => this.customize());\n\t\tthis.page.add_menu_item(__('Reset Dashboard Customizations'), () => this.reset_dashboard_customization());\n\t\tthis.add_customization_buttons();\n\t}\n\n\tsetup_dashboard_page() {\n\t\tconst chart_wrapper_html = `<div class=\"dashboard-view\"></div>`;\n\n\t\tthis.$frappe_list.html(chart_wrapper_html);\n\t\tthis.page.clear_secondary_action();\n\t\tthis.$dashboard_page = this.$page.find('.layout-main-section-wrapper').addClass('dashboard-page');\n\t\tthis.page.main.removeClass('frappe-card');\n\n\t\tthis.$dashboard_wrapper = this.$page.find('.dashboard-view');\n\t\tthis.$chart_header = this.$page.find('.dashboard-header');\n\n\t\tfrappe.utils.bind_actions_with_object(this.$dashboard_page, this);\n\t}\n\n\tadd_customization_buttons() {\n\t\tthis.save_customizations_button = this.page.add_button(\n\t\t\t__(\"Save Customizations\"),\n\t\t\t() => {\n\t\t\t\tthis.save_dashboard_customization();\n\t\t\t\tthis.page.standard_actions.show();\n\t\t\t},\n\t\t\t{btn_class: 'btn-primary'}\n\t\t);\n\n\t\tthis.discard_customizations_button = this.page.add_button(\n\t\t\t__(\"Discard\"),\n\t\t\t() => {\n\t\t\t\tthis.discard_dashboard_customization();\n\t\t\t\tthis.page.standard_actions.show();\n\t\t\t}\n\t\t);\n\n\t\tthis.toggle_customization_buttons(false);\n\t}\n\n\tset_primary_action() {\n\t\t// Don't render Add doc button for dashboard view\n\t}\n\n\ttoggle_customization_buttons(show) {\n\t\tthis.save_customizations_button.toggle(show);\n\t\tthis.discard_customizations_button.toggle(show);\n\t}\n\n\tmake_dashboard() {\n\t\tif (this.dashboard_settings) {\n\t\t\tthis.charts = this.dashboard_settings.charts;\n\t\t\tthis.number_cards = this.dashboard_settings.number_cards;\n\t\t\tthis.render_dashboard();\n\t\t} else {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.fetch_dashboard_items(\n\t\t\t\t\t'Dashboard Chart',\n\t\t\t\t\t{\n\t\t\t\t\t\tchart_type: ['in', ['Count', 'Sum', 'Group By']],\n\t\t\t\t\t\tdocument_type: this.doctype,\n\t\t\t\t\t\tis_public: 1,\n\t\t\t\t\t},\n\t\t\t\t\t'charts'\n\t\t\t\t),\n\t\t\t\t() => this.fetch_dashboard_items('Number Card',\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument_type: this.doctype,\n\t\t\t\t\t\tis_public: 1,\n\t\t\t\t\t},\n\t\t\t\t\t'number_cards'\n\t\t\t\t),\n\t\t\t\t() => this.render_dashboard()\n\t\t\t]);\n\t\t}\n\t}\n\n\trender_dashboard() {\n\t\tthis.$dashboard_wrapper.empty();\n\n\t\tfrappe.dashboard_utils.get_dashboard_settings().then(settings => {\n\t\t\tthis.dashboard_chart_settings = settings.chart_config ? JSON.parse(settings.chart_config) : {};\n\t\t\tthis.charts.map(chart => {\n\t\t\t\tchart.label = chart.chart_name;\n\t\t\t\tchart.chart_settings = this.dashboard_chart_settings[chart.chart_name] || {};\n\t\t\t});\n\t\t\tthis.render_dashboard_charts();\n\t\t});\n\t\tthis.render_number_cards();\n\n\t\tif (!this.charts.length && !this.number_cards.length) {\n\t\t\tthis.render_empty_state();\n\t\t}\n\t}\n\n\tfetch_dashboard_items(doctype, filters, obj_name) {\n\t\treturn frappe.db.get_list(doctype, {\n\t\t\tfilters: filters,\n\t\t\tfields: ['*']\n\t\t}).then(items => {\n\t\t\tthis[obj_name] = items;\n\t\t});\n\t}\n\n\trender_number_cards() {\n\t\tthis.number_card_group = new frappe.widget.WidgetGroup({\n\t\t\tcontainer: this.$dashboard_wrapper,\n\t\t\ttype: \"number_card\",\n\t\t\tcolumns: 3,\n\t\t\toptions: {\n\t\t\t\tallow_sorting: true,\n\t\t\t\tallow_create: true,\n\t\t\t\tallow_delete: true,\n\t\t\t\tallow_hiding: true,\n\t\t\t},\n\t\t\tdefault_values: {doctype: this.doctype},\n\t\t\twidgets: this.number_cards || [],\n\t\t\tin_customize_mode: this.in_customize_mode || false,\n\t\t});\n\n\t\tthis.in_customize_mode && this.number_card_group.customize();\n\t}\n\n\trender_dashboard_charts() {\n\t\tthis.chart_group = new frappe.widget.WidgetGroup({\n\t\t\tcontainer: this.$dashboard_wrapper,\n\t\t\ttype: \"chart\",\n\t\t\tcolumns: 2,\n\t\t\theight: 240,\n\t\t\toptions: {\n\t\t\t\tallow_sorting: true,\n\t\t\t\tallow_create: true,\n\t\t\t\tallow_delete: true,\n\t\t\t\tallow_hiding: true,\n\t\t\t\tallow_resize: true,\n\t\t\t},\n\t\t\tcustom_dialog: () => this.show_add_chart_dialog(),\n\t\t\twidgets: this.charts,\n\t\t\tin_customize_mode: this.in_customize_mode || false,\n\t\t});\n\n\t\tthis.in_customize_mode && this.chart_group.customize();\n\t\tthis.chart_group.container.find('.widget-group-head').hide();\n\t}\n\n\trender_empty_state() {\n\t\tconst no_result_message_html =\n\t\t\t`<p>${__(\"You haven't added any Dashboard Charts or Number Cards yet.\")}\n\t\t\t<br>${__(\"Click On Customize to add your first widget\")}</p>`;\n\n\t\tconst customize_button =\n\t\t\t`<p><button class=\"btn btn-primary btn-sm\" data-action=\"customize\">\n\t\t\t\t${__('Customize')}\n\t\t\t</button></p>`;\n\n\t\tconst empty_state_image = '/assets/frappe/images/ui-states/list-empty-state.svg';\n\n\t\tconst empty_state_html = `<div class=\"msg-box no-border empty-dashboard\">\n\t\t\t<div>\n\t\t\t\t<img src=\"${empty_state_image}\" alt=\"Generic Empty State\" class=\"null-state\">\n\t\t\t</div>\n\t\t\t${no_result_message_html}\n\t\t\t${customize_button}\n\t\t</div>`;\n\n\t\tthis.$dashboard_wrapper.append(empty_state_html);\n\t\tthis.$empty_state = this.$dashboard_wrapper.find('.empty-dashboard');\n\t}\n\n\tcustomize() {\n\t\tif (this.in_customize_mode) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.page.standard_actions.hide();\n\n\t\tif (this.$empty_state) {\n\t\t\tthis.$empty_state.remove();\n\t\t}\n\n\t\tthis.toggle_customize(true);\n\t\tthis.in_customize_mode = true;\n\t\tthis.chart_group.customize();\n\t\tthis.number_card_group.customize();\n\t}\n\n\tget_widgets_to_save(widget_group) {\n\t\tconst config = widget_group.get_widget_config();\n\t\tlet widgets = [];\n\t\tconfig.order.map(widget_name => {\n\t\t\twidgets.push(config.widgets[widget_name]);\n\t\t});\n\t\treturn this.remove_duplicates(widgets);\n\t}\n\n\tsave_dashboard_customization() {\n\t\tthis.toggle_customize(false);\n\n\t\tconst charts = this.get_widgets_to_save(this.chart_group);\n\t\tconst number_cards = this.get_widgets_to_save(this.number_card_group);\n\n\t\tthis.dashboard_settings = {\n\t\t\tcharts: charts,\n\t\t\tnumber_cards: number_cards,\n\t\t};\n\n\t\tfrappe.model.user_settings.save(this.doctype, 'dashboard_settings', this.dashboard_settings);\n\t\tthis.make_dashboard();\n\t}\n\n\tdiscard_dashboard_customization() {\n\t\tthis.dashboard_settings = frappe.get_user_settings(this.doctype)['dashboard_settings'] || null;\n\t\tthis.toggle_customize(false);\n\t\tthis.render_dashboard();\n\t}\n\n\treset_dashboard_customization() {\n\t\tfrappe.confirm(__(\"Are you sure you want to reset all customizations?\"), () => {\n\t\t\tthis.dashboard_settings = null;\n\t\t\tfrappe.model.user_settings.save(\n\t\t\t\tthis.doctype, 'dashboard_settings', this.dashboard_settings\n\t\t\t).then(() => this.make_dashboard());\n\n\t\t\tthis.toggle_customize(false);\n\t\t});\n\t}\n\n\ttoggle_customize(show) {\n\t\tthis.toggle_customization_buttons(show);\n\t\tthis.in_customize_mode = show;\n\t}\n\n\tshow_add_chart_dialog() {\n\t\tlet fields = this.get_field_options();\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add a {0} Chart\", [__(this.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'new_or_existing',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tlabel: __('Choose an existing chart or create a new chart'),\n\t\t\t\t\toptions: [{\n\t\t\t\t\t\t'value': 'New Chart',\n\t\t\t\t\t\t'label': __('New Chart')\n\t\t\t\t\t},{\n\t\t\t\t\t\t'value': 'Existing Chart',\n\t\t\t\t\t\t'label': __('Existing Chart')\n\t\t\t\t\t}],\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Chart'),\n\t\t\t\t\tfieldname: 'chart',\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t'query': 'frappe.desk.doctype.dashboard_chart.dashboard_chart.get_charts_for_user',\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\tdocument_type: [\"in\", [this.doctype, \"\"]],\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\toptions: 'Dashboard Chart',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"Existing Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Chart Label'),\n\t\t\t\t\tfieldname: 'label',\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_1',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Chart Type'),\n\t\t\t\t\tfieldname: 'chart_type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Time Series', 'Group By'],\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tlabel: __('Chart Config'),\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\" && doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Function'),\n\t\t\t\t\tfieldname: 'chart_function',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Count', 'Sum', 'Average'],\n\t\t\t\t\tdefault: 'Count',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Timespan'),\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'timespan',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\"',\n\t\t\t\t\toptions: ['Last Year', 'Last Quarter', 'Last Month', 'Last Week'],\n\t\t\t\t\tdefault: 'Last Year',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_2',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Value Based On'),\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\toptions: fields.value_fields,\n\t\t\t\t\tdepends_on: 'eval: doc.chart_function==\"Sum\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Time Series Based On'),\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\toptions: fields.date_fields,\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.chart_type == \"Time Series\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Time Interval'),\n\t\t\t\t\tfieldname: 'time_interval',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\"',\n\t\t\t\t\toptions: ['Yearly', 'Quarterly', 'Monthly', 'Weekly', 'Daily'],\n\t\t\t\t\tdefault: 'Monthly'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tlabel: __('Chart Config'),\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Group By\" && doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Group By Type'),\n\t\t\t\t\tfieldname: 'group_by_type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Count', 'Sum', 'Average'],\n\t\t\t\t\tdefault: 'Count',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Aggregate Function Based On'),\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'aggregate_function_based_on',\n\t\t\t\t\toptions: fields.aggregate_function_fields,\n\t\t\t\t\tdepends_on: 'eval: [\"Sum\", \"Avergage\"].includes(doc.group_by_type)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_2',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Group By Based On'),\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'group_by_based_on',\n\t\t\t\t\toptions: fields.group_by_fields,\n\t\t\t\t\tdefault: 'Last Year',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Number of Groups'),\n\t\t\t\t\tfieldtype: 'Int',\n\t\t\t\t\tfieldname: 'number_of_groups',\n\t\t\t\t\tdefault: 0,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_3',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Chart Type'),\n\t\t\t\t\tfieldname: 'type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Line', 'Bar', 'Percentage', 'Pie'],\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_1',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Chart Color'),\n\t\t\t\t\tfieldname: 'color',\n\t\t\t\t\tfieldtype: 'Color',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __('Add'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet chart = values;\n\t\t\t\tif (chart.new_or_existing == 'New Chart') {\n\t\t\t\t\tchart.chart_name = chart.label;\n\t\t\t\t\tchart.chart_type = chart.chart_type == 'Time Series' ? chart.chart_function : chart.chart_type;\n\t\t\t\t\tchart.document_type = this.doctype;\n\t\t\t\t\tchart.filters_json = '[]';\n\t\t\t\t\tfrappe.xcall('frappe.desk.doctype.dashboard_chart.dashboard_chart.create_dashboard_chart', {'args': chart}).then((doc)=> {\n\t\t\t\t\t\tthis.chart_group.new_widget.on_create({'chart_name': doc.chart_name, 'name': doc.chart_name, 'label': chart.label});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.chart_group.new_widget.on_create({'chart_name': chart.chart, 'label': chart.chart, 'name': chart.chart});\n\t\t\t\t}\n\t\t\t\tdialog.hide();\n\t\t\t}\n\t\t});\n\t\tdialog.show();\n\t}\n\n\tget_field_options() {\n\t\tlet date_fields = [\n\t\t\t{label: __('Created On'), value: 'creation'},\n\t\t\t{label: __('Last Modified On'), value: 'modified'}\n\t\t];\n\t\tlet value_fields = [];\n\t\tlet group_by_fields = [];\n\t\tlet aggregate_function_fields = [];\n\n\t\tfrappe.get_meta(this.doctype).fields.map(df => {\n\t\t\tif (['Date', 'Datetime'].includes(df.fieldtype)) {\n\t\t\t\tdate_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t\tif (frappe.model.numeric_fieldtypes.includes(df.fieldtype)) {\n\t\t\t\tif (df.fieldtype == 'Currency') {\n\t\t\t\t\tif (!df.options || df.options !== 'Company:company:default_currency') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvalue_fields.push({label: df.label, value: df.fieldname});\n\t\t\t\taggregate_function_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t\tif (['Link', 'Select'].includes(df.fieldtype)) {\n\t\t\t\tgroup_by_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tdate_fields: date_fields,\n\t\t\tvalue_fields: value_fields,\n\t\t\tgroup_by_fields: group_by_fields,\n\t\t\taggregate_function_fields: aggregate_function_fields\n\t\t};\n\t}\n\n\tremove_duplicates(items) {\n\t\treturn items.filter((item, index) => items.indexOf(item) === index);\n\t}\n\n};","/**\n * frappe.views.ImageView\n */\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ImageView = class ImageView extends frappe.views.ListView {\n\tget view_name() {\n\t\t// __(\"Image\")\n\t\treturn \"Image\";\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults().then(() => {\n\t\t\tthis.page_title = this.page_title + \" \" + __(\"Images\");\n\t\t});\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = [\n\t\t\t\"name\",\n\t\t\t...this.get_fields_in_list_view().map(el => el.fieldname),\n\t\t\tthis.meta.title_field,\n\t\t\tthis.meta.image_field,\n\t\t\t\"_liked_by\"\n\t\t];\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.items = this.data.map(d => {\n\t\t\t// absolute url if cordova, else relative\n\t\t\td._image_url = this.get_image_url(d);\n\t\t\treturn d;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.get_attached_images().then(() => {\n\t\t\tthis.render_image_view();\n\n\t\t\tif (!this.gallery) {\n\t\t\t\tthis.setup_gallery();\n\t\t\t} else {\n\t\t\t\tthis.gallery.prepare_pswp_items(this.items, this.images_map);\n\t\t\t}\n\t\t});\n\t}\n\n\trender_image_view() {\n\t\tvar html = this.items.map(this.item_html.bind(this)).join(\"\");\n\n\t\tthis.$page.find(\".layout-main-section-wrapper\").addClass(\"image-view\");\n\n\t\tthis.$result.html(`\n\t\t\t<div class=\"image-view-container\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.render_count();\n\t}\n\n\titem_details_html(item) {\n\t\t// TODO: Image view field in DocType\n\t\tlet info_fields =\n\t\t\tthis.get_fields_in_list_view().map(el => el.fieldname) || [];\n\t\tconst title_field = this.meta.title_field || \"name\";\n\t\tinfo_fields = info_fields.filter(field => field !== title_field);\n\t\tlet info_html = `<div><ul class=\"list-unstyled image-view-info\">`;\n\t\tlet set = false;\n\t\tinfo_fields.forEach((field, index) => {\n\t\t\tif (item[field] && !set) {\n\t\t\t\tif (index == 0) info_html += `<li>${item[field]}</li>`;\n\t\t\t\telse info_html += `<li class=\"text-muted\">${item[field]}</li>`;\n\t\t\t\tset = true;\n\t\t\t}\n\t\t});\n\t\tinfo_html += `</ul></div>`;\n\t\treturn info_html;\n\t}\n\n\titem_html(item) {\n\t\titem._name = encodeURI(item.name);\n\t\tconst encoded_name = item._name;\n\t\tconst title = strip_html(item[this.meta.title_field || \"name\"]);\n\t\tconst escaped_title = frappe.utils.escape_html(title);\n\t\tconst _class = !item._image_url ? \"no-image\" : \"\";\n\t\tconst _html = item._image_url\n\t\t? `<img data-name=\"${encoded_name}\" src=\"${item._image_url}\" alt=\"${title}\">`\n\t\t\t: `<span class=\"placeholder-text\">\n\t\t\t\t${frappe.get_abbr(title)}\n\t\t\t</span>`;\n\n\t\tlet details = this.item_details_html(item);\n\n\t\tconst expand_button_html = item._image_url\n\t\t\t? `<div class=\"zoom-view\" data-name=\"${encoded_name}\">\n\t\t\t\t${frappe.utils.icon(\"expand\", \"xs\")}\n\t\t\t</div>`\n\t\t\t: \"\";\n\n\t\treturn `\n\t\t\t<div class=\"image-view-item ellipsis\">\n\t\t\t\t<div class=\"image-view-header\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\"\n\t\t\t\t\t\t\ttype=\"checkbox\" data-name=\"${escape(item.name)}\">\n\t\t\t\t\t\t${this.get_like_html(item)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-body ${_class}\">\n\t\t\t\t\t<a data-name=\"${encoded_name}\"\n\t\t\t\t\t\ttitle=\"${encoded_name}\"\n\t\t\t\t\t\thref=\"${this.get_form_link(item)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"image-field\"\n\t\t\t\t\t\t\tdata-name=\"${encoded_name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${_html}\n\t\t\t\t\t\t\t${expand_button_html}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t${expand_button_html}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-footer\">\n\t\t\t\t\t<div class=\"image-title\">\n\t\t\t\t\t\t<span class=\"ellipsis\" title=\"${escaped_title}\">\n\t\t\t\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(item)}\"\n\t\t\t\t\t\t\t\ttitle=\"${escaped_title}\" data-doctype=\"${this.doctype}\" data-name=\"${item.name}\">\n\t\t\t\t\t\t\t\t${title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${details}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_attached_images() {\n\t\treturn frappe\n\t\t\t.call({\n\t\t\t\tmethod: \"frappe.core.doctype.file.file.get_attached_images\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tnames: this.items.map(i => i.name)\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(r => {\n\t\t\t\tthis.images_map = Object.assign(\n\t\t\t\t\tthis.images_map || {},\n\t\t\t\t\tr.message\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tget_header_html() {\n\t// \treturn this.get_header_html_skeleton(`\n\t// \t\t<div class=\"list-image-header\">\n\t// \t\t\t<div class=\"list-image-header-item\">\n\t// \t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t// \t\t\t\t<div>${__(this.doctype)} &nbsp;</div>\n\t// \t\t\t\t(<span class=\"text-muted list-count\"></span>)\n\t// \t\t\t</div>\n\t// \t\t\t<div class=\"list-image-header-item\">\n\t// \t\t\t\t<div class=\"level-item list-liked-by-me\">\n\t// \t\t\t\t\t${frappe.utils.icon('heart', 'sm', 'like-icon')}\n\t// \t\t\t\t</div>\n\t// \t\t\t\t<div>${__('Liked')}</div>\n\t// \t\t\t</div>\n\t// \t\t</div>\n\t// \t`);\n\t}\n\n\tsetup_gallery() {\n\t\tvar me = this;\n\t\tthis.gallery = new frappe.views.GalleryView({\n\t\t\tdoctype: this.doctype,\n\t\t\titems: this.items,\n\t\t\twrapper: this.$result,\n\t\t\timages_map: this.images_map\n\t\t});\n\t\tthis.$result.on(\"click\", \".zoom-view\", function(e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar name = $(this).data().name;\n\t\t\tname = decodeURIComponent(name);\n\t\t\tme.gallery.show(name);\n\t\t\treturn false;\n\t\t});\n\t}\n};\n\nfrappe.views.GalleryView = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tvar me = this;\n\n\t\tthis.lib_ready = this.load_lib();\n\t\tthis.lib_ready.then(function() {\n\t\t\tme.prepare();\n\t\t});\n\t},\n\tprepare: function() {\n\t\t// keep only one pswp dom element\n\t\tthis.pswp_root = $(\"body > .pswp\");\n\t\tif (this.pswp_root.length === 0) {\n\t\t\tvar pswp = frappe.render_template(\"photoswipe_dom\");\n\t\t\tthis.pswp_root = $(pswp).appendTo(\"body\");\n\t\t}\n\t},\n\tprepare_pswp_items: function(_items, _images_map) {\n\t\tvar me = this;\n\n\t\tif (_items) {\n\t\t\t// passed when more button clicked\n\t\t\tthis.items = this.items.concat(_items);\n\t\t\tthis.images_map = _images_map;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst items = this.items.map(function(i) {\n\t\t\t\tconst query = 'img[data-name=\"' + i._name + '\"]';\n\t\t\t\tlet el = me.wrapper.find(query).get(0);\n\n\t\t\t\tlet width, height;\n\t\t\t\tif (el) {\n\t\t\t\t\twidth = el.naturalWidth;\n\t\t\t\t\theight = el.naturalHeight;\n\t\t\t\t}\n\n\t\t\t\tif (!el) {\n\t\t\t\t\tel = me.wrapper\n\t\t\t\t\t\t.find('.image-field[data-name=\"' + i._name + '\"]')\n\t\t\t\t\t\t.get(0);\n\t\t\t\t\twidth = el.getBoundingClientRect().width;\n\t\t\t\t\theight = el.getBoundingClientRect().height;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsrc: i._image_url,\n\t\t\t\t\tmsrc: i._image_url,\n\t\t\t\t\tname: i.name,\n\t\t\t\t\tw: width,\n\t\t\t\t\th: height,\n\t\t\t\t\tel: el\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.pswp_items = items;\n\t\t\tresolve();\n\t\t});\n\t},\n\tshow: function(docname) {\n\t\tthis.lib_ready\n\t\t\t.then(() => this.prepare_pswp_items())\n\t\t\t.then(() => this._show(docname));\n\t},\n\t_show: function(docname) {\n\t\tconst me = this;\n\t\tconst items = this.pswp_items;\n\t\tconst item_index = items.findIndex(item => item.name === docname);\n\n\t\tvar options = {\n\t\t\tindex: item_index,\n\t\t\tgetThumbBoundsFn: function(index) {\n\t\t\t\tconst query = 'img[data-name=\"' + items[index]._name + '\"]';\n\t\t\t\tlet thumbnail = me.wrapper.find(query).get(0);\n\n\t\t\t\tif (!thumbnail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar pageYScroll =\n\t\t\t\t\t\twindow.pageYOffset ||\n\t\t\t\t\t\tdocument.documentElement.scrollTop,\n\t\t\t\t\trect = thumbnail.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: rect.left,\n\t\t\t\t\ty: rect.top + pageYScroll,\n\t\t\t\t\tw: rect.width\n\t\t\t\t};\n\t\t\t},\n\t\t\thistory: false,\n\t\t\tshareEl: false,\n\t\t\tshowHideOpacity: true\n\t\t};\n\n\t\t// init\n\t\tthis.pswp = new PhotoSwipe(\n\t\t\tthis.pswp_root.get(0),\n\t\t\tPhotoSwipeUI_Default,\n\t\t\titems,\n\t\t\toptions\n\t\t);\n\t\tthis.browse_images();\n\t\tthis.pswp.init();\n\t},\n\tbrowse_images: function() {\n\t\tconst $more_items = this.pswp_root.find(\".pswp__more-items\");\n\t\tconst images_map = this.images_map;\n\t\tlet last_hide_timeout = null;\n\n\t\tthis.pswp.listen(\"afterChange\", function() {\n\t\t\tconst images = images_map[this.currItem.name];\n\t\t\tif (!images || images.length === 1) {\n\t\t\t\t$more_items.html(\"\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide_more_items_after_2s();\n\t\t\tconst html = images.map(img_html).join(\"\");\n\t\t\t$more_items.html(html);\n\t\t});\n\n\t\tthis.pswp.listen(\"beforeChange\", hide_more_items);\n\t\tthis.pswp.listen(\"initialZoomOut\", hide_more_items);\n\t\tthis.pswp.listen(\"destroy\", () => {\n\t\t\t$(document).off(\"mousemove\", hide_more_items_after_2s);\n\t\t});\n\n\t\t// Replace current image on click\n\t\t$more_items.on(\"click\", \".pswp__more-item\", e => {\n\t\t\tconst img_el = e.target;\n\t\t\tconst index = this.pswp.items.findIndex(\n\t\t\t\ti => i.name === this.pswp.currItem.name\n\t\t\t);\n\n\t\t\tthis.pswp.goTo(index);\n\t\t\tthis.pswp.items.splice(index, 1, {\n\t\t\t\tsrc: img_el.src,\n\t\t\t\tw: img_el.naturalWidth,\n\t\t\t\th: img_el.naturalHeight,\n\t\t\t\tname: this.pswp.currItem.name\n\t\t\t});\n\t\t\tthis.pswp.invalidateCurrItems();\n\t\t\tthis.pswp.updateSize(true);\n\t\t});\n\n\t\t// hide more-images 2s after mousemove\n\t\t$(document).on(\"mousemove\", hide_more_items_after_2s);\n\n\t\tfunction hide_more_items_after_2s() {\n\t\t\tclearTimeout(last_hide_timeout);\n\t\t\tshow_more_items();\n\t\t\tlast_hide_timeout = setTimeout(hide_more_items, 2000);\n\t\t}\n\n\t\tfunction show_more_items() {\n\t\t\t$more_items.show();\n\t\t}\n\n\t\tfunction hide_more_items() {\n\t\t\t$more_items.hide();\n\t\t}\n\n\t\tfunction img_html(src) {\n\t\t\treturn `<div class=\"pswp__more-item\">\n\t\t\t\t<img src=\"${src}\">\n\t\t\t</div>`;\n\t\t}\n\t},\n\tload_lib: function() {\n\t\treturn new Promise(resolve => {\n\t\t\tvar asset_dir = \"assets/frappe/js/lib/photoswipe/\";\n\t\t\tfrappe.require(\n\t\t\t\t[\n\t\t\t\t\tasset_dir + \"photoswipe.css\",\n\t\t\t\t\tasset_dir + \"default-skin.css\",\n\t\t\t\t\tasset_dir + \"photoswipe.js\",\n\t\t\t\t\tasset_dir + \"photoswipe-ui-default.js\"\n\t\t\t\t],\n\t\t\t\tresolve\n\t\t\t);\n\t\t});\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.KanbanView = class KanbanView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Kanban'] || {};\n\t\t\tif (!user_settings.last_kanban_board) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('Missing parameter Kanban Board Name')\n\t\t\t\t});\n\t\t\t\tfrappe.set_route('List', doctype, 'List');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\troute.push(user_settings.last_kanban_board);\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget view_name() {\n\t\t// __(\"Kanban\")\n\t\treturn 'Kanban';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.board_name = frappe.get_route()[3];\n\t\t\t\tthis.page_title = __(this.board_name);\n\t\t\t\tthis.card_meta = this.get_card_meta();\n\t\t\t\tthis.page_length = 0;\n\n\t\t\t\tthis.menu_items.push({\n\t\t\t\t\tlabel: __('Save filters'),\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.save_kanban_board_filters();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn this.get_board();\n\t\t\t});\n\t}\n\n\tsetup_paging_area() {\n\t\t// pass\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t}\n\n\tget_board() {\n\t\treturn frappe.db.get_doc('Kanban Board', this.board_name)\n\t\t\t.then(board => {\n\t\t\t\tthis.board = board;\n\t\t\t\tthis.board.filters_array = JSON.parse(this.board.filters || '[]');\n\t\t\t\tthis.filters = this.board.filters_array;\n\t\t\t});\n\t}\n\n\tbefore_refresh() {\n\n\t}\n\n\tsetup_page() {\n\t\t//this.hide_sidebar = true;\n\t\tthis.hide_page_form = true;\n\t\tthis.hide_card_layout = true;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_side_bar() {\n\t\tsuper.setup_side_bar();\n\t\tthis.toggle_side_bar();\n\t}\n\n\tsetup_view() {\n\t\tif (this.board.columns.length > 5) {\n\t\t\tthis.page.container.addClass('full-width');\n\t\t}\n\t\tthis.setup_realtime_updates();\n\t\tthis.setup_like();\n\t}\n\n\tset_fields() {\n\t\tsuper.set_fields();\n\t\tthis._add_field(this.card_meta.title_field);\n\t}\n\n\tbefore_render() {\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_kanban_board: this.board_name\n\t\t});\n\t}\n\n\trender_list() {\n\n\t}\n\n\ton_filter_change() {\n\t\tif (JSON.stringify(this.board.filters_array) !== JSON.stringify(this.filter_area.get())) {\n\t\t\tthis.page.set_indicator(__('Not Saved'), 'orange');\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\n\tsave_kanban_board_filters() {\n\t\tconst filters = this.filter_area.get();\n\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.save_filters',\n\t\t\targs: {\n\t\t\t\tboard_name: this.board_name,\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tif (r.exc) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('There was an error saving filters')\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'green',\n\t\t\t\tmessage: __('Filters saved')\n\t\t\t});\n\n\t\t\tthis.board.filters_array = filters;\n\t\t\tthis.on_filter_change();\n\t\t});\n\t}\n\n\tget_fields() {\n\t\tthis.fields.push([this.board.field_name, this.board.reference_doctype]);\n\t\treturn super.get_fields();\n\t}\n\n\trender() {\n\t\tconst board_name = this.board_name;\n\t\tif (this.kanban && board_name === this.kanban.board_name) {\n\t\t\tthis.kanban.update(this.data);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kanban = new frappe.views.KanbanBoard({\n\t\t\tdoctype: this.doctype,\n\t\t\tboard: this.board,\n\t\t\tboard_name: board_name,\n\t\t\tcards: this.data,\n\t\t\tcard_meta: this.card_meta,\n\t\t\twrapper: this.$result,\n\t\t\tcur_list: this,\n\t\t\tuser_settings: this.view_user_settings\n\t\t});\n\t}\n\n\tget_card_meta() {\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar doc = frappe.model.get_new_doc(this.doctype);\n\t\tvar title_field = null;\n\t\tvar quick_entry = false;\n\n\t\tif (this.meta.title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, this.meta.title_field);\n\t\t}\n\n\t\tthis.meta.fields.forEach((df) => {\n\t\t\tconst is_valid_field =\n\t\t\t\tin_list(['Data', 'Text', 'Small Text', 'Text Editor'], df.fieldtype)\n\t\t\t\t&& !df.hidden;\n\n\t\t\tif (is_valid_field && !title_field) {\n\t\t\t\t// can be mapped to textarea\n\t\t\t\ttitle_field = df;\n\t\t\t}\n\t\t});\n\n\t\t// quick entry\n\t\tvar mandatory = meta.fields.filter((df) => df.reqd && !doc[df.fieldname]);\n\n\t\tif (mandatory.some(df => frappe.model.table_fields.includes(df.fieldtype)) || mandatory.length > 1) {\n\t\t\tquick_entry = true;\n\t\t}\n\n\t\tif (!title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, 'name');\n\t\t}\n\n\t\treturn {\n\t\t\tquick_entry: quick_entry,\n\t\t\ttitle_field: title_field\n\t\t};\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fluxify.min.js',\n\t\t\t'assets/frappe/js/frappe/views/kanban/kanban_board.js'\n\t\t];\n\t}\n};\n\n\nfrappe.views.KanbanView.get_kanbans = function (doctype) {\n\tlet kanbans = [];\n\n\treturn get_kanban_boards()\n\t\t.then((kanban_boards) => {\n\t\t\tif (kanban_boards) {\n\t\t\t\tkanban_boards.forEach(board => {\n\t\t\t\t\tlet route = `/app/${frappe.router.slug(board.reference_doctype)}/view/kanban/${board.name}`;\n\t\t\t\t\tkanbans.push({ name: board.name, route: route });\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn kanbans;\n\t\t});\n\n\tfunction get_kanban_boards() {\n\t\treturn frappe.call('frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards', { doctype })\n\t\t\t.then(r => r.message);\n\t}\n};\n\n\nfrappe.views.KanbanView.show_kanban_dialog = function (doctype, show_existing) {\n\tlet dialog = null;\n\n\tfrappe.views.KanbanView.get_kanbans(doctype).then(kanbans => {\n\t\tdialog = new_kanban_dialog(kanbans, show_existing);\n\t\tdialog.show();\n\t});\n\n\tfunction make_kanban_board(board_name, field_name, project) {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board',\n\t\t\targs: {\n\t\t\t\tdoctype,\n\t\t\t\tboard_name,\n\t\t\t\tfield_name,\n\t\t\t\tproject\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tvar kb = r.message;\n\t\t\t\tif (kb.filters) {\n\t\t\t\t\tfrappe.provide('frappe.kanban_filters');\n\t\t\t\t\tfrappe.kanban_filters[kb.kanban_board_name] = kb.filters;\n\t\t\t\t}\n\t\t\t\tfrappe.set_route('List', doctype, 'Kanban', kb.kanban_board_name);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction new_kanban_dialog(kanbans, show_existing) {\n\t\tif (dialog) return dialog;\n\n\t\tconst fields = get_fields_for_dialog(kanbans.map(kanban => kanban.name), show_existing);\n\n\t\tlet primary_action_label = __('Save');\n\n\t\tlet primary_action = () => {\n\t\t\tconst values = dialog.get_values();\n\t\t\tif (!values.selected_kanban || values.selected_kanban == 'Create New Board') {\n\t\t\t\tmake_kanban_board(values.board_name, values.field_name, values.project)\n\t\t\t\t\t.then(() => dialog.hide(), (err) => frappe.msgprint(err));\n\t\t\t} else {\n\t\t\t\tfrappe.set_route(kanbans.find(kanban => kanban.name == values.selected_kanban).route);\n\t\t\t}\n\t\t};\n\n\t\tdialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('New Kanban Board'),\n\t\t\tfields,\n\t\t\tprimary_action_label,\n\t\t\tprimary_action\n\t\t});\n\t\treturn dialog;\n\t}\n\n\tfunction get_fields_for_dialog(kanban_options, show_existing = false) {\n\t\t// __('Create New Board')\n\t\tkanban_options.push('Create New Board');\n\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'selected_kanban',\n\t\t\t\tlabel: __('Choose Kanban Board'),\n\t\t\t\treqd: 1,\n\t\t\t\tdepends_on: `eval: ${show_existing}`,\n\t\t\t\tmandatory_depends_on: `eval: ${show_existing}`,\n\t\t\t\toptions: kanban_options,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: 'new_kanban_board_sb',\n\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\tdepends_on: `eval: !${show_existing} || doc.selected_kanban == \"Create New Board\"`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tfieldname: 'board_name',\n\t\t\t\tlabel: __('Kanban Board Name'),\n\t\t\t\tmandatory_depends_on: 'eval: doc.selected_kanban == \"Create New Board\"',\n\t\t\t\tdescription: ['Note', 'ToDo'].includes(doctype) ?\n\t\t\t\t\t__('This Kanban Board will be private') : ''\n\t\t\t}\n\t\t];\n\n\t\tif (doctype === 'Task') {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tfieldname: 'project',\n\t\t\t\tlabel: __('Project'),\n\t\t\t\toptions: 'Project'\n\t\t\t});\n\t\t}\n\n\t\tconst select_fields =\n\t\t\tfrappe.get_meta(doctype).fields\n\t\t\t\t.filter(df => {\n\t\t\t\t\treturn df.fieldtype === 'Select' &&\n\t\t\t\t\t\tdf.fieldname !== 'kanban_column';\n\t\t\t\t});\n\n\t\tif (select_fields.length > 0) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'field_name',\n\t\t\t\tlabel: __('Columns based on'),\n\t\t\t\toptions: select_fields.map(df => ({ label: df.label, value: df.fieldname })),\n\t\t\t\tdefault: select_fields[0],\n\t\t\t\tmandatory_depends_on: 'eval: doc.selected_kanban == \"Create New Board\"',\n\t\t\t});\n\t\t} else {\n\t\t\tfields = [{\n\t\t\t\tfieldtype: 'HTML',\n\t\t\t\toptions: `\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"text-medium\">\n\t\t\t\t\t\t${__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type \"Select\".')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" href=\"/app/customize-form?doc_type=${doctype}\">\n\t\t\t\t\t\t\t${__('Customize Form')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t}];\n\t\t}\n\n\t\treturn fields;\n\t}\n};","/**\n * frappe.views.InboxView\n */\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.InboxView = class InboxView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (!route[3] && frappe.boot.email_accounts.length) {\n\t\t\tlet email_account;\n\t\t\tif (frappe.boot.email_accounts[0].email_id == \"All Accounts\") {\n\t\t\t\temail_account = \"All Accounts\";\n\t\t\t} else {\n\t\t\t\temail_account = frappe.boot.email_accounts[0].email_account;\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\", \"Inbox\", email_account);\n\t\t\treturn true;\n\t\t} else if (!route[3] || (route[3] !== \"All Accounts\" && !is_valid(route[3]))) {\n\t\t\tfrappe.throw(__('No email account associated with the User. Please add an account under User > Email Inbox.'));\n\t\t}\n\t\treturn false;\n\n\t\tfunction is_valid(email_account) {\n\t\t\treturn frappe.boot.email_accounts.find(d => d.email_account === email_account);\n\t\t}\n\t}\n\n\tget view_name() {\n\t\t// __(\"Inbox\")\n\t\treturn 'Inbox';\n\t}\n\n\tshow() {\n\t\tsuper.show();\n\t\t// save email account in user_settings\n\t\tthis.save_view_user_settings({\n\t\t\tlast_email_account: this.current_email_account\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'communication_date';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\tthis.email_account = frappe.get_route()[3];\n\t\tthis.page_title = this.email_account;\n\t\tthis.filters = this.get_inbox_filters();\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\t\tthis.columns.push({\n\t\t\ttype: 'Subject',\n\t\t\tdf: {\n\t\t\t\tlabel: __('Subject'),\n\t\t\t\tfieldname: 'subject'\n\t\t\t}\n\t\t});\n\t\tthis.columns.push({\n\t\t\ttype: 'Field',\n\t\t\tdf: {\n\t\t\t\tlabel: this.is_sent_emails ? __(\"To\") : __(\"From\"),\n\t\t\t\tfieldname: this.is_sent_emails ? 'recipients' : 'sender'\n\t\t\t}\n\t\t});\n\t}\n\n\tget_seen_class(doc) {\n\t\tconst seen =\n\t\t\tBoolean(doc.seen) || JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t\t? ''\n\t\t\t\t: 'bold';\n\t\treturn seen;\n\t}\n\n\tget is_sent_emails() {\n\t\tconst f = this.filter_area.get()\n\t\t\t.find(filter => filter[1] === 'sent_or_received');\n\t\treturn f && f[3] === 'Sent';\n\t}\n\n\trender_header() {\n\t\tthis.$result.find('.list-row-head').remove();\n\t\tthis.$result.prepend(this.get_header_html());\n\t}\n\n\trender() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t}\n\n\tget_meta_html(email) {\n\t\tconst attachment = email.has_attachment ?\n\t\t\t`<span class=\"uil uil-paperclip\" title=\"${__('Has Attachments')}\"></span>` : '';\n\n\t\tconst form_link = frappe.utils.get_form_link(email.reference_doctype, email.reference_name);\n\t\tconst link = email.reference_doctype && email.reference_doctype !== this.doctype ?\n\t\t\t`<a class=\"text-muted grey\" href=\"${form_link}\"\n\t\t\t\ttitle=\"${__('Linked with {0}', [email.reference_doctype])}\">\n\t\t\t\t<i class=\"fa fa-link fa-large\"></i>\n\t\t\t</a>` : '';\n\n\t\tconst communication_date = comment_when(email.communication_date, true);\n\t\tconst status =\n\t\t\temail.status == \"Closed\" ? `<span class=\"fas fa-check fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\temail.status == \"Replied\" ? `<span class=\"fas fa-reply fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\t\t\"\";\n\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${link}\n\t\t\t\t${attachment}\n\t\t\t\t${status}\n\t\t\t\t${communication_date}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_inbox_filters() {\n\t\tvar email_account = this.email_account;\n\t\tvar default_filters = [\n\t\t\t[\"Communication\", \"communication_type\", \"=\", \"Communication\", true],\n\t\t\t[\"Communication\", \"communication_medium\", \"=\", \"Email\", true],\n\t\t];\n\t\tvar filters = [];\n\t\tif (email_account === \"Sent\") {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Sent\", true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t} else if (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"email_status\", \"=\", email_account, true],\n\t\t\t\t[\"Communication\", \"email_account\", \"in\", frappe.boot.all_accounts, true]\n\t\t\t]);\n\t\t} else {\n\t\t\tvar op = \"=\";\n\t\t\tif (email_account == \"All Accounts\") {\n\t\t\t\top = \"in\";\n\t\t\t\temail_account = frappe.boot.all_accounts;\n\t\t\t}\n\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Received\", true],\n\t\t\t\t[\"Communication\", \"status\", \"=\", \"Open\", true],\n\t\t\t\t[\"Communication\", \"email_account\", op, email_account, true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tget_no_result_message() {\n\t\tvar email_account = this.email_account;\n\t\tvar args;\n\t\tif (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\treturn __(\"No {0} mail\", [email_account]);\n\t\t} else if (!email_account && !frappe.boot.email_accounts.length) {\n\t\t\t// email account is not configured\n\t\t\targs = {\n\t\t\t\tdoctype: \"Email Account\",\n\t\t\t\tmsg: __(\"No Email Account\"),\n\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t};\n\t\t} else {\n\t\t\t// no sent mail\n\t\t\targs = {\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tmsg: __(\"No Emails\"),\n\t\t\t\tlabel: __(\"Compose Email\")\n\t\t\t};\n\t\t}\n\n\t\tconst html = frappe.model.can_create(args.doctype) ?\n\t\t\t`<p>${args.msg}</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t\t${args.label}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t` :\n\t\t\t`<p>${ __(\"No Email Accounts Assigned\") }</p>`;\n\n\t\treturn `\n\t\t\t<div class=\"msg-box no-border\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tif (!this.email_account && !frappe.boot.email_accounts.length) {\n\t\t\tfrappe.route_options = {\n\t\t\t\t'email_id': frappe.session.user_email\n\t\t\t};\n\t\t\tfrappe.new_doc('Email Account');\n\t\t} else {\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: {}\n\t\t\t});\n\t\t}\n\t}\n};","frappe.provide('frappe.views');\n\nfrappe.views.MapView = class MapView extends frappe.views.ListView {\n\tget view_name() {\n\t\t// __(\"Map\")\n\t\treturn 'Map';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = __('{0} Map', [this.page_title]);\n\t}\n\n\tget_fields() {\n\t\tthis.gelocation_fields = this.meta.fields.filter(f => f.fieldtype === \"Geolocation\").map(f => f.fieldname)\n\t\tthis.gelocation_fields.forEach(fieldname => {\n\t\t\tthis.fields.push([fieldname, this.doctype]);\n\t\t})\n\t\treturn super.get_fields();\n\t}\n\n\tget_list_fields() {\n\t\tthis.list_fields = this.meta.fields\n\t\t\t.filter(f => (f.in_list_view === 1 || f.in_preview === 1))\n\t\t\t.reduce((prev, curr) => {\n\t\t\t\treturn Object.assign(prev, {[curr.fieldname] : curr.label})\n\t\t\t}, {})\n\t}\n\n\tsetup_view() {\n\t\tthis.sort_selector.wrapper.hide();\n\t\tthis.list_sidebar&&this.list_sidebar.parent.find(\".list-tag-preview\").hide();\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.get_list_fields()\n\t}\n\n\trender() {\n\t\tthis.make_wrapper();\n\t\tthis.bind_leaflet_map();\n\t\tthis.bind_leaflet_draw_control();\n\t\tthis.render_map();\n\t}\n\n\tmake_wrapper() {\n\t\tthis.$result.empty();\n\n\t\tthis.map_id = frappe.dom.get_unique_id();\n\t\tthis.map_area = $(\n\t\t\t`<div class=\"map-wrapper border\">\n\t\t\t\t<div id=${this.map_id} style=\"min-height: calc(100vh - 284px); z-index: 1; max-width:100%\"></div>\n\t\t\t</div>`\n\t\t);\n\t\tthis.map_area.prependTo(this.$result);\n\t}\n\n\tbind_leaflet_map() {\n\t\tvar circleToGeoJSON = L.Circle.prototype.toGeoJSON;\n\t\tL.Circle.include({\n\t\t\ttoGeoJSON: function() {\n\t\t\t\tvar feature = circleToGeoJSON.call(this);\n\t\t\t\tfeature.properties = {\n\t\t\t\t\tpoint_type: 'circle',\n\t\t\t\t\tradius: this.getRadius()\n\t\t\t\t};\n\t\t\t\treturn feature;\n\t\t\t}\n\t\t});\n\n\t\tL.CircleMarker.include({\n\t\t\ttoGeoJSON: function() {\n\t\t\t\tvar feature = circleToGeoJSON.call(this);\n\t\t\t\tfeature.properties = {\n\t\t\t\t\tpoint_type: 'circlemarker',\n\t\t\t\t\tradius: this.getRadius()\n\t\t\t\t};\n\t\t\t\treturn feature;\n\t\t\t}\n\t\t});\n\n\t\tL.Icon.Default.imagePath = '/assets/frappe/images/leaflet/';\n\t\tthis.map = L.map(this.map_id).fitWorld();\n\n\t\tL.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n\t\t\tattribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n\t\t}).addTo(this.map);\n\t}\n\n\tbind_leaflet_draw_control() {\n\t\tthis.editableLayers = new L.FeatureGroup();\n\n\t\tvar options = {\n\t\t\tposition: 'topleft',\n\t\t\tdraw: {\n\t\t\t\tpolyline: {\n\t\t\t\t\tshapeOptions: {\n\t\t\t\t\t\tcolor: frappe.ui.color.get('blue'),\n\t\t\t\t\t\tweight: 5\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpolygon: false,\n\t\t\t\tmarker: false,\n\t\t\t\tcircle: false,\n\t\t\t\tcirclemarker: false,\n\t\t\t\trectangle: false\n\t\t\t},\n\t\t\tedit: {\n\t\t\t\tfeatureGroup: this.editableLayers,\n\t\t\t\tremove: false\n\t\t\t}\n\t\t};\n\n\t\t// create control and add to map\n\t\tvar drawControl = new L.Control.Draw(options);\n\n\t\tthis.map.addControl(drawControl);\n\n\t\tthis.map.on('draw:created', (e) => {\n\t\t\tvar type = e.layerType,\n\t\t\t\tlayer = e.layer;\n\t\t\tif (type === 'marker') {\n\t\t\t\tlayer.bindPopup('Marker');\n\t\t\t}\n\t\t\tthis.editableLayers.addLayer(layer);\n\t\t});\n\n\t\tthis.map.on('draw:deleted draw:edited', (e) => {\n\t\t\tvar layer = e.layer;\n\t\t\tthis.editableLayers.removeLayer(layer);\n\t\t});\n\t}\n\n\trender_map() {\n\t\tconst me = this;\n\t\tme.editableLayers = new L.FeatureGroup();\n\t\tme.data.forEach(value => {\n\t\t\tme.gelocation_fields.forEach(field => {\n\t\t\t\tconst geometry_value = value[field]\n\t\t\t\tconst data_layers = new L.LayerGroup()\n\t\t\t\t\t.addLayer(L.geoJson(JSON.parse(geometry_value),{\n\t\t\t\t\t\tpointToLayer: function(geoJsonPoint, latlng) {\n\t\t\t\t\t\t\tif (geoJsonPoint.properties.point_type == \"circle\"){\n\t\t\t\t\t\t\t\treturn L.circle(latlng, {radius: geoJsonPoint.properties.radius})\n\t\t\t\t\t\t\t\t\t.bindPopup(me.get_popup(value))\n\t\t\t\t\t\t\t\t\t.bindTooltip(me.get_tooltip(value));\n\t\t\t\t\t\t\t} else if (geoJsonPoint.properties.point_type == \"circlemarker\") {\n\t\t\t\t\t\t\t\treturn L.circleMarker(latlng, {radius: geoJsonPoint.properties.radius})\n\t\t\t\t\t\t\t\t\t.bindPopup(me.get_popup(value))\n\t\t\t\t\t\t\t\t\t.bindTooltip(me.get_tooltip(value));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\treturn L.marker(latlng)\n\t\t\t\t\t\t\t\t\t.bindPopup(me.get_popup(value))\n\t\t\t\t\t\t\t\t\t.bindTooltip(me.get_tooltip(value));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\tme.add_non_group_layers(data_layers, me.editableLayers);\n\t\t\t})\n\t\t})\n\t\ttry {\n\t\t\tme.map.flyToBounds(me.editableLayers.getBounds(), {\n\t\t\t\tanimate: false,\n\t\t\t\tpadding: [50,50]\n\t\t\t});\n\t\t}\n\t\tcatch(err) {\n\t\t\t// suppress error if layer has a point.\n\t\t}\n\t\tme.editableLayers.addTo(me.map);\n\n\t\tme.map._onResize();\n\t}\n\n\tadd_non_group_layers(source_layer, target_group) {\n\t\t// https://gis.stackexchange.com/a/203773\n\t\t// Would benefit from https://github.com/Leaflet/Leaflet/issues/4461\n\t\tif (source_layer instanceof L.LayerGroup) {\n\t\t\tsource_layer.eachLayer((layer)=>{\n\t\t\t\tthis.add_non_group_layers(layer, target_group);\n\t\t\t});\n\t\t} else {\n\t\t\ttarget_group.addLayer(source_layer);\n\t\t}\n\t}\n\n\tget_popup(value) {\n\t\tconst text = Object.keys(this.list_fields).reduce((prev, f) => {\n\t\t\treturn `${prev}<p><b>${__(this.list_fields[f])}</b>: ${__(value[f])}</p>`\n\t\t}, `<b>${frappe.utils.get_form_link(\n\t\t\tthis.doctype,\n\t\t\tvalue.name,\n\t\t\ttrue\n\t\t)}</b>`)\n\n\t\treturn text\n\t}\n\n\tget_tooltip(value) {\n\t\treturn `<b>${value.name}</b>`\n\t}\n};\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.treeview_settings\");\nfrappe.provide('frappe.views.trees');\nwindow.cur_tree = null;\n\nfrappe.views.TreeFactory = class TreeFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tfrappe.model.with_doctype(route[1], function() {\n\t\t\tvar options = {\n\t\t\t\tdoctype: route[1],\n\t\t\t\tmeta: frappe.get_meta(route[1])\n\t\t\t};\n\n\t\t\tif (!frappe.treeview_settings[route[1]] && !frappe.meta.get_docfield(route[1], \"is_group\")) {\n\t\t\t\tfrappe.msgprint(__(\"Tree view is not available for {0}\", [route[1]] ));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$.extend(options, frappe.treeview_settings[route[1]] || {});\n\t\t\tfrappe.views.trees[options.doctype] = new frappe.views.TreeView(options);\n\t\t});\n\t}\n}\n\nfrappe.views.TreeView = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\tthis.opts = {};\n\t\tthis.opts.get_tree_root = true;\n\t\tthis.opts.show_expand_all = true;\n\t\t$.extend(this.opts, opts);\n\t\tthis.doctype = opts.doctype;\n\t\tthis.args = {doctype: me.doctype};\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.get_tree_nodes =  me.opts.get_tree_nodes || \"frappe.desk.treeview.get_children\";\n\n\t\tthis.get_permissions();\n\t\tthis.make_page();\n\t\tthis.make_filters();\n\t\tthis.root_value = null;\n\n\t\tif (me.opts.get_tree_root) {\n\t\t\tthis.get_root();\n\t\t}\n\n\t\tthis.onload();\n\t\tthis.set_menu_item();\n\t\tthis.set_primary_action();\n\t},\n\tget_permissions: function(){\n\t\tthis.can_read = frappe.model.can_read(this.doctype);\n\t\tthis.can_create = frappe.boot.user.can_create.indexOf(this.doctype) !== -1 ||\n\t\t\t\t\tfrappe.boot.user.in_create.indexOf(this.doctype) !== -1;\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\t\tthis.can_delete = frappe.model.can_delete(this.doctype);\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\t\tthis.parent = frappe.container.add_page(this.page_name);\n\t\tfrappe.ui.make_app_page({parent:this.parent, single_column:true});\n\n\t\tthis.page = this.parent.page;\n\t\tfrappe.container.change_to(this.page_name);\n\t\tfrappe.breadcrumbs.add(me.opts.breadcrumb || locals.DocType[me.doctype].module, me.doctype);\n\n\t\tthis.set_title();\n\n\t\tthis.page.main.css({\n\t\t\t\"min-height\": \"300px\"\n\t\t});\n\n\t\tthis.page.main.addClass('frappe-card');\n\n\t\tif(this.opts.show_expand_all) {\n\t\t\tthis.page.add_inner_button(__('Expand All'), function() {\n\t\t\t\tme.tree.load_children(me.tree.root_node, true);\n\t\t\t});\n\t\t}\n\n\t\tif(this.opts.view_template) {\n\t\t\tvar row = $('<div class=\"row\"><div>').appendTo(this.page.main);\n\t\t\tthis.body = $('<div class=\"col-sm-6 col-xs-12\"></div>').appendTo(row);\n\t\t\tthis.node_view = $('<div class=\"col-sm-6 hidden-xs\"></div>').appendTo(row);\n\t\t} else {\n\t\t\tthis.body = this.page.main;\n\t\t}\n\t},\n\tset_title: function() {\n\t\t// __(\"Tree\")\n\t\tthis.page.set_title(this.opts.title || __('{0} Tree', [__(this.doctype)]));\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\t\tthis.opts.onload && this.opts.onload(me);\n\t},\n\tmake_filters: function() {\n\t\tvar me = this;\n\t\tfrappe.treeview_settings.filters = []\n\t\t$.each(this.opts.filters || [], function(i, filter) {\n\t\t\tif (frappe.route_options && frappe.route_options[filter.fieldname]) {\n\t\t\t\tfilter.default = frappe.route_options[filter.fieldname];\n\t\t\t}\n\n\t\t\tif (!filter.disable_onchange) {\n\t\t\t\tfilter.change = function() {\n\t\t\t\t\tfilter.onchange && filter.onchange();\n\t\t\t\t\tvar val = this.get_value();\n\t\t\t\t\tme.args[filter.fieldname] = val;\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tme.root_label = val;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.root_label = me.opts.root_label;\n\t\t\t\t\t}\n\t\t\t\t\tme.set_title();\n\t\t\t\t\tme.make_tree();\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tme.page.add_field(filter);\n\n\t\t\tif (filter.default) {\n\t\t\t\t$(\"[data-fieldname='\"+filter.fieldname+\"']\").trigger(\"change\");\n\t\t\t}\n\t\t});\n\t},\n\tget_root: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: me.get_tree_nodes,\n\t\t\targs: me.args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tif (r.message.length > 1) {\n\t\t\t\t\t\tme.root_label = me.doctype;\n\t\t\t\t\t\tme.root_value = \"\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.root_label = r.message[0][\"value\"];\n\t\t\t\t\t\tme.root_value = me.root_label;\n\t\t\t\t\t}\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmake_tree: function() {\n\t\t$(this.parent).find(\".tree\").remove();\n\t\tthis.before_render();\n\n\t\tvar use_label = this.args[this.opts.root_label] || this.root_label || this.opts.root_label;\n\t\tvar use_value = this.root_value;\n\t\tif (use_value == null) {\n\t\t\tuse_value = use_label;\n\t\t}\n\n\t\tthis.tree = new frappe.ui.Tree({\n\t\t\tparent: this.body,\n\t\t\tlabel: use_label,\n\t\t\troot_value: use_value,\n\t\t\texpandable: true,\n\n\t\t\targs: this.args,\n\t\t\tmethod: this.get_tree_nodes,\n\n\t\t\t// array of button props: {label, condition, click, btnClass}\n\t\t\ttoolbar: this.get_toolbar(),\n\n\t\t\tget_label: this.opts.get_label,\n\t\t\ton_render: this.opts.onrender,\n\t\t\ton_click: (node) => { this.select_node(node); },\n\t\t});\n\n\t\tcur_tree = this.tree;\n\t\tthis.post_render();\n\t},\n\n\tbefore_render: function() {\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', 'Tree');\n\t},\n\n\trebuild_tree: function() {\n\t\tlet me = this;\n\n\t\tfrappe.call({\n\t\t\t\"method\": \"frappe.utils.nestedset.rebuild_tree\",\n\t\t\t\"args\": {\n\t\t\t\t'doctype': me.doctype,\n\t\t\t\t'parent_field': \"parent_\"+me.doctype.toLowerCase().replace(/ /g, '_'),\n\t\t\t},\n\t\t\t\"callback\": function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tpost_render: function() {\n\t\tvar me = this;\n\t\tme.opts.post_render && me.opts.post_render(me);\n\t},\n\n\tselect_node: function(node) {\n\t\tvar me = this;\n\t\tif(this.opts.click) {\n\t\t\tthis.opts.click(node);\n\t\t}\n\t\tif(this.opts.view_template) {\n\t\t\tthis.node_view.empty();\n\t\t\t$(frappe.render_template(me.opts.view_template,\n\t\t\t\t{data:node.data, doctype:me.doctype})).appendTo(this.node_view);\n\t\t}\n\t},\n\tget_toolbar: function() {\n\t\tvar me = this;\n\n\t\tvar toolbar = [\n\t\t\t{\n\t\t\t\tlabel:__(me.can_write? \"Edit\": \"Details\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn !node.is_root && me.can_read;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.set_route(\"Form\", me.doctype, node.label);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Add Child\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn me.can_create && node.expandable && !node.hide_add;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tme.new_node();\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Rename\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\tlet allow_rename = true;\n\t\t\t\t\tif (me.doctype && frappe.get_meta(me.doctype)) {\n\t\t\t\t\t\tif(!frappe.get_meta(me.doctype).allow_rename) allow_rename = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn !node.is_root && me.can_write && allow_rename;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.rename_doc(me.doctype, node.label, function(new_name) {\n\t\t\t\t\t\tnode.$tree_link.find('a').text(new_name);\n\t\t\t\t\t\tnode.label = new_name;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Delete\"),\n\t\t\t\tcondition: function(node) { return !node.is_root && me.can_delete; },\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.delete_doc(me.doctype, node.label, function() {\n\t\t\t\t\t\tnode.parent.remove();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t}\n\t\t]\n\n\t\tif(this.opts.toolbar && this.opts.extend_toolbar) {\n\t\t\ttoolbar = toolbar.filter(btn => {\n\t\t\t\treturn !me.opts.toolbar.find(d => d[\"label\"]==btn[\"label\"]);\n\t\t\t});\n\t\t\treturn toolbar.concat(this.opts.toolbar)\n\t\t} else if (this.opts.toolbar && !this.opts.extend_toolbar) {\n\t\t\treturn this.opts.toolbar\n\t\t} else {\n\t\t\treturn toolbar\n\t\t}\n\t},\n\tnew_node: function() {\n\t\tvar me = this;\n\t\tvar node = me.tree.get_selected_node();\n\n\t\tif(!(node && node.expandable)) {\n\t\t\tfrappe.msgprint(__(\"Select a group node first.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepare_fields();\n\n\t\t// the dialog\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('New {0}',[__(me.doctype)]),\n\t\t\tfields: me.fields\n\t\t});\n\n\t\tvar args = $.extend({}, me.args);\n\t\targs[\"parent_\"+me.doctype.toLowerCase().replace(/ /g,'_')] = me.args[\"parent\"];\n\n\t\td.set_value(\"is_group\", 0);\n\t\td.set_values(args);\n\n\t\t// create\n\t\td.set_primary_action(__(\"Create New\"), function() {\n\t\t\tvar btn = this;\n\t\t\tvar v = d.get_values();\n\t\t\tif(!v) return;\n\n\t\t\tv.parent = node.label;\n\t\t\tv.doctype = me.doctype;\n\n\t\t\tif(node.is_root){\n\t\t\t\tv['is_root'] = node.is_root;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tv['is_root'] = false;\n\t\t\t}\n\n\t\t\td.hide();\n\t\t\tfrappe.dom.freeze(__('Creating {0}', [me.doctype]));\n\n\t\t\t$.extend(args, v)\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: me.opts.add_tree_node || \"frappe.desk.treeview.add_node\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(node.expanded) {\n\t\t\t\t\t\t\tme.tree.toggle_node(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.tree.load_children(node, true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\td.show();\n\t},\n\tprepare_fields: function(){\n\t\tvar me = this;\n\n\t\tthis.fields = [\n\t\t\t{fieldtype:'Check', fieldname:'is_group', label:__('Group Node'),\n\t\t\t\tdescription: __(\"Further nodes can be only created under 'Group' type nodes\")}\n\t\t]\n\n\t\tif (this.opts.fields) {\n\t\t\tthis.fields = this.opts.fields;\n\t\t}\n\n\t\tthis.ignore_fields = this.opts.ignore_fields || [];\n\n\t\tvar mandatory_fields = $.map(me.opts.meta.fields, function(d) {\n\t\t\treturn (d.reqd || d.bold && !d.read_only) ? d : null });\n\n\t\tvar opts_field_names = this.fields.map(function(d) {\n\t\t\treturn d.fieldname\n\t\t})\n\n\t\tmandatory_fields.map(function(d) {\n\t\t\tif($.inArray(d.fieldname, me.ignore_fields) === -1 && $.inArray(d.fieldname, opts_field_names) === -1) {\n\t\t\t\tme.fields.push(d)\n\t\t\t}\n\t\t})\n\t},\n\tprint_tree: function() {\n\t\tif(!frappe.model.can_print(this.doctype)) {\n\t\t\tfrappe.msgprint(__(\"You are not allowed to print this report\"));\n\t\t\treturn false;\n\t\t}\n\t\tvar tree = $(\".tree:visible\").html();\n\t\tvar me = this;\n\t\tfrappe.ui.get_print_settings(false, function(print_settings) {\n\t\t\tvar title =  __(me.docname || me.doctype);\n\t\t\tfrappe.render_tree({title: title, tree: tree, print_settings:print_settings});\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.core.doctype.access_log.access_log.make_access_log\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\treport_name: me.page_name,\n\t\t\t\t\tpage: tree,\n\t\t\t\t\tmethod: 'Print'\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_primary_action: function() {\n\t\tvar me = this;\n\t\tif (!this.opts.disable_add_node && this.can_create) {\n\t\t\tme.page.set_primary_action(__(\"New\"), function() {\n\t\t\t\tme.new_node();\n\t\t\t}, \"add\");\n\t\t}\n\t},\n\tset_menu_item: function() {\n\t\tvar me = this;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __('View List'),\n\t\t\t\taction: function() {\n\t\t\t\t\tfrappe.set_route('List', me.doctype);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.print_tree();\n\t\t\t\t}\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Refresh'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (frappe.user.has_role('System Manager')) {\n\t\t\tthis.menu_items.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Rebuild Tree'),\n\t\t\t\t\taction: function() {\n\t\t\t\t\t\tme.rebuild_tree();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif (me.opts.menu_items) {\n\t\t\tme.menu_items.push.apply(me.menu_items, me.opts.menu_items)\n\t\t}\n\n\t\t$.each(me.menu_items, function(i, menu_item){\n\t\t\tvar has_perm = true;\n\t\t\tif(menu_item[\"condition\"]) {\n\t\t\t\thas_perm = eval(menu_item[\"condition\"]);\n\t\t\t}\n\n\t\t\tif (has_perm) {\n\t\t\t\tme.page.add_menu_item(menu_item[\"label\"], menu_item[\"action\"]);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\n\n\n\n\n\n\n"],"names":["frappe","has_indicator","doctype","model","is_submittable","listview_settings","get_indicator","workflow","get_state_fieldname","meta","has_field","doc","__unsaved","__","workflows","without_workflow","settings","workflow_fieldname","value","colour","locals","style","Success","Warning","Danger","Primary","Inverse","Info","docstatus","has_indicator_for_draft","has_indicator_for_cancelled","indicator","status","utils","guess_colour","enabled","disabled","ui","Filter","[object Object]","opts","$","extend","this","undefined","filter_utils","set_conditions","set_conditions_from_config","make","conditions","nested_set_conditions","push","invalid_condition_map","Date","Datetime","Data","Select","Link","Currency","Color","Check","map","c","filter","boot","additional_filters_config","filters_config","Object","keys","let","key","label","fieldtype","valid_for_fieldtypes","includes","filter_edit_area","render_template","parent","appendTo","find","make_select","set_events","setup","fieldselect","FieldSelect","parent_doctype","filter_fields","input_class","select","fieldname","set_field","set_value","on","remove","on_change","change","field","condition","get_condition","add_condition_help","empty","df","const","set_values","is_new","promise","Promise","resolve","addClass","update_filter_tag","hidden","then","$filter_tag","hide","_filter_value_set","set_filter_button_text","make_tag","original_type","set_condition","Array","isArray","join","trim","cur","k","original_docfield","fields_by_name","console","warn","copy_dict","read_only","is_filter","hidden_due_to_dependency","get_default_condition","set_fieldtype","options","selected_doctype","selected_fieldname","args","depends_on","field_name","filter_value","filter_list","get_filter_value","xcall","get_field","make_field","old_fieldtype","old_text","get_value","hide_invalid_conditions","toggle_nested_set_conditions","field_area","get","f","form","make_control","only_input","refresh","bind_filter_field_events","$input","wrapper","keydown","e","which","get_selected_value","description","html","val","trigger_change","$condition_field","get_filter_tag_element","insertAfter","bind_tag","bind","filter_button","closest","show","toggle","get_filter_button_text","get_formatted_value","icon","invalid_conditions","show_condition","nested_set_doctypes","forEach","0","1","2","cint","format","only_value","strip","indexOf","startsWith","endsWith","in_list","split","v","reqd","ignore_link_validation","toLowerCase","get_timespan_options","periods","period_map","Last","This","Next","period","p","FilterGroup","filters","window","fltr","make_popover","append","get_filter_area_template","set_filter_events","init_filter_popover","set_popover_events","popover","content","template","trigger","container","placement","offset","document","body","is","in_datepicker","target","length","parents","hide_empty_filters","toggle_empty_filters","add_filters_to_popover","add_filter","apply","router","update_filters","filters_applied","button_label","toggleClass","clear_filters","promises","run_serially","validate_args","is_new_filter","arguments","push_new_filter","std_fields_list","msgprint","message","bold","filter_exists","_push_new_filter","index","update","filter_items","base_list","exists","f_value","equal","arrays_equal","slice","update_filter_button","get_filters","reduce","acc","assign","from","set_standard_filter","non_standard_filters","add_filters","list_view","Class","init","me","select_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","item","repl","data","originalEvent","text","get_item","modal","removeClass","i","add_field_option","build_options","clear","parts","each","table_fields","std_filters","std_fields","d","doctype_obj","istable","concat","with_blank","main_table_fields","docfield_list","sort","perm","has_perm","permlevel","report_hide","table_df","child_table_fields","link_field","get_docfields","table","no_value_type","Tags","tagsList","onTagAdd","onTagRemove","onTagClick","onChange","placeholder","$ul","$inputWrapper","get_list_element","$placeholder","deactivate","select_tag","tagValue","xss_sanitise","addTag","keypress","keyCode","focusout","activate","focus","addTags","$tag","get_tag","insertBefore","splice","labels","$element","class_name","$li","get_data_pill","pill_wrapper","removeTag","TagEditor","setup_tags","user_tags","initialized","tags","tag","refreshing","call","method","get_args","callback","r","fetch_tags","setup_awesomplete","setup_complete","input","attr","frm","txt","dt","dn","docname","clearTags","setTimeout","is_liked","get_liked_by","session","user","liked","_liked_by","JSON","parse","toggle_like","$btn","name","add","hasClass","css","quiet","exc","action_buttons","replace","liked_by","idx","stringify","click_toggle_like","$count","siblings","not_liked","setup_like_popover","$parent","selector","check_not_liked","dom","is_touchscreen","target_element","animation","decodeURI","liked_by_list","avatar","full_name","children","click","ev","currentTarget","dataset","set_route","provide","views","BaseList","before_refresh","init_promise","tasks","setup_defaults","set_stats","setup_fields","setup_page","setup_side_bar","setup_main_section","setup_view","setup_view_menu","fn","page_name","get_route_str","page_title","doctype_layout","get_meta","user_settings","get_user_settings","start","page_length","can_create","can_write","fields","sort_by","sort_order","primary_action","secondary_action","menu_items","action","class","set_fields","build_fields","title_field","_add_field","is_value_type","in_list_view","Boolean","uniqBy","stats","workflow_state_fieldname","page","$page","main","page_form","hide_page_form","hide_sidebar","setup_page_head","set_title","set_menu_items","set_breadcrumbs","icon_map","Image","List","Report","Calendar","Gantt","Kanban","Dashboard","Map","desk_settings","view_switcher","views_menu","add_custom_button_group","view_name","views_list","ListViewSelect","sidebar","list_sidebar","$secondary_action","set_secondary_action","refresh_button","add_action_icon","set_default_secondary_action","$item","add_menu_item","standard","shortcut","breadcrumbs","module","ListSidebar","show_sidebar","localStorage","show_or_hide_sidebar","setup_list_wrapper","setup_filter_area","setup_sort_selector","setup_result_area","setup_no_result_area","setup_freeze_area","setup_paging_area","$frappe_list","hide_filters","filter_area","FilterArea","set","hide_sort_selector","sort_selector","SortSelector","$filter_section","onchange","on_sort_change","$result","$no_result","get_no_result_message","$freeze","$paging_area","$this","get_full_column_name","get_filters_for_args","like","not set","nested_filters","or_filter","n","get_fields","or_filters","get_or_filters_for_args","order_by","get_sql_string","view","freeze","freeze_on_refresh","freeze_message","get_call_args","prepare_data","toggle_result_area","before_render","render","after_render","dict","values","show_more","names","get_checked_items","custom_actions","$filter_list_wrapper","trigger_refresh","make_standard_filters","make_filter_list","standard_filters","get_standard_filters","on_filter_change","fields_dict","out","get_filter","standard_filters_wrapper","context","refresh_list_view","custom_filter_configs","config","doctype_fields","standard_filter_fields","in_standard_filter","unshift","default_value","defaults","get_user_default","default","add_field","default_filters","view_modes","is_valid","view_mode","BulkOperations","throw","docs","print_settings","get_doc","allow_print_for_draft","allow_print_for_cancelled","valid_docs","has_role","dialog","Dialog","title","get_print_formats","set_primary_action","default_print_format","with_letterhead","print_format","print_sel","json_string","open","encodeURIComponent","docnames","done","items","failed","_server_messages","play_sound","assign_to","AssignToDialog","obj","bulk_assign","re_assign","field_mappings","field_options","status_regex","default_field","test","a","b","nameA","toUpperCase","nameB","set_value_field","disable_primary_action","enable_primary_action","primary_action_label","dialogObj","new_df","match","replace_field","get_data","db","get_link_options","get_values","set_message","ListSettings","listview","subject_field","with_doctype","get_listview_fields","setup_remove_fields","add_new_fields","show_dialog","list_view_settings","show_alert","removed_listview_fields","removed_fields","refresh_columns","update_fields","field_count","fields_html","$wrapper","total_fields","parseInt","is_sortable","show_sortable_handle","can_remove","Sortable","getElementsByClassName","handle","draggable","onUpdate","onclick","column_selector","remove_fields","getAttribute","existing_fields","set_removed_fields","get_removed_listview_fields","fields_order","reset_listview_fields","get_doctype_fields","columns","set_subject_field","set_status_field","get_docfield","set_list_view_fields","type","multiselect_fields","checked","new_fields","column","ListView","get_route","get_sub_path_string","last_view","super","disable_scroll_to_top","has_permissions","view_user_settings","saved_filters","validate_filters","get_menu_items","toggle_paging","patch_refresh_and_load_lib","get_list_view_settings","valid_fields","set_actions_menu_items","actions_menu_items","get_actions_menu_items","workflow_action_menu_items","get_workflow_action_menu_items","workflow_action_items","add_actions_menu_item","is_workflow_action","match_rules_list","get_match_rules","restricted_list","show_restrictions","condition_list","get_fields_in_list_view","image_field","add_fields","track_seen","throttle","load_lib","required_libs","require","setInterval","make_new_doc","clear_primary_action","is_non_std_field","new_doc","setup_columns","render_header","render_skeleton","setup_events","onload","show_restricted_list_indicator_if_applicable","refresh_header","get_df","fields_in_list_view","reorder_listview_fields","innerWidth","hide_name_column","fld","col","documentation","help_link","get_documentation_link","no_result_message","new_button_label","empty_state_image","disable_count","with_comment_count","route_options","parse_filters_from_route_options","toggle_actions_menu_button","show_actions_menu","toggle_workflow_actions","hide_actions_menu","prepend","get_header_html","$row","get_list_row_html_skeleton","save","save_view_user_settings","setup_new_doc_event","reload_stats","render_list","on_row_checked","render_count","_idx","get_list_row_html","get_count_str","str","subject_html","$columns","is_numeric_field","get_header_html_skeleton","left","right","get_column_html","get_meta_html","get_left_html","get_right_html","get_indicator_html","tags_shown","_user_tags","get_tags_html","_value","css_class","Subject","Field","column_html","get_subject_html","fetch_from","strip_html","escape_html","Math","round","formatters","limit","colored","color","get_palette","settings_button","button","get_description","get_label","modified","comment_when","assigned_to","assigned_users","_assign","avatar_group","filterable","_comment_count","get_indicator_dot","current_count","count_without_children","count","total_count","get_form_link","slug","_seen","encodeURI","u","user_info","fullname","formatter","subject","toString","escaped_subject","seen","get_seen_class","escape","get_like_html","url","image","cordova","is_url","base_url","setup_filterable","setup_list_click","setup_tag_event","setup_check_events","setup_like","setup_realtime_updates","setup_action_handler","setup_keyboard_navigation","focus_next","activeElement","next","focus_prev","prev","check_row","get_list_row_if_focused","is_current_page","is_input_focused","handle_navigation","direction","add_shortcut","$list_row","metaKey","ctrlKey","stopPropagation","filters_to_apply","datetime","get_today","$target","$check","prop","preventDefault","link","pathname","$button","shiftKey","$checkbox_cursor","name_1","name_2","findIndex","min_index","max_index","toggle_tags","disable_auto_refresh","realtime","is_being_edited","call_args","datum","a_value","b_value","return_value","$checks","set_rows_as_checked","el","$list_head_subject","$checkbox_actions","preview_label","only_docnames","check","cstr","unescape","query_params","full_url","location","href","get_share_url","can_import","reference_doctype","can_set_user_permissions","allow","user_roles","custom","doc_type","toggle_side_bar","share_url","developer_mode","show_list_settings","workflow_actions","has_workflow","get_all_transition_actions","checked_items","actions","bulk_operations","is_field_editable","field_doc","some","has_editable_fields","edit","apply_assignment_rule","add_tags","can_print","print","has_submit_permission","confirm","submit_or_cancel","can_cancel","can_delete","delete","value_array","get_doctype_for_field","j","trees","tree","on_update","event","trigger_list_update","get_list_view","route","cur_list","ListFactory","Factory","issingle","set_re_route","to_title_case","view_class","load_last_view","change_to","make_page","set_cur_list","re_route_to_view","set_module_breadcrumb","last_route","route_history","history","go","prev_route","module_links","set_doctype_module","set_current_view","setup_views","add_custom_menu_item","current_view","kanban_board","email_account","calendar_name","current_view_handler","reports","get_reports","default_action","setup_dropdown_in_sidebar","calendar","get_calendars","calendars","Inbox","email_accounts","accounts","get_email_accounts","has_common","Tree","treeview_settings","is_tree","setup_kanban_boards","KanbanView","get_kanbans","kanbans","setup_kanban_switcher","add_view_to_menu","views_wrapper","$dropdown","get_page_name","kanban_switcher","show_kanban_dialog","added","reports_to_add","add_reports","ref_doctype","report_type","all_reports","localeCompare","last_opened_kanban","last_kanban_board","get_list","result","accounts_to_add","account","email_id","display_name","ListFilter","can_add_global","$input_area","$list_filters","$saved_filters","saved_filters_hidden","filter_input","render_input","is_global_input","bind_save_filter","bind_toggle_saved_filters","bind_click_filter","bind_remove_filter","get_list_filters","filter_template","set_description","toggle_saved_filters","$filter","set_applied_filter","get_filters_values","applied_filters","remove_filter","remove_filters","debounce","has_value","filter_name_exists","save_filter","help_text","filter_name","insert","for_user","get_current_filters","delete_doc","sidebar_content","setup_list_filter","setup_list_group_by","disable_sidebar_stats","list_group_by","ListGroupBy","list_filter","render_stat","stats_dropdown","setup_search","tag_list","existing","get_stats","make_wrapper","group_by_fields","render_group_by_items","make_group_by_fields_modal","setup_dropdown","setup_filter_by","get_group_by_dropdown_fields","$body","docfield","set_loading_state","get_group_by_count","field_count_list","applied_filter","render_dropdown_items","set_empty_state","current_filters","f_arr","field_counts","current_user","standard_html","applied_filter_html","dropdown_items_html","get_dropdown_html","dropdown_html","applied","is_selected","decodeURIComponent","apply_filter","operator","GanttView","calendar_settings","gantt","field_map","prepare_tasks","progress","isFunction","end","id","dependencies","depends_on_tasks","validate_hex","substr","is_milestone","render_gantt","gantt_view_mode","date_format","bar_height","bar_corner_radius","resize_handle_width","resize_handle_height","resize_handle_corner_radius","resize_handle_offset","on_click","task","on_date_change","moment","on_progress_change","progress_fieldname","on_view_change","mode","custom_popup_html","_start","_end","gantt_custom_popup_html","setup_view_mode_buttons","set_colors","view_is","change_view_mode","t","custom_class","bar_color","get_contrast_color","extendStatics","setPrototypeOf","__proto__","hasOwnProperty","__extends","constructor","prototype","create","__assign","s","__spreadArrays","il","jl","o","l","parentNode","removeChild","defaultProps","h","ref","props","__k","__b","__e","__d","__c","__v","vnode","y","current","_","base","w","m","__r","debounceRendering","__P","T","__n","ownerSVGElement","g","A","P","x","I","H","appendChild","nextSibling","C","setProperty","cssText","addEventListener","N","removeEventListener","removeAttributeNS","setAttributeNS","removeAttribute","setAttribute","z","contextType","__E","L","sub","state","__h","__s","getDerivedStateFromProps","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","getChildContext","getSnapshotBeforeUpdate","diffed","nodeType","localName","createTextNode","createElementNS","createElement","childNodes","dangerouslySetInnerHTML","attributes","__html","innerHTML","unmount","componentWillUnmount","M","q","Consumer","Provider","flushToDom","oldDebounceRendering","preact.options","callbackQ","preact.render","preact.createElement","FakeComponent","shift","getDerivedStateFromError","setState","componentDidCatch","forceUpdate","globalThis","FullCalendarVDom","Component","preact.Component","createRef","preact.createRef","Fragment","preact.Fragment","createContext","_super","defaultValue","ContextType","preact.createContext","origProvider","_this","isNew","subs_1","_props","old","Error","EventSourceApi","internalEventSource","dispatch","sourceId","refetch","sourceIds","defineProperty","publicId","enumerable","configurable","removeElement","elementClosest","documentElement","contains","elementMatches","parentElement","matches","matchesSelector","msMatchesSelector","findElements","containers","HTMLElement","allMatches","querySelectorAll","PIXEL_PROP_RE","applyStyle","propName","applyStyleProp","buildDelegationHandler","handler","matchedChild","listenBySelector","eventType","attachedHandler","listenToHoverBySelector","onMouseEnter","onMouseLeave","currentMatchedChild","realOnMouseLeave_1","transitionEventNames","whenTransitionDone","realCallback","eventName","guidNumber","guid","String","disableCursor","classList","enableCursor","preventSelection","allowSelection","preventContextMenu","allowContextMenu","parseFieldSpecs","token","specs","tokens","charAt","substring","order","func","compareByFieldSpecs","obj0","obj1","fieldSpecs","cmp","compareByFieldSpec","fieldSpec","flexibleCompare","padStart","len","compareNumbers","isInt","computeSmallestCellWidth","cellEl","allWidthEl","querySelector","contentWidthEl","getBoundingClientRect","width","DAY_IDS","addWeeks","dateToUtcArray","arrayToUtcDate","addDays","addMs","diffWeeks","m0","m1","diffDays","valueOf","diffHours","diffMinutes","diffSeconds","diffDayAndTime","m0day","startOfDay","m1day","years","months","days","milliseconds","diffWholeWeeks","diffWholeDays","timeAsMs","getUTCFullYear","getUTCMonth","getUTCDate","startOfHour","getUTCHours","startOfMinute","getUTCMinutes","startOfSecond","getUTCSeconds","weekOfYear","marker","dow","doy","weekOfGivenYear","nextW","min","year","firstWeekStart","firstWeekOffset","dayStart","floor","fwd","getUTCDay","dateToLocalArray","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","arrayToLocalDate","getUTCMilliseconds","UTC","isValidDate","isNaN","createEventInstance","defId","range","forcedStartTzo","forcedEndTzo","instanceId","mergeProps","propObjs","complexPropsMap","dest","complexObjs","filterHash","hash","filtered","mapHash","newHash","arrayToHash","_i","a_1","hashValuesToArray","isPropsEqual","getUnequalProps","compareObjs","oldProps","newProps","equalityFuncs","isObjValsEqual","val0","val1","comparator","collectFromHash","startIndex","endIndex","step","res","parseRecurring","refined","defaultAllDay","dateEnv","recurringTypes","parsed","allDay","allDayGuess","duration","typeData","typeId","expandRecurring","eventStore","framingRange","pluginHooks","defs","instances","instance","recurringDef","def","defaultAllDayEventDuration","defaultTimedEventDuration","starts_1","expandRecurringRanges","eventDef","markers","expand","subtract","INTERNAL_UNITS","PARSE_RE","createDuration","unit","_a","parseString","parseObject","exec","sign","month","day","hours","hour","minutes","minute","seconds","second","millisecond","ms","weeks","week","specifiedWeeks","durationsEqual","d0","d1","addDurations","subtractDurations","multiplyDuration","asRoughYears","dur","asRoughDays","asRoughMonths","asRoughMs","wholeDivideDurations","numerator","denominator","localRes","greatestDurationDenominator","buildIsoString","timeZoneOffset","stripZeroTime","toISOString","formatTimeZoneOffset","formatDayString","formatIsoTimeString","doIso","abs","mins","isArraysEqual","a0","a1","equalityFunc","memoize","workerFunc","resEquality","teardownFunc","currentArgs","currentRes","newArgs","memoizeObjArg","currentArg","newArg","EXTENDED_SETTINGS_AND_SEVERITIES","separator","omitZeroMinute","meridiem","omitCommas","STANDARD_DATE_PROP_SEVERITIES","timeZoneName","era","weekday","MERIDIEM_RE","COMMA_RE","MULTI_SPACE_RE","LTR_RE","UTC_RE","NativeFormatter","formatSettings","standardDateProps","extendedSettings","severity","max","buildFormattingFunc","formatRange","betterDefaultSeparator","diffSeverity","computeMarkerDiffSeverity","calendarSystem","biggestUnitForPartial","full0","full1","partialFormattingFunc","computePartialFormattingOptions","partial0","partial1","insertion","findCommonInsertion","defaultSeparator","before","after","getLargestUnit","standardDatePropCnt","formatWeekNumber","computeWeekNumber","weekText","locale","buildNativeFormattingFunc","sanitizeSettings","timeZone","zeroFormat","normalFormat","Intl","DateTimeFormat","codes","zeroProps","postProcess","injectTzoStr","toLocaleLowerCase","tzoStr","replaced","num","display","simpleNumberFormat","reverse","ca","getMarkerYear","getMarkerMonth","getMarkerDay","biggestUnit","partialOptions","i0","found0","before0","after0","i1","found1","before1","after1","expandZonedMarker","dateInfo","markerToArray","array","createVerboseFormattingArg","startInfo","localeCodes","CmdFormatter","cmdStr","cmdFormatter","FuncFormatter","createFormatter","BASE_OPTION_REFINERS","navLinkDayClick","identity","navLinkWeekClick","bootstrapFontAwesome","buttonIcons","customButtons","nextDayThreshold","scrollTime","slotMinTime","slotMaxTime","dayPopoverFormat","slotDuration","snapDuration","headerToolbar","footerToolbar","defaultRangeSeparator","titleRangeSeparator","forceEventDuration","dayHeaders","dayHeaderFormat","dayHeaderClassNames","dayHeaderContent","dayHeaderDidMount","dayHeaderWillUnmount","dayCellClassNames","dayCellContent","dayCellDidMount","dayCellWillUnmount","initialView","aspectRatio","Number","weekends","weekNumberCalculation","weekNumbers","weekNumberClassNames","weekNumberContent","weekNumberDidMount","weekNumberWillUnmount","editable","viewClassNames","viewDidMount","viewWillUnmount","nowIndicator","nowIndicatorClassNames","nowIndicatorContent","nowIndicatorDidMount","nowIndicatorWillUnmount","showNonCurrentDates","lazyFetching","startParam","endParam","timeZoneParam","locales","themeSystem","dragRevertDuration","dragScroll","allDayMaintainDuration","unselectAuto","dropAccept","eventOrder","handleWindowResize","windowResizeDelay","longPressDelay","eventDragMinDistance","expandRows","height","contentHeight","weekNumberFormat","eventResizableFromStart","displayEventTime","displayEventEnd","progressiveEventRendering","businessHours","initialDate","now","eventDataTransform","stickyHeaderDates","stickyFooterScrollbar","viewHeight","eventSourceFailure","eventSourceSuccess","eventDisplay","eventStartEditable","eventDurationEditable","eventOverlap","eventConstraint","eventAllow","eventBackgroundColor","eventBorderColor","eventTextColor","eventColor","eventClassNames","eventContent","eventDidMount","eventWillUnmount","selectConstraint","selectOverlap","selectAllow","droppable","unselectCancel","slotLabelFormat","slotLaneClassNames","slotLaneContent","slotLaneDidMount","slotLaneWillUnmount","slotLabelClassNames","slotLabelContent","slotLabelDidMount","slotLabelWillUnmount","dayMaxEvents","dayMaxEventRows","dayMinWidth","slotLabelInterval","allDayText","allDayClassNames","allDayContent","allDayDidMount","allDayWillUnmount","slotMinWidth","navLinks","eventTimeFormat","rerenderDelay","moreLinkText","selectMinDistance","selectable","selectLongPressDelay","eventLongPressDelay","selectMirror","eventMinHeight","slotEventOverlap","plugins","firstDay","dayCount","dateAlignment","dateIncrement","hiddenDays","monthMode","fixedWeekCount","validRange","visibleRange","titleFormat","noEventsText","BASE_OPTION_DEFAULTS","center","CALENDAR_LISTENER_REFINERS","datesSet","eventsSet","eventAdd","eventChange","eventRemove","windowResize","eventClick","eventMouseEnter","eventMouseLeave","unselect","loading","_unmount","_beforeprint","_afterprint","_noEventDrop","_noEventResize","_resize","_scrollRequest","CALENDAR_OPTION_REFINERS","buttonText","initialEvents","events","eventSources","COMPLEX_OPTION_COMPARATORS","isBoolComplexEqual","VIEW_OPTION_REFINERS","component","buttonTextKey","dateProfileGeneratorClass","usesMinMaxTime","classNames","didMount","willUnmount","mergeRawOptions","optionSets","refineProps","refiners","extra","raw","parseEvents","rawEvents","eventSource","allowOpenRange","createEmptyEventStore","eventRefiners","buildEventRefiners","rawEvents_1","tuple","parseEvent","eventTupleToStore","getRelevantEvents","def_1","newStore","filterEventStoreDefs","lookDef","isEventDefsGrouped","def0","def1","groupId","mergeEventStores","store0","store1","filterFunc","excludeSubEventStore","master","filteredDefs","filteredInstances","normalizeConstraint","parseClassNames","EVENT_UI_REFINERS","startEditable","durationEditable","constraint","overlap","className","backgroundColor","borderColor","textColor","createEventUi","constraints","allows","combineEventUis","uis","combineTwoEventUis","EMPTY_EVENT_UI","item0","item1","EVENT_NON_DATE_REFINERS","EVENT_DATE_REFINERS","EVENT_REFINERS","extendedProps","refineEventDef","computeIsDefaultAllDay","recurringRes","parseEventDef","singleRes","parseSingle","hasEnd","eventDefMemberAdders","memberAdder","startMeta","endMeta","startMarker","endMarker","startInput","createMarkerMeta","isTimeUnspecified","forcedTzo","computeAlignedDayRange","timedRange","dayCnt","computeVisibleDayRange","startDay","endDay","endTimeMS","diffDates","date0","date1","largeUnit","diffWholeYears","diffWholeMonths","parseRange","createMarker","invertRanges","ranges","constraintRange","dateRange","invertedRanges","compareRanges","range0","range1","intersectRanges","newRange","rangesEqual","rangesIntersect","rangeContainsRange","outerRange","innerRange","rangeContainsMarker","constrainMarkerToRange","sliceEventStore","eventUiBases","inverseBgByGroupId","inverseBgByDefId","defByGroupId","bgRanges","fgRanges","eventUis","compileEventUis","origRange","normalRange","slicedRange","isStart","isEnd","invertedRanges_1","invertedRange","invertedRanges_2","bg","fg","hasBgRendering","setElSeg","seg","fcSeg","getElSeg","eventDefs","compileEventUi","sortEventSegs","segs","eventOrderSpecs","objs","buildSegCompareObj","_seg","eventRange","computeSegDraggable","transformers","isDraggableTransformers","transformers_1","transformer","computeSegStartResizable","computeSegEndResizable","buildSegTimeText","timeFormat","defaultDisplayEventTime","defaultDisplayEventEnd","startOverride","endOverride","eventInstance","segStart","segEnd","getSegMeta","todayRange","nowDate","segRange","isPast","isFuture","isToday","getEventClassNames","isMirror","isDraggable","isStartResizable","isEndResizable","isDragging","isResizing","isSelected","buildEventRangeKey","STANDARD_PROPS","parseDateSpan","defaultDuration","span","parseOpenDateSpan","standardProps","isDateSpansEqual","span0","span1","isSpanPropsEqual","buildDateSpanApi","buildRangeApi","buildRangeApiWithTimeZone","omitTime","toDate","startStr","formatIso","endStr","fabricateEventRange","dateSpan","triggerDateSelect","selection","pev","emitter","buildDateSpanApiWithContext","jsEvent","origEvent","viewApi","calendarApi","triggerDateUnselect","dateSpanTransforms","transform","getDefaultEventEnd","applyMutationToEventStore","eventConfigBase","mutation","eventConfigs","applyMutationToEventDef","applyMutationToEventInstance","eventConfig","startDelta","endDelta","copy","eventDefMutationAppliers","applier","forceAllDay","clearEnd","datesDelta","ViewApi","getCurrentData","viewTitle","dateProfile","activeRange","currentRange","getOption","EVENT_SOURCE_REFINERS","success","failure","parseEventSource","rawObj","buildEventSourceRefiners","metaRes","buildEventSourceMeta","_raw","isFetching","latestFetchId","fetchRange","sourceDefId","eventSourceRefiners","eventSourceDefs","parseMeta","reduceCurrentDate","currentDate","dateMarker","getInitialDate","initialDateInput","getNow","nowInput","createNowMarker","CalendarApi","currentDataManager","batchRendering","updateSize","setOption","optionName","rawOptionValue","currentCalendarOptionsInput","getAvailableLocaleCodes","availableRawLocales","handlerName","currentCalendarOptionsRefiners","off","changeView","viewType","dateOrRange","zoomTo","spec","viewSpecs","getUnitViewSpec","toolbarConfig","viewTypes","viewsWithButtons","singleUnit","prevYear","addYears","nextYear","today","calendarOptions","gotoDate","zonedDateInput","incrementDate","deltaInput","delta","formatDate","dateOrObj","endDate","selectionInput","dateSelection","addEvent","eventInput","sourceInput","EventApi","_def","_instance","triggerEventAdd","sourceApi","getEventSourceById","newEventApi","eventApi","relatedEvents","revert","eventApiToStore","getEventById","getEvents","currentData","buildEventApis","removeAllEvents","getEventSources","sourceHash","sourceApis","internalId","addEventSource","sources","removeAllEventSources","refetchEvents","scrollToTime","timeInput","time","_context","setProp","_b","mutate","setExtendedProp","setStart","granularity","maintainDuration","setEnd","endInput","setDates","instanceRange","moveStart","moveEnd","moveDates","setAllDay","formatInput","context_1","relevantEvents_1","oldEvent","asStore","toPlainObject","collapseColor","collapseExtendedProps","toJSON","excludeInstance","eventApis","excludeInstanceId","calendarSystemClassMap","registerCalendarSystem","theClass","createCalendarSystem","GregorianCalendarSystem","arrayToMarker","arr","ISO_RE","DateEnv","isNamedTimeZone","namedTimeZoneImpl","canComputeOffset","weekDow","weekDoy","weekNumberFunc","timestampToMarker","getYear","addMonths","greatestWholeUnit","countDurationsBetween","diff","startOf","startOfYear","startOfMonth","startOfWeek","dateOptions","offsetForMarker","isEndExclusive","extraOptions","omitTimeZoneOffset","timestampToArray","getTimezoneOffset","offsetForArray","globalLocales","RAW_EN_LOCALE","code","organizeRawLocales","explicitRawLocales","defaultCode","allRawLocales","rawLocaleMap","en","allRawLocales_1","rawLocale","buildLocale","inputSingular","available","queryLocale","parseLocale","codeArg","queryRawLocale","simpleId","merged","NumberFormat","DEF_DEFAULTS","startTime","endTime","daysOfWeek","canVGrowWithinCell","parseBusinessHours","refineInputs","rawDef","pointInsideRect","point","rect","top","bottom","intersectRects","rect1","rect2","constrainPoint","getRectCenter","diffPoints","point1","point2","getCanVGrowWithinCell","computeCanVGrowWithinCell","position","possible","offsetHeight","EMPTY_EVENT_STORE","Splitter","getKeysForEventDefs","_getKeysForEventDefs","splitDateSelection","_splitDateSpan","splitEventStore","_splitEventStore","splitIndividualUi","_splitIndividualUi","splitEventDrag","_splitInteraction","splitEventResize","eventUiBuilders","splitProps","keyInfos","getKeyInfo","defKeys","dateSelections","individualUi","eventStores","eventDrags","eventDrag","eventResizes","eventResize","info","buildEventUiForKey","keyInfo","buildEventUi","eventSelection","dateSpans","keys_1","getKeysForDateSpan","getKeysForEventDef","splitStores","_c","splitHashes","interaction","splitStates","affectedStores_1","affectedEvents","mutatedKeysByDefId","mutatedEvents","mutatedStores_1","populate","isEvent","allUi","eventUiForKey","baseParts","stuff","getDateMeta","isDisabled","isOther","getDayClassNames","theme","getClass","buildNavLinkData","_isRtlScrollbarOnLeft","_scrollbarWidths","getIsRtlScrollbarOnLeft","computeIsRtlScrollbarOnLeft","outerEl","border","padding","overflow","firstChild","getScrollbarWidths","computeScrollbarWidths","computeScrollbarWidthsForEl","clientHeight","offsetWidth","clientWidth","computeEdges","getPadding","computedStyle","getComputedStyle","borderLeft","borderLeftWidth","borderRight","borderRightWidth","borderTop","borderTopWidth","borderBottom","borderBottomWidth","badScrollbarWidths","scrollbarLeftRight","scrollbarBottom","scrollbarLeft","scrollbarRight","paddingLeft","paddingRight","paddingTop","paddingBottom","computeInnerRect","goWithinPadding","doFromWindowViewport","outerRect","computeRect","edges","pageXOffset","pageYOffset","getClippingParents","overflowY","overflowX","unpromisify","isResolved","wrappedSuccess","wrappedFailure","Emitter","handlers","thisContext","setThisContext","setOptions","addToHash","removeFromHash","attachedHandlers","optionHandler","handlers_1","hasHandlers","PositionCache","originEl","els","isHorizontal","isVertical","originClientRect","buildElHorizontals","buildElVerticals","originClientLeft","lefts","rights","originClientTop","tops","bottoms","leftToIndex","leftPosition","topToIndex","topPosition","getWidth","leftIndex","getHeight","topIndex","ScrollController","getMaxScrollTop","getScrollHeight","getClientHeight","getMaxScrollLeft","getScrollWidth","getClientWidth","canScrollVertically","canScrollHorizontally","canScrollUp","getScrollTop","canScrollDown","canScrollLeft","getScrollLeft","canScrollRight","ElementScrollController","scrollTop","scrollLeft","setScrollTop","setScrollLeft","scrollWidth","scrollHeight","WindowScrollController","scroll","Theme","iconOverrideOption","setIconOverride","iconOverrideHash","iconClassesCopy","buttonName","iconClasses","applyIconOverridePrefix","prefix","iconOverridePrefix","classes","getIconClass","isRtl","rtlIconClasses","baseIconClass","getCustomButtonIconClass","customButtonProps","iconOverrideCustomButtonOption","ScrollResponder","execFunc","handleScrollRequest","request","queuedRequest","drain","fireInitialScroll","detach","isDatesNew","ViewContextType","buildViewContext","viewSpec","viewOptions","dateProfileGenerator","registerInteractiveComponent","unregisterInteractiveComponent","addResizeHandler","removeResizeHandler","createScrollResponder","PureComponent","nextProps","nextState","debug","log","propEquality","stateEquality","addPropsEquality","addStateEquality","BaseComponent","setRef","reduceEventStore","receiveRawEvents","fetchId","excludeEventsBySourceId","subset","transformRawEvents","calEachTransform","sourceEachTransform","transformEachRawEvent","refinedEvents","rawEvent","refinedEvent","expandRange","rezoneEventStoreDates","oldDateEnv","newDateEnv","excludeInstances","removals","isInteractionValid","isNewPropsValid","isDateSelectionValid","calendarState","isPropsValid","dateSpanMeta","filterConfig","isInteractionPropsValid","isDateSelectionPropsValid","currentState","subjectEventStore","subjectDefs","subjectInstances","subjectConfigs","selectionConfig","otherEventStore","otherDefs","otherInstances","otherConfigs","subjectInstanceId","subjectInstance","subjectRange","subjectConfig","subjectDef","allConstraintsPass","eventOverlapFunc","otherInstanceId","otherInstance","calendarEventStore","subjectAllow","subjectDateSpan","origDef","origInstance","relevantEventStore","relevantDefs","relevantInstances","selectionRange","selectOverlapFunc","relevantInstanceId","relevantInstance","selectionAllow","businessHoursUnexpanded","constraints_1","anyRangesContainRange","constraintToRanges","eventStoreToRanges","outerRanges","outerRanges_1","DateComponent","uid","prepareHits","queryHit","positionLeft","positionTop","elWidth","elHeight","isValidSegDownEl","isPopover","isInPopover","isValidDateDownEl","createPlugin","deps","reducers","contextInit","eventDragMutationMassagers","dateSelectionTransformers","datePointTransforms","viewPropsTransformers","externalDefTransforms","eventResizeJoinTransforms","viewContainerAppends","eventDropTransformers","componentInteractions","calendarInteractions","themeClasses","namedTimeZonedImpl","elementDraggingImpl","optionChangeHandlers","scrollGridImpl","contentTypeHandlers","listenerRefiners","optionRefiners","propSetHandlers","buildPluginHooks","pluginDefs","globalDefs","isAdded","hooks","addDefs","defs_1","combineHooks","buildBuildPluginHooks","currentHooks","currentOverrideDefs","currentGlobalDefs","overrideDefs","hooks0","hooks1","StandardTheme","compileViewDefs","defaultConfigs","overrideConfigs","ensureViewDef","viewDef","buildViewDef","defaultConfig","overrideConfig","queryProp","theComponent","superType","superDef","rawOptions","overrides","root","tableCellShaded","buttonGroup","buttonActive","close","RenderHook","rootElRef","handleRootEl","elRef","hookProps","MountHook","ContentHook","defaultContent","backupElRef","innerElRef","innerContent","normalizeClassNames","CustomContentRenderContext","renderId","ContentHookInner","renderInnerContent","updateCustomContent","customContentInfo","normalizeContent","innerContentVDom","contentVal","contentKey","rootEl","buildClassNameNormalizer","currentGenerator","currentHookProps","currentClassNames","generator","ViewRoot","customClassNames","parseViewConfigs","inputs","parseViewConfig","createViewHookComponent","viewProps","buildViewSpecs","defaultInputs","optionOverrides","dynamicOptionOverrides","localeDefaults","buildViewSpec","durationInput","durationUnit","singleUnitOverrides","createDurationCached","denom","queryButtonText","optionsSubset","buttonTextMap","optionDefaults","buttonTextOverride","buttonTextDefault","durationInputMap","json","DateProfileGenerator","initHiddenDays","buildPrev","currentDateProfile","forceToValid","prevDate","currentRangeUnit","build","buildNext","nextDate","currentInfo","isRangeAllDay","renderRange","isValid","buildValidRange","trimHiddenDays","buildCurrentRangeInfo","buildRenderRange","adjustActiveRange","buildDateIncrement","validRangeInput","simpleInput","refineRange","buildRangeFromDuration","buildRangeFromDayCount","buildCustomVisibleRange","getFallbackDuration","computeRes","isHiddenDay","skipHiddenDays","runningCount","visibleRangeInput","fallback","customAlignment","rangeInput","isHiddenDayHash","inc","isExclusive","reduceViewType","reduceDynamicOptionOverrides","reduceDateProfile","dp","initEventSources","addSources","parseInitialSources","reduceEventSources","removeSource","fetchDirtySources","fetchSourcesByIds","excludeStaticSources","receiveResponse","reduceEventSourcesNewTimeZone","computeEventSourceLoadingLevel","cnt","eventSourceHash","sources_1","source","isSourceDirty","doesSourceNeedRange","prevSources","sourceIdHash","nextSources","fetchSource","sourceDef","fetch","xhr","error","rawSources","rawSources_1","ignoreRange","reduceDateSelection","currentSelection","reduceSelectedEvent","currentInstanceId","eventInstanceId","reduceEventDrag","currentDrag","newDrag","reduceEventResize","currentResize","newResize","parseToolbars","calendarOptionOverrides","parseToolbar","sectionStrHash","sectionStr","parseSection","calendarCustomButtons","calendarButtonTextOverrides","calendarButtonText","buttonGroupStr","customButtonProps_1","buttonClick","buttonIcon","eventSourceDef","arg","arrayEventSourcePlugin","eventSourceDef$1","funcEventSourcePlugin","requestJson","params","successCallback","failureCallback","injectQueryStringParams","encodeParams","XMLHttpRequest","setRequestHeader","responseText","err","onerror","send","JSON_FEED_EVENT_SOURCE_REFINERS","extraParams","eventSourceDef$2","requestParams","buildRequestParams","errorMessage","jsonFeedEventSourcePlugin","customRequestParams","SIMPLE_RECURRING_REFINERS","startRecur","endRecur","recurring","recurringData","clippedFramingRange","expandRanges","simpleRecurringEventsPlugin","dowHash","dayMarker","instanceStarts","instanceStart","changeHandlerPlugin","handleEventSources","unfoundSources","newInputs","inputs_1","inputFound","unfoundSources_1","unfoundSource","newInputs_1","newInput","handleDateProfile","handleEventStore","globalPlugins","injectHtml","domNodes","injectDomNodes","oldNodes","newNodes","newNodes_1","newNode","DelayedRunner","drainedOption","isRunning","isDirty","pauseDepths","timeoutId","delay","isPaused","clearTimeout","tryDrain","pause","scope","resume","force","drained","TaskRunner","runTaskOption","queue","delayedRunner","completedTasks","runTask","buildTitle","buildTitleFormat","CalendarDataManager","computeOptionsData","_computeOptionsData","computeCurrentViewData","_computeCurrentViewData","buildDateEnv","buildDateEnv$1","buildTheme","buildDateProfileGenerator","buildViewApi","buildViewUiProps","buildEventUiBySource","buildEventUiBases","parseContextBusinessHours","actionRunner","_handleAction","updateData","currentCalendarOptionsRefined","currentViewOptionsInput","currentViewOptionsRefined","optionsData","currentViewType","currentViewData","calendarContext","initialState","loadingLevel","renderableEventStore","contextAndState","reducer","resetOptions","eventSourceLoadingLevel","eventUiSingleBase","eventUiBySource","prevLoadingLevel","newState","onAction","oldData","changeHandlers","oldCalendarOptions","newCalendarOptions","onData","processRawCalendarOptions","refinedOptions","availableLocaleData","warnUnknownOptions","currentRaw","currentRefined","anyChanges","processRawViewOptions","explicitLocale","viewName","CalendarDataProvider","handleData","dataManager","prevProps","newOptionOverrides","Interaction","destroy","parseInteractionSettings","useEventCenter","interactionSettingsToStore","interactionSettingsStore","ElementDragging","setMirrorIsVisible","bool","setMirrorNeedsRevert","setAutoScrollEnabled","Toolbar","startContent","endContent","extraClassName","forceLtr","centerContent","renderSection","widgetGroups","ToolbarSection","activeButton","isTodayEnabled","isPrevEnabled","isNextEnabled","widgetGroup","renderWidgetGroup","isOnlyButtons","widgetGroup_1","widget","ariaAttrs","aria-label","buttonClasses","onClick","groupClassName","ViewContainer","availableWidth","handleEl","updateAvailableWidth","handleResize","liquid","EventClicking","handleSegClick","segEl","hasUrlContainer","defaultPrevented","EventHovering","handleEventElRemove","currentSegEl","handleSegLeave","handleSegEnter","triggerEvent","removeHoverListeners","publicEvName","CalendarContent","buildViewPropTransformers","buildToolbarProps","handleNavLinkClick","_handleNavLinkClick","headerRef","footerRef","interactionsStore","settingsInput","interactions","interactionClass","resizeRunner","viewAspectRatio","toolbarProps","viewVGrow","isHeightAuto","forPrint","viewContext","renderView","buildAppendContent","calendarInteractionClass","anchorEl","navLinkOptions","customAction","ViewComponent","todayInfo","prevInfo","nextInfo","theClasses","CalendarRoot","handleBeforePrint","handleAfterPrint","computeFallbackHeaderFormat","datesRepDistinctDays","CLASS_NAME","TableDateCell","dayMeta","navLinkAttrs","colCnt","data-navlink","tabIndex","extraHookProps","renderInner","data-date","colSpan","extraDataAttrs","isSticky","TableDowCell","dateMeta","extraClassNames","NowTimer","initialNowDate","initialNowQueriedMs","computeTiming","unroundedNow","currentUnitStart","nextUnitStart","waitMs","buildDayRange","DayHeader","createDayHeaderFormatter","dates","renderIntro","explicitFormat","dateCnt","DaySeriesModel","indices","dayIndex","sliceRange","firstIndex","getDateDayIndex","lastIndex","clippedFirstIndex","clippedLastIndex","ceil","dayOffset","DayTableModel","daySeries","breakOnWeeks","daysPerRow","rowCnt","cells","buildCells","headerDates","buildHeaderDates","rows","row","buildCell","seriesSeg","nextIndex","firstCol","lastCol","Slicer","sliceBusinessHours","_sliceBusinessHours","sliceDateSelection","_sliceDateSpan","_sliceEventStore","sliceEventDrag","_sliceInteraction","sliceEventResize","forceDayIfListItem","sliceProps","extraArgs","eventSegs","dateSelectionSegs","businessHourSegs","fgEventSegs","bgEventSegs","sliceNowDate","computeActiveRange","rangeRes","sliceEventRanges","affectedInstances","segs_1","eventRanges","eventRanges_1","sliceEventRange","segs_2","isComponentAllDay","VISIBLE_HIDDEN_RE","Scroller","liquidIsAbsolute","isAbsolute","overcomeLeft","overcomeRight","overcomeBottom","marginLeft","marginRight","marginBottom","maxHeight","needsXScrolling","realClientWidth","getYScrollbarWidth","needsYScrolling","realClientHeight","getXScrollbarWidth","RefMap","masterCallback","currentMap","depths","callbackMap","handleValue","removed","refCallback","collect","getAll","computeShrinkWidth","chunkEls","largestWidth","shrinkCells_1","shrinkCell","getSectionHasLiquidHeight","sectionConfig","getAllowYScrolling","renderChunkContent","chunkConfig","tableClassName","syncRowHeights","minWidth","tableMinWidth","tableColGroupNode","rowContent","isColPropsEqual","cols0","cols1","renderMicroColGroup","cols","shrinkWidth","colNodes","cols_1","colProps","sanitizeShrinkWidth","hasShrinkWidth","cols_2","getScrollGridClassNames","getSectionClassNames","wholeTableVGrow","renderScrollShim","getStickyHeaderDates","getStickyFooterScrollbar","SimpleScrollGrid","processCols","scrollerRefs","scrollerElRefs","_handleScrollerEl","forceYScrollbars","scrollerClientWidths","scrollerClientHeights","handleSizing","computeScrollerDims","currentConfig","sectionConfigs","sections","microColGroupNode","configCnt","configI","headSectionNodes","bodySectionNodes","footSectionNodes","isBuggy","sectionI","outerContent","renderChunkTd","chunk","isLiquid","rowSyncHeights","reportRowHeightChange","scrollerEl","scrollerElRef","scrollbarWidth","sectionCnt","scroller","harnessEl","EventRoot","timeText","disableDragging","disableResizing","isDateSelecting","standardClassNames","StandardEvent","defaultTimeFormat","getSegAnchorAttrs","innerProps","NowIndicatorRoot","isAxis","DAY_NUM_FORMAT","DayCellRoot","refineHookProps","showDayNumber","extraProps","dataAttrs","DayCellContent","dayNumberText","renderFill","fillType","BgEvent","renderInnerContent$1","WeekNumberRoot","defaultFormat","renderInner$1","isRendering","isRendered","customContentRenderId","handleAction","renderRunner","handleRenderRequest","currentData_1","setClassNames","setHeight","wasRendering","pauseRendering","resumeRendering","classNames_1","TableView","headerElRef","renderSimpleLayout","headerRowContent","bodyContent","renderHScrollLayout","ScrollGrid","chunks","colGroups","splitSegsByRow","byRow","splitSegsByFirstCol","byCol","splitInteractionByRow","DEFAULT_WEEK_NUM_FORMAT","TableCell","handleMoreLinkClick","onMoreClick","allSegs","segsByEachCol","hiddenSegs","segIsHidden","moreCnt","dayEl","buildMoreLinkText","rootDataAttrs","showWeekNumber","TableCellTop","forceDayTop","fgContentElRef","fgPaddingBottom","fgContent","marginTop","moreMarginTop","moreLinkClassNames","moreLinkContent","renderMoreLinkInner","moreLinkDidMount","moreLinkWillUnmount","bgContent","renderTopInner","DEFAULT_TABLE_EVENT_TIME_FORMAT","hasListItemDisplay","TableListItemEvent","TableBlockEvent","computeFgSegPlacement","cellModels","eventHeights","maxContentHeight","colPlacements","moreCnts","segTops","segMarginTops","moreTops","paddingBottoms","placeSeg","limitByMaxHeight","limitByMaxEvents","limitByMaxRows","currentNonAbsBottom","currentAbsHeight","placements_1","segHeight","tryPlaceSegAt","canPlaceSegAt","placements","insertionIndex","instanceIdAndFirstCol","segsByFirstCol","extractFirstColSegs","extractAllColSegs","resliceDaySegs","oneColPlacements","oneColPlacements_1","oneColPlacements_2","hiddenCnts","limitEvents","levelIndex","_moreLinkConsumesLevel","isPlacementInBounds","segIsVisible","visibleColPlacements","level","placements_2","recordVisible","recordHidden","currentLevel","moreLinkConsumesLevel","hiddenCnt","doomedLevel","pop","dayDate","colIndex","dayRange","newSegs","TableRow","cellElRefs","frameElRefs","fgElRefs","segHarnessRefs","framePositions","segHeights","businessHoursByCol","bgEventSegsByCol","highlightSegsByCol","getHighlightSegs","mirrorSegsByCol","getMirrorSegs","selectedInstanceHash","cell","normalFgNodes","renderFgSegs","mirrorFgNodes","showDayNumbers","showWeekNumbers","renderFillSegs","updateSizing","prevState","currentProps","nodes","isInvisible","top_1","visibility","leftRightCss","isExternalSizingChange","frameEls","limitByContentHeight","computeSegHeights","computeMaxContentHeight","eventHarnessEl","firstKey","fcContainerEl","getCellEls","elMap","PADDING_FROM_VIEWPORT","SCROLL_DEBOUNCE","Popover","repositioner","handleDocumentMousedown","onClose","handleDocumentScroll","handleCloseClick","extraAttrs","alignmentEl","topAlignmentEl","dims","alignment","innerHeight","MorePopover","handlePopoverEl","popoverEl","hiddenInstances","selectedInstanceId","dayClassNames","onCloseClick","layer","Table","splitBusinessHourSegs","splitBgEventSegs","splitFgEventSegs","splitDateSelectionSegs","buildBuildMoreLinkText","rowRefs","morePopoverState","clickOption","moreLinkClick","segForPublic","currentFgEventSegs","handleMorePopoverClose","businessHourSegsByRow","bgEventSegsByRow","fgEventSegsByRow","dateSelectionSegsByRow","eventDragByRow","eventResizeByRow","limitViaBalanced","colGroupNode","renderRowIntro","isSegAllDay","headerAlignElRef","rowPositions","rowObj","colPositions","positionToHit","getCellRange","getCellEl","relativeRect","moreLinkTextInput","DayTable","slicer","DayTableSlicer","tableRef","dayTableModel","rawHit","DayTableView","buildDayTableModel","headerContent","contentArg","TableDateProfileGenerator","endOfWeek","OPTION_REFINERS","dayGrid","dayGridDay","dayGridWeek","dayGridMonth","AllDaySplitter","timed","TimeColsSlatsCoords","positions","slatMetas","safeComputeTop","startOfDayDate","timeMs","computeTimeTop","computeDateTop","when","slatIndex","slatRemainder","slotDurationMs","slatCoverage","STOCK_SUB_DURATIONS","TimeColsSlats","slatElRefs","minHeight","TimeColsSlatsBody","axis","onCoords","collectSlatEls","slatMeta","isLabeled","TimeColsAxisCell","data-time","isoTimeStr","DEFAULT_SLAT_LABEL_FORMAT","labelFormat","buildSlatMetas","explicitLabelInterval","slatTime","slatIterator","labelInterval","computeLabelInterval","metas","slotsPerLabel","AUTO_ALL_DAY_MAX_EVENT_ROWS","TimeColsView","allDaySplitter","slatCoords","handleScrollTopRequest","renderHeadAxis","frameHeight","renderTableRowAxis","rowHeight","renderAllDayInner","handleSlatCoords","timeContent","isNowIndicator","TimeBodyAxis","nowIndicatorTop","getAllDayMaxEventProps","splitSegsByCol","segsByCol","splitInteractionByCol","computeSegCoords","computeSegVerticals","computeSegHorizontals","forwardCoord","backwardCoord","forwardPressure","level0","levels","buildSlotSegLevels","computeForwardSlotSegs","level0_1","computeSlotSegPressures","level0_2","computeSegForwardBack","computeSlotSegCollisions","otherSegs","results","isSlotSegCollision","seg1","seg2","forwardSegs","forwardSeg","seriesBackwardPressure","seriesBackwardCoord","sortForwardSegs","buildTimeGridSegCompareObj","DEFAULT_TIME_FORMAT","TimeColEvent","isCondensed","timeGridEventCondensedHeight","TimeCol","isSelectMirror","mirrorSegs","interactionAffectedInstances","renderNowIndicator","nowIndicatorSegs","TimeColMisc","segIsInvisible","renderPrintFgSegs","renderPositionedFgSegs","positionCss","computeSegTopBottomCss","computeFgSegPositionCss","shouldOverlap","zIndex","TimeColsContent","splitNowIndicatorSegs","nowIndicatorSegsByRow","updateCoords","onColCoords","collectCellEls","TimeCols","processSlotOptions","onScrollTopRequest","handleColCoords","colCoords","onSlatCoords","scrollResponder","snapsPerSlot","slatTop","slatHeight","partial","snapIndex","snapDurationOverride","DayTimeCols","buildDayRanges","DayTimeColsSlicer","timeColsRef","dayRanges","DayTimeColsView","buildTimeColsModel","hasAttachedAxis","hasDetachedAxis","allDaySlot","timeGridContent","timeGrid","timeGridDay","timeGridWeek","touchMouseIgnoreWait","ignoreMouseDepth","listenerCnt","isWindowTouchMoveCancelled","PointerDragging","containerEl","subjectEl","handleSelector","shouldIgnoreMove","shouldWatchScroll","isTouchDragging","wasTouchScroll","handleMouseDown","shouldIgnoreMouse","isPrimaryMouseButton","tryStart","createEventFromMouse","initScrollWatch","handleMouseMove","handleMouseUp","recordCoords","cleanup","handleTouchStart","createEventFromTouch","targetEl","handleTouchMove","handleTouchEnd","handleTouchScroll","startIgnoringMouse","handleScroll","pageX","prevScrollX","prevPageX","pageY","prevScrollY","prevPageY","isTouch","deltaX","origPageX","deltaY","origPageY","passive","listenerCreated","listenerDestroyed","querySubjectEl","downEl","destroyScrollWatch","cancelTouchScroll","isFirst","touches","onWindowTouchMove","ElementMirror","isVisible","sourceEl","mirrorEl","sourceElRect","revertDuration","origScreenX","origScreenY","updateElPosition","handleMove","setIsVisible","stop","needsRevertAnimation","doRevertAnimation","finalSourceElRect","transition","getMirrorEl","cloneNode","boxSizing","margin","ScrollGeomCache","scrollController","doesListening","handleScrollChange","origScrollTop","origScrollLeft","clientRect","computeClientRect","getEventTarget","ElementScrollGeomCache","WindowScrollGeomCache","getTime","performance","AutoScroller","isEnabled","scrollQuery","edgeThreshold","maxVelocity","pointerScreenX","pointerScreenY","isAnimating","scrollCaches","everMovedUp","everMovedDown","everMovedLeft","everMovedRight","animate","edge","computeBestEdge","handleSide","msSinceRequest","requestAnimation","buildCaches","yDelta","xDelta","requestAnimationFrame","scrollCache","invDistance","distance","velocity","bestSide","leftDist","rightDist","topDist","bottomDist","queryScrollEls","query","FeaturefulElementDragging","minDistance","touchScrollAllowed","mirrorNeedsRevert","isInteracting","isDelayEnded","isDistanceSurpassed","delayTimeoutId","onPointerDown","pointer","mirror","startDelay","handleDistanceSurpassed","onPointerMove","autoScroller","onPointerUp","tryStopDrag","handleDelayEnd","tryStartDrag","stopDrag","setIgnoreMove","OffsetTracker","origRect","computeLeft","computeTop","isWithinClipping","isIgnoredClipping","node","tagName","HitDragging","dragging","droppableStore","useSubjectCenter","requireInitial","initialHit","movingHit","finalHit","handlePointerDown","processFirstCoord","handleDragStart","handleDragMove","handlePointerUp","releaseHits","handleDragEnd","subjectRect","origPoint","adjustedPoint","queryHitForOffset","slicedSubjectRect","coordAdjust","forceHandle","hit","isHitsEqual","offsetTrackers","interactionSettings","offsetLeft","offsetTop","bestHit","offsetTracker","originLeft","originTop","hit0","hit1","buildDatePointApiWithContext","buildDatePointApi","dateStr","DateClicking","hitDragging","DateSelecting","dragSelection","canSelect","getComponentTouchDelay","handleHitUpdate","isFinal","isInvalid","joinHitsIntoSelection","dateSpan0","dateSpan1","dateSelectionTransformers_1","EventDragging","subjectSeg","relevantEvents","receivingContext","validMutation","mutatedRelevantEvents","origTarget","initialContext","getComponentTouchDelay$1","receivingComponent","receivingOptions","computeEventMutation","displayDrag","initialContext_1","receivingContext_1","mutatedRelevantEvents_1","clearDrag","updatedEventApi","eventChangeArg","transformed","eventRemoveArg","draggedEl","addedEventDef","addedEventInstance","addedEventApi","eventAddArg","SELECTOR","nextContext","prevContext","initialCalendar","massagers","massagers_1","massager","EventResizing","draggingSegEl","draggingSeg","querySegEl","computeMutation","isFromStart","transforms","transforms_1","UnselectAuto","isRecentPointerDateSelect","matchesCancel","matchesEvent","onSelect","selectInfo","onDocumentPointerDown","onDocumentPointerUp","documentPointer","LISTENER_REFINERS","dateClick","eventDragStart","eventDragStop","eventDrop","eventResizeStart","eventResizeStop","drop","eventReceive","eventLeave","dataAttrPrefix","InferredElementDragging","mirrorSelector","currentMirrorEl","handlePointerMove","day_map","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","redirect_to_home_if_invalid_route","get_doc_mappings","Event","interaction_type","summary","category","due_date","public","reqd_fields","hidden_fields","ToDo","reference_document","CalendarView","last_calendar","get_calendar_preferences","with_doc","start_date_field","end_date_field","all_day_field","status_field","color_field","rrule","recurrence_rule_field","secondary_status","secondary_status_field","secondary_status_color","calendar_defaults","slots_start_time","daily_minimum_time","slots_end_time","daily_maximum_time","first_day","display_event_time","display_event_end","fullcalendar","sidebar_menu","get_default_options","getItem","setup_options","setup_view_mode_button","clear_user_actions","can_read","$cal","footnote_area","set_footnote","border-top","cal_options","show_secondary_status_legend","btn","option","removeItem","setItem","set_localStorage_option","status_colors","_offset","tz","sys_defaults","time_zone","convert_to_system_tz","lang","interactionPlugin","timeGridPlugin","dayGridPlugin","parameters","get_events_method","prepare_events","update_event","selectionInfo","get_new_doc","get_system_datetime","tooltip","html2text","no_all_day","convert_to_user_tz","validate","add_days","fix_end_date_for_event_render","prepare_colors","remove_from_locals","update_event_method","get_update_args","DashboardView","dashboard_settings","chart_group","number_card_group","setup_dashboard_page","setup_dashboard_customization","make_dashboard","customize","reset_dashboard_customization","add_customization_buttons","clear_secondary_action","$dashboard_page","$dashboard_wrapper","$chart_header","bind_actions_with_object","save_customizations_button","add_button","save_dashboard_customization","standard_actions","btn_class","discard_customizations_button","discard_dashboard_customization","toggle_customization_buttons","charts","number_cards","render_dashboard","fetch_dashboard_items","chart_type","document_type","is_public","dashboard_utils","get_dashboard_settings","dashboard_chart_settings","chart_config","chart","chart_name","chart_settings","render_dashboard_charts","render_number_cards","render_empty_state","obj_name","WidgetGroup","allow_sorting","allow_create","allow_delete","allow_hiding","default_values","widgets","in_customize_mode","allow_resize","custom_dialog","show_add_chart_dialog","empty_state_html","$empty_state","toggle_customize","widget_group","get_widget_config","widget_name","remove_duplicates","get_widgets_to_save","get_field_options","get_query","mandatory_depends_on","value_fields","date_fields","aggregate_function_fields","new_or_existing","chart_function","filters_json","new_widget","on_create","numeric_fieldtypes","ImageView","_image_url","get_image_url","get_attached_images","render_image_view","gallery","prepare_pswp_items","images_map","setup_gallery","item_html","info_fields","info_html","_name","encoded_name","escaped_title","_class","_html","get_abbr","details","item_details_html","expand_button_html","GalleryView","lib_ready","prepare","pswp_root","pswp","_items","_images_map","naturalWidth","naturalHeight","src","msrc","pswp_items","_show","getThumbBoundsFn","thumbnail","pageYScroll","shareEl","showHideOpacity","PhotoSwipe","PhotoSwipeUI_Default","browse_images","$more_items","last_hide_timeout","hide_more_items_after_2s","hide_more_items","img_html","listen","images","currItem","img_el","goTo","invalidateCurrItems","asset_dir","board_name","card_meta","get_card_meta","save_kanban_board_filters","get_board","board","filters_array","hide_card_layout","set_indicator","clear_indicator","kanban","KanbanBoard","cards","quick_entry","mandatory","kanban_boards","show_existing","kanban_options","select_fields","get_fields_for_dialog","project","selected_kanban","kb","kanban_filters","kanban_board_name","new_kanban_dialog","InboxView","last_email_account","current_email_account","get_inbox_filters","is_sent_emails","email","attachment","has_attachment","form_link","reference_name","communication_date","all_accounts","op","msg","CommunicationComposer","user_email","FileView","last_folder","home_folder","add_file_action_buttons","grid_view","get_breadcrumbs_html","home_index","new_route","current_folder","file_menu_items","prompt","file_name","folder","FileUploader","restrictions","allowed_file_types","on_success","file","$cut_button","file_manager","cut","$paste_btn","paste","prepare_datum","is_folder","icon_class","is_image_file","file_url","_title","_type","is_private","render_grid_view","file_body_html","get_route_url","get_creation_date","folders","curr","breadcrumbs_html","creation","now_date","str_to_user","file_size","FileSize","route_url","setup_drag_events","dataTransfer","setData","opacity","$el","files","getData","folder_name","toggle_cut_paste_buttons","hide_paste_btn","can_paste","old_folder","hide_cut_btn","MapView","gelocation_fields","list_fields","in_preview","get_list_fields","bind_leaflet_map","bind_leaflet_draw_control","render_map","map_id","get_unique_id","map_area","prependTo","circleToGeoJSON","Circle","toGeoJSON","include","feature","properties","point_type","radius","getRadius","CircleMarker","Icon","Default","imagePath","fitWorld","tileLayer","attribution","addTo","editableLayers","FeatureGroup","draw","polyline","shapeOptions","weight","polygon","circle","circlemarker","rectangle","featureGroup","drawControl","Control","Draw","addControl","layerType","bindPopup","addLayer","removeLayer","geometry_value","data_layers","LayerGroup","geoJson","pointToLayer","geoJsonPoint","latlng","get_popup","bindTooltip","get_tooltip","circleMarker","add_non_group_layers","flyToBounds","getBounds","_onResize","source_layer","target_group","eachLayer","cur_tree","TreeFactory","TreeView","get_tree_root","show_expand_all","get_tree_nodes","get_permissions","make_filters","root_value","get_root","set_menu_item","in_create","add_page","make_app_page","single_column","breadcrumb","DocType","min-height","add_inner_button","load_children","root_node","view_template","node_view","disable_onchange","root_label","make_tree","use_label","use_value","expandable","toolbar","get_toolbar","on_render","onrender","select_node","post_render","rebuild_tree","parent_field","is_root","hide_add","new_node","btnClass","allow_rename","rename_doc","new_name","$tree_link","extend_toolbar","get_selected_node","prepare_fields","add_tree_node","expanded","toggle_node","always","unfreeze","ignore_fields","mandatory_fields","opts_field_names","inArray","print_tree","get_print_settings","render_tree","report_name","disable_add_node","menu_item","eval","InteractionComposer","no_submit_on_enter","create_action","select_attachments","render_attach","filename","interaction_docs","set_df_property","set_reqd_hidden_fields","get_event_categories","categories","get_input","add_options","setup_attach","doc_mapping","attach","attachments","attachments_folder","attachment_uploaded","cur_frm","get_files","urllib","get_full_url","get_primary_btn","form_values","selected_attachments","element","create_interaction","interaction_values","participants","assign_document","add_attachments","reload_doc","assignee"],"mappings":"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"}