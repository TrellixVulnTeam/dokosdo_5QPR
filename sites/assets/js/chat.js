(function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?n.path:t)}},n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var fuse=createCommonjsModule((function(e,t){
/*!
	 * Fuse.js v3.4.6 - Lightweight fuzzy-search (http://fusejs.io)
	 * 
	 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
	 * All Rights Reserved. Apache Software License 2.0
	 * 
	 * http://www.apache.org/licenses/LICENSE-2.0
	 */
e.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=n(2),s=n(8),i=n(0),p=function(){function e(t,n){var a=n.location,r=void 0===a?0:a,o=n.distance,i=void 0===o?100:o,p=n.threshold,c=void 0===p?.6:p,l=n.maxPatternLength,f=void 0===l?32:l,d=n.caseSensitive,u=void 0!==d&&d,h=n.tokenSeparator,m=void 0===h?/ +/g:h,_=n.findAllMatches,g=void 0!==_&&_,v=n.minMatchCharLength,y=void 0===v?1:v,b=n.id,w=void 0===b?null:b,k=n.keys,C=void 0===k?[]:k,x=n.shouldSort,S=void 0===x||x,$=n.getFn,O=void 0===$?s:$,T=n.sortFn,E=void 0===T?function(e,t){return e.score-t.score}:T,P=n.tokenize,L=void 0!==P&&P,j=n.matchAllTokens,A=void 0!==j&&j,M=n.includeMatches,R=void 0!==M&&M,z=n.includeScore,N=void 0!==z&&z,I=n.verbose,B=void 0!==I&&I;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:i,threshold:c,maxPatternLength:f,isCaseSensitive:u,tokenSeparator:m,findAllMatches:g,minMatchCharLength:y,id:w,keys:C,includeMatches:R,includeScore:N,shouldSort:S,getFn:O,sortFn:E,verbose:B,tokenize:L,matchAllTokens:A},this.setCollection(t)}var t;return(t=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),a=n.tokenSearchers,r=n.fullSearcher,o=this._search(a,r),s=o.weights,i=o.results;return this._computeScore(s,i),this.options.shouldSort&&this._sort(i),t.limit&&"number"==typeof t.limit&&(i=i.slice(0,t.limit)),this._format(i)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),a=0,r=n.length;a<r;a+=1)t.push(new o(n[a],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,a={},r=[];if("string"==typeof n[0]){for(var o=0,s=n.length;o<s;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:a,results:r,tokenSearchers:e,fullSearcher:t});return{weights:null,results:r}}for(var i={},p=0,c=n.length;p<c;p+=1)for(var l=n[p],f=0,d=this.options.keys.length;f<d;f+=1){var u=this.options.keys[f];if("string"!=typeof u){if(i[u.name]={weight:1-u.weight||1},u.weight<=0||u.weight>1)throw new Error("Key weight has to be > 0 and <= 1");u=u.name}else i[u]={weight:1};this._analyze({key:u,value:this.options.getFn(l,u),record:l,index:p},{resultMap:a,results:r,tokenSearchers:e,fullSearcher:t})}return{weights:i,results:r}}},{key:"_analyze",value:function(e,t){var n=e.key,a=e.arrayIndex,r=void 0===a?-1:a,o=e.value,s=e.record,p=e.index,c=t.tokenSearchers,l=void 0===c?[]:c,f=t.fullSearcher,d=void 0===f?[]:f,u=t.resultMap,h=void 0===u?{}:u,m=t.results,_=void 0===m?[]:m;if(null!=o){var g=!1,v=-1,y=0;if("string"==typeof o){this._log("\nKey: ".concat(""===n?"-":n));var b=d.search(o);if(this._log('Full text: "'.concat(o,'", score: ').concat(b.score)),this.options.tokenize){for(var w=o.split(this.options.tokenSeparator),k=[],C=0;C<l.length;C+=1){var x=l[C];this._log('\nPattern: "'.concat(x.pattern,'"'));for(var S=!1,$=0;$<w.length;$+=1){var O=w[$],T=x.search(O),E={};T.isMatch?(E[O]=T.score,g=!0,S=!0,k.push(T.score)):(E[O]=1,this.options.matchAllTokens||k.push(1)),this._log('Token: "'.concat(O,'", score: ').concat(E[O]))}S&&(y+=1)}v=k[0];for(var P=k.length,L=1;L<P;L+=1)v+=k[L];v/=P,this._log("Token score average:",v)}var j=b.score;v>-1&&(j=(j+v)/2),this._log("Score average:",j);var A=!this.options.tokenize||!this.options.matchAllTokens||y>=l.length;if(this._log("\nCheck Matches: ".concat(A)),(g||b.isMatch)&&A){var M=h[p];M?M.output.push({key:n,arrayIndex:r,value:o,score:j,matchedIndices:b.matchedIndices}):(h[p]={item:s,output:[{key:n,arrayIndex:r,value:o,score:j,matchedIndices:b.matchedIndices}]},_.push(h[p]))}}else if(i(o))for(var R=0,z=o.length;R<z;R+=1)this._analyze({key:n,arrayIndex:R,value:o[R],record:s,index:p},{resultMap:h,results:_,tokenSearchers:l,fullSearcher:d})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var n=0,a=t.length;n<a;n+=1){for(var r=t[n].output,o=r.length,s=1,i=1,p=0;p<o;p+=1){var c=e?e[r[p].key].weight:1,l=(1===c?r[p].score:r[p].score||.001)*c;1!==c?i=Math.min(i,l):(r[p].nScore=l,s*=l)}t[n].score=1===i?s:i,this._log(t[n])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===a(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}))),n=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var n=e.output;t.matches=[];for(var a=0,r=n.length;a<r;a+=1){var o=n[a];if(0!==o.matchedIndices.length){var s={indices:o.matchedIndices,value:o.value};o.key&&(s.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(s.arrayIndex=o.arrayIndex),t.matches.push(s)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var o=0,s=e.length;o<s;o+=1){var i=e[o];if(this.options.id&&(i.item=this.options.getFn(i.item,this.options.id)[0]),r.length){for(var p={item:i.item},c=0,l=r.length;c<l;c+=1)r[c](i,p);t.push(p)}else t.push(i.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(e.prototype,t),e}();e.exports=p},function(e,t,n){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=n(3),o=n(4),s=n(7),i=function(){function e(t,n){var a=n.location,r=void 0===a?0:a,o=n.distance,i=void 0===o?100:o,p=n.threshold,c=void 0===p?.6:p,l=n.maxPatternLength,f=void 0===l?32:l,d=n.isCaseSensitive,u=void 0!==d&&d,h=n.tokenSeparator,m=void 0===h?/ +/g:h,_=n.findAllMatches,g=void 0!==_&&_,v=n.minMatchCharLength,y=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:i,threshold:c,maxPatternLength:f,isCaseSensitive:u,tokenSeparator:m,findAllMatches:g,minMatchCharLength:y},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=f&&(this.patternAlphabet=s(this.pattern))}var t;return(t=[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,n=t.maxPatternLength,a=t.tokenSeparator;if(this.pattern.length>n)return r(e,this.pattern,a);var s=this.options,i=s.location,p=s.distance,c=s.threshold,l=s.findAllMatches,f=s.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:i,distance:p,threshold:c,findAllMatches:l,minMatchCharLength:f})}}])&&a(e.prototype,t),e}();e.exports=i},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(a,"|")),o=e.match(r),s=!!o,i=[];if(s)for(var p=0,c=o.length;p<c;p+=1){var l=o[p];i.push([e.indexOf(l),l.length-1])}return{score:s?.5:1,isMatch:s,matchedIndices:i}}},function(e,t,n){var a=n(5),r=n(6);e.exports=function(e,t,n,o){for(var s=o.location,i=void 0===s?0:s,p=o.distance,c=void 0===p?100:p,l=o.threshold,f=void 0===l?.6:l,d=o.findAllMatches,u=void 0!==d&&d,h=o.minMatchCharLength,m=void 0===h?1:h,_=i,g=e.length,v=f,y=e.indexOf(t,_),b=t.length,w=[],k=0;k<g;k+=1)w[k]=0;if(-1!==y){var C=a(t,{errors:0,currentLocation:y,expectedLocation:_,distance:c});if(v=Math.min(C,v),-1!==(y=e.lastIndexOf(t,_+b))){var x=a(t,{errors:0,currentLocation:y,expectedLocation:_,distance:c});v=Math.min(x,v)}}y=-1;for(var S=[],$=1,O=b+g,T=1<<(b<=31?b-1:30),E=0;E<b;E+=1){for(var P=0,L=O;P<L;)a(t,{errors:E,currentLocation:_+L,expectedLocation:_,distance:c})<=v?P=L:O=L,L=Math.floor((O-P)/2+P);O=L;var j=Math.max(1,_-L+1),A=u?g:Math.min(_+L,g)+b,M=Array(A+2);M[A+1]=(1<<E)-1;for(var R=A;R>=j;R-=1){var z=R-1,N=n[e.charAt(z)];if(N&&(w[z]=1),M[R]=(M[R+1]<<1|1)&N,0!==E&&(M[R]|=(S[R+1]|S[R])<<1|1|S[R+1]),M[R]&T&&($=a(t,{errors:E,currentLocation:z,expectedLocation:_,distance:c}))<=v){if(v=$,(y=z)<=_)break;j=Math.max(1,2*_-y)}}if(a(t,{errors:E+1,currentLocation:_,expectedLocation:_,distance:c})>v)break;S=M}return{isMatch:y>=0,score:0===$?.001:$,matchedIndices:r(w,m)}}},function(e,t){e.exports=function(e,t){var n=t.errors,a=void 0===n?0:n,r=t.currentLocation,o=void 0===r?0:r,s=t.expectedLocation,i=void 0===s?0:s,p=t.distance,c=void 0===p?100:p,l=a/e.length,f=Math.abs(i-o);return c?l+f/c:f?1:l}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],a=-1,r=-1,o=0,s=e.length;o<s;o+=1){var i=e[o];i&&-1===a?a=o:i||-1===a||((r=o-1)-a+1>=t&&n.push([a,r]),a=-1)}return e[o-1]&&o-a>=t&&n.push([a,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,a=0;a<n;a+=1)t[e.charAt(a)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t,n){var a=n(0);e.exports=function(e,t){return function e(t,n,r){if(n){var o=n.indexOf("."),s=n,i=null;-1!==o&&(s=n.slice(0,o),i=n.slice(o+1));var p=t[s];if(null!=p)if(i||"string"!=typeof p&&"number"!=typeof p)if(a(p))for(var c=0,l=p.length;c<l;c+=1)e(p[c],i,r);else i&&e(p,i,r);else r.push(p.toString())}else r.push(t);return r}(e,t,[])}}])})),hyper_min=createCommonjsModule((function(e){!function(){function t(){}function n(e,t){for(var n in t)e[n]=t[n];return e}function a(e){!e.__d&&(e.__d=!0)&&1==P.push(e)&&(S.debounceRendering||E)(r)}function r(){var e,t=P;for(P=[];e=t.pop();)e.__d&&w(e)}function o(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&s(e,t.nodeName):n||e._componentConstructor===t.nodeName}function s(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function i(e){var t=n({},e.attributes);t.children=e.children;var a=e.nodeName.defaultProps;if(void 0!==a)for(var r in a)void 0===t[r]&&(t[r]=a[r]);return t}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function c(e,t,n,a,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),a&&a(e);else if("class"!==t||r)if("style"===t){if(a&&"string"!=typeof a&&"string"!=typeof n||(e.style.cssText=a||""),a&&"object"==typeof a){if("string"!=typeof n)for(var o in n)o in a||(e.style[o]="");for(var o in a)e.style[o]="number"==typeof a[o]&&!1===T.test(o)?a[o]+"px":a[o]}}else if("html"===t)a&&(e.innerHTML=a);else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),a?n||e.addEventListener(t,l,s):e.removeEventListener(t,l,s),(e.__l||(e.__l={}))[t]=a}else if("list"!==t&&"type"!==t&&!r&&t in e)(function(e,t,n){try{e[t]=n}catch(e){}})(e,t,null==a?"":a),null!=a&&!1!==a||e.removeAttribute(t);else{var i=r&&t!==(t=t.replace(/^xlink\:?/,""));null==a||!1===a?i?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof a&&(i?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),a):e.setAttribute(t,a))}else e.className=a||""}function l(e){return this.__l[e.type](S.event&&S.event(e)||e)}function f(){for(var e;e=L.pop();)S.afterMount&&S.afterMount(e),e.on_mounted&&e.on_mounted()}function d(e,t,n,a,r,o){j++||(A=null!=r&&void 0!==r.ownerSVGElement,M=null!=e&&!("__hyperattr_"in e));var s=u(e,t,n,a,o);return r&&s.parentNode!==r&&r.appendChild(s),--j||(M=!1,o||f()),s}function u(e,t,n,a,r){var o=e,i=A;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),m(e,!0))),o.__hyperattr_=!0,o;var p=t.nodeName;if("function"==typeof p)return k(e,t,n,a);if(A="svg"===p||"foreignObject"!==p&&A,p+="",(!e||!s(e,p))&&(o=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}(p,A),e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),m(e,!0)}var c=o.firstChild,l=o.__hyperattr_,f=t.children;if(null==l){l=o.__hyperattr_={};for(var d=o.attributes,u=d.length;u--;)l[d[u].name]=d[u].value}return!M&&f&&1===f.length&&"string"==typeof f[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=f[0]&&(c.nodeValue=f[0]):(f&&f.length||null!=c)&&h(o,f,n,a,M||null!=l.html),g(o,t.attributes,l),A=i,o}function h(e,t,n,a,r){var s,i,c,l,f,d=e.childNodes,h=[],_={},g=0,v=0,y=d.length,b=0,w=t?t.length:0;if(0!==y)for(var k=0;k<y;k++){var C=d[k],x=C.__hyperattr_;null!=(S=w&&x?C._component?C._component.__k:x.key:null)?(g++,_[S]=C):(x||(void 0!==C.splitText?!r||C.nodeValue.trim():r))&&(h[b++]=C)}if(0!==w)for(k=0;k<w;k++){var S;if(f=null,null!=(S=(l=t[k]).key))g&&void 0!==_[S]&&(f=_[S],_[S]=void 0,g--);else if(!f&&v<b)for(s=v;s<b;s++)if(void 0!==h[s]&&o(i=h[s],l,r)){f=i,h[s]=void 0,s===b-1&&b--,s===v&&v++;break}f=u(f,l,n,a),c=d[k],f&&f!==e&&f!==c&&(null==c?e.appendChild(f):f===c.nextSibling?p(c):e.insertBefore(f,c))}if(g)for(var k in _)void 0!==_[k]&&m(_[k],!1);for(;v<=b;)void 0!==(f=h[b--])&&m(f,!1)}function m(e,t){var n=e._component;n?C(n):(null!=e.__hyperattr_&&e.__hyperattr_.ref&&e.__hyperattr_.ref(null),!1!==t&&null!=e.__hyperattr_||p(e),_(e))}function _(e){for(e=e.lastChild;e;){var t=e.previousSibling;m(e,!0),e=t}}function g(e,t,n){var a;for(a in n)t&&null!=t[a]||null==n[a]||c(e,a,n[a],n[a]=void 0,A);for(a in t)"children"===a||"innerHTML"===a||a in n&&t[a]===("value"===a||"checked"===a?e[a]:n[a])||c(e,a,n[a],n[a]=t[a],A)}function v(e,t,n){var a,r=R[e.name];if(e.prototype&&e.prototype.render?(a=new e(t,n),x.call(a,t,n)):((a=new x(t,n)).constructor=e,a.render=y),r)for(var o=r.length;o--;)if(r[o].constructor===e){a.__b=r[o].__b,r.splice(o,1);break}return a}function y(e,t,n){return this.constructor(e,n)}function b(e,t,n,r,o){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||o?e.on_mount&&e.on_mount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.__c||(e.__c=e.context),e.context=r),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===S.syncComponentUpdates&&e.base?a(e):w(e,1,o)),e.__r&&e.__r(e))}function w(e,t,a,r){if(!e.__x){var o,s,p,c=e.props,l=e.state,u=e.context,h=e.__p||c,_=e.__s||l,g=e.__c||u,y=e.base,k=e.__b,x=y||k,$=e._component,O=!1;if(y&&(e.props=h,e.state=_,e.context=g,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,l,u)?O=!0:e.componentWillUpdate&&e.componentWillUpdate(c,l,u),e.props=c,e.state=l,e.context=u),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!O){o=e.render(c,l,u),e.getChildContext&&(u=n(n({},u),e.getChildContext()));var T,E,P=o&&o.nodeName;if("function"==typeof P){var A=i(o);(s=$)&&s.constructor===P&&A.key==s.__k?b(s,A,1,u,!1):(T=s,e._component=s=v(P,A,u),s.__b=s.__b||k,s.__u=e,b(s,A,0,u,!1),w(s,1,a,!0)),E=s.base}else p=x,(T=$)&&(p=e._component=null),(x||1===t)&&(p&&(p._component=null),E=d(p,o,u,a||!y,x&&x.parentNode,!0));if(x&&E!==x&&s!==$){var M=x.parentNode;M&&E!==M&&(M.replaceChild(E,x),T||(x._component=null,m(x,!1)))}if(T&&C(T),e.base=E,E&&!r){for(var R=e,z=e;z=z.__u;)(R=z).base=E;E._component=R,E._componentConstructor=R.constructor}}if(!y||a?L.unshift(e):O||(e.on_updated&&e.on_updated(h,_,g),S.afterUpdate&&S.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);j||r||f()}}function k(e,t,n,a){for(var r=e&&e._component,o=r,s=e,p=r&&e._componentConstructor===t.nodeName,c=p,l=i(t);r&&!c&&(r=r.__u);)c=r.constructor===t.nodeName;return r&&c&&(!a||r._component)?(b(r,l,3,n,a),e=r.base):(o&&!p&&(C(o),e=s=null),r=v(t.nodeName,l,n),e&&!r.__b&&(r.__b=e,s=null),b(r,l,1,n,a),e=r.base,s&&e!==s&&(s._component=null,m(s,!1))),e}function C(e){S.beforeUnmount&&S.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?C(n):t&&(t.__hyperattr_&&t.__hyperattr_.ref&&t.__hyperattr_.ref(null),e.__b=t,p(t),function(e){var t=e.constructor.name;(R[t]||(R[t]=[])).push(e)}(e),_(t)),e.__r&&e.__r(null)}function x(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}var S={},$=[],O=[],T=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,E="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,P=[],L=[],j=0,A=!1,M=!1,R={};n(x.prototype,{set_state:function(e,t){var r=this.state;this.__s||(this.__s=n({},r)),n(r,"function"==typeof e?e(r,this.props):e),t&&(this.__h=this.__h||[]).push(t),a(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),w(this,2)},render:function(){}});var z={h:function(e,n){var a,r,o,s,i=arguments,p=O;for(s=arguments.length;s-- >2;)$.push(i[s]);for(n&&null!=n.children&&($.length||$.push(n.children),delete n.children);$.length;)if((r=$.pop())&&void 0!==r.pop)for(s=r.length;s--;)$.push(r[s]);else"boolean"==typeof r&&(r=null),(o="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r+="":"string"!=typeof r&&(o=!1)),o&&a?p[p.length-1]+=r:p===O?p=[r]:p.push(r),a=o;var c=new t;return c.nodeName=e,c.children=p,c.attributes=null==n?void 0:n,c.key=null==n?void 0:n.key,void 0!==S.vnode&&S.vnode(c),c},Component:x,render:function(e,t,n){return d(n,e,{},!1,t,!1)}};e.exports=z}()}));frappe.socketio={open_tasks:{},open_docs:[],emit_queue:[],init:function(port){void 0===port&&(port=3e3),window.io&&(frappe.boot.disable_async||frappe.socketio.socket||("https:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port),{secure:!0}):"http:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port)):"file:"==window.location.protocol&&(frappe.socketio.socket=io.connect(window.localStorage.server)),frappe.socketio.socket?(frappe.socketio.socket.on("msgprint",(function(e){frappe.msgprint(e)})),frappe.socketio.socket.on("eval_js",(function(message){eval(message)})),frappe.socketio.socket.on("progress",(function(e){e.progress&&(e.percent=flt(e.progress[0])/e.progress[1]*100),e.percent&&(100==e.percent?frappe.hide_progress():frappe.show_progress(e.title||__("Progress"),e.percent,100,e.description))})),frappe.socketio.setup_listeners(),frappe.socketio.setup_reconnect(),$(document).on("form-load form-rename",(function(e,t){if(!t.is_new()){for(var n=0,a=frappe.socketio.open_docs.length;n<a;n++){var r=frappe.socketio.open_docs[n];if(t.doctype==r.doctype&&t.docname==r.name)return!1}frappe.socketio.doc_subscribe(t.doctype,t.docname)}})),$(document).on("form-refresh",(function(e,t){t.is_new()||frappe.socketio.doc_open(t.doctype,t.docname)})),$(document).on("form-unload",(function(e,t){t.is_new()||frappe.socketio.doc_close(t.doctype,t.docname)})),$(document).on("form-typing",(function(e,t){frappe.socketio.form_typing(t.doctype,t.docname)})),$(document).on("form-stopped-typing",(function(e,t){frappe.socketio.form_stopped_typing(t.doctype,t.docname)})),window.addEventListener("beforeunload",(function(){cur_frm&&!cur_frm.is_new()&&cur_frm.doc&&frappe.socketio.doc_close(cur_frm.doctype,cur_frm.docname)}))):console.log("Unable to connect to "+frappe.socketio.get_host(port))))},get_host:function(e){void 0===e&&(e=3e3);var t=window.location.origin;if(window.dev_server){var n=t.split(":");e=frappe.boot.socketio_port||e.toString()||"3000",n.length>2&&(t=n[0]+":"+n[1]),t=t+":"+e}return t},subscribe:function(e,t){frappe.socketio.socket.emit("task_subscribe",e),frappe.socketio.socket.emit("progress_subscribe",e),frappe.socketio.open_tasks[e]=t},task_subscribe:function(e){frappe.socketio.socket.emit("task_subscribe",e)},task_unsubscribe:function(e){frappe.socketio.socket.emit("task_unsubscribe",e)},doc_subscribe:function(e,t){frappe.flags.doc_subscribe?console.log("throttled"):(frappe.flags.doc_subscribe=!0,setTimeout((function(){frappe.flags.doc_subscribe=!1}),1e3),frappe.socketio.socket.emit("doc_subscribe",e,t),frappe.socketio.open_docs.push({doctype:e,docname:t}))},doc_unsubscribe:function(e,t){frappe.socketio.socket.emit("doc_unsubscribe",e,t),frappe.socketio.open_docs=$.filter(frappe.socketio.open_docs,(function(n){return n.doctype===e&&n.name===t?null:n}))},doc_open:function(e,t){frappe.socketio.last_doc&&frappe.socketio.last_doc[0]==e&&frappe.socketio.last_doc[1]==t||(frappe.socketio.socket.emit("doc_open",e,t),frappe.socketio.last_doc&&frappe.socketio.doc_close(frappe.socketio.last_doc[0],frappe.socketio.last_doc[1])),frappe.socketio.last_doc=[e,t]},doc_close:function(e,t){frappe.socketio.socket.emit("doc_close",e,t),frappe.socketio.socket.emit("doc_typing_stopped",e,t)},form_typing:function(e,t){frappe.socketio.socket.emit("doc_typing",e,t)},form_stopped_typing:function(e,t){frappe.socketio.socket.emit("doc_typing_stopped",e,t)},setup_listeners:function(){frappe.socketio.socket.on("task_status_change",(function(e){frappe.socketio.process_response(e,e.status.toLowerCase())})),frappe.socketio.socket.on("task_progress",(function(e){frappe.socketio.process_response(e,"progress")}))},setup_reconnect:function(){frappe.socketio.socket.on("connect",(function(){setTimeout((function(){$.each(frappe.socketio.open_tasks,(function(e,t){frappe.socketio.subscribe(e,t)})),$.each(frappe.socketio.open_docs,(function(e){locals[e.doctype]&&locals[e.doctype][e.name]&&frappe.socketio.doc_subscribe(e.doctype,e.name)})),cur_frm&&cur_frm.doc&&frappe.socketio.doc_open(cur_frm.doc.doctype,cur_frm.doc.name)}),5e3)}))},process_response:function(e,t){if(e){var n=frappe.socketio.open_tasks[e.task_id];n[t]&&n[t](e),"success"===t&&n.callback&&n.callback(e),frappe.request.cleanup(n,e),n.always&&n.always(e),e.status_code&&e.status_code>400&&n.error&&n.error(e)}}},frappe.provide("frappe.realtime"),frappe.realtime.on=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.on(e,t)},frappe.realtime.off=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.off(e,t)},frappe.realtime.publish=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.emit(e,t)},function(e){var t=/xyz/.test((function(){xyz}))?/\b_super\b/:/.*/;function n(){}n.extend=function(e){var a=this.prototype,r=Object.create(a);for(var o in e)r[o]="function"==typeof e[o]&&"function"==typeof a[o]&&t.test(e[o])?function(e,t){return function(){var n=this._super;this._super=a[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,e[o]):e[o];var s="function"==typeof r.init?r.hasOwnProperty("init")?r.init:function(){a.init.apply(this,arguments)}:function(){};return s.prototype=r,r.constructor=s,s.extend=n.extend,s},e.Class=n}(commonjsGlobal),frappe.ui.form.Layout=Class.extend({init:function(e){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,e)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message small hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var e=[this.get_new_name_field()];return e=this.doctype_layout?e.concat(this.get_fields_from_layout()):e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},get_new_name_field:function(){return{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}},get_fields_from_layout:function(){for(var e=[],t=0,n=this.doctype_layout.fields;t<n.length;t+=1){var a=n[t],r=copy_dict(frappe.meta.docfield_map[this.doctype][a.fieldname]);r.label=a.label,e.push(r)}return e},show_message:function(e,t){this.message_color&&this.message.removeClass(this.message_color),this.message_color=t&&["yellow","blue"].includes(t)?t:"blue",e?("<"!==e.substr(0,1)&&(e="<div>"+e+"</div>"),this.message.removeClass("hidden").addClass(this.message_color),$(e).appendTo(this.message)):this.message.empty().addClass("hidden")},render:function(e){var t=this,n=e||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(n,(function(e,n){switch(n.fieldtype){case"Fold":t.make_page(n);break;case"Section Break":t.make_section(n);break;case"Column Break":t.make_column(n);break;default:t.make_field(n)}}))},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"})},replace_field:function(e,t,n){if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){var a=this.init_field(t,n);this.fields_dict[e].$wrapper.remove(),this.fields_list.splice(this.fields_dict[e],1,a),this.fields_dict[e]=a,this.frm&&(a.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[e],1,a),this.section.fields_dict[e]=a,this.refresh_fields([t])}},make_field:function(e,t,n){!this.section&&this.make_section(),!this.column&&this.make_column();var a=this.init_field(e,n);this.fields_list.push(a),this.fields_dict[e.fieldname]=a,this.frm&&(a.perm=this.frm.perm),this.section.fields_list.push(a),this.section.fields_dict[e.fieldname]=a,a.section=this.section},init_field:function(e,t){void 0===t&&(t=!1);var n=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:t,doc:this.doc});return n.layout=this,n},make_page:function(e){var t=this,n=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=n.find(".btn-fold").on("click",(function(){var e=$(this).parent().next();e.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),e.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),e.addClass("hide"),t.folded=!0)})),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(e){this.section=new frappe.ui.form.Section(this,e),e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(e){this.column=new frappe.ui.form.Column(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)},refresh:function(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse()},refresh_sections:function(){this.wrapper.find(".form-section:not(.hide-control)").each((function(){var e=$(this).removeClass("empty-section visible-section");e.find(".frappe-control:not(.hide-control)").length?e.addClass("visible-section"):e.addClass("empty-section")})),this.frm&&this.frm.dashboard.refresh()},refresh_fields:function(e){var t=e.map((function(e){if(e.fieldname)return e.fieldname}));this.fields_list.map((function(e){t.includes(e.df.fieldname)&&(e.refresh(),e.df.default&&e.set_input(e.df.default))}))},add_fields:function(e){this.render(e),this.refresh_fields(e)},refresh_section_collapse:function(){if(this.sections&&this.sections.length)for(var e=0;e<this.sections.length;e++){var t=this.sections[e],n=t.df;if(n&&n.collapsible){var a=!0;n.collapsible_depends_on&&(a=!this.evaluate_depends_on_value(n.collapsible_depends_on)),a&&t.has_missing_mandatory()&&(a=!1),"_form_dashboard"===n.fieldname&&(a="yes"===localStorage.getItem("collapseFormDashboard")),t.collapse(a)}}},attach_doc_and_docfields:function(e){for(var t=this,n=0,a=this.fields_list.length;n<a;n++){var r=this.fields_list[n];t.doc&&(r.doc=t.doc,r.doctype=t.doc.doctype,r.docname=t.doc.name,r.df=frappe.meta.get_docfield(t.doc.doctype,r.df.fieldname,t.doc.name)||r.df,t.frm&&(r.perm=t.frm.perm)),e&&r.df&&r.refresh&&r.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each((function(e){$(this).html(e+1)}))},setup_tabbing:function(){var e=this;this.wrapper.on("keydown",(function(t){if(9==t.which){var n=$(t.target),a=n.attr("data-doctype"),r=n.attr("data-fieldname");if(a)return e.handle_tab(a,r,t.shiftKey)}}))},handle_tab:function(e,t,n){var a=this,r=null,o=null,s=a.fields_list,i=!1;if(e!=a.doctype){if(!(r=a.get_open_grid_row())||!r.layout)return;s=r.layout.fields_list}for(var p=0,c=s.length;p<c;p++){if(s[p].df.fieldname==t){if(n){o?this.set_focus(o):$(this.primary_button).focus();break}if(p<c-1&&(i=a.focus_on_next_field(p,s)),i)break}this.is_visible(s[p])&&(o=s[p])}return i||(r?r.doc.idx==r.grid.grid_rows.length?r.toggle_view(!1,(function(){r.grid.frm.layout.handle_tab(r.grid.df.parent,r.grid.df.fieldname)})):r.grid.grid_rows[r.doc.idx].toggle_view(!0):$(this.primary_button).focus()),!1},focus_on_next_field:function(e,t){for(var n=e+1,a=t.length;n<a;n++){var r=t[n];if(this.is_visible(r)){if("Table"===r.df.fieldtype)return r.grid.grid_rows&&r.grid.grid_rows.length||r.grid.add_new_row(),r.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,r.df.fieldtype))return this.set_focus(r),!0}}},is_visible:function(e){return"Write"===e.disp_status&&e.$wrapper&&e.$wrapper.is(":visible")},set_focus:function(e){"Table"==e.df.fieldtype?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var e=!1;for(var t in this.fields_list){(a=this.fields_list[t]).dependencies_clear=!0,(a.df.depends_on||a.df.mandatory_depends_on||a.df.read_only_depends_on)&&(e=!0)}if(e){for(var n=this.fields_list.length-1;n>=0;n--){var a;(a=this.fields_list[n]).guardian_has_value=!0,a.df.depends_on&&(a.guardian_has_value=this.evaluate_depends_on_value(a.df.depends_on),a.guardian_has_value?a.df.hidden_due_to_dependency&&(a.df.hidden_due_to_dependency=!1,a.refresh()):a.df.hidden_due_to_dependency||(a.df.hidden_due_to_dependency=!0,a.refresh())),a.df.mandatory_depends_on&&this.set_dependant_property(a.df.mandatory_depends_on,a.df.fieldname,"reqd"),a.df.read_only_depends_on&&this.set_dependant_property(a.df.read_only_depends_on,a.df.fieldname,"read_only")}this.refresh_section_count()}},set_dependant_property:function(e,t,n){var a,r=this.evaluate_depends_on_value(e)?1:0;this.frm?a=this.frm:(this.is_dialog||"Web Form"===this.doctype)&&(a=this),a&&(this.doc&&this.doc.parent?(a.setting_dependency=!0,a.set_df_property(this.doc.parentfield,n,r,this.doc.parent,t,this.doc.name),a.setting_dependency=!1,this.fields_dict[t]&&this.fields_dict[t].refresh()):a.set_df_property(t,n,r))},evaluate_depends_on_value:function(expression){var out=null,doc=this.doc;if(!doc&&this.get_values)var doc=this.get_values(!0);if(doc){var parent=this.frm?this.frm.doc:this.doc||null;if("boolean"==typeof expression)out=expression;else if("function"==typeof expression)out=expression(doc);else if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5)),parent&&parent.istable&&expression.includes("is_submittable")&&(out=!0)}catch(e){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==expression.substr(0,3)&&this.frm)out=this.frm.script_manager.trigger(expression.substr(3),this.doctype,this.docname);else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}}}),frappe.ui.form.Section=Class.extend({init:function(e,t){this.layout=e,this.df=t||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper));var e=this.layout.card_layout;this.wrapper=$('<div class="row form-section '+(e?"card-section":"")+'">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass),this.df.hide_border&&this.wrapper.toggleClass("hide-border",!0)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var e=this;this.head=$('<div class="section-head">\n\t\t\t'+__(this.df.label)+'\n\t\t\t<span class="ml-2 collapse-indicator mb-1">\n\t\t\t</span>\n\t\t</div>'),this.head.appendTo(this.wrapper),this.indicator=this.head.find(".collapse-indicator"),this.indicator.hide(),this.df.collapsible&&(this.collapse_link=this.head.on("click",(function(){e.collapse()})),this.indicator.show())},refresh:function(){if(this.df){var e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),this.wrapper.toggleClass("hide-control",!!e)}},collapse:function(e){if(this.head&&this.body){void 0===e&&(e=!this.body.hasClass("hide")),this.body.toggleClass("hide",e),this.head.toggleClass("collapsed",e);var t=e?"down":"up-line";this.indicator,this.indicator.html(frappe.utils.icon(t,"sm","mb-1")),this.fields_list.forEach((function(e){"Signature"==e.df.fieldtype&&e.refresh()}))}},is_collapsed:function(){return this.body.hasClass("hide")},has_missing_mandatory:function(){for(var e=!1,t=0,n=this.fields_list.length;t<n;t++){var a=this.fields_list[t].df;if(a.reqd&&null==this.layout.doc[a.fieldname]){e=!0;break}}return e}}),frappe.ui.form.Column=Class.extend({init:function(e,t){t||(t={}),this.df=t,this.section=e,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",(function(){return!1})),this.df.label&&$('<label class="control-label">'+__(this.df.label,null,this.df.parent)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var e=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+e)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(e){$.extend(this,e),this.dirty=!1,this._super(),$.each(this.fields||[],(function(e,t){!t.fieldname&&t.label&&(t.fieldname=t.label.replace(/ /g,"_").toLowerCase())})),this.values&&this.set_values(this.values)},make:function(){var e=this,t=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,(function(e,n){if(n.df.default){var a=n.df.default;"Today"==a&&"Date"==n.df.fieldtype&&(a=frappe.datetime.get_today()),n.set_input(a),t.refresh_dependency()}})),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change",(function(){e.dirty=!0,frappe.run_serially([function(){return frappe.timeout(.1)},function(){return t.refresh_dependency()}])})))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,(function(e,t){if(!in_list(["Date","Datetime","Time","Check"],t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1}))},catch_enter_as_submit:function(){var e=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress((function(t){13==t.which&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))}))},get_input:function(e){var t=this.fields_dict[e];return $(t.txt?t.txt:t.input)},get_field:function(e){return this.fields_dict[e]},get_values:function(e){var t={},n=[];for(var a in this.fields_dict){var r=this.fields_dict[a];if(r.get_value){var o=r.get_value();r.df.reqd&&is_null("string"==typeof o?strip_html(o):o)&&n.push(__(r.df.label)),r.df.reqd&&"Text Editor"===r.df.fieldtype&&is_null(strip_html(cstr(o)))&&n.push(__(r.df.label)),is_null(o)||(t[r.df.fieldname]=o)}}return n.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+n.join("<li>")+"</ul>",indicator:"orange"}),null):t},get_value:function(e){var t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)},set_value:function(e,t){var n=this;return new Promise((function(a){var r=n.fields_dict[e];r?r.set_value(t).then((function(){r.set_input(t),n.refresh_dependency(),a()})):a()}))},set_input:function(e,t){return this.set_value(e,t)},set_values:function(e){var t=[];for(var n in e)this.fields_dict[n]&&t.push(this.set_value(n,e[n]));return Promise.all(t)},clear:function(){for(var e in this.fields_dict){var t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}},set_df_property:function(e,t,n){var a=this.get_field(e);a.df[t]=n,a.refresh()}}),frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(e){return document.getElementById(e)},get_unique_id:function(){var e="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,e},set_unique_id:function(e){var t=$(e);if(t.attr("id"))return t.attr("id");var n="unique-"+frappe.dom.id_count;return t.attr("id",n),frappe.dom.id_count++,n},eval:function(e){if(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}},remove_script_and_style:function(e){var t=["script","style","noscript","title","meta","base","head"];if(!new RegExp(t.map((function(e){return"<"+e+">.*<\\/"+e+">"})).join("|"),"s").test(e))return e;var n=document.createElement("div");n.innerHTML=e;var a=!1;t.forEach((function(e){var t=n.getElementsByTagName(e);for(o=t.length;o--;)a=!0,t[o].parentNode.removeChild(t[o])}));for(var r=n.getElementsByTagName("link"),o=r.length;o--;)"stylesheet"==r[o].getAttribute("rel")&&(a=!0,r[o].parentNode.removeChild(r[o]));return a?n.innerHTML:e},is_element_in_viewport:function(e,t){void 0===t&&(t=0),"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var n=e.getBoundingClientRect();return n.top+t>=0&&n.left+t>=0&&n.bottom-t<=$(window).height()&&n.right-t<=$(window).width()},is_element_in_modal:function(e){return Boolean($(e).parents(".modal").length)},set_style:function(e,t){if(e){var n=document.createElement("style");if(n.type="text/css",t){var a=document.getElementById(t);a&&a.parentNode.removeChild(a),n.id=t}return n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(n),n}},add:function(e,t,n,a,r,o){e&&e.substr&&(e=frappe.dom.by_id(e));var s=document.createElement(t);return e&&e.appendChild(s),n&&("img"==t.toLowerCase()?s.src=n:s.className=n),a&&frappe.dom.css(s,a),r&&(s.innerHTML=r),o&&(s.onclick=o),s},css:function(e,t){return e&&t&&$.extend(e.style,t),e},activate:function(e,t,n,a){void 0===a&&(a="active"),e.find("."+n+"."+a).removeClass(a),t.addClass(a)},freeze:function(e,t){if($("#freeze").length)$("#freeze").addClass("in");else{var n=$("#body").length&&$("#body")||frappe.web_form&&$(frappe.web_form.wrapper),a=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",(function(){var e=cur_frm&&cur_frm.cur_grid||frappe.web_form&&frappe.web_form.cur_grid;if(e)return e.toggle_view(),!1})).appendTo(n);a.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:e||""})),setTimeout((function(){a.addClass("in")}),1)}t&&$("#freeze").addClass(t),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],n=0,a=e.rangeCount;n<a;++n)t.push(e.getRangeAt(n));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var n=0,a=e.length;n<a;++n)t.addRange(e[n])}else document.selection&&e.select&&e.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images:function(e){$(e).find("img").on("error",(function(e){$(e.currentTarget).addClass("no-image")}))},scroll_to_bottom:function(e){var t=$(e);t.scrollTop(t[0].scrollHeight)},file_to_base64:function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsDataURL(e)}))},scroll_to_section:function(e){setTimeout((function(){var t=$('a:contains("'+e+'")');t.length&&(t.parent().hasClass("collapsed")&&t.click(),frappe.ui.scroll(t.parent().parent()))}),200)},pixel_to_inches:function(e){var t=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');t.appendTo(document.body);var n=e/document.getElementById("dpi").offsetWidth;return t.remove(),n}},frappe.ellipsis=function(e,t){return t||(t=20),(e=cstr(e)).length>t&&(e=e.substr(0,t)+"..."),e},frappe.run_serially=function(e){var t=Promise.resolve();return e.forEach((function(e){e&&(t=t.then?t.then(e):Promise.resolve())})),t},frappe.load_image=function(e,t,n,a){void 0===a&&(a=function(){});var r=new Image;r.onload=function(){t(this)},r.onerror=n,a(r),r.src=e},frappe.timeout=function(e){return new Promise((function(t){setTimeout((function(){return t()}),1e3*e)}))},frappe.scrub=function(e,t){return void 0===t&&(t="_"),e.replace(/ /g,t).toLowerCase()},frappe.unscrub=function(e){return frappe.model.unscrub(e)},frappe.get_data_pill=function(e,t,n,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===a&&(a=null);var r=$('\n\t\t<button class="data-pill btn">\n\t\t\t<div class="flex align-center ellipsis">\n\t\t\t\t'+(a||"")+'\n\t\t\t\t<span class="pill-label '+(a?"ml-2":"")+'">'+e+"</span>\n\t\t\t</div>\n\t\t</button>\n\t");if(n){var o=$('\n\t\t\t<span class="remove-btn cursor-pointer">\n\t\t\t\t'+frappe.utils.icon("close","sm")+"\n\t\t\t</span>\n\t\t").click((function(){n(t||e,r)}));r.append(o)}return r},frappe.get_modal=function(e,t){return $('<div class="modal fade" style="overflow: auto;" tabindex="-1">\n\t\t<div class="modal-dialog">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div class="modal-header">\n\t\t\t\t\t<div class="fill-width flex title-section">\n\t\t\t\t\t\t<span class="indicator hidden"></span>\n\t\t\t\t\t\t<h4 class="modal-title">'+e+'</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="modal-actions">\n\t\t\t\t\t\t<button class="btn btn-modal-minimize btn-link hide">\n\t\t\t\t\t\t\t'+frappe.utils.icon("collapse")+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class="btn btn-modal-close btn-link" data-dismiss="modal">\n\t\t\t\t\t\t\t'+frappe.utils.icon("close-alt","sm","close-alt")+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body ui-front">'+t+'</div>\n\t\t\t\t<div class="modal-footer hide">\n\t\t\t\t\t<div class="custom-actions"></div>\n\t\t\t\t\t<div class="standard-actions">\n\t\t\t\t\t\t<button type="button" class="btn btn-secondary btn-sm hide btn-modal-secondary">\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn btn-primary btn-sm hide btn-modal-primary">\n\t\t\t\t\t\t\t'+__("Confirm")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>")},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",(function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})})),$(window).on("offline",(function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})})),frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this.make()}make(){var e=this;this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size?$(this.wrapper).addClass("modal-lg"):"extra-large"==this.size&&$(this.wrapper).addClass("modal-xl"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.footer=this.$wrapper.find(".modal-footer"),this.standard_actions=this.footer.find(".standard-actions"),this.custom_actions=this.footer.find(".custom-actions"),this.set_indicator(),super.make(),this.refresh_section_collapse(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&(this.set_secondary_action_label(this.secondary_action_label||this.action.secondary.label),this.secondary_action||this.set_secondary_action((function(){e.hide()}))),this.minimizable&&(this.header.find(".title-section").click((function(){return e.is_minimized&&e.toggle_minimize()})),this.get_minimize_btn().removeClass("hide").on("click",(function(){return e.toggle_minimize()})));var t=this;this.$wrapper.on("hide.bs.modal",(function(){t.display=!1,frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===t&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),t.onhide&&t.onhide(),t.on_hide&&t.on_hide()})).on("shown.bs.modal",(function(){t.display=!0,window.cur_dialog=t,frappe.ui.open_dialogs.push(t),t.focus_on_first_input(),t.on_page_show&&t.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown")})).on("scroll",(function(){var e=$("input:focus");e.length&&["Date","Datetime","Time"].includes(e.attr("data-fieldtype"))&&e.blur()}))}get_primary_btn(){return this.standard_actions.find(".btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(e,t){this.footer.removeClass("hide"),this.has_primary_action=!0;var n=this;return this.get_primary_btn().removeClass("hide").html(e).click((function(){n.primary_action_fulfilled=!0;var e=n.get_values();e&&t&&t.apply(n,[e])}))}set_secondary_action(e){this.footer.removeClass("hide"),this.get_secondary_btn().removeClass("hide").on("click",e)}set_secondary_action_label(e){this.get_secondary_btn().removeClass("hide").html(e)}disable_primary_action(){this.get_primary_btn().addClass("disabled").prop("disabled",!0)}enable_primary_action(){this.get_primary_btn().removeClass("disabled").prop("disabled",!1)}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.$wrapper.removeClass("modal-minimize"),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}get_secondary_btn(){return this.standard_actions.find(".btn-modal-secondary")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){$(".modal-backdrop").toggle();var e=this.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.is_minimized=!this.is_minimized;var t=this.is_minimized?"expand":"collapse";this.get_minimize_btn().html(frappe.utils.icon(t)),this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer"),$("body").toggleClass("modal-open")}add_custom_action(e,t,n){void 0===n&&(n=null),this.footer.removeClass("hide");var a=$('\n\t\t\t<button class="btn btn-secondary btn-sm '+(n||"")+'">\n\t\t\t\t'+e+"\n\t\t\t</button>\n\t\t");this.custom_actions.append(a),t&&a.click(t)}},frappe.ui.hide_open_dialog=function(){window.cur_dialog&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide())},frappe._.get_data_uri=function(e){var t=e.videoWidth,n=e.videoHeight,a=$("<canvas/>");return a[0].width=t,a[0].height=n,a[0].getContext("2d").drawImage(e,0,0,t,n),a[0].toDataURL("image/png")},frappe.ui.Capture=class{constructor(e){void 0===e&&(e={}),this.options=frappe.ui.Capture.OPTIONS,this.set_options(e)}set_options(e){return this.options=Object.assign({},frappe.ui.Capture.OPTIONS,e),this}render(){var e=this;return navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){e.stream=t,e.dialog=new frappe.ui.Dialog({title:e.options.title,animate:e.options.animate,on_hide:function(){return e.stop_media_stream()}}),e.dialog.get_close_btn().on("click",(function(){e.hide()}));var n=function(){e.dialog.set_primary_action(__("Take Photo"),(function(){var t=frappe._.get_data_uri(r);a.find(".fc-p").attr("src",t),a.find(".fc-s").hide(),a.find(".fc-p").show(),e.dialog.set_secondary_action_label(__("Retake")),e.dialog.get_secondary_btn().show(),e.dialog.set_primary_action(__("Submit"),(function(){e.hide(),e.callback&&e.callback(t)}))}))};n(),e.dialog.set_secondary_action((function(){a.find(".fc-p").hide(),a.find(".fc-s").show(),e.dialog.get_secondary_btn().hide(),e.dialog.get_primary_btn().off("click"),n()})),e.dialog.get_secondary_btn().hide();var a=$(frappe.ui.Capture.TEMPLATE),r=a.find("video")[0];r.srcObject=e.stream,r.play(),$(e.dialog.body).html(a)}))}show(){var e=this;this.render().then((function(){e.dialog.show()})).catch((function(t){if(e.options.error){var n='<span class="indicator red"/> '+frappe.ui.Capture.ERR_MESSAGE;frappe.show_alert(n,3)}throw t}))}hide(){this.dialog&&this.dialog.hide(),this.stop_media_stream()}stop_media_stream(){this.stream&&this.stream.getTracks().forEach((function(e){e.stop()}))}submit(e){this.callback=e}},frappe.ui.Capture.OPTIONS={title:__("Camera"),animate:!1,error:!1},frappe.ui.Capture.ERR_MESSAGE=__("Unable to load camera."),frappe.ui.Capture.TEMPLATE='\n<div class="frappe-capture">\n\t<div class="panel panel-default">\n\t\t<div class="embed-responsive embed-responsive-16by9">\n\t\t\t<img class="fc-p embed-responsive-item" style="object-fit: contain; display: none;"/>\n\t\t\t<video class="fc-s embed-responsive-item">'+frappe.ui.Capture.ERR_MESSAGE+"</video>\n\t\t</div>\n\t</div>\n</div>\n",frappe.user_info=function(e){if(e||(e=frappe.session.user),"bot"===e.toLowerCase())return{fullname:__("Bot"),image:"/assets/frappe/images/ui/bot.png",abbr:"B"};if(frappe.boot.user_info&&frappe.boot.user_info[e])t=frappe.boot.user_info[e];else var t={fullname:frappe.utils.capitalize(e.split("@")[0])||"Unknown"};return t.abbr=frappe.get_abbr(t.fullname),t.color=frappe.get_palette(t.fullname),t},frappe.ui.set_user_background=function(e,t,n){if(t||(t="#page-desktop"),n||(n="Fill Screen"),e){window.cordova&&-1===e.indexOf("http")&&(e=frappe.base_url+e);var a=repl('background: url("%(src)s") center center;',{src:e})}else a="background-color: #4B4C9D;";frappe.dom.set_style(repl("%(selector)s { \t\t%(background)s \t\tbackground-attachment: fixed; \t\t%(style)s \t}",{selector:t,background:a,style:"Fill Screen"===n?"background-size: cover;":""}))},frappe.provide("frappe.user"),$.extend(frappe.user,{name:"Guest",full_name:function(e){return e===frappe.session.user?__("You",null,"Name of the current user. For example: You edited this 5 hours ago."):frappe.user_info(e).fullname},image:function(e){return frappe.user_info(e).image},abbr:function(e){return frappe.user_info(e).abbr},has_role:function(e){for(var t in"string"==typeof e&&(e=[e]),e)if(-1!=(frappe.boot?frappe.boot.user.roles:["Guest"]).indexOf(e[t]))return!0},get_desktop_items:function(){return $.map(frappe.boot.allowed_workspaces,(function(e){var t=e.module_name,n=frappe.modules[t]&&frappe.modules[t].type;if(-1===frappe.boot.user.allow_modules.indexOf(t))return null;var a=null;return"module"===n?(-1!=frappe.boot.user.allow_modules.indexOf(t)||frappe.modules[t].is_help)&&(a=t):"page"===n?-1!=frappe.boot.allowed_pages.indexOf(frappe.modules[t].link)&&(a=t):"list"===n?frappe.model.can_read(frappe.modules[t]._doctype)&&(a=t):"view"===n?a=t:"setup"===n?(frappe.user.has_role("System Manager")||frappe.user.has_role("Administrator"))&&(a=t):a=t,a}))},is_report_manager:function(){return frappe.user.has_role(["Administrator","System Manager","Report Manager"])},get_formatted_email:function(e){var t=frappe.user.full_name(e);if(t){var n="";return-1!==t.search(/[\[\]\\()<>@,:;".]/)&&(n='"'),repl("%(quote)s%(fullname)s%(quote)s <%(email)s>",{fullname:t,email:e,quote:n})}return e},get_emails:function(){return Object.keys(frappe.boot.user_info).map((function(e){return frappe.boot.user_info[e].email}))},toString:function(){return this.name}}),frappe.session_alive=!0,$(document).bind("mousemove",(function(){!1===frappe.session_alive&&$(document).trigger("session_alive"),frappe.session_alive=!0,frappe.session_alive_timeout&&clearTimeout(frappe.session_alive_timeout),frappe.session_alive_timeout=setTimeout("frappe.session_alive=false;",3e4)})),frappe.Error=Error,frappe.TypeError=TypeError,frappe.ValueError=Error,frappe.ImportError=Error,frappe.provide("frappe.datetime"),frappe.datetime.datetime=class{constructor(e,t){if(void 0===t&&(t=null),"undefined"==typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.moment=e?moment(e,t):moment()}format(e){return void 0===e&&(e=null),this.moment.format(e)}},frappe.datetime.range=class{constructor(e,t){if(void 0===typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.start=e,this.end=t}contains(e){return e.moment.isBetween(this.start.moment,this.end.moment)}},frappe.datetime.now=function(){return new frappe.datetime.datetime},frappe.datetime.equal=function(e,t,n){return e=e.moment,t=t.moment,e.isSame(t,n)},frappe.datetime.compare=function(e,t){return e=e.moment,t=t.moment,e.isBefore(t)?1:t.isBefore(e)?-1:0},frappe.quick_edit=function(e,t,n){return new Promise((function(a){frappe.model.with_doctype(e,(function(){frappe.db.get_doc(e,t).then((function(r){var o=frappe.get_meta(e).fields.filter((function(e){return e.reqd||e.bold&&!e.read_only}));o.map((function(e){"content"==e.fieldname&&"File"==r.type&&(e.read_only=1)}));var s=new frappe.ui.Dialog({title:__("Edit")+e+" ("+t+")",fields:o,action:{primary:{label:__("Save"),onsubmit:function(o){frappe.call("frappe.client.save",{doc:Object.assign({},{doctype:e,docname:t},r,o)}).then((function(e){n&&n(e.message),a(e.message)})),s.hide()}},secondary:{label:__("Discard")}}});s.set_values(r);var i=$(s.body);i.append("\n\t\t\t\t\t<div class=\"qe-fp\" style=\"padding-top: '15px'; padding-bottom: '15px'; padding-left: '7px'\">\n\t\t\t\t\t\t<button class=\"btn btn-default btn-sm\">\n\t\t\t\t\t\t\t"+__("Edit in Full Page")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t"),i.find(".qe-fp").click((function(){s.hide(),frappe.set_route("Form",e,t)})),s.show()}))}))}))},frappe.provide("frappe._"),frappe._.format=function(e,t){for(var n in t)e=e.replace("{"+n+"}",t[n]);return e},frappe._.fuzzy_search=function(e,t,n){return n=Object.assign({},{shouldSort:!0,threshold:.6,location:0,distance:100,minMatchCharLength:1,maxPatternLength:32},n),new fuse(t,n).search(e)},frappe._.pluralize=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n="s"),""+e+(1===t?"":n)},frappe._.capitalize=function(e){return""+e.charAt(0).toUpperCase()+e.slice(1)},frappe._.head=function(e){return frappe._.is_empty(e)?void 0:e[0]},frappe._.copy_array=function(e){if(Array.isArray(e))return e.slice();throw frappe.TypeError("Expected Array, recieved "+typeof e+" instead.")},frappe._.is_empty=function(e){var t=!1;return null==e?t=!0:Array.isArray(e)||"string"==typeof e||e instanceof $?t=0===e.length:"object"==typeof e&&(t=0===Object.keys(e).length),t},frappe._.as_array=function(e){return Array.isArray(e)?e:[e]},frappe._.squash=function(e){return Array.isArray(e)&&1===e.length?e[0]:e},frappe._.is_mobile=function(){var e=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini","i"),t=navigator.userAgent;return e.test(t)},frappe._.compact=function(e){return e.filter(Boolean)},frappe.utils=Object.assign({},frappe.utils,frappe._),frappe.provide("frappe.user"),frappe.user.first_name=function(e){return frappe._.head(frappe.user.full_name(e).split(" "))},frappe.provide("frappe.ui.keycode"),frappe.ui.keycode={RETURN:13},frappe.provide("frappe.stores"),frappe.stores=[],frappe.Store=class{constructor(e){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e}static get(e){return e in frappe.stores||(frappe.stores[e]=new frappe.Store(e)),frappe.stores[e]}set(e,t){localStorage.setItem(this.name+":"+e,t)}get(e,t){return localStorage.getItem(this.name+":"+e)}},frappe.provide("frappe.loggers"),frappe.Logger=class{constructor(e,t){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e,this.level=t,this.level||(frappe.boot.developer_mode?this.level=frappe.Logger.ERROR:this.level=frappe.Logger.NOTSET),this.format=frappe.Logger.FORMAT}static get(e,t){return e in frappe.loggers||(frappe.loggers[e]=new frappe.Logger(e,t)),frappe.loggers[e]}debug(e){this.log(e,frappe.Logger.DEBUG)}info(e){this.log(e,frappe.Logger.INFO)}warn(e){this.log(e,frappe.Logger.WARN)}error(e){this.log(e,frappe.Logger.ERROR)}log(e,t){var n=frappe.datetime.now();if(t.value<=this.level.value){var a=frappe._.format(this.format,{time:n.format("HH:mm:ss"),name:this.name});console.log("%c "+a+":","color: "+t.color,e)}}},frappe.Logger.DEBUG={value:10,color:"#616161",name:"DEBUG"},frappe.Logger.INFO={value:20,color:"#2196F3",name:"INFO"},frappe.Logger.WARN={value:30,color:"#FFC107",name:"WARN"},frappe.Logger.ERROR={value:40,color:"#F44336",name:"ERROR"},frappe.Logger.NOTSET={value:0,name:"NOTSET"},frappe.Logger.FORMAT="{time} {name}",frappe.provide("frappe.chat"),frappe.log=frappe.Logger.get("frappe.chat",frappe.Logger.NOTSET),frappe.provide("frappe.chat.profile"),frappe.chat.profile.create=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise((function(n){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.create",{user:frappe.session.user,exists_ok:!0,fields:e},(function(e){t&&t(e.message),n(e.message)}))}))},frappe.chat.profile.update=function(e,t,n){return new Promise((function(a){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.update",{user:e||frappe.session.user,data:t},(function(e){n&&n(e.message),a(e.message)}))}))},frappe.provide("frappe.chat.profile.on"),frappe.chat.profile.on.update=function(e){frappe.realtime.on("frappe.chat.profile:update",(function(t){return e(t.user,t.data)}))},frappe.chat.profile.STATUSES=[{name:"Online",color:"green"},{name:"Away",color:"yellow"},{name:"Busy",color:"red"},{name:"Offline",color:"darkgray"}],frappe.provide("frappe.chat.room"),frappe.chat.room.create=function(e,t,n,a,r){return"function"==typeof a&&(r=a,a=null),n=frappe._.as_array(n),new Promise((function(o){frappe.call("frappe.chat.doctype.chat_room.chat_room.create",{kind:e,token:t||frappe.session.user,users:n,name:a},(function(e){var t=e.message;t=Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}),r&&r(t),o(t)}))}))},frappe.chat.room.get=function(e,t,n){return"function"==typeof e?(n=e,e=null,t=null):"string"==typeof e&&(e=frappe._.as_array(e),"function"==typeof t?(n=t,t=null):"string"==typeof t&&(t=frappe._.as_array(t))),new Promise((function(a){frappe.call("frappe.chat.doctype.chat_room.chat_room.get",{user:frappe.session.user,rooms:e,fields:t},(function(e){var t=e.message;t?(t=(t=frappe._.as_array(t)).map((function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation),last_message:e.last_message?Object.assign({},e.last_message,{creation:new frappe.datetime.datetime(e.last_message.creation)}):null})})),t=frappe._.squash(t)):t=[],n&&n(t),a(t)}))}))},frappe.chat.room.subscribe=function(e){frappe.realtime.publish("frappe.chat.room:subscribe",e)},frappe.chat.room.history=function(e,t){return new Promise((function(n){frappe.call("frappe.chat.doctype.chat_room.chat_room.history",{room:e,user:frappe.session.user},(function(e){var a=e.message?frappe._.as_array(e.message):[];a=a.map((function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation)})})),t&&t(a),n(a)}))}))},frappe.chat.room.search=function(e,t){var n=t.map((function(e){return e.room_name?e.room_name:e.owner===frappe.session.user?frappe.user.full_name(frappe._.squash(e.users)):frappe.user.full_name(e.owner)})),a=frappe._.fuzzy_search(e,n);return t=a.map((function(e){return t[e]}))},frappe.chat.room.sort=function(e,t){return void 0===t&&(t=null),t=t||function(e,t){return e.last_message&&t.last_message?frappe.datetime.compare(e.last_message.creation,t.last_message.creation):e.last_message?frappe.datetime.compare(e.last_message.creation,t.creation):t.last_message?frappe.datetime.compare(e.creation,t.last_message.creation):frappe.datetime.compare(e.creation,t.creation)},e.sort(t),e},frappe.provide("frappe.chat.room.on"),frappe.chat.room.on.update=function(e){frappe.realtime.on("frappe.chat.room:update",(function(t){t.data.last_message&&(t.data=Object.assign({},t.data,{last_message:Object.assign({},t.data.last_message,{creation:new frappe.datetime.datetime(t.data.last_message.creation)})})),e(t.room,t.data)}))},frappe.chat.room.on.create=function(e){frappe.realtime.on("frappe.chat.room:create",(function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))}))},frappe.chat.room.on.typing=function(e){frappe.realtime.on("frappe.chat.room:typing",(function(t){return e(t.room,t.user)}))},frappe.provide("frappe.chat.message"),frappe.chat.message.typing=function(e,t){frappe.realtime.publish("frappe.chat.message:typing",{user:t||frappe.session.user,room:e})},frappe.chat.message.send=function(e,t,n){void 0===n&&(n="Content"),frappe.call("frappe.chat.doctype.chat_message.chat_message.send",{user:frappe.session.user,room:e,content:t,type:n})},frappe.chat.message.update=function(e,t,n){return new Promise((function(a){frappe.call("frappe.chat.doctype.chat_message.chat_message.update",{user:frappe.session.user,message:e,update:t},(function(e){n&&n(response.message),a(response.message)}))}))},frappe.chat.message.sort=function(e){return frappe._.is_empty(e)||e.sort((function(e,t){return frappe.datetime.compare(t.creation,e.creation)})),e},frappe.chat.message.seen=function(e,t){frappe.call("frappe.chat.doctype.chat_message.chat_message.seen",{message:e,user:t||frappe.session.user})},frappe.provide("frappe.chat.message.on"),frappe.chat.message.on.create=function(e){frappe.realtime.on("frappe.chat.message:create",(function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))}))},frappe.chat.message.on.update=function(e){frappe.realtime.on("frappe.chat.message:update",(function(t){return e(t.message,t.data)}))},frappe.chat.pretty_datetime=function(e){var t=moment(),n=e.moment;return t.isSame(n,"d")?n.format("hh:mm A"):t.isSame(n,"week")?n.format("dddd"):n.format("DD/MM/YYYY")},frappe.provide("frappe.chat.sound"),frappe.chat.sound.play=function(e,t){void 0===t&&(t=.1);var n=$('<audio class="chat-audio"/>');n.attr("volume",t),frappe._.is_empty(n)&&$(document).append(n),n.paused||(frappe.log.info("Stopping sound playing."),n[0].pause(),n.attr("currentTime",0)),frappe.log.info("Playing sound."),n.attr("src",frappe.chat.sound.PATH+"/chat-"+e+".mp3"),n[0].play()},frappe.chat.sound.PATH="/assets/frappe/sounds",frappe.chat.emojis=[],frappe.chat.emoji=function(e){return new Promise((function(t){frappe._.is_empty(frappe.chat.emojis)?$.get("https://cdn.rawgit.com/frappe/emoji/master/emoji",(function(n){frappe.chat.emojis=JSON.parse(n),e&&e(frappe.chat.emojis),t(frappe.chat.emojis)})):(e&&e(frappe.chat.emojis),t(frappe.chat.emojis))}))},frappe.provide("frappe.chat.website.settings"),frappe.chat.website.settings=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise((function(n){frappe.call("frappe.chat.website.settings",{fields:e}).then((function(e){var a=e.message;a.enable_from&&(a=Object.assign({},a,{enable_from:new frappe.datetime.datetime(a.enable_from,"HH:mm:ss")})),a.enable_to&&(a=Object.assign({},a,{enable_to:new frappe.datetime.datetime(a.enable_to,"HH:mm:ss")})),t&&t(a),n(a)}))}))},frappe.chat.website.token=function(e){return new Promise((function(t){frappe.call("frappe.chat.website.token").then((function(n){e&&e(n.message),t(n.message)}))}))};var h=hyper_min.h,Component=hyper_min.Component;frappe.provide("frappe.components"),frappe.provide("frappe.chat.component"),frappe.components.Button=class extends Component{render(){var e=this.props,t=frappe.components.Button.SIZE[e.size];return h("button",Object.assign({},e,{class:"btn "+(t&&t.class)+" btn-"+e.type+" "+(e.block?"btn-block":"")+" "+(e.class?e.class:"")}),e.children)}},frappe.components.Button.SIZE={small:{class:"btn-sm"},large:{class:"btn-lg"}},frappe.components.Button.defaultProps={type:"default",block:!1},frappe.components.FAB=class extends frappe.components.Button{render(){var e=this.props,t=frappe.components.FAB.SIZE[e.size];return h(frappe.components.Button,Object.assign({},e,{class:e.class+" "+(t&&t.class)}),h("i",{class:e.icon}))}},frappe.components.FAB.defaultProps={icon:"octicon octicon-plus"},frappe.components.FAB.SIZE={small:{class:"frappe-fab-sm"},large:{class:"frappe-fab-lg"}},frappe.components.Indicator=class extends Component{render(){var e=this.props;return e.color?h("span",Object.assign({},e,{class:"indicator "+e.color})):null}},frappe.components.Unicons=class extends Component{render(){var e=this.props,t=frappe.components.Unicons.TYPE[e.type]||e.type;return e.type?h("i",Object.assign({},e,{class:"uil "+(e.fixed?"fa-fw":"")+" uil-"+t+" "+e.class})):null}},frappe.components.Unicons.TYPE={send:"message"},frappe.components.Unicons.defaultProps={fixed:!1},frappe.components.Octicon=class extends Component{render(){var e=this.props;return e.type?h("i",Object.assign({},e,{class:"octicon octicon-"+e.type})):null}},frappe.components.Avatar=class extends Component{render(){var e=this.props,t=e.abbr||e.title.substr(0,1),n=frappe.components.Avatar.SIZE[e.size]||frappe.components.Avatar.SIZE.medium;return h("span",{class:"avatar "+n.class+" "+(e.class?e.class:"")},e.image?h("img",{class:"standard-image",src:e.image}):h("div",{class:"standard-image"},t))}},frappe.components.Avatar.SIZE={small:{class:"avatar-small"},large:{class:"avatar-large"},medium:{class:"avatar-medium"}},frappe.Chat=class{constructor(e,t){"string"==typeof e||e instanceof $||e instanceof HTMLElement||(t=e,e=null),this.options=frappe.Chat.OPTIONS,this.set_wrapper(e||"body"),this.set_options(t)}set_wrapper(e){return this.$wrapper=$(e),this}set_options(e){return this.options=Object.assign({},this.options,e),this}destroy(){return this.$wrapper.remove(".frappe-chat"),this}render(e){void 0===e&&(e={}),this.destroy();var t=this.$wrapper,n=this.options,a=h(frappe.Chat.Widget,Object.assign({},{layout:n.layout,target:n.target},e));return hyper_min.render(a,t[0]),this}},frappe.Chat.Layout={PAGE:"page",POPPER:"popper"},frappe.Chat.OPTIONS={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget=class extends Component{constructor(e){super(e),this.setup(e),this.make()}setup(e){var t=this;this.room={},this.room.add=function(e){var n=(e=frappe._.as_array(e)).map((function(e){return e.name}));frappe.log.info("Subscribing "+frappe.session.user+" to Chat Rooms "+n.join(", ")+"."),frappe.chat.room.subscribe(n);for(var a=[],r=0,o=e;r<o.length;r+=1){var s=o[r];(["Group","Visitor"].includes(s.type)||s.owner===frappe.session.user||s.last_message||s.users.includes(frappe.session.user))&&(frappe.log.info("Adding "+s.name+" to component."),a.push(s))}t.set_state({rooms:t.state.rooms.concat(a)})},this.room.update=function(e,n){var a=t.state,r=!1,o=a.rooms.map((function(t){if(t.name===e){if(r=!0,n.typing)if(frappe._.is_empty(t.typing))n.typing=frappe._.as_array(n.typing);else{var a=n.typing;t.typing.includes(a)||(n.typing=frappe._.copy_array(t.typing),n.typing.push(a))}return Object.assign({},t,n)}return t}));if("Guest"!==frappe.session.user&&(r?t.set_state({rooms:o}):frappe.chat.room.get(e,(function(e){return t.room.add(e)}))),a.room.name===e){if(n.typing)if(frappe._.is_empty(a.room.typing))n.typing=frappe._.as_array(n.typing);else{var s=n.typing;a.room.typing.includes(s)||(n.typing=frappe._.copy_array(a.room.typing),n.typing.push(s))}var i=Object.assign({},a.room,n);t.set_state({room:i})}},this.room.select=function(e){frappe.chat.room.history(e,(function(n){var a=t.state,r=a.rooms.find((function(t){return t.name===e}));t.set_state({room:Object.assign({},a.room,r,{messages:n})})}))},this.state=Object.assign({},frappe.Chat.Widget.defaultState,e)}make(){var e=this;"Guest"!==frappe.session.user?frappe.chat.profile.create(["status","message_preview","notification_tones","conversation_tones"]).then((function(t){e.set_state({profile:t}),frappe.chat.room.get((function(t){t=frappe._.as_array(t),frappe.log.info("User "+frappe.session.user+" is subscribed to "+t.length+" "+frappe._.pluralize("room",t.length)+"."),frappe._.is_empty(t)||e.room.add(t)})),e.bind()})):this.bind()}bind(){var e=this;frappe.chat.profile.on.update((function(t,n){if(frappe.log.warn("TRIGGER: Chat Profile update "+JSON.stringify(n)+" of User "+t+"."),"status"in n)if(t===frappe.session.user)e.set_state({profile:Object.assign({},e.state.profile,{status:n.status})});else{var a='<span class="indicator '+frappe.chat.profile.STATUSES.find((function(e){return e.name===n.status})).color+'"/> '+frappe.user.full_name(t)+" is currently <b>"+n.status+"</b>";frappe.show_alert(a,3)}})),frappe.chat.room.on.create((function(t){frappe.log.warn("TRIGGER: Chat Room "+t.name+" created."),e.room.add(t)})),frappe.chat.room.on.update((function(t,n){frappe.log.warn("TRIGGER: Chat Room "+t+" update "+JSON.stringify(n)+" recieved."),e.room.update(t,n)})),frappe.chat.room.on.typing((function(t,n){n!==frappe.session.user&&(frappe.log.warn("User "+n+" typing in Chat Room "+t+"."),e.room.update(t,{typing:n}),setTimeout((function(){return e.room.update(t,{typing:null})}),5e3))})),frappe.chat.message.on.create((function(t){var n=e.state;if(n.room.name?n.profile.conversation_tones&&frappe.chat.sound.play("message"):n.profile.notification_tones&&frappe.chat.sound.play("notification"),t.user!==frappe.session.user&&n.profile.message_preview&&!n.toggle){$("body").find(".frappe-chat-alert").remove();var a='\n\t\t\t\t<span data-action="show-message" class="cursor-pointer">\n\t\t\t\t\t<span class="indicator yellow"/>\n\t\t\t\t\t\t<span class="avatar avatar-small">\n\t\t\t\t\t\t\t<span class="avatar-frame" style="background-image: url('+frappe.user.image(t.user)+')"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<b>'+frappe.user.first_name(t.user)+"</b>: "+t.content+"\n\t\t\t\t</span>\n\t\t\t\t";frappe.show_alert(a,15,{"show-message":function(e){this.room.select(e.room),this.base.firstChild._component.toggle()}.bind(e,t)}),frappe.notify(""+frappe.user.first_name(t.user),{body:t.content,icon:frappe.user.image(t.user),tag:t.user})}if(t.room===n.room.name){var r=frappe._.copy_array(n.room.messages);r.push(t),e.set_state({room:Object.assign({},n.room,{messages:r})})}})),frappe.chat.message.on.update((function(e,t){frappe.log.warn("TRIGGER: Chat Message "+e+" update "+JSON.stringify(t)+" recieved.")}))}render(){var e=this,t=this.props,n=this.state,a=this,r=h(frappe.Chat.Widget.ActionBar,{placeholder:__("Search or Create a New Chat"),class:"level",layout:t.layout,actions:frappe._.compact([{label:__("New"),onclick:function(){var e=new frappe.ui.Dialog({title:__("New Chat"),fields:[{label:__("Chat Type"),fieldname:"type",fieldtype:"Select",options:["Group","Direct Chat"],default:"Group",onchange:function(){var t="Group"===e.get_value("type");e.set_df_property("group_name","reqd",t),e.set_df_property("user","reqd",!t)}},{label:__("Group Name"),fieldname:"group_name",fieldtype:"Data",reqd:!0,depends_on:"eval:doc.type == 'Group'"},{label:__("Users"),fieldname:"users",fieldtype:"MultiSelect",options:frappe.user.get_emails(),depends_on:"eval:doc.type == 'Group'"},{label:__("User"),fieldname:"user",fieldtype:"Link",options:"User",depends_on:"eval:doc.type == 'Direct Chat'"}],action:{primary:{label:__("Create"),onsubmit:function(t){if("Group"===t.type){if(!frappe._.is_empty(t.users)){var n=t.group_name,a=e.fields_dict.users.get_values();frappe.chat.room.create("Group",null,a,n)}}else{var r=t.user;frappe.chat.room.create("Direct",null,r)}e.hide()}}}});e.show()}},frappe._.is_mobile()&&{icon:"octicon octicon-x",class:"frappe-chat-close",onclick:function(){return e.set_state({toggle:!1})}}],Boolean),change:function(e){a.set_state({query:e})},span:function(e){a.set_state({span:e})}}),o=[];if("user_info"in frappe.boot)for(var s=0,i=frappe.user.get_emails();s<i.length;s+=1){for(var p=i[s],c=!1,l=0,f=n.rooms;l<f.length;l+=1){var d=f[l];"Direct"===d.type&&(d.owner!==p&&frappe._.squash(d.users)!==p||(c=!0))}c||o.push({owner:frappe.session.user,users:[p]})}var u=n.query?frappe.chat.room.search(n.query,n.rooms.concat(o)):frappe.chat.room.sort(n.rooms),m=n.span?frappe.Chat.Layout.PAGE:frappe.Chat.Layout.POPPER,_=frappe._.is_empty(u)&&!n.query?h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h("p","",__("You don't have any messages yet.")))):h(frappe.Chat.Widget.RoomList,{rooms:u,click:function(t){t.name?e.room.select(t.name):frappe.chat.room.create("Direct",t.owner,frappe._.squash(t.users),(function(t){var n=t.name;return e.room.select(n)}))}}),g=h(frappe.Chat.Widget.Room,Object.assign({},n.room,{layout:m,destroy:function(){e.set_state({room:{name:null,messages:[]}})}})),v=m===frappe.Chat.Layout.POPPER?h(frappe.Chat.Widget.Popper,{heading:r,page:n.room.name&&g,target:t.target,toggle:function(t){return e.set_state({toggle:t})}},_):h("div",{class:"frappe-chat-popper"},h("div",{class:"frappe-chat-popper-collapse"},h("div",{class:"panel panel-default panel-span",style:{width:"25%"}},h("div",{class:"panel-heading"},r),_),g));return h("div",{class:"frappe-chat"},v)}},frappe.Chat.Widget.defaultState={query:"",profile:{},rooms:[],room:{name:null,messages:[],typing:[]},toggle:!1,span:!1},frappe.Chat.Widget.defaultProps={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget.Popper=class extends Component{constructor(e){super(e),this.setup(e)}setup(e){var t=this;this.toggle=this.toggle.bind(this),this.state=frappe.Chat.Widget.Popper.defaultState,e.target&&$(e.target).click((function(){return t.toggle()})),frappe.chat.widget=this}toggle(e){var t;t=1===arguments.length?e:!this.state.active,this.set_state({active:t}),this.props.toggle(t)}on_mounted(){var e=this;$(document.body).on("click",".page-container, .frappe-chat-close",(function(t){t.currentTarget;e.toggle(!1)}))}render(){var e=this,t=this.props,n=this.state;return n.destroy?null:h("div",{class:"frappe-chat-popper",style:t.target?null:{"margin-bottom":"80px"}},t.target?null:h(frappe.components.FAB,{class:"frappe-fab",icon:n.active?"uil uil-message":"font-heavy uil uil-comment-alt",size:frappe._.is_mobile()?null:"large",type:"primary",onclick:function(){return e.toggle()}}),n.active?h("div",{class:"frappe-chat-popper-collapse"},t.page?t.page:h("div",{class:"panel panel-default "+(frappe._.is_mobile()?"panel-span":"")},h("div",{class:"panel-heading"},t.heading),t.children)):null)}},frappe.Chat.Widget.Popper.defaultState={active:!1,destroy:!1},frappe.Chat.Widget.ActionBar=class extends Component{constructor(e){super(e),this.change=this.change.bind(this),this.submit=this.submit.bind(this),this.state=frappe.Chat.Widget.ActionBar.defaultState}change(e){var t,n=this.props,a=this.state;this.set_state(((t={})[e.target.name]=e.target.value,t)),n.change(a.query)}submit(e){var t=this.props,n=this.state;e.preventDefault(),t.submit(n.query)}render(){var e=this,t=this.props,n=this.state,a=t.actions;return h("div",{class:"frappe-chat-action-bar "+(t.class?t.class:"")},h("form",{oninput:this.change,onsubmit:this.submit},h("input",{autocomplete:"off",class:"form-control input-sm",name:"query",value:n.query,placeholder:t.placeholder||"Search"})),frappe._.is_empty(a)?null:a.map((function(e){return h(frappe.Chat.Widget.ActionBar.Action,Object.assign({},e))})),frappe._.is_mobile()?null:h(frappe.Chat.Widget.ActionBar.Action,{icon:"octicon octicon-screen-"+(n.span?"normal":"full"),onclick:function(){var a=!n.span;e.set_state({span:a}),t.span(a)}}))}},frappe.Chat.Widget.ActionBar.defaultState={query:null,span:!1},frappe.Chat.Widget.ActionBar.Action=class extends Component{render(){var e=this.props;return h(frappe.components.Button,Object.assign({},{size:"small",class:"btn-action"},e),e.icon?h("i",{class:e.icon}):null,(e.icon?" ":"")+(e.label?e.label:""))}},frappe.Chat.Widget.RoomList=class extends Component{render(){var e=this.props,t=e.rooms;return frappe._.is_empty(t)?null:h("ul",{class:"frappe-chat-room-list nav flex-column"},t.map((function(t){return h(frappe.Chat.Widget.RoomList.Item,Object.assign({},t,{click:e.click}))})))}},frappe.Chat.Widget.RoomList.Item=class extends Component{render(){var e=this.props,t={};if("Group"===e.type)if(t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing)){if(e.last_message){var n=e.last_message,a=n.content;"File"===n.type?t.subtitle="📁 "+a.name:t.subtitle=e.last_message.content}}else{e.typing=frappe._.as_array(e.typing);var r=e.typing.map((function(e){return frappe.user.first_name(e)}));t.subtitle=r.join(", ")+" typing..."}else{var o=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;if(t.title=frappe.user.full_name(o),t.image=frappe.user.image(o),t.abbr=frappe.user.abbr(o),frappe._.is_empty(e.typing)){if(e.last_message){var s=e.last_message,i=s.content;"File"===s.type?t.subtitle="📁 "+i.name:t.subtitle=e.last_message.content}}else t.subtitle="typing..."}var p=!1;return e.last_message&&(t.timestamp=frappe.chat.pretty_datetime(e.last_message.creation),p=!e.last_message.seen.includes(frappe.session.user)),h("li",{class:"nav-item p-2"},h("a",{class:e.active?"active":"",onclick:function(){e.last_message&&frappe.chat.message.seen(e.last_message.name),e.click(e)}},h("div",{class:"row align-items-center w-100"},h("div",{class:"col-9"},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t))),h("div",{class:"col-3 text-right"},[h("div",{class:"text-muted",style:{"font-size":"9px"}},t.timestamp),p?h("span",{class:"indicator red"}):null]))))}},frappe.Chat.Widget.MediaProfile=class extends Component{render(){var e=this.props,t=frappe.Chat.Widget.MediaProfile.POSITION[e.position||"left"],n=h("div",{class:t.class+" media-middle"},h(frappe.components.Avatar,Object.assign({},e,{title:e.title,image:e.image,size:e.size,abbr:e.abbr})));return h("div",{class:"media align-items-center",style:"media-right"===t.class?{"text-align":"right"}:null},"media-left"===t.class?n:null,h("div",{class:"media-body py-2"},h("div",{class:"media-heading ellipsis small",style:"max-width: "+(e.width_title||"100%")+" display: inline-block"},e.title),e.content?h("div","",h("small","",e.content)):null,e.subtitle?h("div",{class:"media-subtitle small"},h("small",{class:"text-muted"},e.subtitle)):null),"media-right"===t.class?n:null)}},frappe.Chat.Widget.MediaProfile.POSITION={left:{class:"media-left"},right:{class:"media-right"}},frappe.Chat.Widget.Room=class extends Component{render(){var e=this.props,t=(this.state,[{match:/@(\w*)$/,search:function(t,n){if("Group"===e.type){var a=t.slice(1);n([].concat(frappe._.as_array(e.owner),e.users).filter((function(e){return e!==frappe.session.user&&0===e.indexOf(a)})))}},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:frappe.user.full_name(e),image:frappe.user.image(e),size:"small"})}},{match:/:([a-z]*)$/,search:function(e,t){frappe.chat.emoji((function(n){for(var a=e.slice(1),r=[],o=0,s=n;o<s.length;o+=1)for(var i=s[o],p=0,c=i.aliases;p<c.length;p+=1){var l=c[p];0===l.indexOf(a)&&r.push({name:l,value:i.emoji})}t(r)}))},content:function(e){return e.value},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:e.name,abbr:e.value,size:"small"})}}]),n=frappe._.compact([!frappe._.is_mobile()&&{icon:"camera",label:__("Camera"),onclick:function(){var e=new frappe.ui.Capture({animate:!1,error:!0});e.show(),e.submit((function(e){}))}},{icon:"file",label:__("File"),onclick:function(){new frappe.ui.FileUploader({doctype:"Chat Room",docname:e.name,on_success:function(t){var n=t.file_url,a=t.filename;frappe.chat.message.send(e.name,{path:n,name:a},"File")}})}}]);if("Guest"!==frappe.session.user&&e.messages){e.messages=frappe._.as_array(e.messages);for(var a=0,r=e.messages;a<r.length;a+=1){var o=r[a];if(o.seen.includes(frappe.session.user))break;frappe.chat.message.seen(o.name)}}return h("div",{class:"panel panel-default\n\t\t\t\t"+(e.name?"panel-bg":"")+"\n\t\t\t\t"+(e.layout===frappe.Chat.Layout.PAGE||frappe._.is_mobile()?"panel-span":""),style:e.layout===frappe.Chat.Layout.PAGE&&{width:"75%",left:"25%","box-shadow":"none"}},e.name&&h(frappe.Chat.Widget.Room.Header,Object.assign({},e,{on_back:e.destroy})),e.name?frappe._.is_empty(e.messages)?h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 48px"}),h("p","",__("Start a conversation."))))):h(frappe.chat.component.ChatList,{messages:e.messages}):h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 125px"}),h("p","",__("Select a chat to start messaging."))))),e.name?h("div",{class:"chat-room-footer"},h(frappe.chat.component.ChatForm,{actions:n,onchange:function(){frappe.chat.message.typing(e.name)},onsubmit:function(t){frappe.chat.message.send(e.name,t)},hint:t})):null)}},frappe.Chat.Widget.Room.Header=class extends Component{render(){var e=this.props,t={};if(["Group","Visitor"].includes(e.type))if(t.route="chat-room/"+e.name,t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing))t.subtitle="Group"===e.type?e.users.length+" "+frappe._.pluralize("member",e.users.length):"";else{e.typing=frappe._.as_array(e.typing);var n=e.typing.map((function(e){return frappe.user.first_name(e)}));t.subtitle=n.join(", ")+" typing..."}else{var a=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;t.route="user/"+a,t.title=frappe.user.full_name(a),t.image=frappe.user.image(a),frappe._.is_empty(e.typing)||(t.subtitle="typing...")}var r=e.layout===frappe.Chat.Layout.POPPER||frappe._.is_mobile();return h("div",{class:"panel-heading",style:{height:"50px"}},h("div",{class:"level"},r&&"Guest"!==frappe.session.user?h(frappe.components.Button,{class:"btn-back",onclick:e.on_back},h(frappe.components.Octicon,{type:"chevron-left"})):null,h("div","",h("div",{class:"panel-title"},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t)))),h("div",{class:r?"col-2":"col-3"},h("div",{class:"text-right"},frappe._.is_mobile()&&h(frappe.components.Button,{class:"frappe-chat-close",onclick:e.toggle},h(frappe.components.Octicon,{type:"x"}))))))}},frappe.chat.component.ChatList=class extends Component{on_mounted(){this.$element=$(".frappe-chat").find(".chat-list"),this.$element.scrollTop(this.$element[0].scrollHeight)}on_updated(){this.$element.scrollTop(this.$element[0].scrollHeight)}render(){for(var e=[],t=0;t<this.props.messages.length;++t){var n=this.props.messages[t];n.user,frappe.session.user;0!==t&&frappe.datetime.equal(n.creation,this.props.messages[t-1].creation,"day")||e.push({type:"Notification",content:n.creation.format("MMMM DD")}),e.push(n)}return h("div",{class:"chat-list list-group"},frappe._.is_empty(e)?null:e.map((function(e){return h(frappe.chat.component.ChatList.Item,Object.assign({},e))})))}},frappe.chat.component.ChatList.Item=class extends Component{render(){var e=this.props,t=e.user===frappe.session.user,n=e.content;return h("div",{class:"chat-list-item list-group-item"},"Notification"===e.type?h("div",{class:"chat-list-notification"},h("div",{class:"chat-list-notification-content"},n)):h("div",{class:t?"text-right":""},"Group"!==e.room_type||t?null:h(frappe.components.Avatar,{title:frappe.user.full_name(e.user),image:frappe.user.image(e.user)}),h(frappe.chat.component.ChatBubble,e)))}},frappe.chat.component.ChatBubble=class extends Component{constructor(e){super(e),this.onclick=this.onclick.bind(this)}onclick(){var e=this.props;e.user===frappe.session.user&&frappe.quick_edit("Chat Message",e.name,(function(e){}))}render(){var e=this.props,t=e.creation.format("hh:mm A"),n=e.user===frappe.session.user,a=!frappe._.is_empty(e.seen)&&!e.seen.includes(frappe.session.user),r=e.content;return h("div",{class:"chat-bubble "+(e.groupable?"chat-groupable":"")+" chat-bubble-"+(n?"r":"l"),onclick:this.onclick},"Group"!==e.room_type||n?null:h("div",{class:"chat-bubble-author"},h("a",{onclick:function(){frappe.set_route("Form","User",e.user)}},frappe.user.full_name(e.user))),h("div",{class:"chat-bubble-content"},h("small","","File"===e.type?h("a",{class:"no-decoration",href:r.path,target:"_blank"},h(frappe.components.Unicons,{type:"file",fixed:!0})," "+r.name):r)),h("div",{class:"chat-bubble-meta"},h("span",{class:"chat-bubble-creation"},t),n&&a?h("span",{class:"chat-bubble-check"},h(frappe.components.Octicon,{type:"check"})):null))}},frappe.chat.component.ChatForm=class extends Component{constructor(e){super(e),this.onchange=this.onchange.bind(this),this.onsubmit=this.onsubmit.bind(this),this.hint=this.hint.bind(this),this.state=frappe.chat.component.ChatForm.defaultState}onchange(e){var t,n=this.props,a=this.state,r=e.target.value;this.set_state(((t={})[e.target.name]=r,t)),n.onchange(a),this.hint(r)}hint(e){var t=this,n=this.props;this.state;if(n.hint){var a=e.split(" "),r=a.slice(0,a.length-1),o=a[a.length-1];if(o){n.hint=frappe._.as_array(n.hint);var s=n.hint.find((function(e){return e.match.test(o)}));s?s.search(o,(function(e){var n=e.map((function(e){var t=o.replace(s.match,s.content?s.content(e):e),n=(r.join(" ")+" "+t).trim();return e={component:s.component(e),content:n}})).slice(0,s.max||5);t.set_state({hints:n})})):this.set_state({hints:[]})}else this.set_state({hints:[]})}}onsubmit(e){e.preventDefault(),this.state.content&&(this.props.onsubmit(this.state.content),this.set_state({content:null}))}render(){var e=this,t=this.props,n=this.state;return h("div",{class:"chat-form"},n.hints.length?h("ul",{class:"hint-list list-group"},n.hints.map((function(t){return h("li",{class:"hint-list-item list-group-item"},h("a",{href:"javascript:void(0)",onclick:function(){e.set_state({content:t.content,hints:[]})}},t.component))}))):null,h("form",{oninput:this.onchange,onsubmit:this.onsubmit},h("div",{class:"input-group input-group-lg"},frappe._.is_empty(t.actions)?null:h("div",{class:"input-group-btn dropup"},h(frappe.components.Button,{class:"Guest"===frappe.session.user?"disabled":"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.Unicons,{class:"text-muted",type:"paperclip",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-left",onclick:function(e){return e.stopPropagation()}},!frappe._.is_empty(t.actions)&&t.actions.map((function(e){return h("li",null,h("a",{onclick:e.onclick},h(frappe.components.Unicons,{type:e.icon,fixed:!0})," "+e.label))})))),h("textarea",{class:"form-control",name:"content",value:n.content,placeholder:"Type a message",autofocus:!0,onkeypress:function(t){t.which!==frappe.ui.keycode.RETURN||t.shiftKey||e.onsubmit(t)}}),h("div",{class:"input-group-btn"},h(frappe.components.Button,{onclick:this.onsubmit},h(frappe.components.Unicons,{class:frappe._.is_empty(n.content)?"text-muted":"text-primary",type:"send",fixed:!0}))))))}},frappe.chat.component.ChatForm.defaultState={content:null,hints:[]},frappe.chat.component.EmojiPicker=class extends Component{render(){var e=this.props;return h("div",{class:"frappe-chat-emoji dropup "+e.class},h(frappe.components.Button,{type:"primary",class:"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.Unicons,{type:"smile-o",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-right",onclick:function(e){return e.stopPropagation()}},h("div",{class:"panel panel-default"},h(frappe.chat.component.EmojiPicker.List))))}},frappe.chat.component.EmojiPicker.List=class extends Component{render(){this.props;return h("div",{class:"list-group"})}},frappe.provide("frappe._"),frappe._.platform=function(){var e=navigator.appVersion;return e.includes("Win")?"Windows":e.includes("Mac")?"Darwin":e.includes("X11")?"UNIX":e.includes("Linux")?"Linux":void 0},frappe.provide("frappe.assets"),frappe.assets.image=function(e,t){return void 0===t&&(t="frappe"),"/assets/"+t+"/images/"+e},frappe.provide("frappe.boot"),frappe.provide("frappe.browser"),frappe.browser.Notification="Notification"in window,frappe.notify=function(e,t){frappe.log=frappe.Logger.get("frappe.notify");var n={icon:frappe.assets.image("favicon.png","frappe"),lang:frappe.boot.lang||"en"};t=Object.assign({},n,t),frappe.browser.Notification||frappe.log.error("ERROR: This browser does not support desktop notifications."),Notification.requestPermission((function(n){if("granted"===n)new Notification(e,t)}))},frappe.chat.render=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1),frappe.log.info((e?"Enable":"Disable")+" Chat for User.");var n="desk"in frappe;if(n){var a=$(".navbar .frappe-chat-dropdown");e?a.removeClass("hidden"):a.addClass("hidden")}if((!frappe.chatter||t)&&(frappe.chatter=new frappe.Chat({target:n?".frappe-chat-toggle":null}),e))if("Guest"!==frappe.session.user||n)frappe.chatter.render();else{frappe.store=frappe.Store.get("frappe.chat");var r=frappe.store.get("guest_token");frappe.log.info("Local Guest Token - "+r);var o=function(e){return new Promise((function(t){frappe.chat.room.create("Visitor",e).then((function(e){frappe.log.info("Visitor Room Created: "+e.name),frappe.chat.room.subscribe(e.name);var n=e;frappe.chat.room.history(e.name).then((function(e){return Object.assign({},n,{messages:e})})).then((function(e){t(e)}))}))}))};r?o(r).then((function(e){frappe.chatter.render({room:e})})):frappe.chat.website.token().then((function(e){frappe.log.info("Generated Guest Token - "+e),frappe.store.set("guest_token",e),o(e).then((function(e){frappe.chatter.render({room:e})}))}))}},frappe.chat.setup=function(){frappe.log=frappe.Logger.get("frappe.chat"),frappe.log.info("Setting up frappe.chat"),frappe.log.warn("TODO: frappe.chat.<object> requires a storage."),"Guest"!==frappe.session.user?(frappe.log.info("Creating a Chat Profile."),frappe.chat.profile.create("enable_chat").then((function(e){var t=e.enable_chat;if(frappe.log.info("Chat Profile created for User "+frappe.session.user+"."),"desk"in frappe&&frappe.sys_defaults){var n=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t;frappe.chat.render(n)}})),frappe.chat.profile.on.update((function(e,t){if(e===frappe.session.user&&"enable_chat"in t){frappe.log.warn("Chat Profile update (Enable Chat - "+Boolean(t.enable_chat)+")");var n=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t.enable_chat;frappe.chat.render(n)}}))):(frappe.log.info("Retrieving Chat Website Settings."),frappe.chat.website.settings(["socketio","enable","enable_from","enable_to"]).then((function(e){frappe.log.info("Chat Website Setting - "+JSON.stringify(e)),frappe.log.info("Chat Website Setting - "+(e.enable?"Enable":"Disable"));var t=e.enable;e.enable_from&&e.enable_to&&(frappe.log.info("Enabling Chat Schedule - "+e.enable_from.format()+" : "+e.enable_to.format()),t=new frappe.datetime.range(e.enable_from,e.enable_to).contains(frappe.datetime.now()));t&&(frappe.log.info("Initializing Socket.IO"),frappe.socketio.init(e.socketio.port)),frappe.chat.render(t)})))}})();
//# sourceMappingURL=chat.js.map
